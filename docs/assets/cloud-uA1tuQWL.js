import{T as Mt}from"./rsvp-ChCL7CNZ.js";import{c as zt,g as Wt}from"./animations-D9Wo9mUM.js";const yt=new Map,Xt=it=>{if(!it)return"#E25822";if(yt.has(it))return yt.get(it);const r=/^#[0-9A-F]{6}$/i.test(it)?it:"#E25822";if(yt.set(it,r),yt.size>100){const g=yt.keys().next().value;yt.delete(g)}return r},Tt=it=>it?(it.match(/([^\s]+)/g)||[]).length:0;function Ot(it){throw new Error('Could not dynamically require "'+it+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ft={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Nt;function Zt(){return Nt||(Nt=1,(function(it,k){(function(r){it.exports=r()})(function(){return(function r(g,l,n){function s(_,y){if(!l[_]){if(!g[_]){var d=typeof Ot=="function"&&Ot;if(!y&&d)return d(_,!0);if(e)return e(_,!0);var b=new Error("Cannot find module '"+_+"'");throw b.code="MODULE_NOT_FOUND",b}var c=l[_]={exports:{}};g[_][0].call(c.exports,function(m){var o=g[_][1][m];return s(o||m)},c,c.exports,r,g,l,n)}return l[_].exports}for(var e=typeof Ot=="function"&&Ot,a=0;a<n.length;a++)s(n[a]);return s})({1:[function(r,g,l){var n=r("./utils"),s=r("./support"),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";l.encode=function(a){for(var _,y,d,b,c,m,o,f=[],h=0,w=a.length,x=w,I=n.getTypeOf(a)!=="string";h<a.length;)x=w-h,d=I?(_=a[h++],y=h<w?a[h++]:0,h<w?a[h++]:0):(_=a.charCodeAt(h++),y=h<w?a.charCodeAt(h++):0,h<w?a.charCodeAt(h++):0),b=_>>2,c=(3&_)<<4|y>>4,m=1<x?(15&y)<<2|d>>6:64,o=2<x?63&d:64,f.push(e.charAt(b)+e.charAt(c)+e.charAt(m)+e.charAt(o));return f.join("")},l.decode=function(a){var _,y,d,b,c,m,o=0,f=0,h="data:";if(a.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var w,x=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===e.charAt(64)&&x--,a.charAt(a.length-2)===e.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=s.uint8array?new Uint8Array(0|x):new Array(0|x);o<a.length;)_=e.indexOf(a.charAt(o++))<<2|(b=e.indexOf(a.charAt(o++)))>>4,y=(15&b)<<4|(c=e.indexOf(a.charAt(o++)))>>2,d=(3&c)<<6|(m=e.indexOf(a.charAt(o++))),w[f++]=_,c!==64&&(w[f++]=y),m!==64&&(w[f++]=d);return w}},{"./support":30,"./utils":32}],2:[function(r,g,l){var n=r("./external"),s=r("./stream/DataWorker"),e=r("./stream/Crc32Probe"),a=r("./stream/DataLengthProbe");function _(y,d,b,c,m){this.compressedSize=y,this.uncompressedSize=d,this.crc32=b,this.compression=c,this.compressedContent=m}_.prototype={getContentWorker:function(){var y=new s(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),d=this;return y.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),y},getCompressedWorker:function(){return new s(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},_.createWorkerFrom=function(y,d,b){return y.pipe(new e).pipe(new a("uncompressedSize")).pipe(d.compressWorker(b)).pipe(new a("compressedSize")).withStreamInfo("compression",d)},g.exports=_},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,g,l){var n=r("./stream/GenericWorker");l.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},l.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,g,l){var n=r("./utils"),s=(function(){for(var e,a=[],_=0;_<256;_++){e=_;for(var y=0;y<8;y++)e=1&e?3988292384^e>>>1:e>>>1;a[_]=e}return a})();g.exports=function(e,a){return e!==void 0&&e.length?n.getTypeOf(e)!=="string"?(function(_,y,d,b){var c=s,m=b+d;_^=-1;for(var o=b;o<m;o++)_=_>>>8^c[255&(_^y[o])];return-1^_})(0|a,e,e.length,0):(function(_,y,d,b){var c=s,m=b+d;_^=-1;for(var o=b;o<m;o++)_=_>>>8^c[255&(_^y.charCodeAt(o))];return-1^_})(0|a,e,e.length,0):0}},{"./utils":32}],5:[function(r,g,l){l.base64=!1,l.binary=!1,l.dir=!1,l.createFolders=!0,l.date=null,l.compression=null,l.compressionOptions=null,l.comment=null,l.unixPermissions=null,l.dosPermissions=null},{}],6:[function(r,g,l){var n=null;n=typeof Promise<"u"?Promise:r("lie"),g.exports={Promise:n}},{lie:37}],7:[function(r,g,l){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=r("pako"),e=r("./utils"),a=r("./stream/GenericWorker"),_=n?"uint8array":"array";function y(d,b){a.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=b,this.meta={}}l.magic="\b\0",e.inherits(y,a),y.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(e.transformTo(_,d.data),!1)},y.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},y.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},y.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(b){d.push({data:b,meta:d.meta})}},l.compressWorker=function(d){return new y("Deflate",d)},l.uncompressWorker=function(){return new y("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,g,l){function n(c,m){var o,f="";for(o=0;o<m;o++)f+=String.fromCharCode(255&c),c>>>=8;return f}function s(c,m,o,f,h,w){var x,I,C=c.file,U=c.compression,B=w!==_.utf8encode,L=e.transformTo("string",w(C.name)),O=e.transformTo("string",_.utf8encode(C.name)),Z=C.comment,J=e.transformTo("string",w(Z)),v=e.transformTo("string",_.utf8encode(Z)),R=O.length!==C.name.length,i=v.length!==Z.length,D="",X="",j="",Q=C.dir,M=C.date,V={crc32:0,compressedSize:0,uncompressedSize:0};m&&!o||(V.crc32=c.crc32,V.compressedSize=c.compressedSize,V.uncompressedSize=c.uncompressedSize);var z=0;m&&(z|=8),B||!R&&!i||(z|=2048);var A=0,Y=0;Q&&(A|=16),h==="UNIX"?(Y=798,A|=(function(H,st){var lt=H;return H||(lt=st?16893:33204),(65535&lt)<<16})(C.unixPermissions,Q)):(Y=20,A|=(function(H){return 63&(H||0)})(C.dosPermissions)),x=M.getUTCHours(),x<<=6,x|=M.getUTCMinutes(),x<<=5,x|=M.getUTCSeconds()/2,I=M.getUTCFullYear()-1980,I<<=4,I|=M.getUTCMonth()+1,I<<=5,I|=M.getUTCDate(),R&&(X=n(1,1)+n(y(L),4)+O,D+="up"+n(X.length,2)+X),i&&(j=n(1,1)+n(y(J),4)+v,D+="uc"+n(j.length,2)+j);var G="";return G+=`
\0`,G+=n(z,2),G+=U.magic,G+=n(x,2),G+=n(I,2),G+=n(V.crc32,4),G+=n(V.compressedSize,4),G+=n(V.uncompressedSize,4),G+=n(L.length,2),G+=n(D.length,2),{fileRecord:d.LOCAL_FILE_HEADER+G+L+D,dirRecord:d.CENTRAL_FILE_HEADER+n(Y,2)+G+n(J.length,2)+"\0\0\0\0"+n(A,4)+n(f,4)+L+D+J}}var e=r("../utils"),a=r("../stream/GenericWorker"),_=r("../utf8"),y=r("../crc32"),d=r("../signature");function b(c,m,o,f){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=o,this.encodeFileName=f,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}e.inherits(b,a),b.prototype.push=function(c){var m=c.meta.percent||0,o=this.entriesCount,f=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,a.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:o?(m+100*(o-f-1))/o:100}}))},b.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var m=this.streamFiles&&!c.file.dir;if(m){var o=s(c,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:o.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(c){this.accumulate=!1;var m=this.streamFiles&&!c.file.dir,o=s(c,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(o.dirRecord),m)this.push({data:(function(f){return d.DATA_DESCRIPTOR+n(f.crc32,4)+n(f.compressedSize,4)+n(f.uncompressedSize,4)})(c),meta:{percent:100}});else for(this.push({data:o.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var c=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var o=this.bytesWritten-c,f=(function(h,w,x,I,C){var U=e.transformTo("string",C(I));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(h,2)+n(h,2)+n(w,4)+n(x,4)+n(U.length,2)+U})(this.dirRecords.length,o,c,this.zipComment,this.encodeFileName);this.push({data:f,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(c){this._sources.push(c);var m=this;return c.on("data",function(o){m.processChunk(o)}),c.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),c.on("error",function(o){m.error(o)}),this},b.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(c){var m=this._sources;if(!a.prototype.error.call(this,c))return!1;for(var o=0;o<m.length;o++)try{m[o].error(c)}catch{}return!0},b.prototype.lock=function(){a.prototype.lock.call(this);for(var c=this._sources,m=0;m<c.length;m++)c[m].lock()},g.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,g,l){var n=r("../compressions"),s=r("./ZipFileWorker");l.generateWorker=function(e,a,_){var y=new s(a.streamFiles,_,a.platform,a.encodeFileName),d=0;try{e.forEach(function(b,c){d++;var m=(function(w,x){var I=w||x,C=n[I];if(!C)throw new Error(I+" is not a valid compression method !");return C})(c.options.compression,a.compression),o=c.options.compressionOptions||a.compressionOptions||{},f=c.dir,h=c.date;c._compressWorker(m,o).withStreamInfo("file",{name:b,dir:f,date:h,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(y)}),y.entriesCount=d}catch(b){y.error(b)}return y}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,g,l){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new n;for(var e in this)typeof this[e]!="function"&&(s[e]=this[e]);return s}}(n.prototype=r("./object")).loadAsync=r("./load"),n.support=r("./support"),n.defaults=r("./defaults"),n.version="3.10.1",n.loadAsync=function(s,e){return new n().loadAsync(s,e)},n.external=r("./external"),g.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,g,l){var n=r("./utils"),s=r("./external"),e=r("./utf8"),a=r("./zipEntries"),_=r("./stream/Crc32Probe"),y=r("./nodejsUtils");function d(b){return new s.Promise(function(c,m){var o=b.decompressed.getContentWorker().pipe(new _);o.on("error",function(f){m(f)}).on("end",function(){o.streamInfo.crc32!==b.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}g.exports=function(b,c){var m=this;return c=n.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:e.utf8decode}),y.isNode&&y.isStream(b)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",b,!0,c.optimizedBinaryString,c.base64).then(function(o){var f=new a(c);return f.load(o),f}).then(function(o){var f=[s.Promise.resolve(o)],h=o.files;if(c.checkCRC32)for(var w=0;w<h.length;w++)f.push(d(h[w]));return s.Promise.all(f)}).then(function(o){for(var f=o.shift(),h=f.files,w=0;w<h.length;w++){var x=h[w],I=x.fileNameStr,C=n.resolve(x.fileNameStr);m.file(C,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:c.createFolders}),x.dir||(m.file(C).unsafeOriginalName=I)}return f.zipComment.length&&(m.comment=f.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,g,l){var n=r("../utils"),s=r("../stream/GenericWorker");function e(a,_){s.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(_)}n.inherits(e,s),e.prototype._bindStream=function(a){var _=this;(this._stream=a).pause(),a.on("data",function(y){_.push({data:y,meta:{percent:0}})}).on("error",function(y){_.isPaused?this.generatedError=y:_.error(y)}).on("end",function(){_.isPaused?_._upstreamEnded=!0:_.end()})},e.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},e.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},g.exports=e},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,g,l){var n=r("readable-stream").Readable;function s(e,a,_){n.call(this,a),this._helper=e;var y=this;e.on("data",function(d,b){y.push(d)||y._helper.pause(),_&&_(b)}).on("error",function(d){y.emit("error",d)}).on("end",function(){y.push(null)})}r("../utils").inherits(s,n),s.prototype._read=function(){this._helper.resume()},g.exports=s},{"../utils":32,"readable-stream":16}],14:[function(r,g,l){g.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,s);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,s)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var s=new Buffer(n);return s.fill(0),s},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(r,g,l){function n(C,U,B){var L,O=e.getTypeOf(U),Z=e.extend(B||{},y);Z.date=Z.date||new Date,Z.compression!==null&&(Z.compression=Z.compression.toUpperCase()),typeof Z.unixPermissions=="string"&&(Z.unixPermissions=parseInt(Z.unixPermissions,8)),Z.unixPermissions&&16384&Z.unixPermissions&&(Z.dir=!0),Z.dosPermissions&&16&Z.dosPermissions&&(Z.dir=!0),Z.dir&&(C=h(C)),Z.createFolders&&(L=f(C))&&w.call(this,L,!0);var J=O==="string"&&Z.binary===!1&&Z.base64===!1;B&&B.binary!==void 0||(Z.binary=!J),(U instanceof d&&U.uncompressedSize===0||Z.dir||!U||U.length===0)&&(Z.base64=!1,Z.binary=!0,U="",Z.compression="STORE",O="string");var v=null;v=U instanceof d||U instanceof a?U:m.isNode&&m.isStream(U)?new o(C,U):e.prepareContent(C,U,Z.binary,Z.optimizedBinaryString,Z.base64);var R=new b(C,v,Z);this.files[C]=R}var s=r("./utf8"),e=r("./utils"),a=r("./stream/GenericWorker"),_=r("./stream/StreamHelper"),y=r("./defaults"),d=r("./compressedObject"),b=r("./zipObject"),c=r("./generate"),m=r("./nodejsUtils"),o=r("./nodejs/NodejsStreamInputAdapter"),f=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var U=C.lastIndexOf("/");return 0<U?C.substring(0,U):""},h=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},w=function(C,U){return U=U!==void 0?U:y.createFolders,C=h(C),this.files[C]||n.call(this,C,null,{dir:!0,createFolders:U}),this.files[C]};function x(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var U,B,L;for(U in this.files)L=this.files[U],(B=U.slice(this.root.length,U.length))&&U.slice(0,this.root.length)===this.root&&C(B,L)},filter:function(C){var U=[];return this.forEach(function(B,L){C(B,L)&&U.push(L)}),U},file:function(C,U,B){if(arguments.length!==1)return C=this.root+C,n.call(this,C,U,B),this;if(x(C)){var L=C;return this.filter(function(Z,J){return!J.dir&&L.test(Z)})}var O=this.files[this.root+C];return O&&!O.dir?O:null},folder:function(C){if(!C)return this;if(x(C))return this.filter(function(O,Z){return Z.dir&&C.test(O)});var U=this.root+C,B=w.call(this,U),L=this.clone();return L.root=B.name,L},remove:function(C){C=this.root+C;var U=this.files[C];if(U||(C.slice(-1)!=="/"&&(C+="/"),U=this.files[C]),U&&!U.dir)delete this.files[C];else for(var B=this.filter(function(O,Z){return Z.name.slice(0,C.length)===C}),L=0;L<B.length;L++)delete this.files[B[L].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var U,B={};try{if((B=e.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=B.type.toLowerCase(),B.compression=B.compression.toUpperCase(),B.type==="binarystring"&&(B.type="string"),!B.type)throw new Error("No output type specified.");e.checkSupport(B.type),B.platform!=="darwin"&&B.platform!=="freebsd"&&B.platform!=="linux"&&B.platform!=="sunos"||(B.platform="UNIX"),B.platform==="win32"&&(B.platform="DOS");var L=B.comment||this.comment||"";U=c.generateWorker(this,B,L)}catch(O){(U=new a("error")).error(O)}return new _(U,B.type||"string",B.mimeType)},generateAsync:function(C,U){return this.generateInternalStream(C).accumulate(U)},generateNodeStream:function(C,U){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(U)}};g.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,g,l){g.exports=r("stream")},{stream:void 0}],17:[function(r,g,l){var n=r("./DataReader");function s(e){n.call(this,e);for(var a=0;a<this.data.length;a++)e[a]=255&e[a]}r("../utils").inherits(s,n),s.prototype.byteAt=function(e){return this.data[this.zero+e]},s.prototype.lastIndexOfSignature=function(e){for(var a=e.charCodeAt(0),_=e.charCodeAt(1),y=e.charCodeAt(2),d=e.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===a&&this.data[b+1]===_&&this.data[b+2]===y&&this.data[b+3]===d)return b-this.zero;return-1},s.prototype.readAndCheckSignature=function(e){var a=e.charCodeAt(0),_=e.charCodeAt(1),y=e.charCodeAt(2),d=e.charCodeAt(3),b=this.readData(4);return a===b[0]&&_===b[1]&&y===b[2]&&d===b[3]},s.prototype.readData=function(e){if(this.checkOffset(e),e===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,a},g.exports=s},{"../utils":32,"./DataReader":18}],18:[function(r,g,l){var n=r("../utils");function s(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var a,_=0;for(this.checkOffset(e),a=this.index+e-1;a>=this.index;a--)_=(_<<8)+this.byteAt(a);return this.index+=e,_},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},g.exports=s},{"../utils":32}],19:[function(r,g,l){var n=r("./Uint8ArrayReader");function s(e){n.call(this,e)}r("../utils").inherits(s,n),s.prototype.readData=function(e){this.checkOffset(e);var a=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,a},g.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,g,l){var n=r("./DataReader");function s(e){n.call(this,e)}r("../utils").inherits(s,n),s.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},s.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},s.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},s.prototype.readData=function(e){this.checkOffset(e);var a=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,a},g.exports=s},{"../utils":32,"./DataReader":18}],21:[function(r,g,l){var n=r("./ArrayReader");function s(e){n.call(this,e)}r("../utils").inherits(s,n),s.prototype.readData=function(e){if(this.checkOffset(e),e===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,a},g.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(r,g,l){var n=r("../utils"),s=r("../support"),e=r("./ArrayReader"),a=r("./StringReader"),_=r("./NodeBufferReader"),y=r("./Uint8ArrayReader");g.exports=function(d){var b=n.getTypeOf(d);return n.checkSupport(b),b!=="string"||s.uint8array?b==="nodebuffer"?new _(d):s.uint8array?new y(n.transformTo("uint8array",d)):new e(n.transformTo("array",d)):new a(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,g,l){l.LOCAL_FILE_HEADER="PK",l.CENTRAL_FILE_HEADER="PK",l.CENTRAL_DIRECTORY_END="PK",l.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",l.ZIP64_CENTRAL_DIRECTORY_END="PK",l.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,g,l){var n=r("./GenericWorker"),s=r("../utils");function e(a){n.call(this,"ConvertWorker to "+a),this.destType=a}s.inherits(e,n),e.prototype.processChunk=function(a){this.push({data:s.transformTo(this.destType,a.data),meta:a.meta})},g.exports=e},{"../utils":32,"./GenericWorker":28}],25:[function(r,g,l){var n=r("./GenericWorker"),s=r("../crc32");function e(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(e,n),e.prototype.processChunk=function(a){this.streamInfo.crc32=s(a.data,this.streamInfo.crc32||0),this.push(a)},g.exports=e},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,g,l){var n=r("../utils"),s=r("./GenericWorker");function e(a){s.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}n.inherits(e,s),e.prototype.processChunk=function(a){if(a){var _=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=_+a.data.length}s.prototype.processChunk.call(this,a)},g.exports=e},{"../utils":32,"./GenericWorker":28}],27:[function(r,g,l){var n=r("../utils"),s=r("./GenericWorker");function e(a){s.call(this,"DataWorker");var _=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(y){_.dataIsReady=!0,_.data=y,_.max=y&&y.length||0,_.type=n.getTypeOf(y),_.isPaused||_._tickAndRepeat()},function(y){_.error(y)})}n.inherits(e,s),e.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},e.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},e.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},e.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,_=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,_);break;case"uint8array":a=this.data.subarray(this.index,_);break;case"array":case"nodebuffer":a=this.data.slice(this.index,_)}return this.index=_,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},g.exports=e},{"../utils":32,"./GenericWorker":28}],28:[function(r,g,l){function n(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,e){return this._listeners[s].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,e){if(this._listeners[s])for(var a=0;a<this._listeners[s].length;a++)this._listeners[s][a].call(this,e)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var e=this;return s.on("data",function(a){e.processChunk(a)}),s.on("end",function(){e.end()}),s.on("error",function(a){e.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,e){return this.extraStreamInfo[s]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},g.exports=n},{}],29:[function(r,g,l){var n=r("../utils"),s=r("./ConvertWorker"),e=r("./GenericWorker"),a=r("../base64"),_=r("../support"),y=r("../external"),d=null;if(_.nodestream)try{d=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(m,o){return new y.Promise(function(f,h){var w=[],x=m._internalType,I=m._outputType,C=m._mimeType;m.on("data",function(U,B){w.push(U),o&&o(B)}).on("error",function(U){w=[],h(U)}).on("end",function(){try{var U=(function(B,L,O){switch(B){case"blob":return n.newBlob(n.transformTo("arraybuffer",L),O);case"base64":return a.encode(L);default:return n.transformTo(B,L)}})(I,(function(B,L){var O,Z=0,J=null,v=0;for(O=0;O<L.length;O++)v+=L[O].length;switch(B){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for(J=new Uint8Array(v),O=0;O<L.length;O++)J.set(L[O],Z),Z+=L[O].length;return J;case"nodebuffer":return Buffer.concat(L);default:throw new Error("concat : unsupported type '"+B+"'")}})(x,w),C);f(U)}catch(B){h(B)}w=[]}).resume()})}function c(m,o,f){var h=o;switch(o){case"blob":case"arraybuffer":h="uint8array";break;case"base64":h="string"}try{this._internalType=h,this._outputType=o,this._mimeType=f,n.checkSupport(h),this._worker=m.pipe(new s(h)),m.lock()}catch(w){this._worker=new e("error"),this._worker.error(w)}}c.prototype={accumulate:function(m){return b(this,m)},on:function(m,o){var f=this;return m==="data"?this._worker.on(m,function(h){o.call(f,h.data,h.meta)}):this._worker.on(m,function(){n.delay(o,arguments,f)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},g.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,g,l){if(l.base64=!0,l.array=!0,l.string=!0,l.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",l.nodebuffer=typeof Buffer<"u",l.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")l.blob=!1;else{var n=new ArrayBuffer(0);try{l.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(n),l.blob=s.getBlob("application/zip").size===0}catch{l.blob=!1}}}try{l.nodestream=!!r("readable-stream").Readable}catch{l.nodestream=!1}},{"readable-stream":16}],31:[function(r,g,l){for(var n=r("./utils"),s=r("./support"),e=r("./nodejsUtils"),a=r("./stream/GenericWorker"),_=new Array(256),y=0;y<256;y++)_[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;_[254]=_[254]=1;function d(){a.call(this,"utf-8 decode"),this.leftOver=null}function b(){a.call(this,"utf-8 encode")}l.utf8encode=function(c){return s.nodebuffer?e.newBufferFrom(c,"utf-8"):(function(m){var o,f,h,w,x,I=m.length,C=0;for(w=0;w<I;w++)(64512&(f=m.charCodeAt(w)))==55296&&w+1<I&&(64512&(h=m.charCodeAt(w+1)))==56320&&(f=65536+(f-55296<<10)+(h-56320),w++),C+=f<128?1:f<2048?2:f<65536?3:4;for(o=s.uint8array?new Uint8Array(C):new Array(C),w=x=0;x<C;w++)(64512&(f=m.charCodeAt(w)))==55296&&w+1<I&&(64512&(h=m.charCodeAt(w+1)))==56320&&(f=65536+(f-55296<<10)+(h-56320),w++),f<128?o[x++]=f:(f<2048?o[x++]=192|f>>>6:(f<65536?o[x++]=224|f>>>12:(o[x++]=240|f>>>18,o[x++]=128|f>>>12&63),o[x++]=128|f>>>6&63),o[x++]=128|63&f);return o})(c)},l.utf8decode=function(c){return s.nodebuffer?n.transformTo("nodebuffer",c).toString("utf-8"):(function(m){var o,f,h,w,x=m.length,I=new Array(2*x);for(o=f=0;o<x;)if((h=m[o++])<128)I[f++]=h;else if(4<(w=_[h]))I[f++]=65533,o+=w-1;else{for(h&=w===2?31:w===3?15:7;1<w&&o<x;)h=h<<6|63&m[o++],w--;1<w?I[f++]=65533:h<65536?I[f++]=h:(h-=65536,I[f++]=55296|h>>10&1023,I[f++]=56320|1023&h)}return I.length!==f&&(I.subarray?I=I.subarray(0,f):I.length=f),n.applyFromCharCode(I)})(c=n.transformTo(s.uint8array?"uint8array":"array",c))},n.inherits(d,a),d.prototype.processChunk=function(c){var m=n.transformTo(s.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var o=m;(m=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),m.set(o,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var f=(function(w,x){var I;for((x=x||w.length)>w.length&&(x=w.length),I=x-1;0<=I&&(192&w[I])==128;)I--;return I<0||I===0?x:I+_[w[I]]>x?I:x})(m),h=m;f!==m.length&&(s.uint8array?(h=m.subarray(0,f),this.leftOver=m.subarray(f,m.length)):(h=m.slice(0,f),this.leftOver=m.slice(f,m.length))),this.push({data:l.utf8decode(h),meta:c.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:l.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},l.Utf8DecodeWorker=d,n.inherits(b,a),b.prototype.processChunk=function(c){this.push({data:l.utf8encode(c.data),meta:c.meta})},l.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,g,l){var n=r("./support"),s=r("./base64"),e=r("./nodejsUtils"),a=r("./external");function _(o){return o}function y(o,f){for(var h=0;h<o.length;++h)f[h]=255&o.charCodeAt(h);return f}r("setimmediate"),l.newBlob=function(o,f){l.checkSupport("blob");try{return new Blob([o],{type:f})}catch{try{var h=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return h.append(o),h.getBlob(f)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(o,f,h){var w=[],x=0,I=o.length;if(I<=h)return String.fromCharCode.apply(null,o);for(;x<I;)f==="array"||f==="nodebuffer"?w.push(String.fromCharCode.apply(null,o.slice(x,Math.min(x+h,I)))):w.push(String.fromCharCode.apply(null,o.subarray(x,Math.min(x+h,I)))),x+=h;return w.join("")},stringifyByChar:function(o){for(var f="",h=0;h<o.length;h++)f+=String.fromCharCode(o[h]);return f},applyCanBeUsed:{uint8array:(function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,e.allocBuffer(1)).length===1}catch{return!1}})()}};function b(o){var f=65536,h=l.getTypeOf(o),w=!0;if(h==="uint8array"?w=d.applyCanBeUsed.uint8array:h==="nodebuffer"&&(w=d.applyCanBeUsed.nodebuffer),w)for(;1<f;)try{return d.stringifyByChunk(o,h,f)}catch{f=Math.floor(f/2)}return d.stringifyByChar(o)}function c(o,f){for(var h=0;h<o.length;h++)f[h]=o[h];return f}l.applyFromCharCode=b;var m={};m.string={string:_,array:function(o){return y(o,new Array(o.length))},arraybuffer:function(o){return m.string.uint8array(o).buffer},uint8array:function(o){return y(o,new Uint8Array(o.length))},nodebuffer:function(o){return y(o,e.allocBuffer(o.length))}},m.array={string:b,array:_,arraybuffer:function(o){return new Uint8Array(o).buffer},uint8array:function(o){return new Uint8Array(o)},nodebuffer:function(o){return e.newBufferFrom(o)}},m.arraybuffer={string:function(o){return b(new Uint8Array(o))},array:function(o){return c(new Uint8Array(o),new Array(o.byteLength))},arraybuffer:_,uint8array:function(o){return new Uint8Array(o)},nodebuffer:function(o){return e.newBufferFrom(new Uint8Array(o))}},m.uint8array={string:b,array:function(o){return c(o,new Array(o.length))},arraybuffer:function(o){return o.buffer},uint8array:_,nodebuffer:function(o){return e.newBufferFrom(o)}},m.nodebuffer={string:b,array:function(o){return c(o,new Array(o.length))},arraybuffer:function(o){return m.nodebuffer.uint8array(o).buffer},uint8array:function(o){return c(o,new Uint8Array(o.length))},nodebuffer:_},l.transformTo=function(o,f){if(f=f||"",!o)return f;l.checkSupport(o);var h=l.getTypeOf(f);return m[h][o](f)},l.resolve=function(o){for(var f=o.split("/"),h=[],w=0;w<f.length;w++){var x=f[w];x==="."||x===""&&w!==0&&w!==f.length-1||(x===".."?h.pop():h.push(x))}return h.join("/")},l.getTypeOf=function(o){return typeof o=="string"?"string":Object.prototype.toString.call(o)==="[object Array]"?"array":n.nodebuffer&&e.isBuffer(o)?"nodebuffer":n.uint8array&&o instanceof Uint8Array?"uint8array":n.arraybuffer&&o instanceof ArrayBuffer?"arraybuffer":void 0},l.checkSupport=function(o){if(!n[o.toLowerCase()])throw new Error(o+" is not supported by this platform")},l.MAX_VALUE_16BITS=65535,l.MAX_VALUE_32BITS=-1,l.pretty=function(o){var f,h,w="";for(h=0;h<(o||"").length;h++)w+="\\x"+((f=o.charCodeAt(h))<16?"0":"")+f.toString(16).toUpperCase();return w},l.delay=function(o,f,h){setImmediate(function(){o.apply(h||null,f||[])})},l.inherits=function(o,f){function h(){}h.prototype=f.prototype,o.prototype=new h},l.extend=function(){var o,f,h={};for(o=0;o<arguments.length;o++)for(f in arguments[o])Object.prototype.hasOwnProperty.call(arguments[o],f)&&h[f]===void 0&&(h[f]=arguments[o][f]);return h},l.prepareContent=function(o,f,h,w,x){return a.Promise.resolve(f).then(function(I){return n.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new a.Promise(function(C,U){var B=new FileReader;B.onload=function(L){C(L.target.result)},B.onerror=function(L){U(L.target.error)},B.readAsArrayBuffer(I)}):I}).then(function(I){var C=l.getTypeOf(I);return C?(C==="arraybuffer"?I=l.transformTo("uint8array",I):C==="string"&&(x?I=s.decode(I):h&&w!==!0&&(I=(function(U){return y(U,n.uint8array?new Uint8Array(U.length):new Array(U.length))})(I))),I):a.Promise.reject(new Error("Can't read the data of '"+o+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,g,l){var n=r("./reader/readerFor"),s=r("./utils"),e=r("./signature"),a=r("./zipEntry"),_=r("./support");function y(d){this.files=[],this.loadOptions=d}y.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(b)+", expected "+s.pretty(d)+")")}},isSignature:function(d,b){var c=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===b;return this.reader.setIndex(c),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),b=_.uint8array?"uint8array":"array",c=s.transformTo(b,d);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,b,c,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[d]={id:d,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,b;for(d=0;d<this.files.length;d++)b=this.files[d],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(e.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(e.CENTRAL_FILE_HEADER);)(d=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(e.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,e.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var b=d;if(this.checkSignature(e.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(e.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(e.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,e.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(e.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(e.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var c=this.centralDirOffset+this.centralDirSize;this.zip64&&(c+=20,c+=12+this.zip64EndOfCentralSize);var m=b-c;if(0<m)this.isSignature(b,e.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=n(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},g.exports=y},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,g,l){var n=r("./reader/readerFor"),s=r("./utils"),e=r("./compressedObject"),a=r("./crc32"),_=r("./utf8"),y=r("./compressions"),d=r("./support");function b(c,m){this.options=c,this.loadOptions=m}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(c){var m,o;if(c.skip(22),this.fileNameLength=c.readInt(2),o=c.readInt(2),this.fileName=c.readData(this.fileNameLength),c.skip(o),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=(function(f){for(var h in y)if(Object.prototype.hasOwnProperty.call(y,h)&&y[h].magic===f)return y[h];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new e(this.compressedSize,this.uncompressedSize,this.crc32,m,c.readData(this.compressedSize))},readCentralPart:function(c){this.versionMadeBy=c.readInt(2),c.skip(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4);var m=c.readInt(2);if(this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");c.skip(m),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var c=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),c==0&&(this.dosPermissions=63&this.externalFileAttributes),c==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=n(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(c){var m,o,f,h=c.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});c.index+4<h;)m=c.readInt(2),o=c.readInt(2),f=c.readData(o),this.extraFields[m]={id:m,length:o,value:f};c.setIndex(h)},handleUTF8:function(){var c=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=_.utf8decode(this.fileName),this.fileCommentStr=_.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var o=s.transformTo(c,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(o)}var f=this.findExtraFieldUnicodeComment();if(f!==null)this.fileCommentStr=f;else{var h=s.transformTo(c,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(h)}}},findExtraFieldUnicodePath:function(){var c=this.extraFields[28789];if(c){var m=n(c.value);return m.readInt(1)!==1||a(this.fileName)!==m.readInt(4)?null:_.utf8decode(m.readData(c.length-5))}return null},findExtraFieldUnicodeComment:function(){var c=this.extraFields[25461];if(c){var m=n(c.value);return m.readInt(1)!==1||a(this.fileComment)!==m.readInt(4)?null:_.utf8decode(m.readData(c.length-5))}return null}},g.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,g,l){function n(m,o,f){this.name=m,this.dir=f.dir,this.date=f.date,this.comment=f.comment,this.unixPermissions=f.unixPermissions,this.dosPermissions=f.dosPermissions,this._data=o,this._dataBinary=f.binary,this.options={compression:f.compression,compressionOptions:f.compressionOptions}}var s=r("./stream/StreamHelper"),e=r("./stream/DataWorker"),a=r("./utf8"),_=r("./compressedObject"),y=r("./stream/GenericWorker");n.prototype={internalStream:function(m){var o=null,f="string";try{if(!m)throw new Error("No output type specified.");var h=(f=m.toLowerCase())==="string"||f==="text";f!=="binarystring"&&f!=="text"||(f="string"),o=this._decompressWorker();var w=!this._dataBinary;w&&!h&&(o=o.pipe(new a.Utf8EncodeWorker)),!w&&h&&(o=o.pipe(new a.Utf8DecodeWorker))}catch(x){(o=new y("error")).error(x)}return new s(o,f,"")},async:function(m,o){return this.internalStream(m).accumulate(o)},nodeStream:function(m,o){return this.internalStream(m||"nodebuffer").toNodejsStream(o)},_compressWorker:function(m,o){if(this._data instanceof _&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var f=this._decompressWorker();return this._dataBinary||(f=f.pipe(new a.Utf8EncodeWorker)),_.createWorkerFrom(f,m,o)},_decompressWorker:function(){return this._data instanceof _?this._data.getContentWorker():this._data instanceof y?this._data:new e(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<d.length;c++)n.prototype[d[c]]=b;g.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,g,l){(function(n){var s,e,a=n.MutationObserver||n.WebKitMutationObserver;if(a){var _=0,y=new a(m),d=n.document.createTextNode("");y.observe(d,{characterData:!0}),s=function(){d.data=_=++_%2}}else if(n.setImmediate||n.MessageChannel===void 0)s="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var o=n.document.createElement("script");o.onreadystatechange=function(){m(),o.onreadystatechange=null,o.parentNode.removeChild(o),o=null},n.document.documentElement.appendChild(o)}:function(){setTimeout(m,0)};else{var b=new n.MessageChannel;b.port1.onmessage=m,s=function(){b.port2.postMessage(0)}}var c=[];function m(){var o,f;e=!0;for(var h=c.length;h;){for(f=c,c=[],o=-1;++o<h;)f[o]();h=c.length}e=!1}g.exports=function(o){c.push(o)!==1||e||s()}}).call(this,typeof zt<"u"?zt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,g,l){var n=r("immediate");function s(){}var e={},a=["REJECTED"],_=["FULFILLED"],y=["PENDING"];function d(h){if(typeof h!="function")throw new TypeError("resolver must be a function");this.state=y,this.queue=[],this.outcome=void 0,h!==s&&o(this,h)}function b(h,w,x){this.promise=h,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}function c(h,w,x){n(function(){var I;try{I=w(x)}catch(C){return e.reject(h,C)}I===h?e.reject(h,new TypeError("Cannot resolve promise with itself")):e.resolve(h,I)})}function m(h){var w=h&&h.then;if(h&&(typeof h=="object"||typeof h=="function")&&typeof w=="function")return function(){w.apply(h,arguments)}}function o(h,w){var x=!1;function I(B){x||(x=!0,e.reject(h,B))}function C(B){x||(x=!0,e.resolve(h,B))}var U=f(function(){w(C,I)});U.status==="error"&&I(U.value)}function f(h,w){var x={};try{x.value=h(w),x.status="success"}catch(I){x.status="error",x.value=I}return x}(g.exports=d).prototype.finally=function(h){if(typeof h!="function")return this;var w=this.constructor;return this.then(function(x){return w.resolve(h()).then(function(){return x})},function(x){return w.resolve(h()).then(function(){throw x})})},d.prototype.catch=function(h){return this.then(null,h)},d.prototype.then=function(h,w){if(typeof h!="function"&&this.state===_||typeof w!="function"&&this.state===a)return this;var x=new this.constructor(s);return this.state!==y?c(x,this.state===_?h:w,this.outcome):this.queue.push(new b(x,h,w)),x},b.prototype.callFulfilled=function(h){e.resolve(this.promise,h)},b.prototype.otherCallFulfilled=function(h){c(this.promise,this.onFulfilled,h)},b.prototype.callRejected=function(h){e.reject(this.promise,h)},b.prototype.otherCallRejected=function(h){c(this.promise,this.onRejected,h)},e.resolve=function(h,w){var x=f(m,w);if(x.status==="error")return e.reject(h,x.value);var I=x.value;if(I)o(h,I);else{h.state=_,h.outcome=w;for(var C=-1,U=h.queue.length;++C<U;)h.queue[C].callFulfilled(w)}return h},e.reject=function(h,w){h.state=a,h.outcome=w;for(var x=-1,I=h.queue.length;++x<I;)h.queue[x].callRejected(w);return h},d.resolve=function(h){return h instanceof this?h:e.resolve(new this(s),h)},d.reject=function(h){var w=new this(s);return e.reject(w,h)},d.all=function(h){var w=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=h.length,I=!1;if(!x)return this.resolve([]);for(var C=new Array(x),U=0,B=-1,L=new this(s);++B<x;)O(h[B],B);return L;function O(Z,J){w.resolve(Z).then(function(v){C[J]=v,++U!==x||I||(I=!0,e.resolve(L,C))},function(v){I||(I=!0,e.reject(L,v))})}},d.race=function(h){var w=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=h.length,I=!1;if(!x)return this.resolve([]);for(var C=-1,U=new this(s);++C<x;)B=h[C],w.resolve(B).then(function(L){I||(I=!0,e.resolve(U,L))},function(L){I||(I=!0,e.reject(U,L))});var B;return U}},{immediate:36}],38:[function(r,g,l){var n={};(0,r("./lib/utils/common").assign)(n,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),g.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,g,l){var n=r("./zlib/deflate"),s=r("./utils/common"),e=r("./utils/strings"),a=r("./zlib/messages"),_=r("./zlib/zstream"),y=Object.prototype.toString,d=0,b=-1,c=0,m=8;function o(h){if(!(this instanceof o))return new o(h);this.options=s.assign({level:b,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},h||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _,this.strm.avail_out=0;var x=n.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(x!==d)throw new Error(a[x]);if(w.header&&n.deflateSetHeader(this.strm,w.header),w.dictionary){var I;if(I=typeof w.dictionary=="string"?e.string2buf(w.dictionary):y.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(x=n.deflateSetDictionary(this.strm,I))!==d)throw new Error(a[x]);this._dict_set=!0}}function f(h,w){var x=new o(w);if(x.push(h,!0),x.err)throw x.msg||a[x.err];return x.result}o.prototype.push=function(h,w){var x,I,C=this.strm,U=this.options.chunkSize;if(this.ended)return!1;I=w===~~w?w:w===!0?4:0,typeof h=="string"?C.input=e.string2buf(h):y.call(h)==="[object ArrayBuffer]"?C.input=new Uint8Array(h):C.input=h,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new s.Buf8(U),C.next_out=0,C.avail_out=U),(x=n.deflate(C,I))!==1&&x!==d)return this.onEnd(x),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(e.buf2binstring(s.shrinkBuf(C.output,C.next_out))):this.onData(s.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&x!==1);return I===4?(x=n.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===d):I!==2||(this.onEnd(d),!(C.avail_out=0))},o.prototype.onData=function(h){this.chunks.push(h)},o.prototype.onEnd=function(h){h===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},l.Deflate=o,l.deflate=f,l.deflateRaw=function(h,w){return(w=w||{}).raw=!0,f(h,w)},l.gzip=function(h,w){return(w=w||{}).gzip=!0,f(h,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,g,l){var n=r("./zlib/inflate"),s=r("./utils/common"),e=r("./utils/strings"),a=r("./zlib/constants"),_=r("./zlib/messages"),y=r("./zlib/zstream"),d=r("./zlib/gzheader"),b=Object.prototype.toString;function c(o){if(!(this instanceof c))return new c(o);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},o||{});var f=this.options;f.raw&&0<=f.windowBits&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),!(0<=f.windowBits&&f.windowBits<16)||o&&o.windowBits||(f.windowBits+=32),15<f.windowBits&&f.windowBits<48&&(15&f.windowBits)==0&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var h=n.inflateInit2(this.strm,f.windowBits);if(h!==a.Z_OK)throw new Error(_[h]);this.header=new d,n.inflateGetHeader(this.strm,this.header)}function m(o,f){var h=new c(f);if(h.push(o,!0),h.err)throw h.msg||_[h.err];return h.result}c.prototype.push=function(o,f){var h,w,x,I,C,U,B=this.strm,L=this.options.chunkSize,O=this.options.dictionary,Z=!1;if(this.ended)return!1;w=f===~~f?f:f===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof o=="string"?B.input=e.binstring2buf(o):b.call(o)==="[object ArrayBuffer]"?B.input=new Uint8Array(o):B.input=o,B.next_in=0,B.avail_in=B.input.length;do{if(B.avail_out===0&&(B.output=new s.Buf8(L),B.next_out=0,B.avail_out=L),(h=n.inflate(B,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&O&&(U=typeof O=="string"?e.string2buf(O):b.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,h=n.inflateSetDictionary(this.strm,U)),h===a.Z_BUF_ERROR&&Z===!0&&(h=a.Z_OK,Z=!1),h!==a.Z_STREAM_END&&h!==a.Z_OK)return this.onEnd(h),!(this.ended=!0);B.next_out&&(B.avail_out!==0&&h!==a.Z_STREAM_END&&(B.avail_in!==0||w!==a.Z_FINISH&&w!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=e.utf8border(B.output,B.next_out),I=B.next_out-x,C=e.buf2string(B.output,x),B.next_out=I,B.avail_out=L-I,I&&s.arraySet(B.output,B.output,x,I,0),this.onData(C)):this.onData(s.shrinkBuf(B.output,B.next_out)))),B.avail_in===0&&B.avail_out===0&&(Z=!0)}while((0<B.avail_in||B.avail_out===0)&&h!==a.Z_STREAM_END);return h===a.Z_STREAM_END&&(w=a.Z_FINISH),w===a.Z_FINISH?(h=n.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===a.Z_OK):w!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(B.avail_out=0))},c.prototype.onData=function(o){this.chunks.push(o)},c.prototype.onEnd=function(o){o===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg},l.Inflate=c,l.inflate=m,l.inflateRaw=function(o,f){return(f=f||{}).raw=!0,m(o,f)},l.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,g,l){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";l.assign=function(a){for(var _=Array.prototype.slice.call(arguments,1);_.length;){var y=_.shift();if(y){if(typeof y!="object")throw new TypeError(y+"must be non-object");for(var d in y)y.hasOwnProperty(d)&&(a[d]=y[d])}}return a},l.shrinkBuf=function(a,_){return a.length===_?a:a.subarray?a.subarray(0,_):(a.length=_,a)};var s={arraySet:function(a,_,y,d,b){if(_.subarray&&a.subarray)a.set(_.subarray(y,y+d),b);else for(var c=0;c<d;c++)a[b+c]=_[y+c]},flattenChunks:function(a){var _,y,d,b,c,m;for(_=d=0,y=a.length;_<y;_++)d+=a[_].length;for(m=new Uint8Array(d),_=b=0,y=a.length;_<y;_++)c=a[_],m.set(c,b),b+=c.length;return m}},e={arraySet:function(a,_,y,d,b){for(var c=0;c<d;c++)a[b+c]=_[y+c]},flattenChunks:function(a){return[].concat.apply([],a)}};l.setTyped=function(a){a?(l.Buf8=Uint8Array,l.Buf16=Uint16Array,l.Buf32=Int32Array,l.assign(l,s)):(l.Buf8=Array,l.Buf16=Array,l.Buf32=Array,l.assign(l,e))},l.setTyped(n)},{}],42:[function(r,g,l){var n=r("./common"),s=!0,e=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{e=!1}for(var a=new n.Buf8(256),_=0;_<256;_++)a[_]=252<=_?6:248<=_?5:240<=_?4:224<=_?3:192<=_?2:1;function y(d,b){if(b<65537&&(d.subarray&&e||!d.subarray&&s))return String.fromCharCode.apply(null,n.shrinkBuf(d,b));for(var c="",m=0;m<b;m++)c+=String.fromCharCode(d[m]);return c}a[254]=a[254]=1,l.string2buf=function(d){var b,c,m,o,f,h=d.length,w=0;for(o=0;o<h;o++)(64512&(c=d.charCodeAt(o)))==55296&&o+1<h&&(64512&(m=d.charCodeAt(o+1)))==56320&&(c=65536+(c-55296<<10)+(m-56320),o++),w+=c<128?1:c<2048?2:c<65536?3:4;for(b=new n.Buf8(w),o=f=0;f<w;o++)(64512&(c=d.charCodeAt(o)))==55296&&o+1<h&&(64512&(m=d.charCodeAt(o+1)))==56320&&(c=65536+(c-55296<<10)+(m-56320),o++),c<128?b[f++]=c:(c<2048?b[f++]=192|c>>>6:(c<65536?b[f++]=224|c>>>12:(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63),b[f++]=128|c>>>6&63),b[f++]=128|63&c);return b},l.buf2binstring=function(d){return y(d,d.length)},l.binstring2buf=function(d){for(var b=new n.Buf8(d.length),c=0,m=b.length;c<m;c++)b[c]=d.charCodeAt(c);return b},l.buf2string=function(d,b){var c,m,o,f,h=b||d.length,w=new Array(2*h);for(c=m=0;c<h;)if((o=d[c++])<128)w[m++]=o;else if(4<(f=a[o]))w[m++]=65533,c+=f-1;else{for(o&=f===2?31:f===3?15:7;1<f&&c<h;)o=o<<6|63&d[c++],f--;1<f?w[m++]=65533:o<65536?w[m++]=o:(o-=65536,w[m++]=55296|o>>10&1023,w[m++]=56320|1023&o)}return y(w,m)},l.utf8border=function(d,b){var c;for((b=b||d.length)>d.length&&(b=d.length),c=b-1;0<=c&&(192&d[c])==128;)c--;return c<0||c===0?b:c+a[d[c]]>b?c:b}},{"./common":41}],43:[function(r,g,l){g.exports=function(n,s,e,a){for(var _=65535&n|0,y=n>>>16&65535|0,d=0;e!==0;){for(e-=d=2e3<e?2e3:e;y=y+(_=_+s[a++]|0)|0,--d;);_%=65521,y%=65521}return _|y<<16|0}},{}],44:[function(r,g,l){g.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,g,l){var n=(function(){for(var s,e=[],a=0;a<256;a++){s=a;for(var _=0;_<8;_++)s=1&s?3988292384^s>>>1:s>>>1;e[a]=s}return e})();g.exports=function(s,e,a,_){var y=n,d=_+a;s^=-1;for(var b=_;b<d;b++)s=s>>>8^y[255&(s^e[b])];return-1^s}},{}],46:[function(r,g,l){var n,s=r("../utils/common"),e=r("./trees"),a=r("./adler32"),_=r("./crc32"),y=r("./messages"),d=0,b=4,c=0,m=-2,o=-1,f=4,h=2,w=8,x=9,I=286,C=30,U=19,B=2*I+1,L=15,O=3,Z=258,J=Z+O+1,v=42,R=113,i=1,D=2,X=3,j=4;function Q(t,F){return t.msg=y[F],F}function M(t){return(t<<1)-(4<t?9:0)}function V(t){for(var F=t.length;0<=--F;)t[F]=0}function z(t){var F=t.state,T=F.pending;T>t.avail_out&&(T=t.avail_out),T!==0&&(s.arraySet(t.output,F.pending_buf,F.pending_out,T,t.next_out),t.next_out+=T,F.pending_out+=T,t.total_out+=T,t.avail_out-=T,F.pending-=T,F.pending===0&&(F.pending_out=0))}function A(t,F){e._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,F),t.block_start=t.strstart,z(t.strm)}function Y(t,F){t.pending_buf[t.pending++]=F}function G(t,F){t.pending_buf[t.pending++]=F>>>8&255,t.pending_buf[t.pending++]=255&F}function H(t,F){var T,p,u=t.max_chain_length,S=t.strstart,N=t.prev_length,P=t.nice_match,E=t.strstart>t.w_size-J?t.strstart-(t.w_size-J):0,W=t.window,q=t.w_mask,$=t.prev,K=t.strstart+Z,nt=W[S+N-1],et=W[S+N];t.prev_length>=t.good_match&&(u>>=2),P>t.lookahead&&(P=t.lookahead);do if(W[(T=F)+N]===et&&W[T+N-1]===nt&&W[T]===W[S]&&W[++T]===W[S+1]){S+=2,T++;do;while(W[++S]===W[++T]&&W[++S]===W[++T]&&W[++S]===W[++T]&&W[++S]===W[++T]&&W[++S]===W[++T]&&W[++S]===W[++T]&&W[++S]===W[++T]&&W[++S]===W[++T]&&S<K);if(p=Z-(K-S),S=K-Z,N<p){if(t.match_start=F,P<=(N=p))break;nt=W[S+N-1],et=W[S+N]}}while((F=$[F&q])>E&&--u!=0);return N<=t.lookahead?N:t.lookahead}function st(t){var F,T,p,u,S,N,P,E,W,q,$=t.w_size;do{if(u=t.window_size-t.lookahead-t.strstart,t.strstart>=$+($-J)){for(s.arraySet(t.window,t.window,$,$,0),t.match_start-=$,t.strstart-=$,t.block_start-=$,F=T=t.hash_size;p=t.head[--F],t.head[F]=$<=p?p-$:0,--T;);for(F=T=$;p=t.prev[--F],t.prev[F]=$<=p?p-$:0,--T;);u+=$}if(t.strm.avail_in===0)break;if(N=t.strm,P=t.window,E=t.strstart+t.lookahead,W=u,q=void 0,q=N.avail_in,W<q&&(q=W),T=q===0?0:(N.avail_in-=q,s.arraySet(P,N.input,N.next_in,q,E),N.state.wrap===1?N.adler=a(N.adler,P,q,E):N.state.wrap===2&&(N.adler=_(N.adler,P,q,E)),N.next_in+=q,N.total_in+=q,q),t.lookahead+=T,t.lookahead+t.insert>=O)for(S=t.strstart-t.insert,t.ins_h=t.window[S],t.ins_h=(t.ins_h<<t.hash_shift^t.window[S+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[S+O-1])&t.hash_mask,t.prev[S&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=S,S++,t.insert--,!(t.lookahead+t.insert<O)););}while(t.lookahead<J&&t.strm.avail_in!==0)}function lt(t,F){for(var T,p;;){if(t.lookahead<J){if(st(t),t.lookahead<J&&F===d)return i;if(t.lookahead===0)break}if(T=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,T=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),T!==0&&t.strstart-T<=t.w_size-J&&(t.match_length=H(t,T)),t.match_length>=O)if(p=e._tr_tally(t,t.strstart-t.match_start,t.match_length-O),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=O){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,T=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,--t.match_length!=0;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else p=e._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(p&&(A(t,!1),t.strm.avail_out===0))return i}return t.insert=t.strstart<O-1?t.strstart:O-1,F===b?(A(t,!0),t.strm.avail_out===0?X:j):t.last_lit&&(A(t,!1),t.strm.avail_out===0)?i:D}function tt(t,F){for(var T,p,u;;){if(t.lookahead<J){if(st(t),t.lookahead<J&&F===d)return i;if(t.lookahead===0)break}if(T=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,T=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=O-1,T!==0&&t.prev_length<t.max_lazy_match&&t.strstart-T<=t.w_size-J&&(t.match_length=H(t,T),t.match_length<=5&&(t.strategy===1||t.match_length===O&&4096<t.strstart-t.match_start)&&(t.match_length=O-1)),t.prev_length>=O&&t.match_length<=t.prev_length){for(u=t.strstart+t.lookahead-O,p=e._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-O),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=u&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,T=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),--t.prev_length!=0;);if(t.match_available=0,t.match_length=O-1,t.strstart++,p&&(A(t,!1),t.strm.avail_out===0))return i}else if(t.match_available){if((p=e._tr_tally(t,0,t.window[t.strstart-1]))&&A(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return i}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(p=e._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<O-1?t.strstart:O-1,F===b?(A(t,!0),t.strm.avail_out===0?X:j):t.last_lit&&(A(t,!1),t.strm.avail_out===0)?i:D}function rt(t,F,T,p,u){this.good_length=t,this.max_lazy=F,this.nice_length=T,this.max_chain=p,this.func=u}function ct(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*B),this.dyn_dtree=new s.Buf16(2*(2*C+1)),this.bl_tree=new s.Buf16(2*(2*U+1)),V(this.dyn_ltree),V(this.dyn_dtree),V(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(L+1),this.heap=new s.Buf16(2*I+1),V(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*I+1),V(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function at(t){var F;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=h,(F=t.state).pending=0,F.pending_out=0,F.wrap<0&&(F.wrap=-F.wrap),F.status=F.wrap?v:R,t.adler=F.wrap===2?0:1,F.last_flush=d,e._tr_init(F),c):Q(t,m)}function dt(t){var F=at(t);return F===c&&(function(T){T.window_size=2*T.w_size,V(T.head),T.max_lazy_match=n[T.level].max_lazy,T.good_match=n[T.level].good_length,T.nice_match=n[T.level].nice_length,T.max_chain_length=n[T.level].max_chain,T.strstart=0,T.block_start=0,T.lookahead=0,T.insert=0,T.match_length=T.prev_length=O-1,T.match_available=0,T.ins_h=0})(t.state),F}function ut(t,F,T,p,u,S){if(!t)return m;var N=1;if(F===o&&(F=6),p<0?(N=0,p=-p):15<p&&(N=2,p-=16),u<1||x<u||T!==w||p<8||15<p||F<0||9<F||S<0||f<S)return Q(t,m);p===8&&(p=9);var P=new ct;return(t.state=P).strm=t,P.wrap=N,P.gzhead=null,P.w_bits=p,P.w_size=1<<P.w_bits,P.w_mask=P.w_size-1,P.hash_bits=u+7,P.hash_size=1<<P.hash_bits,P.hash_mask=P.hash_size-1,P.hash_shift=~~((P.hash_bits+O-1)/O),P.window=new s.Buf8(2*P.w_size),P.head=new s.Buf16(P.hash_size),P.prev=new s.Buf16(P.w_size),P.lit_bufsize=1<<u+6,P.pending_buf_size=4*P.lit_bufsize,P.pending_buf=new s.Buf8(P.pending_buf_size),P.d_buf=1*P.lit_bufsize,P.l_buf=3*P.lit_bufsize,P.level=F,P.strategy=S,P.method=T,dt(t)}n=[new rt(0,0,0,0,function(t,F){var T=65535;for(T>t.pending_buf_size-5&&(T=t.pending_buf_size-5);;){if(t.lookahead<=1){if(st(t),t.lookahead===0&&F===d)return i;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;var p=t.block_start+T;if((t.strstart===0||t.strstart>=p)&&(t.lookahead=t.strstart-p,t.strstart=p,A(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-J&&(A(t,!1),t.strm.avail_out===0))return i}return t.insert=0,F===b?(A(t,!0),t.strm.avail_out===0?X:j):(t.strstart>t.block_start&&(A(t,!1),t.strm.avail_out),i)}),new rt(4,4,8,4,lt),new rt(4,5,16,8,lt),new rt(4,6,32,32,lt),new rt(4,4,16,16,tt),new rt(8,16,32,32,tt),new rt(8,16,128,128,tt),new rt(8,32,128,256,tt),new rt(32,128,258,1024,tt),new rt(32,258,258,4096,tt)],l.deflateInit=function(t,F){return ut(t,F,w,15,8,0)},l.deflateInit2=ut,l.deflateReset=dt,l.deflateResetKeep=at,l.deflateSetHeader=function(t,F){return t&&t.state?t.state.wrap!==2?m:(t.state.gzhead=F,c):m},l.deflate=function(t,F){var T,p,u,S;if(!t||!t.state||5<F||F<0)return t?Q(t,m):m;if(p=t.state,!t.output||!t.input&&t.avail_in!==0||p.status===666&&F!==b)return Q(t,t.avail_out===0?-5:m);if(p.strm=t,T=p.last_flush,p.last_flush=F,p.status===v)if(p.wrap===2)t.adler=0,Y(p,31),Y(p,139),Y(p,8),p.gzhead?(Y(p,(p.gzhead.text?1:0)+(p.gzhead.hcrc?2:0)+(p.gzhead.extra?4:0)+(p.gzhead.name?8:0)+(p.gzhead.comment?16:0)),Y(p,255&p.gzhead.time),Y(p,p.gzhead.time>>8&255),Y(p,p.gzhead.time>>16&255),Y(p,p.gzhead.time>>24&255),Y(p,p.level===9?2:2<=p.strategy||p.level<2?4:0),Y(p,255&p.gzhead.os),p.gzhead.extra&&p.gzhead.extra.length&&(Y(p,255&p.gzhead.extra.length),Y(p,p.gzhead.extra.length>>8&255)),p.gzhead.hcrc&&(t.adler=_(t.adler,p.pending_buf,p.pending,0)),p.gzindex=0,p.status=69):(Y(p,0),Y(p,0),Y(p,0),Y(p,0),Y(p,0),Y(p,p.level===9?2:2<=p.strategy||p.level<2?4:0),Y(p,3),p.status=R);else{var N=w+(p.w_bits-8<<4)<<8;N|=(2<=p.strategy||p.level<2?0:p.level<6?1:p.level===6?2:3)<<6,p.strstart!==0&&(N|=32),N+=31-N%31,p.status=R,G(p,N),p.strstart!==0&&(G(p,t.adler>>>16),G(p,65535&t.adler)),t.adler=1}if(p.status===69)if(p.gzhead.extra){for(u=p.pending;p.gzindex<(65535&p.gzhead.extra.length)&&(p.pending!==p.pending_buf_size||(p.gzhead.hcrc&&p.pending>u&&(t.adler=_(t.adler,p.pending_buf,p.pending-u,u)),z(t),u=p.pending,p.pending!==p.pending_buf_size));)Y(p,255&p.gzhead.extra[p.gzindex]),p.gzindex++;p.gzhead.hcrc&&p.pending>u&&(t.adler=_(t.adler,p.pending_buf,p.pending-u,u)),p.gzindex===p.gzhead.extra.length&&(p.gzindex=0,p.status=73)}else p.status=73;if(p.status===73)if(p.gzhead.name){u=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>u&&(t.adler=_(t.adler,p.pending_buf,p.pending-u,u)),z(t),u=p.pending,p.pending===p.pending_buf_size)){S=1;break}S=p.gzindex<p.gzhead.name.length?255&p.gzhead.name.charCodeAt(p.gzindex++):0,Y(p,S)}while(S!==0);p.gzhead.hcrc&&p.pending>u&&(t.adler=_(t.adler,p.pending_buf,p.pending-u,u)),S===0&&(p.gzindex=0,p.status=91)}else p.status=91;if(p.status===91)if(p.gzhead.comment){u=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>u&&(t.adler=_(t.adler,p.pending_buf,p.pending-u,u)),z(t),u=p.pending,p.pending===p.pending_buf_size)){S=1;break}S=p.gzindex<p.gzhead.comment.length?255&p.gzhead.comment.charCodeAt(p.gzindex++):0,Y(p,S)}while(S!==0);p.gzhead.hcrc&&p.pending>u&&(t.adler=_(t.adler,p.pending_buf,p.pending-u,u)),S===0&&(p.status=103)}else p.status=103;if(p.status===103&&(p.gzhead.hcrc?(p.pending+2>p.pending_buf_size&&z(t),p.pending+2<=p.pending_buf_size&&(Y(p,255&t.adler),Y(p,t.adler>>8&255),t.adler=0,p.status=R)):p.status=R),p.pending!==0){if(z(t),t.avail_out===0)return p.last_flush=-1,c}else if(t.avail_in===0&&M(F)<=M(T)&&F!==b)return Q(t,-5);if(p.status===666&&t.avail_in!==0)return Q(t,-5);if(t.avail_in!==0||p.lookahead!==0||F!==d&&p.status!==666){var P=p.strategy===2?(function(E,W){for(var q;;){if(E.lookahead===0&&(st(E),E.lookahead===0)){if(W===d)return i;break}if(E.match_length=0,q=e._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++,q&&(A(E,!1),E.strm.avail_out===0))return i}return E.insert=0,W===b?(A(E,!0),E.strm.avail_out===0?X:j):E.last_lit&&(A(E,!1),E.strm.avail_out===0)?i:D})(p,F):p.strategy===3?(function(E,W){for(var q,$,K,nt,et=E.window;;){if(E.lookahead<=Z){if(st(E),E.lookahead<=Z&&W===d)return i;if(E.lookahead===0)break}if(E.match_length=0,E.lookahead>=O&&0<E.strstart&&($=et[K=E.strstart-1])===et[++K]&&$===et[++K]&&$===et[++K]){nt=E.strstart+Z;do;while($===et[++K]&&$===et[++K]&&$===et[++K]&&$===et[++K]&&$===et[++K]&&$===et[++K]&&$===et[++K]&&$===et[++K]&&K<nt);E.match_length=Z-(nt-K),E.match_length>E.lookahead&&(E.match_length=E.lookahead)}if(E.match_length>=O?(q=e._tr_tally(E,1,E.match_length-O),E.lookahead-=E.match_length,E.strstart+=E.match_length,E.match_length=0):(q=e._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++),q&&(A(E,!1),E.strm.avail_out===0))return i}return E.insert=0,W===b?(A(E,!0),E.strm.avail_out===0?X:j):E.last_lit&&(A(E,!1),E.strm.avail_out===0)?i:D})(p,F):n[p.level].func(p,F);if(P!==X&&P!==j||(p.status=666),P===i||P===X)return t.avail_out===0&&(p.last_flush=-1),c;if(P===D&&(F===1?e._tr_align(p):F!==5&&(e._tr_stored_block(p,0,0,!1),F===3&&(V(p.head),p.lookahead===0&&(p.strstart=0,p.block_start=0,p.insert=0))),z(t),t.avail_out===0))return p.last_flush=-1,c}return F!==b?c:p.wrap<=0?1:(p.wrap===2?(Y(p,255&t.adler),Y(p,t.adler>>8&255),Y(p,t.adler>>16&255),Y(p,t.adler>>24&255),Y(p,255&t.total_in),Y(p,t.total_in>>8&255),Y(p,t.total_in>>16&255),Y(p,t.total_in>>24&255)):(G(p,t.adler>>>16),G(p,65535&t.adler)),z(t),0<p.wrap&&(p.wrap=-p.wrap),p.pending!==0?c:1)},l.deflateEnd=function(t){var F;return t&&t.state?(F=t.state.status)!==v&&F!==69&&F!==73&&F!==91&&F!==103&&F!==R&&F!==666?Q(t,m):(t.state=null,F===R?Q(t,-3):c):m},l.deflateSetDictionary=function(t,F){var T,p,u,S,N,P,E,W,q=F.length;if(!t||!t.state||(S=(T=t.state).wrap)===2||S===1&&T.status!==v||T.lookahead)return m;for(S===1&&(t.adler=a(t.adler,F,q,0)),T.wrap=0,q>=T.w_size&&(S===0&&(V(T.head),T.strstart=0,T.block_start=0,T.insert=0),W=new s.Buf8(T.w_size),s.arraySet(W,F,q-T.w_size,T.w_size,0),F=W,q=T.w_size),N=t.avail_in,P=t.next_in,E=t.input,t.avail_in=q,t.next_in=0,t.input=F,st(T);T.lookahead>=O;){for(p=T.strstart,u=T.lookahead-(O-1);T.ins_h=(T.ins_h<<T.hash_shift^T.window[p+O-1])&T.hash_mask,T.prev[p&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=p,p++,--u;);T.strstart=p,T.lookahead=O-1,st(T)}return T.strstart+=T.lookahead,T.block_start=T.strstart,T.insert=T.lookahead,T.lookahead=0,T.match_length=T.prev_length=O-1,T.match_available=0,t.next_in=P,t.input=E,t.avail_in=N,T.wrap=S,c},l.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,g,l){g.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,g,l){g.exports=function(n,s){var e,a,_,y,d,b,c,m,o,f,h,w,x,I,C,U,B,L,O,Z,J,v,R,i,D;e=n.state,a=n.next_in,i=n.input,_=a+(n.avail_in-5),y=n.next_out,D=n.output,d=y-(s-n.avail_out),b=y+(n.avail_out-257),c=e.dmax,m=e.wsize,o=e.whave,f=e.wnext,h=e.window,w=e.hold,x=e.bits,I=e.lencode,C=e.distcode,U=(1<<e.lenbits)-1,B=(1<<e.distbits)-1;t:do{x<15&&(w+=i[a++]<<x,x+=8,w+=i[a++]<<x,x+=8),L=I[w&U];e:for(;;){if(w>>>=O=L>>>24,x-=O,(O=L>>>16&255)===0)D[y++]=65535&L;else{if(!(16&O)){if((64&O)==0){L=I[(65535&L)+(w&(1<<O)-1)];continue e}if(32&O){e.mode=12;break t}n.msg="invalid literal/length code",e.mode=30;break t}Z=65535&L,(O&=15)&&(x<O&&(w+=i[a++]<<x,x+=8),Z+=w&(1<<O)-1,w>>>=O,x-=O),x<15&&(w+=i[a++]<<x,x+=8,w+=i[a++]<<x,x+=8),L=C[w&B];r:for(;;){if(w>>>=O=L>>>24,x-=O,!(16&(O=L>>>16&255))){if((64&O)==0){L=C[(65535&L)+(w&(1<<O)-1)];continue r}n.msg="invalid distance code",e.mode=30;break t}if(J=65535&L,x<(O&=15)&&(w+=i[a++]<<x,(x+=8)<O&&(w+=i[a++]<<x,x+=8)),c<(J+=w&(1<<O)-1)){n.msg="invalid distance too far back",e.mode=30;break t}if(w>>>=O,x-=O,(O=y-d)<J){if(o<(O=J-O)&&e.sane){n.msg="invalid distance too far back",e.mode=30;break t}if(R=h,(v=0)===f){if(v+=m-O,O<Z){for(Z-=O;D[y++]=h[v++],--O;);v=y-J,R=D}}else if(f<O){if(v+=m+f-O,(O-=f)<Z){for(Z-=O;D[y++]=h[v++],--O;);if(v=0,f<Z){for(Z-=O=f;D[y++]=h[v++],--O;);v=y-J,R=D}}}else if(v+=f-O,O<Z){for(Z-=O;D[y++]=h[v++],--O;);v=y-J,R=D}for(;2<Z;)D[y++]=R[v++],D[y++]=R[v++],D[y++]=R[v++],Z-=3;Z&&(D[y++]=R[v++],1<Z&&(D[y++]=R[v++]))}else{for(v=y-J;D[y++]=D[v++],D[y++]=D[v++],D[y++]=D[v++],2<(Z-=3););Z&&(D[y++]=D[v++],1<Z&&(D[y++]=D[v++]))}break}}break}}while(a<_&&y<b);a-=Z=x>>3,w&=(1<<(x-=Z<<3))-1,n.next_in=a,n.next_out=y,n.avail_in=a<_?_-a+5:5-(a-_),n.avail_out=y<b?b-y+257:257-(y-b),e.hold=w,e.bits=x}},{}],49:[function(r,g,l){var n=r("../utils/common"),s=r("./adler32"),e=r("./crc32"),a=r("./inffast"),_=r("./inftrees"),y=1,d=2,b=0,c=-2,m=1,o=852,f=592;function h(v){return(v>>>24&255)+(v>>>8&65280)+((65280&v)<<8)+((255&v)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function x(v){var R;return v&&v.state?(R=v.state,v.total_in=v.total_out=R.total=0,v.msg="",R.wrap&&(v.adler=1&R.wrap),R.mode=m,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new n.Buf32(o),R.distcode=R.distdyn=new n.Buf32(f),R.sane=1,R.back=-1,b):c}function I(v){var R;return v&&v.state?((R=v.state).wsize=0,R.whave=0,R.wnext=0,x(v)):c}function C(v,R){var i,D;return v&&v.state?(D=v.state,R<0?(i=0,R=-R):(i=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?c:(D.window!==null&&D.wbits!==R&&(D.window=null),D.wrap=i,D.wbits=R,I(v))):c}function U(v,R){var i,D;return v?(D=new w,(v.state=D).window=null,(i=C(v,R))!==b&&(v.state=null),i):c}var B,L,O=!0;function Z(v){if(O){var R;for(B=new n.Buf32(512),L=new n.Buf32(32),R=0;R<144;)v.lens[R++]=8;for(;R<256;)v.lens[R++]=9;for(;R<280;)v.lens[R++]=7;for(;R<288;)v.lens[R++]=8;for(_(y,v.lens,0,288,B,0,v.work,{bits:9}),R=0;R<32;)v.lens[R++]=5;_(d,v.lens,0,32,L,0,v.work,{bits:5}),O=!1}v.lencode=B,v.lenbits=9,v.distcode=L,v.distbits=5}function J(v,R,i,D){var X,j=v.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new n.Buf8(j.wsize)),D>=j.wsize?(n.arraySet(j.window,R,i-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(D<(X=j.wsize-j.wnext)&&(X=D),n.arraySet(j.window,R,i-D,X,j.wnext),(D-=X)?(n.arraySet(j.window,R,i-D,D,0),j.wnext=D,j.whave=j.wsize):(j.wnext+=X,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=X))),0}l.inflateReset=I,l.inflateReset2=C,l.inflateResetKeep=x,l.inflateInit=function(v){return U(v,15)},l.inflateInit2=U,l.inflate=function(v,R){var i,D,X,j,Q,M,V,z,A,Y,G,H,st,lt,tt,rt,ct,at,dt,ut,t,F,T,p,u=0,S=new n.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!v||!v.state||!v.output||!v.input&&v.avail_in!==0)return c;(i=v.state).mode===12&&(i.mode=13),Q=v.next_out,X=v.output,V=v.avail_out,j=v.next_in,D=v.input,M=v.avail_in,z=i.hold,A=i.bits,Y=M,G=V,F=b;t:for(;;)switch(i.mode){case m:if(i.wrap===0){i.mode=13;break}for(;A<16;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if(2&i.wrap&&z===35615){S[i.check=0]=255&z,S[1]=z>>>8&255,i.check=e(i.check,S,2,0),A=z=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&z)<<8)+(z>>8))%31){v.msg="incorrect header check",i.mode=30;break}if((15&z)!=8){v.msg="unknown compression method",i.mode=30;break}if(A-=4,t=8+(15&(z>>>=4)),i.wbits===0)i.wbits=t;else if(t>i.wbits){v.msg="invalid window size",i.mode=30;break}i.dmax=1<<t,v.adler=i.check=1,i.mode=512&z?10:12,A=z=0;break;case 2:for(;A<16;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if(i.flags=z,(255&i.flags)!=8){v.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){v.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=z>>8&1),512&i.flags&&(S[0]=255&z,S[1]=z>>>8&255,i.check=e(i.check,S,2,0)),A=z=0,i.mode=3;case 3:for(;A<32;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}i.head&&(i.head.time=z),512&i.flags&&(S[0]=255&z,S[1]=z>>>8&255,S[2]=z>>>16&255,S[3]=z>>>24&255,i.check=e(i.check,S,4,0)),A=z=0,i.mode=4;case 4:for(;A<16;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}i.head&&(i.head.xflags=255&z,i.head.os=z>>8),512&i.flags&&(S[0]=255&z,S[1]=z>>>8&255,i.check=e(i.check,S,2,0)),A=z=0,i.mode=5;case 5:if(1024&i.flags){for(;A<16;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}i.length=z,i.head&&(i.head.extra_len=z),512&i.flags&&(S[0]=255&z,S[1]=z>>>8&255,i.check=e(i.check,S,2,0)),A=z=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(M<(H=i.length)&&(H=M),H&&(i.head&&(t=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,D,j,H,t)),512&i.flags&&(i.check=e(i.check,D,H,j)),M-=H,j+=H,i.length-=H),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(M===0)break t;for(H=0;t=D[j+H++],i.head&&t&&i.length<65536&&(i.head.name+=String.fromCharCode(t)),t&&H<M;);if(512&i.flags&&(i.check=e(i.check,D,H,j)),M-=H,j+=H,t)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(M===0)break t;for(H=0;t=D[j+H++],i.head&&t&&i.length<65536&&(i.head.comment+=String.fromCharCode(t)),t&&H<M;);if(512&i.flags&&(i.check=e(i.check,D,H,j)),M-=H,j+=H,t)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;A<16;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if(z!==(65535&i.check)){v.msg="header crc mismatch",i.mode=30;break}A=z=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),v.adler=i.check=0,i.mode=12;break;case 10:for(;A<32;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}v.adler=i.check=h(z),A=z=0,i.mode=11;case 11:if(i.havedict===0)return v.next_out=Q,v.avail_out=V,v.next_in=j,v.avail_in=M,i.hold=z,i.bits=A,2;v.adler=i.check=1,i.mode=12;case 12:if(R===5||R===6)break t;case 13:if(i.last){z>>>=7&A,A-=7&A,i.mode=27;break}for(;A<3;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}switch(i.last=1&z,A-=1,3&(z>>>=1)){case 0:i.mode=14;break;case 1:if(Z(i),i.mode=20,R!==6)break;z>>>=2,A-=2;break t;case 2:i.mode=17;break;case 3:v.msg="invalid block type",i.mode=30}z>>>=2,A-=2;break;case 14:for(z>>>=7&A,A-=7&A;A<32;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if((65535&z)!=(z>>>16^65535)){v.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&z,A=z=0,i.mode=15,R===6)break t;case 15:i.mode=16;case 16:if(H=i.length){if(M<H&&(H=M),V<H&&(H=V),H===0)break t;n.arraySet(X,D,j,H,Q),M-=H,j+=H,V-=H,Q+=H,i.length-=H;break}i.mode=12;break;case 17:for(;A<14;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if(i.nlen=257+(31&z),z>>>=5,A-=5,i.ndist=1+(31&z),z>>>=5,A-=5,i.ncode=4+(15&z),z>>>=4,A-=4,286<i.nlen||30<i.ndist){v.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;A<3;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}i.lens[N[i.have++]]=7&z,z>>>=3,A-=3}for(;i.have<19;)i.lens[N[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,T={bits:i.lenbits},F=_(0,i.lens,0,19,i.lencode,0,i.work,T),i.lenbits=T.bits,F){v.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;rt=(u=i.lencode[z&(1<<i.lenbits)-1])>>>16&255,ct=65535&u,!((tt=u>>>24)<=A);){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if(ct<16)z>>>=tt,A-=tt,i.lens[i.have++]=ct;else{if(ct===16){for(p=tt+2;A<p;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if(z>>>=tt,A-=tt,i.have===0){v.msg="invalid bit length repeat",i.mode=30;break}t=i.lens[i.have-1],H=3+(3&z),z>>>=2,A-=2}else if(ct===17){for(p=tt+3;A<p;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}A-=tt,t=0,H=3+(7&(z>>>=tt)),z>>>=3,A-=3}else{for(p=tt+7;A<p;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}A-=tt,t=0,H=11+(127&(z>>>=tt)),z>>>=7,A-=7}if(i.have+H>i.nlen+i.ndist){v.msg="invalid bit length repeat",i.mode=30;break}for(;H--;)i.lens[i.have++]=t}}if(i.mode===30)break;if(i.lens[256]===0){v.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,T={bits:i.lenbits},F=_(y,i.lens,0,i.nlen,i.lencode,0,i.work,T),i.lenbits=T.bits,F){v.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,T={bits:i.distbits},F=_(d,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,T),i.distbits=T.bits,F){v.msg="invalid distances set",i.mode=30;break}if(i.mode=20,R===6)break t;case 20:i.mode=21;case 21:if(6<=M&&258<=V){v.next_out=Q,v.avail_out=V,v.next_in=j,v.avail_in=M,i.hold=z,i.bits=A,a(v,G),Q=v.next_out,X=v.output,V=v.avail_out,j=v.next_in,D=v.input,M=v.avail_in,z=i.hold,A=i.bits,i.mode===12&&(i.back=-1);break}for(i.back=0;rt=(u=i.lencode[z&(1<<i.lenbits)-1])>>>16&255,ct=65535&u,!((tt=u>>>24)<=A);){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if(rt&&(240&rt)==0){for(at=tt,dt=rt,ut=ct;rt=(u=i.lencode[ut+((z&(1<<at+dt)-1)>>at)])>>>16&255,ct=65535&u,!(at+(tt=u>>>24)<=A);){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}z>>>=at,A-=at,i.back+=at}if(z>>>=tt,A-=tt,i.back+=tt,i.length=ct,rt===0){i.mode=26;break}if(32&rt){i.back=-1,i.mode=12;break}if(64&rt){v.msg="invalid literal/length code",i.mode=30;break}i.extra=15&rt,i.mode=22;case 22:if(i.extra){for(p=i.extra;A<p;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}i.length+=z&(1<<i.extra)-1,z>>>=i.extra,A-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;rt=(u=i.distcode[z&(1<<i.distbits)-1])>>>16&255,ct=65535&u,!((tt=u>>>24)<=A);){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if((240&rt)==0){for(at=tt,dt=rt,ut=ct;rt=(u=i.distcode[ut+((z&(1<<at+dt)-1)>>at)])>>>16&255,ct=65535&u,!(at+(tt=u>>>24)<=A);){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}z>>>=at,A-=at,i.back+=at}if(z>>>=tt,A-=tt,i.back+=tt,64&rt){v.msg="invalid distance code",i.mode=30;break}i.offset=ct,i.extra=15&rt,i.mode=24;case 24:if(i.extra){for(p=i.extra;A<p;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}i.offset+=z&(1<<i.extra)-1,z>>>=i.extra,A-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){v.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(V===0)break t;if(H=G-V,i.offset>H){if((H=i.offset-H)>i.whave&&i.sane){v.msg="invalid distance too far back",i.mode=30;break}st=H>i.wnext?(H-=i.wnext,i.wsize-H):i.wnext-H,H>i.length&&(H=i.length),lt=i.window}else lt=X,st=Q-i.offset,H=i.length;for(V<H&&(H=V),V-=H,i.length-=H;X[Q++]=lt[st++],--H;);i.length===0&&(i.mode=21);break;case 26:if(V===0)break t;X[Q++]=i.length,V--,i.mode=21;break;case 27:if(i.wrap){for(;A<32;){if(M===0)break t;M--,z|=D[j++]<<A,A+=8}if(G-=V,v.total_out+=G,i.total+=G,G&&(v.adler=i.check=i.flags?e(i.check,X,G,Q-G):s(i.check,X,G,Q-G)),G=V,(i.flags?z:h(z))!==i.check){v.msg="incorrect data check",i.mode=30;break}A=z=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;A<32;){if(M===0)break t;M--,z+=D[j++]<<A,A+=8}if(z!==(4294967295&i.total)){v.msg="incorrect length check",i.mode=30;break}A=z=0}i.mode=29;case 29:F=1;break t;case 30:F=-3;break t;case 31:return-4;case 32:default:return c}return v.next_out=Q,v.avail_out=V,v.next_in=j,v.avail_in=M,i.hold=z,i.bits=A,(i.wsize||G!==v.avail_out&&i.mode<30&&(i.mode<27||R!==4))&&J(v,v.output,v.next_out,G-v.avail_out)?(i.mode=31,-4):(Y-=v.avail_in,G-=v.avail_out,v.total_in+=Y,v.total_out+=G,i.total+=G,i.wrap&&G&&(v.adler=i.check=i.flags?e(i.check,X,G,v.next_out-G):s(i.check,X,G,v.next_out-G)),v.data_type=i.bits+(i.last?64:0)+(i.mode===12?128:0)+(i.mode===20||i.mode===15?256:0),(Y==0&&G===0||R===4)&&F===b&&(F=-5),F)},l.inflateEnd=function(v){if(!v||!v.state)return c;var R=v.state;return R.window&&(R.window=null),v.state=null,b},l.inflateGetHeader=function(v,R){var i;return v&&v.state?(2&(i=v.state).wrap)==0?c:((i.head=R).done=!1,b):c},l.inflateSetDictionary=function(v,R){var i,D=R.length;return v&&v.state?(i=v.state).wrap!==0&&i.mode!==11?c:i.mode===11&&s(1,R,D,0)!==i.check?-3:J(v,R,D,D)?(i.mode=31,-4):(i.havedict=1,b):c},l.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,g,l){var n=r("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],e=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],_=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];g.exports=function(y,d,b,c,m,o,f,h){var w,x,I,C,U,B,L,O,Z,J=h.bits,v=0,R=0,i=0,D=0,X=0,j=0,Q=0,M=0,V=0,z=0,A=null,Y=0,G=new n.Buf16(16),H=new n.Buf16(16),st=null,lt=0;for(v=0;v<=15;v++)G[v]=0;for(R=0;R<c;R++)G[d[b+R]]++;for(X=J,D=15;1<=D&&G[D]===0;D--);if(D<X&&(X=D),D===0)return m[o++]=20971520,m[o++]=20971520,h.bits=1,0;for(i=1;i<D&&G[i]===0;i++);for(X<i&&(X=i),v=M=1;v<=15;v++)if(M<<=1,(M-=G[v])<0)return-1;if(0<M&&(y===0||D!==1))return-1;for(H[1]=0,v=1;v<15;v++)H[v+1]=H[v]+G[v];for(R=0;R<c;R++)d[b+R]!==0&&(f[H[d[b+R]]++]=R);if(B=y===0?(A=st=f,19):y===1?(A=s,Y-=257,st=e,lt-=257,256):(A=a,st=_,-1),v=i,U=o,Q=R=z=0,I=-1,C=(V=1<<(j=X))-1,y===1&&852<V||y===2&&592<V)return 1;for(;;){for(L=v-Q,Z=f[R]<B?(O=0,f[R]):f[R]>B?(O=st[lt+f[R]],A[Y+f[R]]):(O=96,0),w=1<<v-Q,i=x=1<<j;m[U+(z>>Q)+(x-=w)]=L<<24|O<<16|Z|0,x!==0;);for(w=1<<v-1;z&w;)w>>=1;if(w!==0?(z&=w-1,z+=w):z=0,R++,--G[v]==0){if(v===D)break;v=d[b+f[R]]}if(X<v&&(z&C)!==I){for(Q===0&&(Q=X),U+=i,M=1<<(j=v-Q);j+Q<D&&!((M-=G[j+Q])<=0);)j++,M<<=1;if(V+=1<<j,y===1&&852<V||y===2&&592<V)return 1;m[I=z&C]=X<<24|j<<16|U-o|0}}return z!==0&&(m[U+z]=v-Q<<24|64<<16|0),h.bits=X,0}},{"../utils/common":41}],51:[function(r,g,l){g.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,g,l){var n=r("../utils/common"),s=0,e=1;function a(u){for(var S=u.length;0<=--S;)u[S]=0}var _=0,y=29,d=256,b=d+1+y,c=30,m=19,o=2*b+1,f=15,h=16,w=7,x=256,I=16,C=17,U=18,B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(b+2));a(J);var v=new Array(2*c);a(v);var R=new Array(512);a(R);var i=new Array(256);a(i);var D=new Array(y);a(D);var X,j,Q,M=new Array(c);function V(u,S,N,P,E){this.static_tree=u,this.extra_bits=S,this.extra_base=N,this.elems=P,this.max_length=E,this.has_stree=u&&u.length}function z(u,S){this.dyn_tree=u,this.max_code=0,this.stat_desc=S}function A(u){return u<256?R[u]:R[256+(u>>>7)]}function Y(u,S){u.pending_buf[u.pending++]=255&S,u.pending_buf[u.pending++]=S>>>8&255}function G(u,S,N){u.bi_valid>h-N?(u.bi_buf|=S<<u.bi_valid&65535,Y(u,u.bi_buf),u.bi_buf=S>>h-u.bi_valid,u.bi_valid+=N-h):(u.bi_buf|=S<<u.bi_valid&65535,u.bi_valid+=N)}function H(u,S,N){G(u,N[2*S],N[2*S+1])}function st(u,S){for(var N=0;N|=1&u,u>>>=1,N<<=1,0<--S;);return N>>>1}function lt(u,S,N){var P,E,W=new Array(f+1),q=0;for(P=1;P<=f;P++)W[P]=q=q+N[P-1]<<1;for(E=0;E<=S;E++){var $=u[2*E+1];$!==0&&(u[2*E]=st(W[$]++,$))}}function tt(u){var S;for(S=0;S<b;S++)u.dyn_ltree[2*S]=0;for(S=0;S<c;S++)u.dyn_dtree[2*S]=0;for(S=0;S<m;S++)u.bl_tree[2*S]=0;u.dyn_ltree[2*x]=1,u.opt_len=u.static_len=0,u.last_lit=u.matches=0}function rt(u){8<u.bi_valid?Y(u,u.bi_buf):0<u.bi_valid&&(u.pending_buf[u.pending++]=u.bi_buf),u.bi_buf=0,u.bi_valid=0}function ct(u,S,N,P){var E=2*S,W=2*N;return u[E]<u[W]||u[E]===u[W]&&P[S]<=P[N]}function at(u,S,N){for(var P=u.heap[N],E=N<<1;E<=u.heap_len&&(E<u.heap_len&&ct(S,u.heap[E+1],u.heap[E],u.depth)&&E++,!ct(S,P,u.heap[E],u.depth));)u.heap[N]=u.heap[E],N=E,E<<=1;u.heap[N]=P}function dt(u,S,N){var P,E,W,q,$=0;if(u.last_lit!==0)for(;P=u.pending_buf[u.d_buf+2*$]<<8|u.pending_buf[u.d_buf+2*$+1],E=u.pending_buf[u.l_buf+$],$++,P===0?H(u,E,S):(H(u,(W=i[E])+d+1,S),(q=B[W])!==0&&G(u,E-=D[W],q),H(u,W=A(--P),N),(q=L[W])!==0&&G(u,P-=M[W],q)),$<u.last_lit;);H(u,x,S)}function ut(u,S){var N,P,E,W=S.dyn_tree,q=S.stat_desc.static_tree,$=S.stat_desc.has_stree,K=S.stat_desc.elems,nt=-1;for(u.heap_len=0,u.heap_max=o,N=0;N<K;N++)W[2*N]!==0?(u.heap[++u.heap_len]=nt=N,u.depth[N]=0):W[2*N+1]=0;for(;u.heap_len<2;)W[2*(E=u.heap[++u.heap_len]=nt<2?++nt:0)]=1,u.depth[E]=0,u.opt_len--,$&&(u.static_len-=q[2*E+1]);for(S.max_code=nt,N=u.heap_len>>1;1<=N;N--)at(u,W,N);for(E=K;N=u.heap[1],u.heap[1]=u.heap[u.heap_len--],at(u,W,1),P=u.heap[1],u.heap[--u.heap_max]=N,u.heap[--u.heap_max]=P,W[2*E]=W[2*N]+W[2*P],u.depth[E]=(u.depth[N]>=u.depth[P]?u.depth[N]:u.depth[P])+1,W[2*N+1]=W[2*P+1]=E,u.heap[1]=E++,at(u,W,1),2<=u.heap_len;);u.heap[--u.heap_max]=u.heap[1],(function(et,ht){var kt,ft,xt,ot,Et,Rt,mt=ht.dyn_tree,Dt=ht.max_code,Pt=ht.stat_desc.static_tree,jt=ht.stat_desc.has_stree,Lt=ht.stat_desc.extra_bits,Ut=ht.stat_desc.extra_base,St=ht.stat_desc.max_length,At=0;for(ot=0;ot<=f;ot++)et.bl_count[ot]=0;for(mt[2*et.heap[et.heap_max]+1]=0,kt=et.heap_max+1;kt<o;kt++)St<(ot=mt[2*mt[2*(ft=et.heap[kt])+1]+1]+1)&&(ot=St,At++),mt[2*ft+1]=ot,Dt<ft||(et.bl_count[ot]++,Et=0,Ut<=ft&&(Et=Lt[ft-Ut]),Rt=mt[2*ft],et.opt_len+=Rt*(ot+Et),jt&&(et.static_len+=Rt*(Pt[2*ft+1]+Et)));if(At!==0){do{for(ot=St-1;et.bl_count[ot]===0;)ot--;et.bl_count[ot]--,et.bl_count[ot+1]+=2,et.bl_count[St]--,At-=2}while(0<At);for(ot=St;ot!==0;ot--)for(ft=et.bl_count[ot];ft!==0;)Dt<(xt=et.heap[--kt])||(mt[2*xt+1]!==ot&&(et.opt_len+=(ot-mt[2*xt+1])*mt[2*xt],mt[2*xt+1]=ot),ft--)}})(u,S),lt(W,nt,u.bl_count)}function t(u,S,N){var P,E,W=-1,q=S[1],$=0,K=7,nt=4;for(q===0&&(K=138,nt=3),S[2*(N+1)+1]=65535,P=0;P<=N;P++)E=q,q=S[2*(P+1)+1],++$<K&&E===q||($<nt?u.bl_tree[2*E]+=$:E!==0?(E!==W&&u.bl_tree[2*E]++,u.bl_tree[2*I]++):$<=10?u.bl_tree[2*C]++:u.bl_tree[2*U]++,W=E,nt=($=0)===q?(K=138,3):E===q?(K=6,3):(K=7,4))}function F(u,S,N){var P,E,W=-1,q=S[1],$=0,K=7,nt=4;for(q===0&&(K=138,nt=3),P=0;P<=N;P++)if(E=q,q=S[2*(P+1)+1],!(++$<K&&E===q)){if($<nt)for(;H(u,E,u.bl_tree),--$!=0;);else E!==0?(E!==W&&(H(u,E,u.bl_tree),$--),H(u,I,u.bl_tree),G(u,$-3,2)):$<=10?(H(u,C,u.bl_tree),G(u,$-3,3)):(H(u,U,u.bl_tree),G(u,$-11,7));W=E,nt=($=0)===q?(K=138,3):E===q?(K=6,3):(K=7,4)}}a(M);var T=!1;function p(u,S,N,P){G(u,(_<<1)+(P?1:0),3),(function(E,W,q,$){rt(E),Y(E,q),Y(E,~q),n.arraySet(E.pending_buf,E.window,W,q,E.pending),E.pending+=q})(u,S,N)}l._tr_init=function(u){T||((function(){var S,N,P,E,W,q=new Array(f+1);for(E=P=0;E<y-1;E++)for(D[E]=P,S=0;S<1<<B[E];S++)i[P++]=E;for(i[P-1]=E,E=W=0;E<16;E++)for(M[E]=W,S=0;S<1<<L[E];S++)R[W++]=E;for(W>>=7;E<c;E++)for(M[E]=W<<7,S=0;S<1<<L[E]-7;S++)R[256+W++]=E;for(N=0;N<=f;N++)q[N]=0;for(S=0;S<=143;)J[2*S+1]=8,S++,q[8]++;for(;S<=255;)J[2*S+1]=9,S++,q[9]++;for(;S<=279;)J[2*S+1]=7,S++,q[7]++;for(;S<=287;)J[2*S+1]=8,S++,q[8]++;for(lt(J,b+1,q),S=0;S<c;S++)v[2*S+1]=5,v[2*S]=st(S,5);X=new V(J,B,d+1,b,f),j=new V(v,L,0,c,f),Q=new V(new Array(0),O,0,m,w)})(),T=!0),u.l_desc=new z(u.dyn_ltree,X),u.d_desc=new z(u.dyn_dtree,j),u.bl_desc=new z(u.bl_tree,Q),u.bi_buf=0,u.bi_valid=0,tt(u)},l._tr_stored_block=p,l._tr_flush_block=function(u,S,N,P){var E,W,q=0;0<u.level?(u.strm.data_type===2&&(u.strm.data_type=(function($){var K,nt=4093624447;for(K=0;K<=31;K++,nt>>>=1)if(1&nt&&$.dyn_ltree[2*K]!==0)return s;if($.dyn_ltree[18]!==0||$.dyn_ltree[20]!==0||$.dyn_ltree[26]!==0)return e;for(K=32;K<d;K++)if($.dyn_ltree[2*K]!==0)return e;return s})(u)),ut(u,u.l_desc),ut(u,u.d_desc),q=(function($){var K;for(t($,$.dyn_ltree,$.l_desc.max_code),t($,$.dyn_dtree,$.d_desc.max_code),ut($,$.bl_desc),K=m-1;3<=K&&$.bl_tree[2*Z[K]+1]===0;K--);return $.opt_len+=3*(K+1)+5+5+4,K})(u),E=u.opt_len+3+7>>>3,(W=u.static_len+3+7>>>3)<=E&&(E=W)):E=W=N+5,N+4<=E&&S!==-1?p(u,S,N,P):u.strategy===4||W===E?(G(u,2+(P?1:0),3),dt(u,J,v)):(G(u,4+(P?1:0),3),(function($,K,nt,et){var ht;for(G($,K-257,5),G($,nt-1,5),G($,et-4,4),ht=0;ht<et;ht++)G($,$.bl_tree[2*Z[ht]+1],3);F($,$.dyn_ltree,K-1),F($,$.dyn_dtree,nt-1)})(u,u.l_desc.max_code+1,u.d_desc.max_code+1,q+1),dt(u,u.dyn_ltree,u.dyn_dtree)),tt(u),P&&rt(u)},l._tr_tally=function(u,S,N){return u.pending_buf[u.d_buf+2*u.last_lit]=S>>>8&255,u.pending_buf[u.d_buf+2*u.last_lit+1]=255&S,u.pending_buf[u.l_buf+u.last_lit]=255&N,u.last_lit++,S===0?u.dyn_ltree[2*N]++:(u.matches++,S--,u.dyn_ltree[2*(i[N]+d+1)]++,u.dyn_dtree[2*A(S)]++),u.last_lit===u.lit_bufsize-1},l._tr_align=function(u){G(u,2,3),H(u,x,J),(function(S){S.bi_valid===16?(Y(S,S.bi_buf),S.bi_buf=0,S.bi_valid=0):8<=S.bi_valid&&(S.pending_buf[S.pending++]=255&S.bi_buf,S.bi_buf>>=8,S.bi_valid-=8)})(u)}},{"../utils/common":41}],53:[function(r,g,l){g.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,g,l){(function(n){(function(s,e){if(!s.setImmediate){var a,_,y,d,b=1,c={},m=!1,o=s.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(s);f=f&&f.setTimeout?f:s,a={}.toString.call(s.process)==="[object process]"?function(I){process.nextTick(function(){w(I)})}:(function(){if(s.postMessage&&!s.importScripts){var I=!0,C=s.onmessage;return s.onmessage=function(){I=!1},s.postMessage("","*"),s.onmessage=C,I}})()?(d="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",x,!1):s.attachEvent("onmessage",x),function(I){s.postMessage(d+I,"*")}):s.MessageChannel?((y=new MessageChannel).port1.onmessage=function(I){w(I.data)},function(I){y.port2.postMessage(I)}):o&&"onreadystatechange"in o.createElement("script")?(_=o.documentElement,function(I){var C=o.createElement("script");C.onreadystatechange=function(){w(I),C.onreadystatechange=null,_.removeChild(C),C=null},_.appendChild(C)}):function(I){setTimeout(w,0,I)},f.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var C=new Array(arguments.length-1),U=0;U<C.length;U++)C[U]=arguments[U+1];var B={callback:I,args:C};return c[b]=B,a(b),b++},f.clearImmediate=h}function h(I){delete c[I]}function w(I){if(m)setTimeout(w,0,I);else{var C=c[I];if(C){m=!0;try{(function(U){var B=U.callback,L=U.args;switch(L.length){case 0:B();break;case 1:B(L[0]);break;case 2:B(L[0],L[1]);break;case 3:B(L[0],L[1],L[2]);break;default:B.apply(e,L)}})(C)}finally{h(I),m=!1}}}}function x(I){I.source===s&&typeof I.data=="string"&&I.data.indexOf(d)===0&&w(+I.data.slice(d.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof zt<"u"?zt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ft)),Ft.exports}var $t=Zt();const Ht=Wt($t);var _t=(it=>(it.INVALID_FILE="INVALID_FILE",it.MISSING_MANIFEST="MISSING_MANIFEST",it.CORRUPTION="CORRUPTION",it.DATABASE_ERROR="DATABASE_ERROR",it.UNKNOWN="UNKNOWN",it))(_t||{});class gt extends Error{constructor(k,r){super(r),this.type=k,this.name="IngestionError"}}class pt{constructor(){this.dbName="FlowLibraryDB",this.version=3,this.db=null,this.metadataCache=null,this.cacheTimestamp=0,this.CACHE_TTL=3e4}static getInstance(){return pt.instance||(pt.instance=new pt),pt.instance}async init(){if(!this.db)return new Promise((k,r)=>{const g=indexedDB.open(this.dbName,this.version);g.onerror=()=>r(g.error),g.onupgradeneeded=l=>{const n=l.target.result;n.objectStoreNames.contains("books")||n.createObjectStore("books",{keyPath:"id"}),n.objectStoreNames.contains("metadata")||n.createObjectStore("metadata",{keyPath:"id"}),n.objectStoreNames.contains("sources")||n.createObjectStore("sources"),n.objectStoreNames.contains("covers")||n.createObjectStore("covers"),n.objectStoreNames.contains("deletions")||n.createObjectStore("deletions")},g.onsuccess=l=>{this.db=l.target.result,k()}})}async saveBook(k){await this.init();const{chapters:r,...g}=k;this.metadataCache&&this.metadataCache.set(k.id,g),await this.put("books",k),await this.put("metadata",g)}async saveSource(k,r){await this.init(),await this.put("sources",r,k)}async getSource(k){return await this.init(),this.get("sources",k)}async deleteBook(k){return await this.init(),this.metadataCache&&this.metadataCache.delete(k),new Promise((r,g)=>{const l=this.db.transaction(["books","metadata","sources","covers","deletions"],"readwrite");l.objectStore("books").delete(k),l.objectStore("metadata").delete(k),l.objectStore("sources").delete(k),l.objectStore("covers").delete(k),l.objectStore("deletions").put(Date.now(),k),l.oncomplete=()=>{try{localStorage.removeItem(`book_progress_${k}`)}catch{}r()},l.onerror=()=>g(l.error)})}async wasDeletionRecorded(k){return await this.init(),await this.get("deletions",k)!==void 0}async saveBooksInBatch(k){if(k.length!==0)return await this.init(),new Promise((r,g)=>{const l=this.db.transaction(["books","metadata"],"readwrite"),n=l.objectStore("books"),s=l.objectStore("metadata");for(const e of k){const{chapters:a,..._}=e;n.put(e),s.put(_),this.metadataCache&&this.metadataCache.set(e.id,_)}l.oncomplete=()=>r(),l.onerror=()=>g(l.error)})}async cleanupOrphanedBackups(){try{const k=await this.getAllMetadata(),r=new Set(k.map(l=>l.id)),g=[];for(let l=0;l<localStorage.length;l++){const n=localStorage.key(l);if(n&&n.startsWith("book_progress_")){const s=n.replace("book_progress_","");r.has(s)||g.push(n)}}g.forEach(l=>localStorage.removeItem(l)),g.length>0&&console.log(`[TitanStorage] Cleaned up ${g.length} orphaned localStorage backups`)}catch(k){console.warn("[TitanStorage] Failed to cleanup localStorage backups:",k)}}async getAllMetadata(){await this.init();const k=Date.now();if(this.metadataCache&&k-this.cacheTimestamp<this.CACHE_TTL)return Array.from(this.metadataCache.values());const r=await this.getAll("metadata");return this.metadataCache=new Map,r.forEach(g=>this.metadataCache.set(g.id,g)),this.cacheTimestamp=k,r}async getFullBook(k){return await this.init(),this.get("books",k)}async saveCoverBlob(k,r){await this.init(),await this.put("covers",r,k)}async getCoverBlob(k){return await this.init(),this.get("covers",k)}async deleteCoverBlob(k){await this.init(),await this.delete("covers",k)}async put(k,r,g){return new Promise((l,n)=>{const e=this.db.transaction(k,"readwrite").objectStore(k),a=g?e.put(r,g):e.put(r);a.onsuccess=()=>l(),a.onerror=()=>n(a.error)})}async get(k,r){return new Promise((g,l)=>{const e=this.db.transaction(k,"readonly").objectStore(k).get(r);e.onsuccess=()=>g(e.result),e.onerror=()=>l(e.error)})}async getAll(k){return new Promise((r,g)=>{const s=this.db.transaction(k,"readonly").objectStore(k).getAll();s.onsuccess=()=>r(s.result),s.onerror=()=>g(s.error)})}async delete(k,r){return new Promise((g,l)=>{const e=this.db.transaction(k,"readwrite").objectStore(k).delete(r);e.onsuccess=()=>g(),e.onerror=()=>l(e.error)})}}const Bt=class Bt{static async findCover(k,r){try{const g=k.replace(/\(.*\)/,"").trim(),l=r.replace(/\(.*\)/,"").trim(),n=encodeURIComponent(`${g} ${l}`),s=new AbortController,e=setTimeout(()=>s.abort(),2500),a=await fetch(`${this.SEARCH_URL}?q=${n}&limit=1&fields=cover_i`,{signal:s.signal});if(clearTimeout(e),!a.ok)return;const y=(await a.json()).docs?.[0]?.cover_i;if(y)return`${this.IMAGE_URL}/${y}-L.jpg`}catch{}}static async cacheAndGetCover(k,r){try{const g=pt.getInstance(),l=await g.getCoverBlob(k);if(l)return URL.createObjectURL(l);const n=new AbortController,s=setTimeout(()=>n.abort(),5e3),e=await fetch(r,{signal:n.signal,mode:"cors"});if(clearTimeout(s),!e.ok)return console.warn("[CoverService] Failed to download cover:",e.status),r;const a=await e.blob();return await g.saveCoverBlob(k,a),URL.createObjectURL(a)}catch(g){return console.warn("[CoverService] Cache failed, using URL:",g),r}}static async getCachedCover(k){try{const g=await pt.getInstance().getCoverBlob(k);if(g)return URL.createObjectURL(g)}catch{}}static async clearCachedCover(k){try{await pt.getInstance().deleteCoverBlob(k)}catch{}}};Bt.SEARCH_URL="https://openlibrary.org/search.json",Bt.IMAGE_URL="https://covers.openlibrary.org/b/id";let bt=Bt;class wt{constructor(){}static getInstance(){return wt.instance||(wt.instance=new wt),wt.instance}async ingest(k){try{this.validateFile(k);let r;try{r=await k.arrayBuffer()}catch(e){throw console.error("[Ingestion] Failed to read file:",e),new gt(_t.UNKNOWN,`Failed to read file: ${e instanceof Error?e.message:"Unknown error"}`)}const g=await this.unzipFromBuffer(r),l=await this.parseContainer(g),n=await this.parseOPF(g,l),s=await this.constructBookFromZip(g,n);if(s.coverUrl||(s.coverUrl=await bt.findCover(s.title,s.author)),s.coverUrl)try{s.coverUrl=await bt.cacheAndGetCover(s.id,s.coverUrl)}catch(e){console.warn("[Ingestion] Cover caching failed, using URL:",e)}return s.sourceType="epub",await this.persistBook(s,r),s}catch(r){throw console.error("[Ingestion] Import failed:",r),r instanceof gt?r:new gt(_t.UNKNOWN,r.message||"Unknown import error")}}async ingestFromText(k,r,g,l,n){const s=crypto.randomUUID(),e=this.heuristicChaptering(g),a={id:s,title:k,author:r,coverUrl:n,tintColorHex:l,lastOpened:new Date,isFinished:!1,bookmarkProgress:0,chapters:e,sourceType:"text"};if(a.coverUrl||(a.coverUrl=await bt.findCover(k,r)),a.coverUrl)try{a.coverUrl=await bt.cacheAndGetCover(a.id,a.coverUrl)}catch(d){console.warn("[Ingestion] Cover caching failed, using URL:",d)}const y=new TextEncoder().encode(g).buffer;return await this.persistBook(a,y),a}async ingestPastedText(k,r){const g=crypto.randomUUID();let l=0;for(let d=0;d<k.length;d++)l=k.charCodeAt(d)+((l<<5)-l);const s=`hsl(${Math.abs(l%360)}, 45%, 45%)`,e=this.simpleChaptering(r),a={id:g,title:k,author:"Clipping",tintColorHex:s,lastOpened:new Date,isFinished:!1,bookmarkProgress:0,chapters:e,sourceType:"pasted"},y=new TextEncoder().encode(r).buffer;return await this.persistBook(a,y),a}simpleChaptering(k){const g=k.split(/\n\s*\n/).filter(a=>a.trim()),l=[];let n=[],s=0,e=1;for(const a of g){const _=a.trim().split(/\s+/).length;n.push(a.trim()),s+=_,s>=2e3&&(l.push({id:crypto.randomUUID(),title:l.length===0?"Start":`Section ${e}`,content:n.join(`

`),wordCount:s,sortOrder:l.length}),n=[],s=0,e++)}return n.length>0&&l.push({id:crypto.randomUUID(),title:l.length===0?"Content":`Section ${e}`,content:n.join(`

`),wordCount:s,sortOrder:l.length}),l.length===1&&(l[0].title="Content"),l}async persistBook(k,r){const g=pt.getInstance();await g.saveBook(k),await g.saveSource(k.id,r)}heuristicChaptering(k){let r=k;const g=r.indexOf("*** START OF"),l=r.indexOf("*** END OF");if(g!==-1){const d=r.substring(g),b=d.indexOf(`
`,d.indexOf(`
`)+1);r=d.substring(b)}l!==-1&&(r=r.substring(0,l));const n=r.split(/\n\s*\n/),s=[];let e=[],a="Preface",_=1;const y=400;for(let d=0;d<n.length;d++){const c=n[d].replace(/\s+/g," ").trim();if(!c)continue;const m=/^(chapter|book|part|letter|prologue|epilogue|foreword|preface|stave|volume|vol\.)\s*([ivxlcdm\d]+|the\s+\w+)?/i.test(c),o=/^[IVXLCDM]+\.?$/.test(c),f=/^\d+\.?$/.test(c);if((m||o&&c.length<10||f&&c.length<5)&&c.length<100)if(Tt(e.join(" "))>50||s.length===0){this.flushChapter(s,e,a,_++),e=[],a=c;continue}else{a=c;continue}e.push(c),e.length>=y&&(this.flushChapter(s,e,a,_++),e=[],a=`Part ${_}`)}return e.length>0&&this.flushChapter(s,e,a,_++),s}flushChapter(k,r,g,l){const n=r.map(a=>`<p>${a}</p>`).join(`
`),s=Tt(n);let e=g.trim();k.push({id:crypto.randomUUID(),title:e,content:n,sortOrder:k.length,wordCount:s,estimatedReadTime:Math.ceil(s/250)})}async constructBookFromZip(k,r){const g=crypto.randomUUID();let l;if(r.coverPath){const e=k.file(r.coverPath);if(e){const a=await e.async("blob");l=URL.createObjectURL(a)}}const n=[],s=20;for(let e=0;e<r.spine.length;e+=s){const a=r.spine.slice(e,e+s);(await Promise.all(a.map((y,d)=>this.processEpubChapter(k,y,e+d)))).forEach(y=>{y&&n.push(y)}),e+s<r.spine.length&&await new Promise(y=>setTimeout(y,0))}if(n.length===0&&r.spine.length>0){console.warn("[Ingestion] No chapters extracted, trying without front-matter filter...");for(let e=0;e<r.spine.length;e++){const a=await this.processEpubChapterPermissive(k,r.spine[e],e);a&&n.push(a)}}return{id:g,title:r.metadata.title,author:r.metadata.author,coverUrl:l,lastOpened:new Date,isFinished:!1,bookmarkProgress:0,chapters:n}}async processEpubChapterPermissive(k,r,g){const l=k.file(r);if(!l)return console.warn(`[Ingestion] File not found: ${r}`),null;const n=await l.async("uint8array"),s=this.cleanTextAggressive(n),e=s.replace(/<[^>]+>/g," ").trim(),a=Tt(e);return a<3?null:{id:crypto.randomUUID(),title:`Section ${g+1}`,content:s,sortOrder:g,wordCount:a,estimatedReadTime:Math.ceil(a/250)}}async processEpubChapter(k,r,g){const l=k.file(r);if(!l)return null;const n=await l.async("uint8array"),s=this.cleanTextAggressive(n),e=s.replace(/<[^>]+>/g," ").trim(),a=Tt(e);return a<10||g<10&&this.isLikelyFrontMatter(e,a)?null:{id:crypto.randomUUID(),title:`Chapter ${g+1}`,content:s,sortOrder:g,wordCount:a,estimatedReadTime:Math.ceil(a/250)}}cleanTextAggressive(k){let r="";try{r=new TextDecoder("utf-8",{fatal:!0}).decode(k)}catch{r=new TextDecoder("windows-1252").decode(k)}return r=r.replace(/<(script|style|head)[^>]*>[\s\S]*?<\/\1>/gi,""),r=r.replace(/<br\s*\/?>/gi,"___BR___"),r=r.replace(/<\/(p|div|h\d|li|blockquote)>/gi,"___P___"),r=r.replace(/<[^>]+>/g,""),r=this.decodeEntities(r),r=r.replace(/\s+/g," "),r=r.replace(/___BR___/g,`
`),r=r.replace(/___P___/g,`

`),r.split(`

`).map(g=>g.trim()).filter(g=>g.length>0&&!/^\d+$/.test(g)).map(g=>`<p>${g}</p>`).join(`
`)}isLikelyFrontMatter(k,r){if(r>600)return!1;const g=k.toLowerCase().slice(0,1e3);return r<200&&/copyright|rights reserved|isbn|published by|table of contents|acknowledgments/.test(g)}decodeEntities(k){const r=document.createElement("textarea");return r.innerHTML=k,r.value}validateFile(k){if(!k.name.toLowerCase().endsWith(".epub")||k.size===0)throw new gt(_t.INVALID_FILE,"Invalid EPUB file.")}async unzipFromBuffer(k){try{return await new Ht().loadAsync(k)}catch(r){throw console.error("[Ingestion] ZIP extraction failed:",r),new gt(_t.CORRUPTION,`Corrupted archive: ${r instanceof Error?r.message:"Unknown error"}`)}}async unzip(k){const r=await k.arrayBuffer();return this.unzipFromBuffer(r)}async parseContainer(k){const r=k.file("META-INF/container.xml");if(!r)throw new gt(_t.MISSING_MANIFEST,"Missing container.xml");const l=(await r.async("string")).match(/full-path=["']([^"']+)["']/i);if(!l)throw new gt(_t.MISSING_MANIFEST,"Invalid container.xml");return l[1]}async parseOPF(k,r){const g=k.file(r);if(!g)throw new gt(_t.MISSING_MANIFEST,"Missing OPF");const l=await g.async("string"),n=l.match(/<dc:title[^>]*>(.*?)<\/dc:title>/is)?.[1]?.trim()||"Unknown",s=l.match(/<dc:creator[^>]*>(.*?)<\/dc:creator>/is)?.[1]?.trim()||"Unknown",e=new Map,a=/<item\s+([^>]+?)\s*\/?>/gi;let _;for(;(_=a.exec(l))!==null;){const o=_[1],f=o.match(/id=["']([^"']+)["']/i),h=o.match(/href=["']([^"']+)["']/i);f&&h&&e.set(f[1],h[1])}const y=[],d=/<itemref\s+[^>]*idref=["']([^"']+)["'][^>]*\/?>/gi;let b;for(;(b=d.exec(l))!==null;){const o=b[1],f=e.get(o);f&&y.push(this.resolvePath(r,f))}if(y.length===0){console.warn("[Ingestion] Empty spine, falling back to manifest HTML files");for(const[o,f]of e)/\.(x?html?|htm)$/i.test(f)&&y.push(this.resolvePath(r,f));y.sort()}const c=l.match(/<meta\s+name=["']cover["']\s+content=["']([^"']+)["']/i)?.[1];let m=c?e.get(c):void 0;return m&&(m=this.resolvePath(r,m)),{metadata:{title:n,author:s},spine:y,coverPath:m}}resolvePath(k,r){return(k.substring(0,k.lastIndexOf("/")+1)+r).replace(/\/+/g,"/")}}const Gt="570686176836-dtbdhnverff6qo63tfbgvmrts2oadqmp.apps.googleusercontent.com",qt="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.appdata";class vt{constructor(){this.accessToken=null,this.tokenExpiry=0,this.libraryFolderId=null}static getInstance(){return vt.instance||(vt.instance=new vt),vt.instance}get isAuthenticated(){return!!this.accessToken&&Date.now()<this.tokenExpiry}async init(){window.google&&(this.tokenClient=window.google.accounts.oauth2.initTokenClient({client_id:Gt,scope:qt,callback:k=>{if(k.error!==void 0)throw k;this.accessToken=k.access_token,this.tokenExpiry=Date.now()+Number(k.expires_in)*1e3-6e4}}))}async signIn(){return this.tokenClient||await this.init(),new Promise(k=>{this.tokenClient.callback=r=>{r.access_token&&(this.accessToken=r.access_token,this.tokenExpiry=Date.now()+Number(r.expires_in)*1e3-6e4,k())},this.accessToken&&Date.now()<this.tokenExpiry?k():this.tokenClient.requestAccessToken({prompt:"consent"})})}async fetch(k,r={}){this.isAuthenticated||await this.signIn();const g={Authorization:`Bearer ${this.accessToken}`,...r.headers||{}};r.body instanceof FormData?delete g["Content-Type"]:g["Content-Type"]||(g["Content-Type"]="application/json");const l=async s=>fetch(k,{...r,headers:s});let n=await l(g);return n.status===401&&(await this.signIn(),g.Authorization=`Bearer ${this.accessToken}`,n=await l(g)),!n.ok&&n.status!==404&&console.warn(`[DriveService] Request failed: ${k} (${n.status})`),n}async getUserInfo(){return(await(await this.fetch("https://www.googleapis.com/oauth2/v3/userinfo")).json()).email}async ensureLibraryFolder(){if(this.libraryFolderId)return this.libraryFolderId;const g=await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("mimeType='application/vnd.google-apps.folder' and name='Flow Library' and trashed=false")}`)).json();if(g.files&&g.files.length>0)return this.libraryFolderId=g.files[0].id,this.libraryFolderId;const n=await(await this.fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",body:JSON.stringify({name:"Flow Library",mimeType:"application/vnd.google-apps.folder"})})).json();return this.libraryFolderId=n.id,this.libraryFolderId}async uploadFile(k,r){const g=await this.ensureLibraryFolder(),l={name:k,parents:[g]},n=new FormData;return n.append("metadata",new Blob([JSON.stringify(l)],{type:"application/json"})),n.append("file",r),(await(await this.fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",body:n})).json()).id}async listBooks(){const r=`'${await this.ensureLibraryFolder()}' in parents and mimeType!='application/vnd.google-apps.folder' and trashed=false`;return(await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(r)}&fields=files(id, name, modifiedTime, size, mimeType)`)).json()).files||[]}async downloadFile(k){return(await this.fetch(`https://www.googleapis.com/drive/v3/files/${k}?alt=media`)).arrayBuffer()}async getSyncState(){const g=await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name='flow_state.json' and 'appDataFolder' in parents and trashed=false")}&spaces=appDataFolder`)).json();if(!g.files||g.files.length===0)return null;const l=g.files[0].id,n=await this.fetch(`https://www.googleapis.com/drive/v3/files/${l}?alt=media`);try{return await n.json()}catch{return null}}async saveSyncState(k){const l=await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name='flow_state.json' and 'appDataFolder' in parents and trashed=false")}&spaces=appDataFolder`)).json(),n=new Blob([JSON.stringify(k)],{type:"application/json"});if(l.files&&l.files.length>0){const s=l.files[0].id;await this.fetch(`https://www.googleapis.com/upload/drive/v3/files/${s}?uploadType=media`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:n})}else{const s={name:"flow_state.json",parents:["appDataFolder"]},e=new FormData;e.append("metadata",new Blob([JSON.stringify(s)],{type:"application/json"})),e.append("file",n),await this.fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",body:e})}}}class Ct{constructor(){this.status="idle",this.listeners=new Set,this.isSyncing=!1,this.pendingSync=!1,this.drive=vt.getInstance(),this.storage=pt.getInstance(),this.ingestion=wt.getInstance(),this.settings=Mt.getInstance()}static getInstance(){return Ct.instance||(Ct.instance=new Ct),Ct.instance}subscribe(k){return this.listeners.add(k),()=>this.listeners.delete(k)}notifyStatus(k){this.status=k,this.listeners.forEach(r=>r.onStatusChange?.(k))}async connect(){try{await this.drive.signIn();const k=await this.drive.getUserInfo();return this.settings.updateSettings({isSyncEnabled:!0,googleDriveEmail:k}),this.syncNow(!0),this.syncTimer&&clearInterval(this.syncTimer),this.syncTimer=setInterval(()=>this.syncNow(!1),3e5),k}catch(k){throw console.error(k),new Error("Failed to connect Google Drive")}}requestSync(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.syncNow(!1)},2e3)}async syncNow(k=!1){if(this.settings.getSettings().isSyncEnabled&&!(!k&&!this.drive.isAuthenticated)){if(this.isSyncing){this.pendingSync=!0;return}this.isSyncing=!0,this.notifyStatus("syncing");try{await this.syncState(),await this.syncBooks(),this.notifyStatus("success"),setTimeout(()=>this.notifyStatus("idle"),3e3)}catch(r){console.error("[SyncManager] Sync failed",r),this.notifyStatus("error")}finally{this.isSyncing=!1,this.pendingSync&&(this.pendingSync=!1,this.syncNow(!1))}}}async syncState(){const k=await this.storage.getAllMetadata(),r=await this.drive.getSyncState();if(!r){const n=this.buildSyncState(k);await this.drive.saveSyncState(n);return}if(r.preferences){const n=this.settings.getSettings();JSON.stringify(n)!==JSON.stringify(r.preferences)&&this.settings.updateSettings(r.preferences)}let g=!1;const l=r.books||{};for(const n of k){this.getFingerprint(n);let s=Object.keys(l).find(e=>{const a=l[e];return!!(n.driveId&&a.driveId===n.driveId)});if(s){const e=l[s],a=new Date(n.lastOpened).getTime(),_=e.lastOpened,y=_>a+1e4,d=a>_+1e4;y?await this.applyRemoteUpdate(n,e):d?(l[s]=this.mapBookToSyncEntry(n),g=!0):(e.progress||0)>(n.bookmarkProgress||0)?await this.applyRemoteUpdate(n,e):(n.bookmarkProgress||0)>(e.progress||0)&&(l[s]=this.mapBookToSyncEntry(n),g=!0)}else l[n.id]=this.mapBookToSyncEntry(n),g=!0}g&&(r.timestamp=Date.now(),r.books=l,await this.drive.saveSyncState(r))}async syncBooks(){const k=await this.drive.listBooks(),r=await this.storage.getAllMetadata(),g=new Map,l=new Map;r.forEach(n=>{n.driveId&&g.set(n.driveId,n),l.set(this.getFingerprint(n),n)});for(const n of k){if(g.has(n.id))continue;const s=this.parseFilename(n.name),e=`${s.title}|${s.author}`,a=r.find(y=>y.title===s.title&&y.author===s.author);if(a&&await this.storage.wasDeletionRecorded(a.id))continue;const _=l.get(e);if(_){_.driveId=n.id,await this.storage.saveBook(_);continue}try{const y=await this.drive.downloadFile(n.id);let d;const b=n.name.toLowerCase().endsWith(".txt")||n.mimeType==="text/plain";if(b){const m=new TextDecoder().decode(y);d=await this.ingestion.ingestFromText(s.title,s.author,m)}else{const c=new Blob([y],{type:"application/epub+zip"}),m=new File([c],n.name,{type:"application/epub+zip"});d=await this.ingestion.ingest(m)}d.driveId=n.id,d.sourceType=b?"text":"epub",await this.storage.saveBook(d),this.listeners.forEach(c=>c.onNewBook?.(d))}catch(y){console.error(`[Sync] Download failed for ${n.name}`,y)}}for(const n of r)if(!n.driveId)try{const s=await this.storage.getSource(n.id);if(s){let e,a;n.sourceType==="text"?(e=new Blob([s],{type:"text/plain"}),a=`${this.sanitizeFilename(n.title)} - ${this.sanitizeFilename(n.author)}.txt`):(e=new Blob([s],{type:"application/epub+zip"}),a=`${this.sanitizeFilename(n.title)}.epub`);const _=await this.drive.uploadFile(a,e);n.driveId=_,await this.storage.saveBook(n)}}catch(s){console.error(`[Sync] Upload failed for ${n.title}`,s)}}async applyRemoteUpdate(k,r){(k.bookmarkProgress!==r.progress||k.isFinished!==r.isFinished)&&(k.bookmarkProgress=r.progress,k.lastTokenIndex=r.lastTokenIndex,k.isFinished=r.isFinished,k.lastOpened=new Date(r.lastOpened),await this.storage.saveBook(k),this.listeners.forEach(g=>g.onNewBook?.(k)))}buildSyncState(k){const r={version:1,timestamp:Date.now(),books:{},preferences:this.settings.getSettings()};return k.forEach(g=>{r.books[g.id]=this.mapBookToSyncEntry(g)}),r}mapBookToSyncEntry(k){return{progress:k.bookmarkProgress,lastTokenIndex:k.lastTokenIndex,isFinished:k.isFinished,lastOpened:new Date(k.lastOpened).getTime(),driveId:k.driveId}}getFingerprint(k){return`${k.title.trim().toLowerCase()}|${k.author.trim().toLowerCase()}`}parseFilename(k){const r=k.replace(/\.(txt|epub)$/i,""),g=r.split(" - ");return g.length>=2?{title:g[0].trim(),author:g.slice(1).join(" - ").trim()}:{title:r.trim(),author:"Unknown Author"}}sanitizeFilename(k){return k.replace(/[^a-z0-9 \-_]/gi,"").trim()}resolveConflict(k,r){k.bookmarkProgress=r,this.storage.saveBook(k),this.listeners.forEach(g=>g.onNewBook?.(k))}}const Kt=[{title:"Frankenstein",author:"Mary Shelley",summary:"A scientist creates a sentient creature in a unorthodox scientific experiment. Gothic sci-fi vibes.",moodColor:"#56494E",genre:"Gothic Fiction",tags:["Sci-Fi","Classic","Horror"],gutenbergId:"84"},{title:"Pride and Prejudice",author:"Jane Austen",summary:"The turbulent relationship between Elizabeth Bennet and Fitzwilliam Darcy. Witty and romantic.",moodColor:"#D8A49B",genre:"Romance",tags:["Social Commentary","Classic"],gutenbergId:"1342"},{title:"Dracula",author:"Bram Stoker",summary:"Count Dracula's attempt to move from Transylvania to England. The ultimate vampire horror.",moodColor:"#740001",genre:"Horror",tags:["Epistolary","Classic","Vampires"],gutenbergId:"345"},{title:"The Great Gatsby",author:"F. Scott Fitzgerald",summary:"A portrait of the Jazz Age in all its decadence and excess. Tragic glamour.",moodColor:"#E3C565",genre:"Modernist Fiction",tags:["Jazz Age","American Classic"],gutenbergId:"64317"},{title:"Moby Dick",author:"Herman Melville",summary:"The narrative of the sailor Ishmael and the obsessive quest of Ahab. Deep ocean madness.",moodColor:"#476C9B",genre:"Adventure",tags:["Nautical","Classic"],gutenbergId:"2701"},{title:"Alice's Adventures in Wonderland",author:"Lewis Carroll",summary:"A young girl named Alice falls through a rabbit hole into a fantasy world. Surreal and trippy.",moodColor:"#6D9DC5",genre:"Fantasy",tags:["Surrealism","Classic","Children"],gutenbergId:"11"},{title:"The Picture of Dorian Gray",author:"Oscar Wilde",summary:"A philosophical novel about a man whose portrait ages while he stays young. Aesthetic hedonism.",moodColor:"#2E4052",genre:"Philosophical Fiction",tags:["Aestheticism","Classic"],gutenbergId:"174"},{title:"The Adventures of Sherlock Holmes",author:"Arthur Conan Doyle",summary:"A consulting detective known for his proficiency with observation and deduction. Foggy London mystery.",moodColor:"#5C5C5C",genre:"Mystery",tags:["Detective","Classic"],gutenbergId:"1661"},{title:"The Metamorphosis",author:"Franz Kafka",summary:"Salesman Gregor Samsa wakes one morning to find himself inexplicably transformed. Existential dread.",moodColor:"#556B2F",genre:"Existentialism",tags:["Absurdist","Classic"],gutenbergId:"5200"},{title:"Wuthering Heights",author:"Emily Bront",summary:"A tale of the all-encompassing and passionate, yet thwarted, love. Windy moors and ghosts.",moodColor:"#483C46",genre:"Gothic Romance",tags:["Moors","Classic"],gutenbergId:"768"}],Yt=it=>{let k=0;for(let g=0;g<it.length;g++)k=it.charCodeAt(g)+((k<<5)-k);const r=(k&16777215).toString(16).toUpperCase();return"#"+"00000".substring(0,6-r.length)+r};class It{constructor(){}static getInstance(){return It.instance||(It.instance=new It),It.instance}getFeaturedBooks(){return Kt.map(k=>({...k,coverUrl:k.coverUrl||`https://www.gutenberg.org/cache/epub/${k.gutenbergId}/pg${k.gutenbergId}.cover.medium.jpg`}))}async searchCuratedBooks(k){const r=k.trim();if(!r)return this.getFeaturedBooks();const g=`https://gutendex.com/books/?search=${encodeURIComponent(r)}`,l=`https://gutendex.com/books/?topic=${encodeURIComponent(r)}`;try{const[n,s]=await Promise.all([fetch(g).then(d=>d.json()),fetch(l).then(d=>d.json())]),e=n.results||[],a=s.results||[],_=new Set,y=[];return[...e,...a].forEach(d=>{_.has(d.id)||(_.add(d.id),y.push(d))}),y.filter(d=>Object.keys(d.formats).some(b=>b.startsWith("text/plain"))).slice(0,20).map(d=>{const b=d.authors.length>0?d.authors[0].name.replace(/,/,""):"Unknown Author",c=d.formats["image/jpeg"]||d.formats["image/png"]||`https://www.gutenberg.org/cache/epub/${d.id}/pg${d.id}.cover.medium.jpg`,m=d.subjects.length>0?d.subjects[0].split(" -- ")[0]:"Classic",o=d.subjects.map(f=>f.split(" -- ")[0]).slice(0,3);return{title:d.title,author:b,summary:d.summaries&&d.summaries.length>0?d.summaries[0]:`A ${m} masterpiece by ${b}.`,genre:m,tags:o,moodColor:Yt(d.title),gutenbergId:d.id.toString(),coverUrl:c}})}catch(n){return console.error("Discovery search failed",n),[]}}async downloadBook(k){if(!k.gutenbergId)throw new Error("Cannot download book without Gutenberg ID");try{const r=k.gutenbergId,g=`https://api.github.com/search/repositories?q=${r}+in:name+user:GITenberg`,l=await fetch(g);if(!l.ok)throw new Error("Could not locate book repository.");const n=await l.json();if(!n.items||n.items.length===0)throw new Error("Book not found in GITenberg archives.");const s=n.items[0],e=s.default_branch||"master",_=`https://raw.githubusercontent.com/GITenberg/${s.name}/${e}/${r}.txt`,y=await fetch(_);if(!y.ok)throw new Error("Failed to retrieve text content from archive.");const d=await y.text();if(d.trim().startsWith("<!DOCTYPE html>")||d.length<500)throw new Error("Downloaded content appears invalid.");return wt.getInstance().ingestFromText(k.title,k.author,d,k.moodColor,k.coverUrl)}catch(r){throw console.error("[CloudService] Download failed",r),new Error("Could not download book. Please try another title.")}}}export{bt as C,vt as G,wt as I,Ct as S,pt as T,It as a,Tt as c,Xt as g};
