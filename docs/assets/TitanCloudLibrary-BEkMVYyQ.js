import{r as i,j as e,A as y,m as f}from"./animations-D9Wo9mUM.js";import{a as z}from"./cloud-Be3Yh6fZ.js";import{u as L}from"./index-C5M5FrMl.js";import{w as E,X as B,x as D,S as $,y as A,r as R,D as G,z as I,a as U,A as P}from"./icons-B3aCiBot.js";import"./rsvp-eqVIbU96.js";import"./vendor-react-uIRdnfX0.js";const q=["philosophy","gothic","sci-fi","adventure","poetry","mystery"],M=({existingBooks:v,onClose:N,onImport:C,onOpen:k})=>{const s=L(),m=z.getInstance(),[c,u]=i.useState(""),[n,p]=i.useState([]),[d,g]=i.useState(!1),[j,x]=i.useState({});i.useEffect(()=>{h()},[]);const h=async()=>{u(""),p(m.getFeaturedBooks())},b=async(t,o)=>{t?.preventDefault();const a=o!==void 0?o:c;if(!a.trim()){h();return}g(!0),p([]);try{const r=await m.searchCuratedBooks(a);p(r)}catch(r){console.error(r)}finally{g(!1)}};i.useEffect(()=>{c.trim()===""&&h()},[c]);const S=async t=>{const o=t.title,a=j[o]||"idle";if(!(a==="loading"||a==="success")){x(r=>({...r,[o]:"loading"}));try{const r=await m.downloadBook(t);C(r),x(l=>({...l,[o]:"success"}))}catch(r){console.error(`Failed to download ${t.title}`,r),x(l=>({...l,[o]:"error"})),setTimeout(()=>{x(l=>({...l,[o]:"idle"}))},3e3)}}},T=t=>{switch(t){case"loading":return e.jsxs("div",{className:"flex items-center gap-2 relative w-full justify-center h-full",children:[e.jsx(P,{size:16,className:"animate-spin"}),e.jsx("span",{className:"lowercase",children:"retrieving..."})]});case"success":return e.jsxs(e.Fragment,{children:[e.jsx(U,{size:16}),e.jsx("span",{className:"lowercase",children:"added to shelf"})]});case"error":return e.jsxs(e.Fragment,{children:[e.jsx(I,{size:16}),e.jsx("span",{className:"lowercase",children:"failed. retry?"})]});default:return e.jsxs(e.Fragment,{children:[e.jsx(G,{size:16}),e.jsx("span",{className:"lowercase",children:"add to shelf"})]})}},F=(t,o)=>{const a={border:"none",color:"#FFF",backgroundColor:o||s.accent};return t==="loading"?{...a,backgroundColor:s.surface,color:s.primaryText,border:`1px solid ${s.borderColor}`,cursor:"wait"}:t==="success"?{...a,backgroundColor:"#10b981"}:t==="error"?{...a,backgroundColor:"#ef4444"}:a},w=n.length>0&&n[0].isCopyrightedReplacement;return e.jsxs("div",{className:"flex flex-col h-full bg-[#F2F2F7] dark:bg-black transition-colors",style:{backgroundColor:s.background},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-5 border-b",style:{borderColor:s.borderColor},children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{size:24,style:{color:s.accent}}),e.jsx("h2",{className:"text-2xl font-serif font-black lowercase tracking-tight leading-none",style:{color:s.primaryText},children:"visit the library"})]}),e.jsx("p",{className:"text-xs font-medium opacity-60 lowercase max-w-[240px]",style:{color:s.secondaryText},children:"70,000+ free public domain ebooks"})]}),e.jsx("button",{onClick:N,className:"p-3 -mr-3 rounded-full hover:bg-black/5 transition-colors",children:e.jsx(B,{size:24,style:{color:s.secondaryText}})})]}),e.jsxs("div",{className:"px-6 pt-4 pb-2",children:[e.jsxs("form",{onSubmit:b,className:"relative group",children:[e.jsx("input",{type:"text",placeholder:"search title, author, genre, or keyword...",value:c,onChange:t=>u(t.target.value),className:"w-full h-12 pl-11 pr-4 rounded-xl text-base font-medium outline-none transition-all shadow-sm focus:shadow-md",style:{backgroundColor:s.surface,color:s.primaryText,border:`1px solid ${s.borderColor}`}}),e.jsx(D,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 opacity-40 group-focus-within:opacity-100 transition-opacity",style:{color:s.primaryText}})]}),!c&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3 animate-fadeIn",children:q.map(t=>e.jsx("button",{onClick:()=>{u(t),b(void 0,t)},className:"px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest border transition-all active:scale-95 opacity-50 hover:opacity-100",style:{backgroundColor:s.surface,borderColor:s.borderColor,color:s.primaryText},children:t},t))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 pb-20 pt-4 custom-scrollbar",children:[e.jsx(y,{children:d&&e.jsxs(f.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-center justify-center gap-2 py-6 mb-2 text-sm font-medium",style:{color:s.secondaryText},children:[e.jsx($,{className:"animate-pulse",size:16,style:{color:s.accent}}),e.jsx("span",{className:"lowercase",children:"scanning project gutenberg..."})]})}),e.jsx(y,{children:!d&&w&&e.jsxs(f.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-2xl flex items-start gap-4 border",style:{backgroundColor:s.surface,borderColor:s.borderColor},children:[e.jsx("div",{className:"p-2 rounded-full bg-neutral-100 shrink-0",children:e.jsx(A,{size:16,className:"text-neutral-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm lowercase mb-1",style:{color:s.primaryText},children:"locked in the vault"}),e.jsx("p",{className:"text-xs font-medium leading-relaxed opacity-70 lowercase",style:{color:s.secondaryText},children:"that book is still under copyright. here are some similar public domain classics."})]})]})}),!d&&!w&&n.length>0&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 opacity-50",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest",style:{color:s.secondaryText},children:c?"results":"featured"}),e.jsx("div",{className:"h-px flex-1 bg-current opacity-20",style:{color:s.secondaryText}})]}),!d&&n.length===0&&c&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-center opacity-60",children:[e.jsxs("p",{className:"font-serif italic text-lg lowercase",style:{color:s.secondaryText},children:['"no matches found in ',activeSource.name.toLowerCase(),'"']}),e.jsx("p",{className:"text-xs mt-2 opacity-60",style:{color:s.secondaryText},children:"try a different search or browse another source"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(y,{mode:"popLayout",children:n.map((t,o)=>{const a=v.find(l=>l.title.trim().toLowerCase()===t.title.trim().toLowerCase()&&l.author.trim().toLowerCase()===t.author.trim().toLowerCase()),r=j[t.title]||"idle";return e.jsxs(f.div,{layout:!0,initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2,delay:o*.03},className:"relative p-5 rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-shadow group border",style:{backgroundColor:s.surface,borderColor:s.borderColor},children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 rounded-full blur-[60px] opacity-[0.12] transition-opacity group-hover:opacity-[0.2]",style:{backgroundColor:t.moodColor||s.accent}}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-3 mb-3",children:[t.coverUrl&&e.jsx("img",{src:t.coverUrl,alt:"",className:"w-12 h-16 object-cover rounded-lg shadow-sm shrink-0",onError:l=>l.currentTarget.style.display="none"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-serif font-bold text-base leading-tight mb-0.5 line-clamp-2",style:{color:s.primaryText},children:t.title}),e.jsx("p",{className:"text-xs font-medium opacity-60 uppercase tracking-wider",style:{color:s.primaryText},children:t.author})]})]}),t.genre&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mb-3",children:e.jsx("span",{className:"px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-tight",style:{backgroundColor:`${s.accent}15`,color:s.accent},children:t.genre})}),e.jsx("p",{className:"text-xs leading-relaxed opacity-70 line-clamp-2",style:{color:s.secondaryText},children:t.summary})]}),a?e.jsxs("button",{onClick:()=>k(a),className:"mt-4 flex items-center justify-center gap-2 w-full h-10 rounded-xl font-bold text-sm transition-all active:scale-95 shadow-sm hover:shadow-md",style:{backgroundColor:s.accent,color:"#FFF"},children:[e.jsx(R,{size:14,fill:"currentColor"}),e.jsx("span",{className:"lowercase",children:"open book"})]}):e.jsx("button",{onClick:()=>S(t),disabled:r==="loading"||r==="success",className:"mt-4 flex items-center justify-center gap-2 w-full h-10 rounded-xl font-bold text-sm transition-all active:scale-95 disabled:opacity-90 disabled:scale-100 shadow-sm hover:shadow-md overflow-hidden relative",style:F(r,t.moodColor),children:T(r)})]})]},`gutenberg-${t.title}`)})})})]})]})};export{M as TitanCloudLibrary,M as default};
