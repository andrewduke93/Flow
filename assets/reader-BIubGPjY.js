var Ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var pn={exports:{}},ke={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Es;function Co(){if(Es)return ke;Es=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(s,r,i){var a=null;if(i!==void 0&&(a=""+i),r.key!==void 0&&(a=""+r.key),"key"in r){i={};for(var o in r)o!=="key"&&(i[o]=r[o])}else i=r;return r=i.ref,{$$typeof:e,type:s,key:a,ref:r!==void 0?r:null,props:i}}return ke.Fragment=t,ke.jsx=n,ke.jsxs=n,ke}var As;function Po(){return As||(As=1,pn.exports=Co()),pn.exports}var I=Po(),mn={exports:{}},dt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rs;function Io(){if(Rs)return dt;Rs=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),m=Symbol.iterator;function f(w){return w===null||typeof w!="object"?null:(w=m&&w[m]||w["@@iterator"],typeof w=="function"?w:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,v={};function g(w,C,K){this.props=w,this.context=C,this.refs=v,this.updater=K||x}g.prototype.isReactComponent={},g.prototype.setState=function(w,C){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,C,"setState")},g.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function b(){}b.prototype=g.prototype;function k(w,C,K){this.props=w,this.context=C,this.refs=v,this.updater=K||x}var P=k.prototype=new b;P.constructor=k,h(P,g.prototype),P.isPureReactComponent=!0;var T=Array.isArray;function M(){}var A={H:null,A:null,T:null,S:null},D=Object.prototype.hasOwnProperty;function F(w,C,K){var V=K.ref;return{$$typeof:e,type:w,key:C,ref:V!==void 0?V:null,props:K}}function W(w,C){return F(w.type,C,w.props)}function Z(w){return typeof w=="object"&&w!==null&&w.$$typeof===e}function E(w){var C={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(K){return C[K]})}var z=/\/+/g;function y(w,C){return typeof w=="object"&&w!==null&&w.key!=null?E(""+w.key):C.toString(36)}function B(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(M,M):(w.status="pending",w.then(function(C){w.status==="pending"&&(w.status="fulfilled",w.value=C)},function(C){w.status==="pending"&&(w.status="rejected",w.reason=C)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function tt(w,C,K,V,$){var lt=typeof w;(lt==="undefined"||lt==="boolean")&&(w=null);var ut=!1;if(w===null)ut=!0;else switch(lt){case"bigint":case"string":case"number":ut=!0;break;case"object":switch(w.$$typeof){case e:case t:ut=!0;break;case c:return ut=w._init,tt(ut(w._payload),C,K,V,$)}}if(ut)return $=$(w),ut=V===""?"."+y(w,0):V,T($)?(K="",ut!=null&&(K=ut.replace(z,"$&/")+"/"),tt($,C,K,"",function(Y){return Y})):$!=null&&(Z($)&&($=W($,K+($.key==null||w&&w.key===$.key?"":(""+$.key).replace(z,"$&/")+"/")+ut)),C.push($)),1;ut=0;var Q=V===""?".":V+":";if(T(w))for(var nt=0;nt<w.length;nt++)V=w[nt],lt=Q+y(V,nt),ut+=tt(V,C,K,lt,$);else if(nt=f(w),typeof nt=="function")for(w=nt.call(w),nt=0;!(V=w.next()).done;)V=V.value,lt=Q+y(V,nt++),ut+=tt(V,C,K,lt,$);else if(lt==="object"){if(typeof w.then=="function")return tt(B(w),C,K,V,$);throw C=String(w),Error("Objects are not valid as a React child (found: "+(C==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":C)+"). If you meant to render a collection of children, use an array instead.")}return ut}function U(w,C,K){if(w==null)return w;var V=[],$=0;return tt(w,V,"","",function(lt){return C.call(K,lt,$++)}),V}function ot(w){if(w._status===-1){var C=w._result;C=C(),C.then(function(K){(w._status===0||w._status===-1)&&(w._status=1,w._result=K)},function(K){(w._status===0||w._status===-1)&&(w._status=2,w._result=K)}),w._status===-1&&(w._status=0,w._result=C)}if(w._status===1)return w._result.default;throw w._result}var G=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var C=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(C))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)},at={map:U,forEach:function(w,C,K){U(w,function(){C.apply(this,arguments)},K)},count:function(w){var C=0;return U(w,function(){C++}),C},toArray:function(w){return U(w,function(C){return C})||[]},only:function(w){if(!Z(w))throw Error("React.Children.only expected to receive a single React element child.");return w}};return dt.Activity=p,dt.Children=at,dt.Component=g,dt.Fragment=n,dt.Profiler=r,dt.PureComponent=k,dt.StrictMode=s,dt.Suspense=l,dt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,dt.__COMPILER_RUNTIME={__proto__:null,c:function(w){return A.H.useMemoCache(w)}},dt.cache=function(w){return function(){return w.apply(null,arguments)}},dt.cacheSignal=function(){return null},dt.cloneElement=function(w,C,K){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var V=h({},w.props),$=w.key;if(C!=null)for(lt in C.key!==void 0&&($=""+C.key),C)!D.call(C,lt)||lt==="key"||lt==="__self"||lt==="__source"||lt==="ref"&&C.ref===void 0||(V[lt]=C[lt]);var lt=arguments.length-2;if(lt===1)V.children=K;else if(1<lt){for(var ut=Array(lt),Q=0;Q<lt;Q++)ut[Q]=arguments[Q+2];V.children=ut}return F(w.type,$,V)},dt.createContext=function(w){return w={$$typeof:a,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:i,_context:w},w},dt.createElement=function(w,C,K){var V,$={},lt=null;if(C!=null)for(V in C.key!==void 0&&(lt=""+C.key),C)D.call(C,V)&&V!=="key"&&V!=="__self"&&V!=="__source"&&($[V]=C[V]);var ut=arguments.length-2;if(ut===1)$.children=K;else if(1<ut){for(var Q=Array(ut),nt=0;nt<ut;nt++)Q[nt]=arguments[nt+2];$.children=Q}if(w&&w.defaultProps)for(V in ut=w.defaultProps,ut)$[V]===void 0&&($[V]=ut[V]);return F(w,lt,$)},dt.createRef=function(){return{current:null}},dt.forwardRef=function(w){return{$$typeof:o,render:w}},dt.isValidElement=Z,dt.lazy=function(w){return{$$typeof:c,_payload:{_status:-1,_result:w},_init:ot}},dt.memo=function(w,C){return{$$typeof:u,type:w,compare:C===void 0?null:C}},dt.startTransition=function(w){var C=A.T,K={};A.T=K;try{var V=w(),$=A.S;$!==null&&$(K,V),typeof V=="object"&&V!==null&&typeof V.then=="function"&&V.then(M,G)}catch(lt){G(lt)}finally{C!==null&&K.types!==null&&(C.types=K.types),A.T=C}},dt.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},dt.use=function(w){return A.H.use(w)},dt.useActionState=function(w,C,K){return A.H.useActionState(w,C,K)},dt.useCallback=function(w,C){return A.H.useCallback(w,C)},dt.useContext=function(w){return A.H.useContext(w)},dt.useDebugValue=function(){},dt.useDeferredValue=function(w,C){return A.H.useDeferredValue(w,C)},dt.useEffect=function(w,C){return A.H.useEffect(w,C)},dt.useEffectEvent=function(w){return A.H.useEffectEvent(w)},dt.useId=function(){return A.H.useId()},dt.useImperativeHandle=function(w,C,K){return A.H.useImperativeHandle(w,C,K)},dt.useInsertionEffect=function(w,C){return A.H.useInsertionEffect(w,C)},dt.useLayoutEffect=function(w,C){return A.H.useLayoutEffect(w,C)},dt.useMemo=function(w,C){return A.H.useMemo(w,C)},dt.useOptimistic=function(w,C){return A.H.useOptimistic(w,C)},dt.useReducer=function(w,C,K){return A.H.useReducer(w,C,K)},dt.useRef=function(w){return A.H.useRef(w)},dt.useState=function(w){return A.H.useState(w)},dt.useSyncExternalStore=function(w,C,K){return A.H.useSyncExternalStore(w,C,K)},dt.useTransition=function(){return A.H.useTransition()},dt.version="19.2.3",dt}var js;function Eo(){return js||(js=1,mn.exports=Io()),mn.exports}var j=Eo();const Ao=Zr(j),Xn=j.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),on=j.createContext({}),an=j.createContext(null),Jn=typeof document<"u",Qn=Jn?j.useLayoutEffect:j.useEffect,Yr=j.createContext({strict:!1}),ts=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Ro="framerAppearId",Xr="data-"+ts(Ro),jo={useManualTiming:!1};class Ms{constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const n=this.order.indexOf(t);n!==-1&&(this.order.splice(n,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function Mo(e){let t=new Ms,n=new Ms,s=0,r=!1,i=!1;const a=new WeakSet,o={schedule:(l,u=!1,c=!1)=>{const p=c&&r,m=p?t:n;return u&&a.add(l),m.add(l)&&p&&r&&(s=t.order.length),l},cancel:l=>{n.remove(l),a.delete(l)},process:l=>{if(r){i=!0;return}if(r=!0,[t,n]=[n,t],n.clear(),s=t.order.length,s)for(let u=0;u<s;u++){const c=t.order[u];a.has(c)&&(o.schedule(c),e()),c(l)}r=!1,i&&(i=!1,o.process(l))}};return o}const $e=["read","resolveKeyframes","update","preRender","render","postRender"],No=40;function Jr(e,t){let n=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=$e.reduce((p,m)=>(p[m]=Mo(()=>n=!0),p),{}),a=p=>{i[p].process(r)},o=()=>{const p=performance.now();n=!1,r.delta=s?1e3/60:Math.max(Math.min(p-r.timestamp,No),1),r.timestamp=p,r.isProcessing=!0,$e.forEach(a),r.isProcessing=!1,n&&t&&(s=!1,e(o))},l=()=>{n=!0,s=!0,r.isProcessing||e(o)};return{schedule:$e.reduce((p,m)=>{const f=i[m];return p[m]=(x,h=!1,v=!1)=>(n||l(),f.schedule(x,h,v)),p},{}),cancel:p=>$e.forEach(m=>i[m].cancel(p)),state:r,steps:i}}const{schedule:es}=Jr(queueMicrotask,!1);function Fo(e,t,n,s){const{visualElement:r}=j.useContext(on),i=j.useContext(Yr),a=j.useContext(an),o=j.useContext(Xn).reducedMotion,l=j.useRef();s=s||i.renderer,!l.current&&s&&(l.current=s(e,{visualState:t,parent:r,props:n,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:o}));const u=l.current;j.useInsertionEffect(()=>{u&&u.update(n,a)});const c=j.useRef(!!(n[Xr]&&!window.HandoffComplete));return Qn(()=>{u&&(es.postRender(u.render),c.current&&u.animationState&&u.animationState.animateChanges())}),j.useEffect(()=>{u&&(u.updateFeatures(),!c.current&&u.animationState&&u.animationState.animateChanges(),c.current&&(c.current=!1,window.HandoffComplete=!0))}),u}function he(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Do(e,t,n){return j.useCallback(s=>{s&&e.mount&&e.mount(s),t&&(s?t.mount(s):t.unmount()),n&&(typeof n=="function"?n(s):he(n)&&(n.current=s))},[t])}function Re(e){return typeof e=="string"||Array.isArray(e)}function ln(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const ns=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ss=["initial",...ns];function cn(e){return ln(e.animate)||ss.some(t=>Re(e[t]))}function Qr(e){return!!(cn(e)||e.variants)}function Oo(e,t){if(cn(e)){const{initial:n,animate:s}=e;return{initial:n===!1||Re(n)?n:void 0,animate:Re(s)?s:void 0}}return e.inherit!==!1?t:{}}function Lo(e){const{initial:t,animate:n}=Oo(e,j.useContext(on));return j.useMemo(()=>({initial:t,animate:n}),[Ns(t),Ns(n)])}function Ns(e){return Array.isArray(e)?e.join(" "):e}const Fs={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},je={};for(const e in Fs)je[e]={isEnabled:t=>Fs[e].some(n=>!!t[n])};function zo(e){for(const t in e)je[t]={...je[t],...e[t]}}const rs=j.createContext({}),ti=j.createContext({}),Bo=Symbol.for("motionComponentSymbol");function Vo({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:s,Component:r}){e&&zo(e);function i(o,l){let u;const c={...j.useContext(Xn),...o,layoutId:Uo(o)},{isStatic:p}=c,m=Lo(o),f=s(o,p);if(!p&&Jn){m.visualElement=Fo(r,f,c,t);const x=j.useContext(ti),h=j.useContext(Yr).strict;m.visualElement&&(u=m.visualElement.loadFeatures(c,h,e,x))}return I.jsxs(on.Provider,{value:m,children:[u&&m.visualElement?I.jsx(u,{visualElement:m.visualElement,...c}):null,n(r,o,Do(f,m.visualElement,l),f,p,m.visualElement)]})}const a=j.forwardRef(i);return a[Bo]=r,a}function Uo({layoutId:e}){const t=j.useContext(rs).id;return t&&e!==void 0?t+"-"+e:e}function $o(e){function t(s,r={}){return Vo(e(s,r))}if(typeof Proxy>"u")return t;const n=new Map;return new Proxy(t,{get:(s,r)=>(n.has(r)||n.set(r,t(r)),n.get(r))})}const Wo=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function is(e){return typeof e!="string"||e.includes("-")?!1:!!(Wo.indexOf(e)>-1||/[A-Z]/u.test(e))}const Ye={};function Ho(e){Object.assign(Ye,e)}const Fe=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],le=new Set(Fe);function ei(e,{layout:t,layoutId:n}){return le.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!Ye[e]||e==="opacity")}const kt=e=>!!(e&&e.getVelocity),Go={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},qo=Fe.length;function Ko(e,{enableHardwareAcceleration:t=!0,allowTransformNone:n=!0},s,r){let i="";for(let a=0;a<qo;a++){const o=Fe[a];if(e[o]!==void 0){const l=Go[o]||o;i+=`${l}(${e[o]}) `}}return t&&!e.z&&(i+="translateZ(0)"),i=i.trim(),r?i=r(e,s?"":i):n&&s&&(i="none"),i}const ni=e=>t=>typeof t=="string"&&t.startsWith(e),si=ni("--"),Zo=ni("var(--"),os=e=>Zo(e)?Yo.test(e.split("/*")[0].trim()):!1,Yo=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Xo=(e,t)=>t&&typeof e=="number"?t.transform(e):e,qt=(e,t,n)=>n>t?t:n<e?e:n,ve={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Ce={...ve,transform:e=>qt(0,1,e)},We={...ve,default:1},Pe=e=>Math.round(e*1e5)/1e5,as=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,Jo=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,Qo=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function De(e){return typeof e=="string"}const Oe=e=>({test:t=>De(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Ut=Oe("deg"),Ft=Oe("%"),ht=Oe("px"),ta=Oe("vh"),ea=Oe("vw"),Ds={...Ft,parse:e=>Ft.parse(e)/100,transform:e=>Ft.transform(e*100)},Os={...ve,transform:Math.round},ri={borderWidth:ht,borderTopWidth:ht,borderRightWidth:ht,borderBottomWidth:ht,borderLeftWidth:ht,borderRadius:ht,radius:ht,borderTopLeftRadius:ht,borderTopRightRadius:ht,borderBottomRightRadius:ht,borderBottomLeftRadius:ht,width:ht,maxWidth:ht,height:ht,maxHeight:ht,size:ht,top:ht,right:ht,bottom:ht,left:ht,padding:ht,paddingTop:ht,paddingRight:ht,paddingBottom:ht,paddingLeft:ht,margin:ht,marginTop:ht,marginRight:ht,marginBottom:ht,marginLeft:ht,rotate:Ut,rotateX:Ut,rotateY:Ut,rotateZ:Ut,scale:We,scaleX:We,scaleY:We,scaleZ:We,skew:Ut,skewX:Ut,skewY:Ut,distance:ht,translateX:ht,translateY:ht,translateZ:ht,x:ht,y:ht,z:ht,perspective:ht,transformPerspective:ht,opacity:Ce,originX:Ds,originY:Ds,originZ:ht,zIndex:Os,backgroundPositionX:ht,backgroundPositionY:ht,fillOpacity:Ce,strokeOpacity:Ce,numOctaves:Os};function ls(e,t,n,s){const{style:r,vars:i,transform:a,transformOrigin:o}=e;let l=!1,u=!1,c=!0;for(const p in t){const m=t[p];if(si(p)){i[p]=m;continue}const f=ri[p],x=Xo(m,f);if(le.has(p)){if(l=!0,a[p]=x,!c)continue;m!==(f.default||0)&&(c=!1)}else p.startsWith("origin")?(u=!0,o[p]=x):r[p]=x}if(t.transform||(l||s?r.transform=Ko(e.transform,n,c,s):r.transform&&(r.transform="none")),u){const{originX:p="50%",originY:m="50%",originZ:f=0}=o;r.transformOrigin=`${p} ${m} ${f}`}}const cs=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ii(e,t,n){for(const s in t)!kt(t[s])&&!ei(s,n)&&(e[s]=t[s])}function na({transformTemplate:e},t,n){return j.useMemo(()=>{const s=cs();return ls(s,t,{enableHardwareAcceleration:!n},e),Object.assign({},s.vars,s.style)},[t])}function sa(e,t,n){const s=e.style||{},r={};return ii(r,s,e),Object.assign(r,na(e,t,n)),r}function ra(e,t,n){const s={},r=sa(e,t,n);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=r,s}const ia=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Xe(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||ia.has(e)}let oi=e=>!Xe(e);function oa(e){e&&(oi=t=>t.startsWith("on")?!Xe(t):e(t))}try{oa(require("@emotion/is-prop-valid").default)}catch{}function aa(e,t,n){const s={};for(const r in e)r==="values"&&typeof e.values=="object"||(oi(r)||n===!0&&Xe(r)||!t&&!Xe(r)||e.draggable&&r.startsWith("onDrag"))&&(s[r]=e[r]);return s}function Ls(e,t,n){return typeof e=="string"?e:ht.transform(t+n*e)}function la(e,t,n){const s=Ls(t,e.x,e.width),r=Ls(n,e.y,e.height);return`${s} ${r}`}const ca={offset:"stroke-dashoffset",array:"stroke-dasharray"},ua={offset:"strokeDashoffset",array:"strokeDasharray"};function ha(e,t,n=1,s=0,r=!0){e.pathLength=1;const i=r?ca:ua;e[i.offset]=ht.transform(-s);const a=ht.transform(t),o=ht.transform(n);e[i.array]=`${a} ${o}`}function us(e,{attrX:t,attrY:n,attrScale:s,originX:r,originY:i,pathLength:a,pathSpacing:o=1,pathOffset:l=0,...u},c,p,m){if(ls(e,u,c,m),p){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:f,style:x,dimensions:h}=e;f.transform&&(h&&(x.transform=f.transform),delete f.transform),h&&(r!==void 0||i!==void 0||x.transform)&&(x.transformOrigin=la(h,r!==void 0?r:.5,i!==void 0?i:.5)),t!==void 0&&(f.x=t),n!==void 0&&(f.y=n),s!==void 0&&(f.scale=s),a!==void 0&&ha(f,a,o,l,!1)}const ai=()=>({...cs(),attrs:{}}),hs=e=>typeof e=="string"&&e.toLowerCase()==="svg";function da(e,t,n,s){const r=j.useMemo(()=>{const i=ai();return us(i,t,{enableHardwareAcceleration:!1},hs(s),e.transformTemplate),{...i.attrs,style:{...i.style}}},[t]);if(e.style){const i={};ii(i,e.style,e),r.style={...i,...r.style}}return r}function fa(e=!1){return(n,s,r,{latestValues:i},a)=>{const l=(is(n)?da:ra)(s,i,a,n),u=aa(s,typeof n=="string",e),c=n!==j.Fragment?{...u,...l,ref:r}:{},{children:p}=s,m=j.useMemo(()=>kt(p)?p.get():p,[p]);return j.createElement(n,{...c,children:m})}}function li(e,{style:t,vars:n},s,r){Object.assign(e.style,t,r&&r.getProjectionStyles(s));for(const i in n)e.style.setProperty(i,n[i])}const ci=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function ui(e,t,n,s){li(e,t,void 0,s);for(const r in t.attrs)e.setAttribute(ci.has(r)?r:ts(r),t.attrs[r])}function ds(e,t,n){var s;const{style:r}=e,i={};for(const a in r)(kt(r[a])||t.style&&kt(t.style[a])||ei(a,e)||((s=n==null?void 0:n.getValue(a))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(i[a]=r[a]);return i}function hi(e,t,n){const s=ds(e,t,n);for(const r in e)if(kt(e[r])||kt(t[r])){const i=Fe.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;s[i]=e[r]}return s}function fs(e,t,n,s={},r={}){return typeof t=="function"&&(t=t(n!==void 0?n:e.custom,s,r)),typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"&&(t=t(n!==void 0?n:e.custom,s,r)),t}function di(e){const t=j.useRef(null);return t.current===null&&(t.current=e()),t.current}const Nn=e=>Array.isArray(e),pa=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),ma=e=>Nn(e)?e[e.length-1]||0:e;function qe(e){const t=kt(e)?e.get():e;return pa(t)?t.toValue():t}function ga({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:n},s,r,i){const a={latestValues:ya(s,r,i,e),renderState:t()};return n&&(a.mount=o=>n(s,o,a)),a}const fi=e=>(t,n)=>{const s=j.useContext(on),r=j.useContext(an),i=()=>ga(e,t,s,r);return n?i():di(i)};function ya(e,t,n,s){const r={},i=s(e,{});for(const m in i)r[m]=qe(i[m]);let{initial:a,animate:o}=e;const l=cn(e),u=Qr(e);t&&u&&!l&&e.inherit!==!1&&(a===void 0&&(a=t.initial),o===void 0&&(o=t.animate));let c=n?n.initial===!1:!1;c=c||a===!1;const p=c?o:a;return p&&typeof p!="boolean"&&!ln(p)&&(Array.isArray(p)?p:[p]).forEach(f=>{const x=fs(e,f);if(!x)return;const{transitionEnd:h,transition:v,...g}=x;for(const b in g){let k=g[b];if(Array.isArray(k)){const P=c?k.length-1:0;k=k[P]}k!==null&&(r[b]=k)}for(const b in h)r[b]=h[b]}),r}const _t=e=>e,{schedule:xt,cancel:Kt,state:bt,steps:gn}=Jr(typeof requestAnimationFrame<"u"?requestAnimationFrame:_t,!0),va={useVisualState:fi({scrapeMotionValuesFromProps:hi,createRenderState:ai,onMount:(e,t,{renderState:n,latestValues:s})=>{xt.read(()=>{try{n.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),xt.render(()=>{us(n,s,{enableHardwareAcceleration:!1},hs(t.tagName),e.transformTemplate),ui(t,n)})}})},xa={useVisualState:fi({scrapeMotionValuesFromProps:ds,createRenderState:cs})};function ba(e,{forwardMotionProps:t=!1},n,s){return{...is(e)?va:xa,preloadedFeatures:n,useRender:fa(t),createVisualElement:s,Component:e}}function Ot(e,t,n,s={passive:!0}){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n)}const pi=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function un(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}const wa=e=>t=>pi(t)&&e(t,un(t));function Lt(e,t,n,s){return Ot(e,t,wa(n),s)}const ka=(e,t)=>n=>t(e(n)),zt=(...e)=>e.reduce(ka);function mi(e){let t=null;return()=>{const n=()=>{t=null};return t===null?(t=e,n):!1}}const zs=mi("dragHorizontal"),Bs=mi("dragVertical");function gi(e){let t=!1;if(e==="y")t=Bs();else if(e==="x")t=zs();else{const n=zs(),s=Bs();n&&s?t=()=>{n(),s()}:(n&&n(),s&&s())}return t}function yi(){const e=gi(!0);return e?(e(),!1):!0}class Yt{constructor(t){this.isMounted=!1,this.node=t}update(){}}function Vs(e,t){const n=t?"pointerenter":"pointerleave",s=t?"onHoverStart":"onHoverEnd",r=(i,a)=>{if(i.pointerType==="touch"||yi())return;const o=e.getProps();e.animationState&&o.whileHover&&e.animationState.setActive("whileHover",t);const l=o[s];l&&l(i,a)};return Lt(e.current,n,r,{passive:!e.getProps()[s]})}class _a extends Yt{mount(){this.unmount=zt(Vs(this.node,!0),Vs(this.node,!1))}unmount(){}}class Sa extends Yt{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=zt(Ot(this.node.current,"focus",()=>this.onFocus()),Ot(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const vi=(e,t)=>t?e===t?!0:vi(e,t.parentElement):!1;function yn(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,un(n))}class Ta extends Yt{constructor(){super(...arguments),this.removeStartListeners=_t,this.removeEndListeners=_t,this.removeAccessibleListeners=_t,this.startPointerPress=(t,n)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),i=Lt(window,"pointerup",(o,l)=>{if(!this.checkPressEnd())return;const{onTap:u,onTapCancel:c,globalTapTarget:p}=this.node.getProps();!p&&!vi(this.node.current,o.target)?c&&c(o,l):u&&u(o,l)},{passive:!(s.onTap||s.onPointerUp)}),a=Lt(window,"pointercancel",(o,l)=>this.cancelPress(o,l),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=zt(i,a),this.startPress(t,n)},this.startAccessiblePress=()=>{const t=i=>{if(i.key!=="Enter"||this.isPressing)return;const a=o=>{o.key!=="Enter"||!this.checkPressEnd()||yn("up",(l,u)=>{const{onTap:c}=this.node.getProps();c&&c(l,u)})};this.removeEndListeners(),this.removeEndListeners=Ot(this.node.current,"keyup",a),yn("down",(o,l)=>{this.startPress(o,l)})},n=Ot(this.node.current,"keydown",t),s=()=>{this.isPressing&&yn("cancel",(i,a)=>this.cancelPress(i,a))},r=Ot(this.node.current,"blur",s);this.removeAccessibleListeners=zt(n,r)}}startPress(t,n){this.isPressing=!0;const{onTapStart:s,whileTap:r}=this.node.getProps();r&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&s(t,n)}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!yi()}cancelPress(t,n){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&s(t,n)}mount(){const t=this.node.getProps(),n=Lt(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),s=Ot(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=zt(n,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Fn=new WeakMap,vn=new WeakMap,Ca=e=>{const t=Fn.get(e.target);t&&t(e)},Pa=e=>{e.forEach(Ca)};function Ia({root:e,...t}){const n=e||document;vn.has(n)||vn.set(n,{});const s=vn.get(n),r=JSON.stringify(t);return s[r]||(s[r]=new IntersectionObserver(Pa,{root:e,...t})),s[r]}function Ea(e,t,n){const s=Ia(t);return Fn.set(e,n),s.observe(e),()=>{Fn.delete(e),s.unobserve(e)}}const Aa={some:0,all:1};class Ra extends Yt{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:s,amount:r="some",once:i}=t,a={root:n?n.current:void 0,rootMargin:s,threshold:typeof r=="number"?r:Aa[r]},o=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,i&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:c,onViewportLeave:p}=this.node.getProps(),m=u?c:p;m&&m(l)};return Ea(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(ja(t,n))&&this.startObserver()}unmount(){}}function ja({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const Ma={inView:{Feature:Ra},tap:{Feature:Ta},focus:{Feature:Sa},hover:{Feature:_a}};function xi(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}function Na(e){const t={};return e.values.forEach((n,s)=>t[s]=n.get()),t}function Fa(e){const t={};return e.values.forEach((n,s)=>t[s]=n.getVelocity()),t}function hn(e,t,n){const s=e.getProps();return fs(s,t,n!==void 0?n:s.custom,Na(e),Fa(e))}const Ht=e=>e*1e3,Bt=e=>e/1e3,Da={type:"spring",stiffness:500,damping:25,restSpeed:10},Oa=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),La={type:"keyframes",duration:.8},za={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Ba=(e,{keyframes:t})=>t.length>2?La:le.has(e)?e.startsWith("scale")?Oa(t[1]):Da:za;function Va({when:e,delay:t,delayChildren:n,staggerChildren:s,staggerDirection:r,repeat:i,repeatType:a,repeatDelay:o,from:l,elapsed:u,...c}){return!!Object.keys(c).length}function ps(e,t){return e[t]||e.default||e}const Ua=e=>e!==null;function dn(e,{repeat:t,repeatType:n="loop"},s){const r=e.filter(Ua),i=t&&n!=="loop"&&t%2===1?0:r.length-1;return!i||s===void 0?r[i]:s}let Ke;function $a(){Ke=void 0}const Gt={now:()=>(Ke===void 0&&Gt.set(bt.isProcessing||jo.useManualTiming?bt.timestamp:performance.now()),Ke),set:e=>{Ke=e,queueMicrotask($a)}},bi=e=>/^0[^.\s]+$/u.test(e);function Wa(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||bi(e):!0}let wi=_t;const ki=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Ha=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Ga(e){const t=Ha.exec(e);if(!t)return[,];const[,n,s,r]=t;return[`--${n??s}`,r]}function _i(e,t,n=1){const[s,r]=Ga(e);if(!s)return;const i=window.getComputedStyle(t).getPropertyValue(s);if(i){const a=i.trim();return ki(a)?parseFloat(a):a}return os(r)?_i(r,t,n+1):r}const qa=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Us=e=>e===ve||e===ht,$s=(e,t)=>parseFloat(e.split(", ")[t]),Ws=(e,t)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const r=s.match(/^matrix3d\((.+)\)$/u);if(r)return $s(r[1],t);{const i=s.match(/^matrix\((.+)\)$/u);return i?$s(i[1],e):0}},Ka=new Set(["x","y","z"]),Za=Fe.filter(e=>!Ka.has(e));function Ya(e){const t=[];return Za.forEach(n=>{const s=e.getValue(n);s!==void 0&&(t.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),t}const ye={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:Ws(4,13),y:Ws(5,14)};ye.translateX=ye.x;ye.translateY=ye.y;const Si=e=>t=>t.test(e),Xa={test:e=>e==="auto",parse:e=>e},Ti=[ve,ht,Ft,Ut,ea,ta,Xa],Hs=e=>Ti.find(Si(e)),ae=new Set;let Dn=!1,On=!1;function Ci(){if(On){const e=Array.from(ae).filter(s=>s.needsMeasurement),t=new Set(e.map(s=>s.element)),n=new Map;t.forEach(s=>{const r=Ya(s);r.length&&(n.set(s,r),s.render())}),e.forEach(s=>s.measureInitialState()),t.forEach(s=>{s.render();const r=n.get(s);r&&r.forEach(([i,a])=>{var o;(o=s.getValue(i))===null||o===void 0||o.set(a)})}),e.forEach(s=>s.measureEndState()),e.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}On=!1,Dn=!1,ae.forEach(e=>e.complete()),ae.clear()}function Pi(){ae.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(On=!0)})}function Ja(){Pi(),Ci()}class ms{constructor(t,n,s,r,i,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=s,this.motionValue=r,this.element=i,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ae.add(this),Dn||(Dn=!0,xt.read(Pi),xt.resolveKeyframes(Ci))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:s,motionValue:r}=this;for(let i=0;i<t.length;i++)if(t[i]===null)if(i===0){const a=r==null?void 0:r.get(),o=t[t.length-1];if(a!==void 0)t[0]=a;else if(s&&n){const l=s.readValue(n,o);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=o),r&&a===void 0&&r.set(t[0])}else t[i]=t[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ae.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ae.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const gs=(e,t)=>n=>!!(De(n)&&Qo.test(n)&&n.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(n,t)),Ii=(e,t,n)=>s=>{if(!De(s))return s;const[r,i,a,o]=s.match(as);return{[e]:parseFloat(r),[t]:parseFloat(i),[n]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},Qa=e=>qt(0,255,e),xn={...ve,transform:e=>Math.round(Qa(e))},se={test:gs("rgb","red"),parse:Ii("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:s=1})=>"rgba("+xn.transform(e)+", "+xn.transform(t)+", "+xn.transform(n)+", "+Pe(Ce.transform(s))+")"};function tl(e){let t="",n="",s="",r="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),s=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),s=e.substring(3,4),r=e.substring(4,5),t+=t,n+=n,s+=s,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}}const Ln={test:gs("#"),parse:tl,transform:se.transform},de={test:gs("hsl","hue"),parse:Ii("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:s=1})=>"hsla("+Math.round(e)+", "+Ft.transform(Pe(t))+", "+Ft.transform(Pe(n))+", "+Pe(Ce.transform(s))+")"},wt={test:e=>se.test(e)||Ln.test(e)||de.test(e),parse:e=>se.test(e)?se.parse(e):de.test(e)?de.parse(e):Ln.parse(e),transform:e=>De(e)?e:e.hasOwnProperty("red")?se.transform(e):de.transform(e)};function el(e){var t,n;return isNaN(e)&&De(e)&&(((t=e.match(as))===null||t===void 0?void 0:t.length)||0)+(((n=e.match(Jo))===null||n===void 0?void 0:n.length)||0)>0}const Ei="number",Ai="color",nl="var",sl="var(",Gs="${}",rl=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Je(e){const t=e.toString(),n=[],s={color:[],number:[],var:[]},r=[];let i=0;const o=t.replace(rl,l=>(wt.test(l)?(s.color.push(i),r.push(Ai),n.push(wt.parse(l))):l.startsWith(sl)?(s.var.push(i),r.push(nl),n.push(l)):(s.number.push(i),r.push(Ei),n.push(parseFloat(l))),++i,Gs)).split(Gs);return{values:n,split:o,indexes:s,types:r}}function Ri(e){return Je(e).values}function ji(e){const{split:t,types:n}=Je(e),s=t.length;return r=>{let i="";for(let a=0;a<s;a++)if(i+=t[a],r[a]!==void 0){const o=n[a];o===Ei?i+=Pe(r[a]):o===Ai?i+=wt.transform(r[a]):i+=r[a]}return i}}const il=e=>typeof e=="number"?0:e;function ol(e){const t=Ri(e);return ji(e)(t.map(il))}const Zt={test:el,parse:Ri,createTransformer:ji,getAnimatableNone:ol},al=new Set(["brightness","contrast","saturate","opacity"]);function ll(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[s]=n.match(as)||[];if(!s)return e;const r=n.replace(s,"");let i=al.has(t)?1:0;return s!==n&&(i*=100),t+"("+i+r+")"}const cl=/\b([a-z-]*)\(.*?\)/gu,zn={...Zt,getAnimatableNone:e=>{const t=e.match(cl);return t?t.map(ll).join(" "):e}},ul={...ri,color:wt,backgroundColor:wt,outlineColor:wt,fill:wt,stroke:wt,borderColor:wt,borderTopColor:wt,borderRightColor:wt,borderBottomColor:wt,borderLeftColor:wt,filter:zn,WebkitFilter:zn},ys=e=>ul[e];function Mi(e,t){let n=ys(e);return n!==zn&&(n=Zt),n.getAnimatableNone?n.getAnimatableNone(t):void 0}function hl(e,t,n){let s=0,r;for(;s<e.length&&!r;)typeof e[s]=="string"&&e[s]!=="none"&&e[s]!=="0"&&(r=e[s]),s++;if(r&&n)for(const i of t)e[i]=Mi(n,r)}class Ni extends ms{constructor(t,n,s,r){super(t,n,s,r,r==null?void 0:r.owner,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:s}=this;if(!n.current)return;super.readKeyframes();for(let l=0;l<t.length;l++){const u=t[l];if(typeof u=="string"&&os(u)){const c=_i(u,n.current);c!==void 0&&(t[l]=c),l===t.length-1&&(this.finalKeyframe=u)}}if(!qa.has(s)||t.length!==2)return this.resolveNoneKeyframes();const[r,i]=t,a=Hs(r),o=Hs(i);if(a!==o)if(Us(a)&&Us(o))for(let l=0;l<t.length;l++){const u=t[l];typeof u=="string"&&(t[l]=parseFloat(u))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,s=[];for(let r=0;r<t.length;r++)Wa(t[r])&&s.push(r);s.length&&hl(t,s,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:s}=this;if(!t.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ye[s](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&t.getValue(s,r).jump(r,!1)}measureEndState(){var t;const{element:n,name:s,unresolvedKeyframes:r}=this;if(!n.current)return;const i=n.getValue(s);i&&i.jump(this.measuredOrigin,!1);const a=r.length-1,o=r[a];r[a]=ye[s](n.measureViewportBox(),window.getComputedStyle(n.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([l,u])=>{n.getValue(l).set(u)}),this.resolveNoneKeyframes()}}function dl(e){let t;return()=>(t===void 0&&(t=e()),t)}const qs=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Zt.test(e)||e==="0")&&!e.startsWith("url("));function fl(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function pl(e,t,n,s){const r=e[0];if(r===null)return!1;const i=e[e.length-1],a=qs(r,t),o=qs(i,t);return!a||!o?!1:fl(e)||n==="spring"&&s}class Fi{constructor({autoplay:t=!0,delay:n=0,type:s="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:a="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:t,delay:n,type:s,repeat:r,repeatDelay:i,repeatType:a,...o},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Ja(),this._resolved}onKeyframesResolved(t,n){this.hasAttemptedResolve=!0;const{name:s,type:r,velocity:i,delay:a,onComplete:o,onUpdate:l,isGenerator:u}=this.options;if(!u&&!pl(t,s,r,i))if(a)this.options.duration=0;else{l==null||l(dn(t,this.options,n)),o==null||o(),this.resolveFinishedPromise();return}const c=this.initPlayback(t,n);c!==!1&&(this._resolved={keyframes:t,finalKeyframe:n,...c},this.onPostResolved())}onPostResolved(){}then(t,n){return this.currentFinishedPromise.then(t,n)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function Di(e,t){return t?e*(1e3/t):0}const ml=5;function Oi(e,t,n){const s=Math.max(t-ml,0);return Di(n-e(s),t-s)}const bn=.001,gl=.01,yl=10,vl=.05,xl=1;function bl({duration:e=800,bounce:t=.25,velocity:n=0,mass:s=1}){let r,i,a=1-t;a=qt(vl,xl,a),e=qt(gl,yl,Bt(e)),a<1?(r=u=>{const c=u*a,p=c*e,m=c-n,f=Bn(u,a),x=Math.exp(-p);return bn-m/f*x},i=u=>{const p=u*a*e,m=p*n+n,f=Math.pow(a,2)*Math.pow(u,2)*e,x=Math.exp(-p),h=Bn(Math.pow(u,2),a);return(-r(u)+bn>0?-1:1)*((m-f)*x)/h}):(r=u=>{const c=Math.exp(-u*e),p=(u-n)*e+1;return-bn+c*p},i=u=>{const c=Math.exp(-u*e),p=(n-u)*(e*e);return c*p});const o=5/e,l=kl(r,i,o);if(e=Ht(e),isNaN(l))return{stiffness:100,damping:10,duration:e};{const u=Math.pow(l,2)*s;return{stiffness:u,damping:a*2*Math.sqrt(s*u),duration:e}}}const wl=12;function kl(e,t,n){let s=n;for(let r=1;r<wl;r++)s=s-e(s)/t(s);return s}function Bn(e,t){return e*Math.sqrt(1-t*t)}const _l=["duration","bounce"],Sl=["stiffness","damping","mass"];function Ks(e,t){return t.some(n=>e[n]!==void 0)}function Tl(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!Ks(e,Sl)&&Ks(e,_l)){const n=bl(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}function Li({keyframes:e,restDelta:t,restSpeed:n,...s}){const r=e[0],i=e[e.length-1],a={done:!1,value:r},{stiffness:o,damping:l,mass:u,duration:c,velocity:p,isResolvedFromDuration:m}=Tl({...s,velocity:-Bt(s.velocity||0)}),f=p||0,x=l/(2*Math.sqrt(o*u)),h=i-r,v=Bt(Math.sqrt(o/u)),g=Math.abs(h)<5;n||(n=g?.01:2),t||(t=g?.005:.5);let b;if(x<1){const k=Bn(v,x);b=P=>{const T=Math.exp(-x*v*P);return i-T*((f+x*v*h)/k*Math.sin(k*P)+h*Math.cos(k*P))}}else if(x===1)b=k=>i-Math.exp(-v*k)*(h+(f+v*h)*k);else{const k=v*Math.sqrt(x*x-1);b=P=>{const T=Math.exp(-x*v*P),M=Math.min(k*P,300);return i-T*((f+x*v*h)*Math.sinh(M)+k*h*Math.cosh(M))/k}}return{calculatedDuration:m&&c||null,next:k=>{const P=b(k);if(m)a.done=k>=c;else{let T=f;k!==0&&(x<1?T=Oi(b,k,P):T=0);const M=Math.abs(T)<=n,A=Math.abs(i-P)<=t;a.done=M&&A}return a.value=a.done?i:P,a}}}function Zs({keyframes:e,velocity:t=0,power:n=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:a,min:o,max:l,restDelta:u=.5,restSpeed:c}){const p=e[0],m={done:!1,value:p},f=D=>o!==void 0&&D<o||l!==void 0&&D>l,x=D=>o===void 0?l:l===void 0||Math.abs(o-D)<Math.abs(l-D)?o:l;let h=n*t;const v=p+h,g=a===void 0?v:a(v);g!==v&&(h=g-p);const b=D=>-h*Math.exp(-D/s),k=D=>g+b(D),P=D=>{const F=b(D),W=k(D);m.done=Math.abs(F)<=u,m.value=m.done?g:W};let T,M;const A=D=>{f(m.value)&&(T=D,M=Li({keyframes:[m.value,x(m.value)],velocity:Oi(k,D,m.value),damping:r,stiffness:i,restDelta:u,restSpeed:c}))};return A(0),{calculatedDuration:null,next:D=>{let F=!1;return!M&&T===void 0&&(F=!0,P(D),A(D)),T!==void 0&&D>=T?M.next(D-T):(!F&&P(D),m)}}}const zi=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,Cl=1e-7,Pl=12;function Il(e,t,n,s,r){let i,a,o=0;do a=t+(n-t)/2,i=zi(a,s,r)-e,i>0?n=a:t=a;while(Math.abs(i)>Cl&&++o<Pl);return a}function Le(e,t,n,s){if(e===t&&n===s)return _t;const r=i=>Il(i,0,1,e,n);return i=>i===0||i===1?i:zi(r(i),t,s)}const El=Le(.42,0,1,1),Al=Le(0,0,.58,1),Bi=Le(.42,0,.58,1),Rl=e=>Array.isArray(e)&&typeof e[0]!="number",Vi=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Ui=e=>t=>1-e(1-t),vs=e=>1-Math.sin(Math.acos(e)),$i=Ui(vs),jl=Vi(vs),Wi=Le(.33,1.53,.69,.99),xs=Ui(Wi),Ml=Vi(xs),Nl=e=>(e*=2)<1?.5*xs(e):.5*(2-Math.pow(2,-10*(e-1))),Fl={linear:_t,easeIn:El,easeInOut:Bi,easeOut:Al,circIn:vs,circInOut:jl,circOut:$i,backIn:xs,backInOut:Ml,backOut:Wi,anticipate:Nl},Ys=e=>{if(Array.isArray(e)){wi(e.length===4);const[t,n,s,r]=e;return Le(t,n,s,r)}else if(typeof e=="string")return Fl[e];return e},Me=(e,t,n)=>{const s=t-e;return s===0?1:(n-e)/s},gt=(e,t,n)=>e+(t-e)*n;function wn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Dl({hue:e,saturation:t,lightness:n,alpha:s}){e/=360,t/=100,n/=100;let r=0,i=0,a=0;if(!t)r=i=a=n;else{const o=n<.5?n*(1+t):n+t-n*t,l=2*n-o;r=wn(l,o,e+1/3),i=wn(l,o,e),a=wn(l,o,e-1/3)}return{red:Math.round(r*255),green:Math.round(i*255),blue:Math.round(a*255),alpha:s}}const kn=(e,t,n)=>{const s=e*e,r=n*(t*t-s)+s;return r<0?0:Math.sqrt(r)},Ol=[Ln,se,de],Ll=e=>Ol.find(t=>t.test(e));function Xs(e){const t=Ll(e);let n=t.parse(e);return t===de&&(n=Dl(n)),n}const Js=(e,t)=>{const n=Xs(e),s=Xs(t),r={...n};return i=>(r.red=kn(n.red,s.red,i),r.green=kn(n.green,s.green,i),r.blue=kn(n.blue,s.blue,i),r.alpha=gt(n.alpha,s.alpha,i),se.transform(r))};function Vn(e,t){return n=>n>0?t:e}function zl(e,t){return n=>gt(e,t,n)}function bs(e){return typeof e=="number"?zl:typeof e=="string"?os(e)?Vn:wt.test(e)?Js:Ul:Array.isArray(e)?Hi:typeof e=="object"?wt.test(e)?Js:Bl:Vn}function Hi(e,t){const n=[...e],s=n.length,r=e.map((i,a)=>bs(i)(i,t[a]));return i=>{for(let a=0;a<s;a++)n[a]=r[a](i);return n}}function Bl(e,t){const n={...e,...t},s={};for(const r in n)e[r]!==void 0&&t[r]!==void 0&&(s[r]=bs(e[r])(e[r],t[r]));return r=>{for(const i in s)n[i]=s[i](r);return n}}function Vl(e,t){var n;const s=[],r={color:0,var:0,number:0};for(let i=0;i<t.values.length;i++){const a=t.types[i],o=e.indexes[a][r[a]],l=(n=e.values[o])!==null&&n!==void 0?n:0;s[i]=l,r[a]++}return s}const Ul=(e,t)=>{const n=Zt.createTransformer(t),s=Je(e),r=Je(t);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?zt(Hi(Vl(s,r),r.values),n):Vn(e,t)};function Gi(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?gt(e,t,n):bs(e)(e,t)}function $l(e,t,n){const s=[],r=n||Gi,i=e.length-1;for(let a=0;a<i;a++){let o=r(e[a],e[a+1]);if(t){const l=Array.isArray(t)?t[a]||_t:t;o=zt(l,o)}s.push(o)}return s}function Wl(e,t,{clamp:n=!0,ease:s,mixer:r}={}){const i=e.length;if(wi(i===t.length),i===1)return()=>t[0];if(i===2&&e[0]===e[1])return()=>t[1];e[0]>e[i-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=$l(t,s,r),o=a.length,l=u=>{let c=0;if(o>1)for(;c<e.length-2&&!(u<e[c+1]);c++);const p=Me(e[c],e[c+1],u);return a[c](p)};return n?u=>l(qt(e[0],e[i-1],u)):l}function Hl(e,t){const n=e[e.length-1];for(let s=1;s<=t;s++){const r=Me(0,t,s);e.push(gt(n,1,r))}}function Gl(e){const t=[0];return Hl(t,e.length-1),t}function ql(e,t){return e.map(n=>n*t)}function Kl(e,t){return e.map(()=>t||Bi).splice(0,e.length-1)}function Qe({duration:e=300,keyframes:t,times:n,ease:s="easeInOut"}){const r=Rl(s)?s.map(Ys):Ys(s),i={done:!1,value:t[0]},a=ql(n&&n.length===t.length?n:Gl(t),e),o=Wl(a,t,{ease:Array.isArray(r)?r:Kl(t,r)});return{calculatedDuration:e,next:l=>(i.value=o(l),i.done=l>=e,i)}}const Qs=2e4;function Zl(e){let t=0;const n=50;let s=e.next(t);for(;!s.done&&t<Qs;)t+=n,s=e.next(t);return t>=Qs?1/0:t}const Yl=e=>{const t=({timestamp:n})=>e(n);return{start:()=>xt.update(t,!0),stop:()=>Kt(t),now:()=>bt.isProcessing?bt.timestamp:Gt.now()}},Xl={decay:Zs,inertia:Zs,tween:Qe,keyframes:Qe,spring:Li},Jl=e=>e/100;class ws extends Fi{constructor({KeyframeResolver:t=ms,...n}){super(n),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:o}=this.options;o&&o()};const{name:s,motionValue:r,keyframes:i}=this.options,a=(o,l)=>this.onKeyframesResolved(o,l);s&&r&&r.owner?this.resolver=r.owner.resolveKeyframes(i,a,s,r):this.resolver=new t(i,a,s,r),this.resolver.scheduleResolve()}initPlayback(t){const{type:n="keyframes",repeat:s=0,repeatDelay:r=0,repeatType:i,velocity:a=0}=this.options,o=Xl[n]||Qe;let l,u;o!==Qe&&typeof t[0]!="number"&&(l=zt(Jl,Gi(t[0],t[1])),t=[0,100]);const c=o({...this.options,keyframes:t});i==="mirror"&&(u=o({...this.options,keyframes:[...t].reverse(),velocity:-a})),c.calculatedDuration===null&&(c.calculatedDuration=Zl(c));const{calculatedDuration:p}=c,m=p+r,f=m*(s+1)-r;return{generator:c,mirroredGenerator:u,mapPercentToKeyframes:l,calculatedDuration:p,resolvedDuration:m,totalDuration:f}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,n=!1){const{resolved:s}=this;if(!s){const{keyframes:D}=this.options;return{done:!0,value:D[D.length-1]}}const{finalKeyframe:r,generator:i,mirroredGenerator:a,mapPercentToKeyframes:o,keyframes:l,calculatedDuration:u,totalDuration:c,resolvedDuration:p}=s;if(this.startTime===null)return i.next(0);const{delay:m,repeat:f,repeatType:x,repeatDelay:h,onUpdate:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-c/this.speed,this.startTime)),n?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const g=this.currentTime-m*(this.speed>=0?1:-1),b=this.speed>=0?g<0:g>c;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=c);let k=this.currentTime,P=i;if(f){const D=Math.min(this.currentTime,c)/p;let F=Math.floor(D),W=D%1;!W&&D>=1&&(W=1),W===1&&F--,F=Math.min(F,f+1),!!(F%2)&&(x==="reverse"?(W=1-W,h&&(W-=h/p)):x==="mirror"&&(P=a)),k=qt(0,1,W)*p}const T=b?{done:!1,value:l[0]}:P.next(k);o&&(T.value=o(T.value));let{done:M}=T;!b&&u!==null&&(M=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const A=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&M);return A&&r!==void 0&&(T.value=dn(l,this.options,r)),v&&v(T.value),A&&this.finish(),T}get duration(){const{resolved:t}=this;return t?Bt(t.calculatedDuration):0}get time(){return Bt(this.currentTime)}set time(t){t=Ht(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Bt(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=Yl,onPlay:n}=this.options;this.driver||(this.driver=t(r=>this.tick(r))),n&&n();const s=this.driver.now();this.holdTime!==null?this.startTime=s-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=s),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const qi=e=>Array.isArray(e)&&typeof e[0]=="number";function Ki(e){return!!(!e||typeof e=="string"&&e in ks||qi(e)||Array.isArray(e)&&e.every(Ki))}const Se=([e,t,n,s])=>`cubic-bezier(${e}, ${t}, ${n}, ${s})`,ks={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Se([0,.65,.55,1]),circOut:Se([.55,0,1,.45]),backIn:Se([.31,.01,.66,-.59]),backOut:Se([.33,1.53,.69,.99])};function Ql(e){return Zi(e)||ks.easeOut}function Zi(e){if(e)return qi(e)?Se(e):Array.isArray(e)?e.map(Ql):ks[e]}function tc(e,t,n,{delay:s=0,duration:r=300,repeat:i=0,repeatType:a="loop",ease:o,times:l}={}){const u={[t]:n};l&&(u.offset=l);const c=Zi(o);return Array.isArray(c)&&(u.easing=c),e.animate(u,{delay:s,duration:r,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:i+1,direction:a==="reverse"?"alternate":"normal"})}const ec=dl(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),nc=new Set(["opacity","clipPath","filter","transform"]),tn=10,sc=2e4;function rc(e){return e.type==="spring"||e.name==="backgroundColor"||!Ki(e.ease)}function ic(e,t){const n=new ws({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:e[0]};const r=[];let i=0;for(;!s.done&&i<sc;)s=n.sample(i),r.push(s.value),i+=tn;return{times:void 0,keyframes:r,duration:i-tn,ease:"linear"}}class tr extends Fi{constructor(t){super(t);const{name:n,motionValue:s,keyframes:r}=this.options;this.resolver=new Ni(r,(i,a)=>this.onKeyframesResolved(i,a),n,s),this.resolver.scheduleResolve()}initPlayback(t,n){var s;let{duration:r=300,times:i,ease:a,type:o,motionValue:l,name:u}=this.options;if(!(!((s=l.owner)===null||s===void 0)&&s.current))return!1;if(rc(this.options)){const{onComplete:p,onUpdate:m,motionValue:f,...x}=this.options,h=ic(t,x);t=h.keyframes,t.length===1&&(t[1]=t[0]),r=h.duration,i=h.times,a=h.ease,o="keyframes"}const c=tc(l.owner.current,u,t,{...this.options,duration:r,times:i,ease:a});return c.startTime=Gt.now(),this.pendingTimeline?(c.timeline=this.pendingTimeline,this.pendingTimeline=void 0):c.onfinish=()=>{const{onComplete:p}=this.options;l.set(dn(t,this.options,n)),p&&p(),this.cancel(),this.resolveFinishedPromise()},{animation:c,duration:r,times:i,type:o,ease:a,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:n}=t;return Bt(n)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:n}=t;return Bt(n.currentTime||0)}set time(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.currentTime=Ht(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:n}=t;return n.playbackRate}set speed(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:n}=t;return n.playState}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:n}=this;if(!n)return _t;const{animation:s}=n;s.timeline=t,s.onfinish=null}return _t}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:t}=this;if(!t)return;const{animation:n,keyframes:s,duration:r,type:i,ease:a,times:o}=t;if(!(n.playState==="idle"||n.playState==="finished")){if(this.time){const{motionValue:l,onUpdate:u,onComplete:c,...p}=this.options,m=new ws({...p,keyframes:s,duration:r,type:i,ease:a,times:o,isGenerator:!0}),f=Ht(this.time);l.setWithVelocity(m.sample(f-tn).value,m.sample(f).value,tn)}this.cancel()}}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:n,name:s,repeatDelay:r,repeatType:i,damping:a,type:o}=t;return ec()&&s&&nc.has(s)&&n&&n.owner&&n.owner.current instanceof HTMLElement&&!n.owner.getProps().onUpdate&&!r&&i!=="mirror"&&a!==0&&o!=="inertia"}}const _s=(e,t,n,s={},r,i)=>a=>{const o=ps(s,e)||{},l=o.delay||s.delay||0;let{elapsed:u=0}=s;u=u-Ht(l);let c={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-u,onUpdate:m=>{t.set(m),o.onUpdate&&o.onUpdate(m)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:i?void 0:r};Va(o)||(c={...c,...Ba(e,c)}),c.duration&&(c.duration=Ht(c.duration)),c.repeatDelay&&(c.repeatDelay=Ht(c.repeatDelay)),c.from!==void 0&&(c.keyframes[0]=c.from);let p=!1;if((c.type===!1||c.duration===0&&!c.repeatDelay)&&(c.duration=0,c.delay===0&&(p=!0)),p&&!i&&t.get()!==void 0){const m=dn(c.keyframes,o);if(m!==void 0){xt.update(()=>{c.onUpdate(m),c.onComplete()});return}}return!i&&tr.supports(c)?new tr(c):new ws(c)};function en(e){return!!(kt(e)&&e.add)}function Ss(e,t){e.indexOf(t)===-1&&e.push(t)}function Ts(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Cs{constructor(){this.subscriptions=[]}add(t){return Ss(this.subscriptions,t),()=>Ts(this.subscriptions,t)}notify(t,n,s){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](t,n,s);else for(let i=0;i<r;i++){const a=this.subscriptions[i];a&&a(t,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const er=30,oc=e=>!isNaN(parseFloat(e));class ac{constructor(t,n={}){this.version="11.1.7",this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(s,r=!0)=>{const i=Gt.now();this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.canTrackVelocity=oc(this.current),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=Gt.now()}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new Cs);const s=this.events[t].add(n);return t==="change"?()=>{s(),xt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t,n=!0){!n||!this.passiveEffect?this.updateAndNotify(t,n):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Gt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>er)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,er);return Di(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ne(e,t){return new ac(e,t)}function lc(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,Ne(n))}function cc(e,t){const n=hn(e,t);let{transitionEnd:s={},transition:r={},...i}=n||{};i={...i,...s};for(const a in i){const o=ma(i[a]);lc(e,a,o)}}function uc({protectedKeys:e,needsAnimating:t},n){const s=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,s}function Yi(e,t,{delay:n=0,transitionOverride:s,type:r}={}){var i;let{transition:a=e.getDefaultTransition(),transitionEnd:o,...l}=t;const u=e.getValue("willChange");s&&(a=s);const c=[],p=r&&e.animationState&&e.animationState.getState()[r];for(const m in l){const f=e.getValue(m,(i=e.latestValues[m])!==null&&i!==void 0?i:null),x=l[m];if(x===void 0||p&&uc(p,m))continue;const h={delay:n,elapsed:0,...ps(a||{},m)};let v=!1;if(window.HandoffAppearAnimations){const k=e.getProps()[Xr];if(k){const P=window.HandoffAppearAnimations(k,m);P!==null&&(h.elapsed=P,v=!0)}}f.start(_s(m,f,x,e.shouldReduceMotion&&le.has(m)?{type:!1}:h,e,v));const g=f.animation;g&&(en(u)&&(u.add(m),g.then(()=>u.remove(m))),c.push(g))}return o&&Promise.all(c).then(()=>{xt.update(()=>{o&&cc(e,o)})}),c}function Un(e,t,n={}){var s;const r=hn(e,t,n.type==="exit"?(s=e.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:i=e.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(i=n.transitionOverride);const a=r?()=>Promise.all(Yi(e,r,n)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(u=0)=>{const{delayChildren:c=0,staggerChildren:p,staggerDirection:m}=i;return hc(e,t,c+u,p,m,n)}:()=>Promise.resolve(),{when:l}=i;if(l){const[u,c]=l==="beforeChildren"?[a,o]:[o,a];return u().then(()=>c())}else return Promise.all([a(),o(n.delay)])}function hc(e,t,n=0,s=0,r=1,i){const a=[],o=(e.variantChildren.size-1)*s,l=r===1?(u=0)=>u*s:(u=0)=>o-u*s;return Array.from(e.variantChildren).sort(dc).forEach((u,c)=>{u.notify("AnimationStart",t),a.push(Un(u,t,{...i,delay:n+l(c)}).then(()=>u.notify("AnimationComplete",t)))}),Promise.all(a)}function dc(e,t){return e.sortNodePosition(t)}function fc(e,t,n={}){e.notify("AnimationStart",t);let s;if(Array.isArray(t)){const r=t.map(i=>Un(e,i,n));s=Promise.all(r)}else if(typeof t=="string")s=Un(e,t,n);else{const r=typeof t=="function"?hn(e,t,n.custom):t;s=Promise.all(Yi(e,r,n))}return s.then(()=>{xt.postRender(()=>{e.notify("AnimationComplete",t)})})}const pc=[...ns].reverse(),mc=ns.length;function gc(e){return t=>Promise.all(t.map(({animation:n,options:s})=>fc(e,n,s)))}function yc(e){let t=gc(e);const n=xc();let s=!0;const r=l=>(u,c)=>{var p;const m=hn(e,c,l==="exit"?(p=e.presenceContext)===null||p===void 0?void 0:p.custom:void 0);if(m){const{transition:f,transitionEnd:x,...h}=m;u={...u,...h,...x}}return u};function i(l){t=l(e)}function a(l){const u=e.getProps(),c=e.getVariantContext(!0)||{},p=[],m=new Set;let f={},x=1/0;for(let v=0;v<mc;v++){const g=pc[v],b=n[g],k=u[g]!==void 0?u[g]:c[g],P=Re(k),T=g===l?b.isActive:null;T===!1&&(x=v);let M=k===c[g]&&k!==u[g]&&P;if(M&&s&&e.manuallyAnimateOnMount&&(M=!1),b.protectedKeys={...f},!b.isActive&&T===null||!k&&!b.prevProp||ln(k)||typeof k=="boolean")continue;let D=vc(b.prevProp,k)||g===l&&b.isActive&&!M&&P||v>x&&P,F=!1;const W=Array.isArray(k)?k:[k];let Z=W.reduce(r(g),{});T===!1&&(Z={});const{prevResolvedValues:E={}}=b,z={...E,...Z},y=B=>{D=!0,m.has(B)&&(F=!0,m.delete(B)),b.needsAnimating[B]=!0;const tt=e.getValue(B);tt&&(tt.liveStyle=!1)};for(const B in z){const tt=Z[B],U=E[B];if(f.hasOwnProperty(B))continue;let ot=!1;Nn(tt)&&Nn(U)?ot=!xi(tt,U):ot=tt!==U,ot?tt!=null?y(B):m.add(B):tt!==void 0&&m.has(B)?y(B):b.protectedKeys[B]=!0}b.prevProp=k,b.prevResolvedValues=Z,b.isActive&&(f={...f,...Z}),s&&e.blockInitialAnimation&&(D=!1),D&&(!M||F)&&p.push(...W.map(B=>({animation:B,options:{type:g}})))}if(m.size){const v={};m.forEach(g=>{const b=e.getBaseTarget(g),k=e.getValue(g);k&&(k.liveStyle=!0),v[g]=b??null}),p.push({animation:v})}let h=!!p.length;return s&&(u.initial===!1||u.initial===u.animate)&&!e.manuallyAnimateOnMount&&(h=!1),s=!1,h?t(p):Promise.resolve()}function o(l,u){var c;if(n[l].isActive===u)return Promise.resolve();(c=e.variantChildren)===null||c===void 0||c.forEach(m=>{var f;return(f=m.animationState)===null||f===void 0?void 0:f.setActive(l,u)}),n[l].isActive=u;const p=a(l);for(const m in n)n[m].protectedKeys={};return p}return{animateChanges:a,setActive:o,setAnimateFunction:i,getState:()=>n}}function vc(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!xi(t,e):!1}function Jt(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function xc(){return{animate:Jt(!0),whileInView:Jt(),whileHover:Jt(),whileTap:Jt(),whileDrag:Jt(),whileFocus:Jt(),exit:Jt()}}class bc extends Yt{constructor(t){super(t),t.animationState||(t.animationState=yc(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),ln(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){}}let wc=0;class kc extends Yt{constructor(){super(...arguments),this.id=wc++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const r=this.node.animationState.setActive("exit",!t);n&&!t&&r.then(()=>n(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const _c={animation:{Feature:bc},exit:{Feature:kc}},nr=(e,t)=>Math.abs(e-t);function Sc(e,t){const n=nr(e.x,t.x),s=nr(e.y,t.y);return Math.sqrt(n**2+s**2)}class Xi{constructor(t,n,{transformPagePoint:s,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=Sn(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,f=Sc(p.offset,{x:0,y:0})>=3;if(!m&&!f)return;const{point:x}=p,{timestamp:h}=bt;this.history.push({...x,timestamp:h});const{onStart:v,onMove:g}=this.handlers;m||(v&&v(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),g&&g(this.lastMoveEvent,p)},this.handlePointerMove=(p,m)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=_n(m,this.transformPagePoint),xt.update(this.updatePoint,!0)},this.handlePointerUp=(p,m)=>{this.end();const{onEnd:f,onSessionEnd:x,resumeAnimation:h}=this.handlers;if(this.dragSnapToOrigin&&h&&h(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=Sn(p.type==="pointercancel"?this.lastMoveEventInfo:_n(m,this.transformPagePoint),this.history);this.startEvent&&f&&f(p,v),x&&x(p,v)},!pi(t))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=s,this.contextWindow=r||window;const a=un(t),o=_n(a,this.transformPagePoint),{point:l}=o,{timestamp:u}=bt;this.history=[{...l,timestamp:u}];const{onSessionStart:c}=n;c&&c(t,Sn(o,this.history)),this.removeListeners=zt(Lt(this.contextWindow,"pointermove",this.handlePointerMove),Lt(this.contextWindow,"pointerup",this.handlePointerUp),Lt(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Kt(this.updatePoint)}}function _n(e,t){return t?{point:t(e.point)}:e}function sr(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Sn({point:e},t){return{point:e,delta:sr(e,Ji(t)),offset:sr(e,Tc(t)),velocity:Cc(t,.1)}}function Tc(e){return e[0]}function Ji(e){return e[e.length-1]}function Cc(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,s=null;const r=Ji(e);for(;n>=0&&(s=e[n],!(r.timestamp-s.timestamp>Ht(t)));)n--;if(!s)return{x:0,y:0};const i=Bt(r.timestamp-s.timestamp);if(i===0)return{x:0,y:0};const a={x:(r.x-s.x)/i,y:(r.y-s.y)/i};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function St(e){return e.max-e.min}function $n(e,t=0,n=.01){return Math.abs(e-t)<=n}function rr(e,t,n,s=.5){e.origin=s,e.originPoint=gt(t.min,t.max,e.origin),e.scale=St(n)/St(t),($n(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=gt(n.min,n.max,e.origin)-e.originPoint,($n(e.translate)||isNaN(e.translate))&&(e.translate=0)}function Ie(e,t,n,s){rr(e.x,t.x,n.x,s?s.originX:void 0),rr(e.y,t.y,n.y,s?s.originY:void 0)}function ir(e,t,n){e.min=n.min+t.min,e.max=e.min+St(t)}function Pc(e,t,n){ir(e.x,t.x,n.x),ir(e.y,t.y,n.y)}function or(e,t,n){e.min=t.min-n.min,e.max=e.min+St(t)}function Ee(e,t,n){or(e.x,t.x,n.x),or(e.y,t.y,n.y)}function Ic(e,{min:t,max:n},s){return t!==void 0&&e<t?e=s?gt(t,e,s.min):Math.max(e,t):n!==void 0&&e>n&&(e=s?gt(n,e,s.max):Math.min(e,n)),e}function ar(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function Ec(e,{top:t,left:n,bottom:s,right:r}){return{x:ar(e.x,n,r),y:ar(e.y,t,s)}}function lr(e,t){let n=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,s]=[s,n]),{min:n,max:s}}function Ac(e,t){return{x:lr(e.x,t.x),y:lr(e.y,t.y)}}function Rc(e,t){let n=.5;const s=St(e),r=St(t);return r>s?n=Me(t.min,t.max-s,e.min):s>r&&(n=Me(e.min,e.max-r,t.min)),qt(0,1,n)}function jc(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const Wn=.35;function Mc(e=Wn){return e===!1?e=0:e===!0&&(e=Wn),{x:cr(e,"left","right"),y:cr(e,"top","bottom")}}function cr(e,t,n){return{min:ur(e,t),max:ur(e,n)}}function ur(e,t){return typeof e=="number"?e:e[t]||0}const hr=()=>({translate:0,scale:1,origin:0,originPoint:0}),fe=()=>({x:hr(),y:hr()}),dr=()=>({min:0,max:0}),vt=()=>({x:dr(),y:dr()});function Pt(e){return[e("x"),e("y")]}function Qi({top:e,left:t,right:n,bottom:s}){return{x:{min:t,max:n},y:{min:e,max:s}}}function Nc({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Fc(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function Tn(e){return e===void 0||e===1}function Hn({scale:e,scaleX:t,scaleY:n}){return!Tn(e)||!Tn(t)||!Tn(n)}function Qt(e){return Hn(e)||to(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function to(e){return fr(e.x)||fr(e.y)}function fr(e){return e&&e!=="0%"}function nn(e,t,n){const s=e-n,r=t*s;return n+r}function pr(e,t,n,s,r){return r!==void 0&&(e=nn(e,r,s)),nn(e,n,s)+t}function Gn(e,t=0,n=1,s,r){e.min=pr(e.min,t,n,s,r),e.max=pr(e.max,t,n,s,r)}function eo(e,{x:t,y:n}){Gn(e.x,t.translate,t.scale,t.originPoint),Gn(e.y,n.translate,n.scale,n.originPoint)}function Dc(e,t,n,s=!1){const r=n.length;if(!r)return;t.x=t.y=1;let i,a;for(let o=0;o<r;o++){i=n[o],a=i.projectionDelta;const l=i.instance;l&&l.style&&l.style.display==="contents"||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&pe(e,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,eo(e,a)),s&&Qt(i.latestValues)&&pe(e,i.latestValues))}t.x=mr(t.x),t.y=mr(t.y)}function mr(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function Wt(e,t){e.min=e.min+t,e.max=e.max+t}function gr(e,t,[n,s,r]){const i=t[r]!==void 0?t[r]:.5,a=gt(e.min,e.max,i);Gn(e,t[n],t[s],a,t.scale)}const Oc=["x","scaleX","originX"],Lc=["y","scaleY","originY"];function pe(e,t){gr(e.x,t,Oc),gr(e.y,t,Lc)}function no(e,t){return Qi(Fc(e.getBoundingClientRect(),t))}function zc(e,t,n){const s=no(e,n),{scroll:r}=t;return r&&(Wt(s.x,r.offset.x),Wt(s.y,r.offset.y)),s}const so=({current:e})=>e?e.ownerDocument.defaultView:null,Bc=new WeakMap;class Vc{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=vt(),this.visualElement=t}start(t,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const r=c=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(un(c,"page").point)},i=(c,p)=>{const{drag:m,dragPropagation:f,onDragStart:x}=this.getProps();if(m&&!f&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=gi(m),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Pt(v=>{let g=this.getAxisMotionValue(v).get()||0;if(Ft.test(g)){const{projection:b}=this.visualElement;if(b&&b.layout){const k=b.layout.layoutBox[v];k&&(g=St(k)*(parseFloat(g)/100))}}this.originPoint[v]=g}),x&&x(c,p);const{animationState:h}=this.visualElement;h&&h.setActive("whileDrag",!0)},a=(c,p)=>{const{dragPropagation:m,dragDirectionLock:f,onDirectionLock:x,onDrag:h}=this.getProps();if(!m&&!this.openGlobalLock)return;const{offset:v}=p;if(f&&this.currentDirection===null){this.currentDirection=Uc(v),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",p.point,v),this.updateAxis("y",p.point,v),this.visualElement.render(),h&&h(c,p)},o=(c,p)=>this.stop(c,p),l=()=>Pt(c=>{var p;return this.getAnimationState(c)==="paused"&&((p=this.getAxisMotionValue(c).animation)===null||p===void 0?void 0:p.play())}),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Xi(t,{onSessionStart:r,onStart:i,onMove:a,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,contextWindow:so(this.visualElement)})}stop(t,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&i(t,n)}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,s){const{drag:r}=this.getProps();if(!s||!He(t,r,this.currentDirection))return;const i=this.getAxisMotionValue(t);let a=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(a=Ic(a,this.constraints[t],this.elastic[t])),i.set(a)}resolveConstraints(){var t;const{dragConstraints:n,dragElastic:s}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,i=this.constraints;n&&he(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&r?this.constraints=Ec(r.layoutBox,n):this.constraints=!1,this.elastic=Mc(s),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Pt(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=jc(r.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!he(t))return!1;const s=t.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=zc(s,r.root,this.visualElement.getTransformPagePoint());let a=Ac(r.layout.layoutBox,i);if(n){const o=n(Nc(a));this.hasMutatedConstraints=!!o,o&&(a=Qi(o))}return a}startAnimation(t){const{drag:n,dragMomentum:s,dragElastic:r,dragTransition:i,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},u=Pt(c=>{if(!He(c,n,this.currentDirection))return;let p=l&&l[c]||{};a&&(p={min:0,max:0});const m=r?200:1e6,f=r?40:1e7,x={type:"inertia",velocity:s?t[c]:0,bounceStiffness:m,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...i,...p};return this.startAxisValueAnimation(c,x)});return Promise.all(u).then(o)}startAxisValueAnimation(t,n){const s=this.getAxisMotionValue(t);return s.start(_s(t,s,0,n,this.visualElement))}stopAnimation(){Pt(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Pt(t=>{var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,s=this.visualElement.getProps(),r=s[n];return r||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){Pt(n=>{const{drag:s}=this.getProps();if(!He(n,s,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(n);if(r&&r.layout){const{min:a,max:o}=r.layout.layoutBox[n];i.set(t[n]-gt(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!he(n)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Pt(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();r[a]=Rc({min:l,max:l},this.constraints[a])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Pt(a=>{if(!He(a,t,null))return;const o=this.getAxisMotionValue(a),{min:l,max:u}=this.constraints[a];o.set(gt(l,u,r[a]))})}addListeners(){if(!this.visualElement.current)return;Bc.set(this.visualElement,this);const t=this.visualElement.current,n=Lt(t,"pointerdown",l=>{const{drag:u,dragListener:c=!0}=this.getProps();u&&c&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();he(l)&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",s);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),s();const a=Ot(window,"resize",()=>this.scalePositionWithinConstraints()),o=r.addEventListener("didUpdate",(({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(Pt(c=>{const p=this.getAxisMotionValue(c);p&&(this.originPoint[c]+=l[c].translate,p.set(p.get()+l[c].translate))}),this.visualElement.render())}));return()=>{a(),n(),i(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:a=Wn,dragMomentum:o=!0}=t;return{...t,drag:n,dragDirectionLock:s,dragPropagation:r,dragConstraints:i,dragElastic:a,dragMomentum:o}}}function He(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function Uc(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class $c extends Yt{constructor(t){super(t),this.removeGroupControls=_t,this.removeListeners=_t,this.controls=new Vc(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||_t}unmount(){this.removeGroupControls(),this.removeListeners()}}const yr=e=>(t,n)=>{e&&e(t,n)};class Wc extends Yt{constructor(){super(...arguments),this.removePointerDownListener=_t}onPointerDown(t){this.session=new Xi(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:so(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:yr(t),onStart:yr(n),onMove:s,onEnd:(i,a)=>{delete this.session,r&&r(i,a)}}}mount(){this.removePointerDownListener=Lt(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function Hc(){const e=j.useContext(an);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:s}=e,r=j.useId();return j.useEffect(()=>s(r),[]),!t&&n?[!1,()=>n&&n(r)]:[!0]}const Ze={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function vr(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const _e={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(ht.test(e))e=parseFloat(e);else return e;const n=vr(e,t.target.x),s=vr(e,t.target.y);return`${n}% ${s}%`}},Gc={correct:(e,{treeScale:t,projectionDelta:n})=>{const s=e,r=Zt.parse(e);if(r.length>5)return s;const i=Zt.createTransformer(e),a=typeof r[0]!="number"?1:0,o=n.x.scale*t.x,l=n.y.scale*t.y;r[0+a]/=o,r[1+a]/=l;const u=gt(o,l,.5);return typeof r[2+a]=="number"&&(r[2+a]/=u),typeof r[3+a]=="number"&&(r[3+a]/=u),i(r)}};class qc extends j.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s,layoutId:r}=this.props,{projection:i}=t;Ho(Kc),i&&(n.group&&n.group.add(i),s&&s.register&&r&&s.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Ze.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:s,drag:r,isPresent:i}=this.props,a=s.projection;return a&&(a.isPresent=i,r||t.layoutDependency!==n||n===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==i&&(i?a.promote():a.relegate()||xt.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),es.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:r}=t;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function ro(e){const[t,n]=Hc(),s=j.useContext(rs);return I.jsx(qc,{...e,layoutGroup:s,switchLayoutGroup:j.useContext(ti),isPresent:t,safeToRemove:n})}const Kc={borderRadius:{..._e,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:_e,borderTopRightRadius:_e,borderBottomLeftRadius:_e,borderBottomRightRadius:_e,boxShadow:Gc},io=["TopLeft","TopRight","BottomLeft","BottomRight"],Zc=io.length,xr=e=>typeof e=="string"?parseFloat(e):e,br=e=>typeof e=="number"||ht.test(e);function Yc(e,t,n,s,r,i){r?(e.opacity=gt(0,n.opacity!==void 0?n.opacity:1,Xc(s)),e.opacityExit=gt(t.opacity!==void 0?t.opacity:1,0,Jc(s))):i&&(e.opacity=gt(t.opacity!==void 0?t.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let a=0;a<Zc;a++){const o=`border${io[a]}Radius`;let l=wr(t,o),u=wr(n,o);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||br(l)===br(u)?(e[o]=Math.max(gt(xr(l),xr(u),s),0),(Ft.test(u)||Ft.test(l))&&(e[o]+="%")):e[o]=u}(t.rotate||n.rotate)&&(e.rotate=gt(t.rotate||0,n.rotate||0,s))}function wr(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Xc=oo(0,.5,$i),Jc=oo(.5,.95,_t);function oo(e,t,n){return s=>s<e?0:s>t?1:n(Me(e,t,s))}function kr(e,t){e.min=t.min,e.max=t.max}function Ct(e,t){kr(e.x,t.x),kr(e.y,t.y)}function _r(e,t,n,s,r){return e-=t,e=nn(e,1/n,s),r!==void 0&&(e=nn(e,1/r,s)),e}function Qc(e,t=0,n=1,s=.5,r,i=e,a=e){if(Ft.test(t)&&(t=parseFloat(t),t=gt(a.min,a.max,t/100)-a.min),typeof t!="number")return;let o=gt(i.min,i.max,s);e===i&&(o-=t),e.min=_r(e.min,t,n,o,r),e.max=_r(e.max,t,n,o,r)}function Sr(e,t,[n,s,r],i,a){Qc(e,t[n],t[s],t[r],t.scale,i,a)}const tu=["x","scaleX","originX"],eu=["y","scaleY","originY"];function Tr(e,t,n,s){Sr(e.x,t,tu,n?n.x:void 0,s?s.x:void 0),Sr(e.y,t,eu,n?n.y:void 0,s?s.y:void 0)}function Cr(e){return e.translate===0&&e.scale===1}function ao(e){return Cr(e.x)&&Cr(e.y)}function nu(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function lo(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function Pr(e){return St(e.x)/St(e.y)}class su{constructor(){this.members=[]}add(t){Ss(this.members,t),t.scheduleRender()}remove(t){if(Ts(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(r=>t===r);if(n===0)return!1;let s;for(let r=n;r>=0;r--){const i=this.members[r];if(i.isPresent!==!1){s=i;break}}return s?(this.promote(s),!0):!1}promote(t,n){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,n&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:r}=t.options;r===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:s}=t;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Ir(e,t,n){let s="";const r=e.x.translate/t.x,i=e.y.translate/t.y,a=(n==null?void 0:n.z)||0;if((r||i||a)&&(s=`translate3d(${r}px, ${i}px, ${a}px) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:u,rotate:c,rotateX:p,rotateY:m,skewX:f,skewY:x}=n;u&&(s=`perspective(${u}px) ${s}`),c&&(s+=`rotate(${c}deg) `),p&&(s+=`rotateX(${p}deg) `),m&&(s+=`rotateY(${m}deg) `),f&&(s+=`skewX(${f}deg) `),x&&(s+=`skewY(${x}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return(o!==1||l!==1)&&(s+=`scale(${o}, ${l})`),s||"none"}const ru=(e,t)=>e.depth-t.depth;class iu{constructor(){this.children=[],this.isDirty=!1}add(t){Ss(this.children,t),this.isDirty=!0}remove(t){Ts(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(ru),this.isDirty=!1,this.children.forEach(t)}}function ou(e,t){const n=Gt.now(),s=({timestamp:r})=>{const i=r-n;i>=t&&(Kt(s),e(i-t))};return xt.read(s,!0),()=>Kt(s)}function au(e){window.MotionDebug&&window.MotionDebug.record(e)}function lu(e){return e instanceof SVGElement&&e.tagName!=="svg"}function cu(e,t,n){const s=kt(e)?e:Ne(e);return s.start(_s("",s,t,n)),s.animation}const Cn=["","X","Y","Z"],uu={visibility:"hidden"},Er=1e3;let hu=0;const te={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function Pn(e,t,n,s){const{latestValues:r}=t;r[e]&&(n[e]=r[e],t.setStaticValue(e,0),s&&(s[e]=0))}function co({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:s,resetTransform:r}){return class{constructor(a={},o=t==null?void 0:t()){this.id=hu++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,te.totalNodes=te.resolvedTargetDeltas=te.recalculatedProjection=0,this.nodes.forEach(pu),this.nodes.forEach(xu),this.nodes.forEach(bu),this.nodes.forEach(mu),au(te)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new iu)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Cs),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,o=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=lu(a),this.instance=a;const{layoutId:l,layout:u,visualElement:c}=this.options;if(c&&!c.current&&c.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),o&&(u||l)&&(this.isLayoutDirty=!0),e){let p;const m=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,p&&p(),p=ou(m,250),Ze.hasAnimatedSinceResize&&(Ze.hasAnimatedSinceResize=!1,this.nodes.forEach(Rr))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&c&&(l||u)&&this.addEventListener("didUpdate",({delta:p,hasLayoutChanged:m,hasRelativeTargetChanged:f,layout:x})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const h=this.options.transition||c.getDefaultTransition()||Tu,{onLayoutAnimationStart:v,onLayoutAnimationComplete:g}=c.getProps(),b=!this.targetLayout||!lo(this.targetLayout,x)||f,k=!m&&f;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||k||m&&(b||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(p,k);const P={...ps(h,"layout"),onPlay:v,onComplete:g};(c.shouldReduceMotion||this.options.layoutRoot)&&(P.delay=0,P.type=!1),this.startAnimation(P)}else m||Rr(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=x})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Kt(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(wu),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let c=0;c<this.path.length;c++){const p=this.path[c];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Ar);return}this.isUpdating||this.nodes.forEach(yu),this.isUpdating=!1,window.HandoffCancelAllAnimations&&window.HandoffCancelAllAnimations(),this.nodes.forEach(vu),this.nodes.forEach(du),this.nodes.forEach(fu),this.clearAllSnapshots();const o=Gt.now();bt.delta=qt(0,1e3/60,o-bt.timestamp),bt.timestamp=o,bt.isProcessing=!0,gn.update.process(bt),gn.preRender.process(bt),gn.render.process(bt),bt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,es.read(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(gu),this.sharedNodes.forEach(ku)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,xt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){xt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=vt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&(this.scroll={animationId:this.root.animationId,phase:a,isRoot:s(this.instance),offset:n(this.instance)})}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform,o=this.projectionDelta&&!ao(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,c=u!==this.prevTransformTemplateValue;a&&(o||Qt(this.latestValues)||c)&&(r(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),Cu(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return vt();const o=a.measureViewportBox(),{scroll:l}=this.root;return l&&(Wt(o.x,l.offset.x),Wt(o.y,l.offset.y)),o}removeElementScroll(a){const o=vt();Ct(o,a);for(let l=0;l<this.path.length;l++){const u=this.path[l],{scroll:c,options:p}=u;if(u!==this.root&&c&&p.layoutScroll){if(c.isRoot){Ct(o,a);const{scroll:m}=this.root;m&&(Wt(o.x,-m.offset.x),Wt(o.y,-m.offset.y))}Wt(o.x,c.offset.x),Wt(o.y,c.offset.y)}}return o}applyTransform(a,o=!1){const l=vt();Ct(l,a);for(let u=0;u<this.path.length;u++){const c=this.path[u];!o&&c.options.layoutScroll&&c.scroll&&c!==c.root&&pe(l,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),Qt(c.latestValues)&&pe(l,c.latestValues)}return Qt(this.latestValues)&&pe(l,this.latestValues),l}removeTransform(a){const o=vt();Ct(o,a);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!Qt(u.latestValues))continue;Hn(u.latestValues)&&u.updateSnapshot();const c=vt(),p=u.measurePageBox();Ct(c,p),Tr(o,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,c)}return Qt(this.latestValues)&&Tr(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==bt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var o;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==l;if(!(a||u&&this.isSharedProjectionDirty||this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:p,layoutId:m}=this.options;if(!(!this.layout||!(p||m))){if(this.resolvedRelativeTargetAt=bt.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=vt(),this.relativeTargetOrigin=vt(),Ee(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),Ct(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=vt(),this.targetWithTransforms=vt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Pc(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ct(this.target,this.layout.layoutBox),eo(this.target,this.targetDelta)):Ct(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=vt(),this.relativeTargetOrigin=vt(),Ee(this.relativeTargetOrigin,this.target,f.target),Ct(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}te.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Hn(this.parent.latestValues)||to(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let u=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(u=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===bt.timestamp&&(u=!1),u)return;const{layout:c,layoutId:p}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||p))return;Ct(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,f=this.treeScale.y;Dc(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=vt());const{target:x}=o;if(!x){this.projectionTransform&&(this.projectionDelta=fe(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=fe(),this.projectionDeltaWithTransform=fe());const h=this.projectionTransform;Ie(this.projectionDelta,this.layoutCorrected,x,this.latestValues),this.projectionTransform=Ir(this.projectionDelta,this.treeScale),(this.projectionTransform!==h||this.treeScale.x!==m||this.treeScale.y!==f)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",x)),te.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(a,o=!1){const l=this.snapshot,u=l?l.latestValues:{},c={...this.latestValues},p=fe();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const m=vt(),f=l?l.source:void 0,x=this.layout?this.layout.source:void 0,h=f!==x,v=this.getStack(),g=!v||v.members.length<=1,b=!!(h&&!g&&this.options.crossfade===!0&&!this.path.some(Su));this.animationProgress=0;let k;this.mixTargetDelta=P=>{const T=P/1e3;jr(p.x,a.x,T),jr(p.y,a.y,T),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ee(m,this.layout.layoutBox,this.relativeParent.layout.layoutBox),_u(this.relativeTarget,this.relativeTargetOrigin,m,T),k&&nu(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=vt()),Ct(k,this.relativeTarget)),h&&(this.animationValues=c,Yc(c,u,this.latestValues,T,b,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Kt(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=xt.update(()=>{Ze.hasAnimatedSinceResize=!0,this.currentAnimation=cu(0,Er,{...a,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Er),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:u,latestValues:c}=a;if(!(!o||!l||!u)){if(this!==a&&this.layout&&u&&uo(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||vt();const p=St(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+p;const m=St(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+m}Ct(o,l),pe(o,c),Ie(this.projectionDeltaWithTransform,this.layoutCorrected,o,c)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new su),this.sharedNodes.get(a).add(o);const u=o.options.initialPromotionConfig;o.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const u={};l.z&&Pn("z",a,u,this.animationValues);for(let c=0;c<Cn.length;c++)Pn(`rotate${Cn[c]}`,a,u,this.animationValues),Pn(`skew${Cn[c]}`,a,u,this.animationValues);a.render();for(const c in u)a.setStaticValue(c,u[c]),this.animationValues&&(this.animationValues[c]=u[c]);a.scheduleRender()}getProjectionStyles(a){var o,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return uu;const u={visibility:""},c=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,u.opacity="",u.pointerEvents=qe(a==null?void 0:a.pointerEvents)||"",u.transform=c?c(this.latestValues,""):"none",u;const p=this.getLead();if(!this.projectionDelta||!this.layout||!p.target){const h={};return this.options.layoutId&&(h.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,h.pointerEvents=qe(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!Qt(this.latestValues)&&(h.transform=c?c({},""):"none",this.hasProjected=!1),h}const m=p.animationValues||p.latestValues;this.applyTransformsToTarget(),u.transform=Ir(this.projectionDeltaWithTransform,this.treeScale,m),c&&(u.transform=c(m,u.transform));const{x:f,y:x}=this.projectionDelta;u.transformOrigin=`${f.origin*100}% ${x.origin*100}% 0`,p.animationValues?u.opacity=p===this?(l=(o=m.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:u.opacity=p===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const h in Ye){if(m[h]===void 0)continue;const{correct:v,applyTo:g}=Ye[h],b=u.transform==="none"?m[h]:v(m[h],p);if(g){const k=g.length;for(let P=0;P<k;P++)u[g[P]]=b}else u[h]=b}return this.options.layoutId&&(u.pointerEvents=p===this?qe(a==null?void 0:a.pointerEvents)||"":"none"),u}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var o;return(o=a.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(Ar),this.root.sharedNodes.clear()}}}function du(e){e.updateLayout()}function fu(e){var t;const n=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:r}=e.layout,{animationType:i}=e.options,a=n.source!==e.layout.source;i==="size"?Pt(p=>{const m=a?n.measuredBox[p]:n.layoutBox[p],f=St(m);m.min=s[p].min,m.max=m.min+f}):uo(i,n.layoutBox,s)&&Pt(p=>{const m=a?n.measuredBox[p]:n.layoutBox[p],f=St(s[p]);m.max=m.min+f,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[p].max=e.relativeTarget[p].min+f)});const o=fe();Ie(o,s,n.layoutBox);const l=fe();a?Ie(l,e.applyTransform(r,!0),n.measuredBox):Ie(l,s,n.layoutBox);const u=!ao(o);let c=!1;if(!e.resumeFrom){const p=e.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:m,layout:f}=p;if(m&&f){const x=vt();Ee(x,n.layoutBox,m.layoutBox);const h=vt();Ee(h,s,f.layoutBox),lo(x,h)||(c=!0),p.options.layoutRoot&&(e.relativeTarget=h,e.relativeTargetOrigin=x,e.relativeParent=p)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:l,layoutDelta:o,hasLayoutChanged:u,hasRelativeTargetChanged:c})}else if(e.isLead()){const{onExitComplete:s}=e.options;s&&s()}e.options.transition=void 0}function pu(e){te.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function mu(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function gu(e){e.clearSnapshot()}function Ar(e){e.clearMeasurements()}function yu(e){e.isLayoutDirty=!1}function vu(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Rr(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function xu(e){e.resolveTargetDelta()}function bu(e){e.calcProjection()}function wu(e){e.resetSkewAndRotation()}function ku(e){e.removeLeadSnapshot()}function jr(e,t,n){e.translate=gt(t.translate,0,n),e.scale=gt(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function Mr(e,t,n,s){e.min=gt(t.min,n.min,s),e.max=gt(t.max,n.max,s)}function _u(e,t,n,s){Mr(e.x,t.x,n.x,s),Mr(e.y,t.y,n.y,s)}function Su(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Tu={duration:.45,ease:[.4,0,.1,1]},Nr=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Fr=Nr("applewebkit/")&&!Nr("chrome/")?Math.round:_t;function Dr(e){e.min=Fr(e.min),e.max=Fr(e.max)}function Cu(e){Dr(e.x),Dr(e.y)}function uo(e,t,n){return e==="position"||e==="preserve-aspect"&&!$n(Pr(t),Pr(n),.2)}const Pu=co({attachResizeListener:(e,t)=>Ot(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),In={current:void 0},ho=co({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!In.current){const e=new Pu({});e.mount(window),e.setOptions({layoutScroll:!0}),In.current=e}return In.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Iu={pan:{Feature:Wc},drag:{Feature:$c,ProjectionNode:ho,MeasureLayout:ro}},qn={current:null},fo={current:!1};function Eu(){if(fo.current=!0,!!Jn)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>qn.current=e.matches;e.addListener(t),t()}else qn.current=!1}function Au(e,t,n){const{willChange:s}=t;for(const r in t){const i=t[r],a=n[r];if(kt(i))e.addValue(r,i),en(s)&&s.add(r);else if(kt(a))e.addValue(r,Ne(i,{owner:e})),en(s)&&s.remove(r);else if(a!==i)if(e.hasValue(r)){const o=e.getValue(r);o.liveStyle===!0?o.jump(i):o.hasAnimated||o.set(i)}else{const o=e.getStaticValue(r);e.addValue(r,Ne(o!==void 0?o:i,{owner:e}))}}for(const r in n)t[r]===void 0&&e.removeValue(r);return t}const Or=new WeakMap,Ru=[...Ti,wt,Zt],ju=e=>Ru.find(Si(e)),po=Object.keys(je),Mu=po.length,Lr=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],Nu=ss.length;function mo(e){if(e)return e.options.allowProjection!==!1?e.projection:mo(e.parent)}class Fu{scrapeMotionValuesFromProps(t,n,s){return{}}constructor({parent:t,props:n,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:i,visualState:a},o={}){this.resolveKeyframes=(m,f,x,h)=>new this.KeyframeResolver(m,f,x,h,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=ms,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>xt.render(this.render,!1,!0);const{latestValues:l,renderState:u}=a;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=u,this.parent=t,this.props=n,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.blockInitialAnimation=!!i,this.isControllingVariants=cn(n),this.isVariantNode=Qr(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:c,...p}=this.scrapeMotionValuesFromProps(n,{},this);for(const m in p){const f=p[m];l[m]!==void 0&&kt(f)&&(f.set(l[m],!1),en(c)&&c.add(m))}}mount(t){this.current=t,Or.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),fo.current||Eu(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:qn.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){var t;Or.delete(this.current),this.projection&&this.projection.unmount(),Kt(this.notifyUpdate),Kt(this.render),this.valueSubscriptions.forEach(n=>n()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const n in this.events)this.events[n].clear();for(const n in this.features)(t=this.features[n])===null||t===void 0||t.unmount();this.current=null}bindToMotionValue(t,n){const s=le.has(t),r=n.on("change",a=>{this.latestValues[t]=a,this.props.onUpdate&&xt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),i=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{r(),i(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...n},s,r,i){let a,o;for(let l=0;l<Mu;l++){const u=po[l],{isEnabled:c,Feature:p,ProjectionNode:m,MeasureLayout:f}=je[u];m&&(a=m),c(n)&&(!this.features[u]&&p&&(this.features[u]=new p(this)),f&&(o=f))}if((this.type==="html"||this.type==="svg")&&!this.projection&&a){this.projection=new a(this.latestValues,mo(this.parent));const{layoutId:l,layout:u,drag:c,dragConstraints:p,layoutScroll:m,layoutRoot:f}=n;this.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!c||p&&he(p),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof u=="string"?u:"both",initialPromotionConfig:i,layoutScroll:m,layoutRoot:f})}return o}updateFeatures(){for(const t in this.features){const n=this.features[t];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):vt()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<Lr.length;s++){const r=Lr[s];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const i="on"+r,a=t[i];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=Au(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const s=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(s.initial=this.props.initial),s}const n={};for(let s=0;s<Nu;s++){const r=ss[s],i=this.props[r];(Re(i)||i===!1)&&(n[r]=i)}return n}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const s=this.values.get(t);n!==s&&(s&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&n!==void 0&&(s=Ne(n===null?void 0:n,{owner:this}),this.addValue(t,s)),s}readValue(t,n){var s;let r=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(s=this.getBaseTargetFromProps(this.props,t))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,t,this.options);return r!=null&&(typeof r=="string"&&(ki(r)||bi(r))?r=parseFloat(r):!ju(r)&&Zt.test(n)&&(r=Mi(t,n)),this.setBaseTarget(t,kt(r)?r.get():r)),kt(r)?r.get():r}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var n;const{initial:s}=this.props;let r;if(typeof s=="string"||typeof s=="object"){const a=fs(this.props,s,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);a&&(r=a[t])}if(s&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,t);return i!==void 0&&!kt(i)?i:this.initialValues[t]!==void 0&&r===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new Cs),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}}class go extends Fu{constructor(){super(...arguments),this.KeyframeResolver=Ni}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:s}){delete n[t],delete s[t]}}function Du(e){return window.getComputedStyle(e)}class Ou extends go{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,n){if(le.has(n)){const s=ys(n);return s&&s.default||0}else{const s=Du(t),r=(si(n)?s.getPropertyValue(n):s[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(t,{transformPagePoint:n}){return no(t,n)}build(t,n,s,r){ls(t,n,s,r.transformTemplate)}scrapeMotionValuesFromProps(t,n,s){return ds(t,n,s)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;kt(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(t,n,s,r){li(t,n,s,r)}}class Lu extends go{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(le.has(n)){const s=ys(n);return s&&s.default||0}return n=ci.has(n)?n:ts(n),t.getAttribute(n)}measureInstanceViewportBox(){return vt()}scrapeMotionValuesFromProps(t,n,s){return hi(t,n,s)}build(t,n,s,r){us(t,n,s,this.isSVGTag,r.transformTemplate)}renderInstance(t,n,s,r){ui(t,n,s,r)}mount(t){this.isSVGTag=hs(t.tagName),super.mount(t)}}const zu=(e,t)=>is(e)?new Lu(t,{enableHardwareAcceleration:!1}):new Ou(t,{allowProjection:e!==j.Fragment,enableHardwareAcceleration:!0}),Bu={layout:{ProjectionNode:ho,MeasureLayout:ro}},Vu={..._c,...Ma,...Iu,...Bu},Uu=$o((e,t)=>ba(e,t,Vu,zu));function yo(){const e=j.useRef(!1);return Qn(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function $u(){const e=yo(),[t,n]=j.useState(0),s=j.useCallback(()=>{e.current&&n(t+1)},[t]);return[j.useCallback(()=>xt.postRender(s),[s]),t]}class Wu extends j.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Hu({children:e,isPresent:t}){const n=j.useId(),s=j.useRef(null),r=j.useRef({width:0,height:0,top:0,left:0}),{nonce:i}=j.useContext(Xn);return j.useInsertionEffect(()=>{const{width:a,height:o,top:l,left:u}=r.current;if(t||!s.current||!a||!o)return;s.current.dataset.motionPopId=n;const c=document.createElement("style");return i&&(c.nonce=i),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${o}px !important;
            top: ${l}px !important;
            left: ${u}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[t]),I.jsx(Wu,{isPresent:t,childRef:s,sizeRef:r,children:j.cloneElement(e,{ref:s})})}const En=({children:e,initial:t,isPresent:n,onExitComplete:s,custom:r,presenceAffectsLayout:i,mode:a})=>{const o=di(Gu),l=j.useId(),u=j.useMemo(()=>({id:l,initial:t,isPresent:n,custom:r,onExitComplete:c=>{o.set(c,!0);for(const p of o.values())if(!p)return;s&&s()},register:c=>(o.set(c,!1),()=>o.delete(c))}),i?[Math.random()]:[n]);return j.useMemo(()=>{o.forEach((c,p)=>o.set(p,!1))},[n]),j.useEffect(()=>{!n&&!o.size&&s&&s()},[n]),a==="popLayout"&&(e=I.jsx(Hu,{isPresent:n,children:e})),I.jsx(an.Provider,{value:u,children:e})};function Gu(){return new Map}function qu(e){return j.useEffect(()=>()=>e(),[])}const ee=e=>e.key||"";function Ku(e,t){e.forEach(n=>{const s=ee(n);t.set(s,n)})}function Zu(e){const t=[];return j.Children.forEach(e,n=>{j.isValidElement(n)&&t.push(n)}),t}const Sd=({children:e,custom:t,initial:n=!0,onExitComplete:s,exitBeforeEnter:r,presenceAffectsLayout:i=!0,mode:a="sync"})=>{const o=j.useContext(rs).forceRender||$u()[0],l=yo(),u=Zu(e);let c=u;const p=j.useRef(new Map).current,m=j.useRef(c),f=j.useRef(new Map).current,x=j.useRef(!0);if(Qn(()=>{x.current=!1,Ku(u,f),m.current=c}),qu(()=>{x.current=!0,f.clear(),p.clear()}),x.current)return I.jsx(I.Fragment,{children:c.map(b=>I.jsx(En,{isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:i,mode:a,children:b},ee(b)))});c=[...c];const h=m.current.map(ee),v=u.map(ee),g=h.length;for(let b=0;b<g;b++){const k=h[b];v.indexOf(k)===-1&&!p.has(k)&&p.set(k,void 0)}return a==="wait"&&p.size&&(c=[]),p.forEach((b,k)=>{if(v.indexOf(k)!==-1)return;const P=f.get(k);if(!P)return;const T=h.indexOf(k);let M=b;if(!M){const A=()=>{p.delete(k);const D=Array.from(f.keys()).filter(F=>!v.includes(F));if(D.forEach(F=>f.delete(F)),m.current=u.filter(F=>{const W=ee(F);return W===k||D.includes(W)}),!p.size){if(l.current===!1)return;o(),s&&s()}};M=I.jsx(En,{isPresent:!1,onExitComplete:A,custom:t,presenceAffectsLayout:i,mode:a,children:P},ee(P)),p.set(k,M)}c.splice(T,0,M)}),c=c.map(b=>{const k=b.key;return p.has(k)?b:I.jsx(En,{isPresent:!0,presenceAffectsLayout:i,mode:a,children:b},ee(b))}),I.jsx(I.Fragment,{children:p.size?c:c.map(b=>j.cloneElement(b))})},Td=e=>!e||!/^#[0-9A-F]{6}$/i.test(e)?"#E25822":e,Te=e=>e?(e.match(/([^\s]+)/g)||[]).length:0;/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yu=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Xu=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,s)=>s?s.toUpperCase():n.toLowerCase()),zr=e=>{const t=Xu(e);return t.charAt(0).toUpperCase()+t.slice(1)},vo=(...e)=>e.filter((t,n,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===n).join(" ").trim(),Ju=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const th=j.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:a,...o},l)=>j.createElement("svg",{ref:l,...Qu,width:t,height:t,stroke:e,strokeWidth:s?Number(n)*24/Number(t):n,className:vo("lucide",r),...!i&&!Ju(o)&&{"aria-hidden":"true"},...o},[...a.map(([u,c])=>j.createElement(u,c)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=(e,t)=>{const n=j.forwardRef(({className:s,...r},i)=>j.createElement(th,{ref:i,iconNode:t,className:vo(`lucide-${Yu(zr(e))}`,`lucide-${e}`,s),...r}));return n.displayName=zr(e),n};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eh=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Cd=ft("arrow-left",eh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nh=[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],Pd=ft("book-marked",nh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sh=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Id=ft("book-open",sh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rh=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]],Ed=ft("bookmark-check",rh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ad=ft("check",ih);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oh=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ah=ft("chevron-down",oh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ch=ft("chevron-left",lh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Rd=ft("chevron-right",uh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hh=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],jd=ft("circle-alert",hh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dh=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Md=ft("circle-check-big",dh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fh=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],Nd=ft("cloud-download",fh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ph=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Br=ft("cloud",ph);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mh=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Fd=ft("download",mh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]],Dd=ft("file-plus",gh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yh=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Od=ft("heart",yh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vh=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Ld=ft("layout-grid",vh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xh=[["rect",{width:"8",height:"18",x:"3",y:"3",rx:"1",key:"oynpb5"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M20.4 18.9c.2.5-.1 1.1-.6 1.3l-1.9.7c-.5.2-1.1-.1-1.3-.6L11.1 5.1c-.2-.5.1-1.1.6-1.3l1.9-.7c.5-.2 1.1.1 1.3.6Z",key:"1qboyk"}]],zd=ft("library-big",xh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bh=[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]],Bd=ft("library",bh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wh=[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M11 19H3",key:"zflm78"}],["path",{d:"M21 16V5",key:"yxg4q8"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],kh=ft("list-music",wh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _h=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Vd=ft("loader-circle",_h);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sh=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Ud=ft("lock",Sh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Th=[["path",{d:"M5 12h14",key:"1ays0h"}]],xo=ft("minus",Th);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ch=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],Ph=ft("palette",Ch);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ih=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Eh=ft("pause",Ih);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ah=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Rh=ft("play",Ah);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jh=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],bo=ft("plus",jh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mh=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],$d=ft("refresh-cw",Mh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nh=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Wd=ft("search",Nh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fh=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Hd=ft("settings",Fh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dh=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],Oh=ft("skip-back",Dh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lh=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],zh=ft("sparkles",Lh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bh=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Gd=ft("square-check-big",Bh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vh=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],qd=ft("trash-2",Vh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uh=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Kd=ft("triangle-alert",Uh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $h=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Ae=ft("type",$h);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wh=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Hh=ft("x",Wh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gh=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],qh=ft("zap",Gh),ue={Modern:{background:"#F2F2F7",surface:"#FFFFFF",primaryText:"#000000",secondaryText:"#8A8A8E",accent:"#E25822",dimmer:"rgba(255,255,255,0.85)",borderColor:"#E5E5EA"},Sepia:{background:"#F8F1E3",surface:"#FFFDF5",primaryText:"#5C4033",secondaryText:"#8C7356",accent:"#D45D48",dimmer:"rgba(248,241,227,0.9)",borderColor:"#E6DCC8"},Night:{background:"#000000",surface:"#1C1C1E",primaryText:"#F2F2F7",secondaryText:"#8E8E93",accent:"#E25822",dimmer:"rgba(0,0,0,0.8)",borderColor:"#2C2C2E"},OLED:{background:"#000000",surface:"#121212",primaryText:"#FFFFFF",secondaryText:"#888888",accent:"#E25822",dimmer:"rgba(0,0,0,0.9)",borderColor:"#333333"},System:{background:"#F2F2F7",surface:"#FFFFFF",primaryText:"#000000",secondaryText:"#8A8A8E",accent:"#E25822",dimmer:"rgba(255,255,255,0.9)",borderColor:"#E5E5EA"}};class re{constructor(){this.listeners=new Set,this._mode="Modern";try{const t=localStorage.getItem("titan_theme_mode");t&&Object.keys(ue).concat(["System"]).includes(t)&&(this._mode=t)}catch(t){console.warn("[TitanTheme] Failed to load theme preference",t)}}static getInstance(){return re.instance||(re.instance=new re),re.instance}get mode(){return this._mode}setMode(t){this._mode=t;try{localStorage.setItem("titan_theme_mode",t)}catch(n){console.warn("[TitanTheme] Failed to save theme preference",n)}this.notify()}get currentColors(){return this._mode==="System"?typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?ue.Night:ue.Modern:ue[this._mode]||ue.Modern}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t())}}const Xt=()=>{const e=re.getInstance(),[t,n]=j.useState(e.currentColors);return j.useEffect(()=>{const s=()=>n(e.currentColors);return e.subscribe(s)},[]),t};class Mt{constructor(){this.listeners=new Set,this.STORAGE_KEY="titan_reader_prefs_v15_true_book",this.config=this.loadFromStorage()}static getInstance(){return Mt.instance||(Mt.instance=new Mt),Mt.instance}getDefaultConfig(){return{id:"user-default",themeMode:"System",fontFamily:"New York",fontSize:18,lineHeight:1.35,paragraphSpacing:10,motionBlurIntensity:.05,showReflections:!1,rsvpSpeed:200,hasCustomSpeed:!1,rsvpChunkSize:1,isRSVPContextEnabled:!0,rsvpColorHighlight:"#FF3B30"}}loadFromStorage(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(t){const n=JSON.parse(t),s={...this.getDefaultConfig(),...n};return s.hasCustomSpeed||(s.rsvpSpeed=200),s}}catch(t){console.warn("[TitanSettings] Failed to load config",t)}return this.getDefaultConfig()}saveToStorage(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.config))}catch(t){console.warn("[TitanSettings] Failed to save config",t)}}getSettings(){return{...this.config}}updateSettings(t){this.config={...this.config,...t},this.saveToStorage(),this.notify()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t())}}const ze=()=>{const e=Mt.getInstance(),[t,n]=j.useState(e.getSettings());return j.useEffect(()=>{const s=()=>n(e.getSettings());return e.subscribe(s)},[]),{settings:t,updateSettings:s=>e.updateSettings(s)}};function Ge(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var An={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Vr;function Kh(){return Vr||(Vr=1,(function(e,t){(function(n){e.exports=n()})(function(){return(function n(s,r,i){function a(u,c){if(!r[u]){if(!s[u]){var p=typeof Ge=="function"&&Ge;if(!c&&p)return p(u,!0);if(o)return o(u,!0);var m=new Error("Cannot find module '"+u+"'");throw m.code="MODULE_NOT_FOUND",m}var f=r[u]={exports:{}};s[u][0].call(f.exports,function(x){var h=s[u][1][x];return a(h||x)},f,f.exports,n,s,r,i)}return r[u].exports}for(var o=typeof Ge=="function"&&Ge,l=0;l<i.length;l++)a(i[l]);return a})({1:[function(n,s,r){var i=n("./utils"),a=n("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(l){for(var u,c,p,m,f,x,h,v=[],g=0,b=l.length,k=b,P=i.getTypeOf(l)!=="string";g<l.length;)k=b-g,p=P?(u=l[g++],c=g<b?l[g++]:0,g<b?l[g++]:0):(u=l.charCodeAt(g++),c=g<b?l.charCodeAt(g++):0,g<b?l.charCodeAt(g++):0),m=u>>2,f=(3&u)<<4|c>>4,x=1<k?(15&c)<<2|p>>6:64,h=2<k?63&p:64,v.push(o.charAt(m)+o.charAt(f)+o.charAt(x)+o.charAt(h));return v.join("")},r.decode=function(l){var u,c,p,m,f,x,h=0,v=0,g="data:";if(l.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var b,k=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&k--,l.charAt(l.length-2)===o.charAt(64)&&k--,k%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=a.uint8array?new Uint8Array(0|k):new Array(0|k);h<l.length;)u=o.indexOf(l.charAt(h++))<<2|(m=o.indexOf(l.charAt(h++)))>>4,c=(15&m)<<4|(f=o.indexOf(l.charAt(h++)))>>2,p=(3&f)<<6|(x=o.indexOf(l.charAt(h++))),b[v++]=u,f!==64&&(b[v++]=c),x!==64&&(b[v++]=p);return b}},{"./support":30,"./utils":32}],2:[function(n,s,r){var i=n("./external"),a=n("./stream/DataWorker"),o=n("./stream/Crc32Probe"),l=n("./stream/DataLengthProbe");function u(c,p,m,f,x){this.compressedSize=c,this.uncompressedSize=p,this.crc32=m,this.compression=f,this.compressedContent=x}u.prototype={getContentWorker:function(){var c=new a(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),p=this;return c.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new a(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(c,p,m){return c.pipe(new o).pipe(new l("uncompressedSize")).pipe(p.compressWorker(m)).pipe(new l("compressedSize")).withStreamInfo("compression",p)},s.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,s,r){var i=n("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,s,r){var i=n("./utils"),a=(function(){for(var o,l=[],u=0;u<256;u++){o=u;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;l[u]=o}return l})();s.exports=function(o,l){return o!==void 0&&o.length?i.getTypeOf(o)!=="string"?(function(u,c,p,m){var f=a,x=m+p;u^=-1;for(var h=m;h<x;h++)u=u>>>8^f[255&(u^c[h])];return-1^u})(0|l,o,o.length,0):(function(u,c,p,m){var f=a,x=m+p;u^=-1;for(var h=m;h<x;h++)u=u>>>8^f[255&(u^c.charCodeAt(h))];return-1^u})(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(n,s,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(n,s,r){var i=null;i=typeof Promise<"u"?Promise:n("lie"),s.exports={Promise:i}},{lie:37}],7:[function(n,s,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=n("pako"),o=n("./utils"),l=n("./stream/GenericWorker"),u=i?"uint8array":"array";function c(p,m){l.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=m,this.meta={}}r.magic="\b\0",o.inherits(c,l),c.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(u,p.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(m){p.push({data:m,meta:p.meta})}},r.compressWorker=function(p){return new c("Deflate",p)},r.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,s,r){function i(f,x){var h,v="";for(h=0;h<x;h++)v+=String.fromCharCode(255&f),f>>>=8;return v}function a(f,x,h,v,g,b){var k,P,T=f.file,M=f.compression,A=b!==u.utf8encode,D=o.transformTo("string",b(T.name)),F=o.transformTo("string",u.utf8encode(T.name)),W=T.comment,Z=o.transformTo("string",b(W)),E=o.transformTo("string",u.utf8encode(W)),z=F.length!==T.name.length,y=E.length!==W.length,B="",tt="",U="",ot=T.dir,G=T.date,at={crc32:0,compressedSize:0,uncompressedSize:0};x&&!h||(at.crc32=f.crc32,at.compressedSize=f.compressedSize,at.uncompressedSize=f.uncompressedSize);var w=0;x&&(w|=8),A||!z&&!y||(w|=2048);var C=0,K=0;ot&&(C|=16),g==="UNIX"?(K=798,C|=(function($,lt){var ut=$;return $||(ut=lt?16893:33204),(65535&ut)<<16})(T.unixPermissions,ot)):(K=20,C|=(function($){return 63&($||0)})(T.dosPermissions)),k=G.getUTCHours(),k<<=6,k|=G.getUTCMinutes(),k<<=5,k|=G.getUTCSeconds()/2,P=G.getUTCFullYear()-1980,P<<=4,P|=G.getUTCMonth()+1,P<<=5,P|=G.getUTCDate(),z&&(tt=i(1,1)+i(c(D),4)+F,B+="up"+i(tt.length,2)+tt),y&&(U=i(1,1)+i(c(Z),4)+E,B+="uc"+i(U.length,2)+U);var V="";return V+=`
\0`,V+=i(w,2),V+=M.magic,V+=i(k,2),V+=i(P,2),V+=i(at.crc32,4),V+=i(at.compressedSize,4),V+=i(at.uncompressedSize,4),V+=i(D.length,2),V+=i(B.length,2),{fileRecord:p.LOCAL_FILE_HEADER+V+D+B,dirRecord:p.CENTRAL_FILE_HEADER+i(K,2)+V+i(Z.length,2)+"\0\0\0\0"+i(C,4)+i(v,4)+D+B+Z}}var o=n("../utils"),l=n("../stream/GenericWorker"),u=n("../utf8"),c=n("../crc32"),p=n("../signature");function m(f,x,h,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=x,this.zipPlatform=h,this.encodeFileName=v,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(m,l),m.prototype.push=function(f){var x=f.meta.percent||0,h=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,l.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:h?(x+100*(h-v-1))/h:100}}))},m.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var x=this.streamFiles&&!f.file.dir;if(x){var h=a(f,x,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:h.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(f){this.accumulate=!1;var x=this.streamFiles&&!f.file.dir,h=a(f,x,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(h.dirRecord),x)this.push({data:(function(v){return p.DATA_DESCRIPTOR+i(v.crc32,4)+i(v.compressedSize,4)+i(v.uncompressedSize,4)})(f),meta:{percent:100}});else for(this.push({data:h.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var f=this.bytesWritten,x=0;x<this.dirRecords.length;x++)this.push({data:this.dirRecords[x],meta:{percent:100}});var h=this.bytesWritten-f,v=(function(g,b,k,P,T){var M=o.transformTo("string",T(P));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(g,2)+i(g,2)+i(b,4)+i(k,4)+i(M.length,2)+M})(this.dirRecords.length,h,f,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(f){this._sources.push(f);var x=this;return f.on("data",function(h){x.processChunk(h)}),f.on("end",function(){x.closedSource(x.previous.streamInfo),x._sources.length?x.prepareNextSource():x.end()}),f.on("error",function(h){x.error(h)}),this},m.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(f){var x=this._sources;if(!l.prototype.error.call(this,f))return!1;for(var h=0;h<x.length;h++)try{x[h].error(f)}catch{}return!0},m.prototype.lock=function(){l.prototype.lock.call(this);for(var f=this._sources,x=0;x<f.length;x++)f[x].lock()},s.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,s,r){var i=n("../compressions"),a=n("./ZipFileWorker");r.generateWorker=function(o,l,u){var c=new a(l.streamFiles,u,l.platform,l.encodeFileName),p=0;try{o.forEach(function(m,f){p++;var x=(function(b,k){var P=b||k,T=i[P];if(!T)throw new Error(P+" is not a valid compression method !");return T})(f.options.compression,l.compression),h=f.options.compressionOptions||l.compressionOptions||{},v=f.dir,g=f.date;f._compressWorker(x,h).withStreamInfo("file",{name:m,dir:v,date:g,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(c)}),c.entriesCount=p}catch(m){c.error(m)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,s,r){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new i;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(i.prototype=n("./object")).loadAsync=n("./load"),i.support=n("./support"),i.defaults=n("./defaults"),i.version="3.10.1",i.loadAsync=function(a,o){return new i().loadAsync(a,o)},i.external=n("./external"),s.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,s,r){var i=n("./utils"),a=n("./external"),o=n("./utf8"),l=n("./zipEntries"),u=n("./stream/Crc32Probe"),c=n("./nodejsUtils");function p(m){return new a.Promise(function(f,x){var h=m.decompressed.getContentWorker().pipe(new u);h.on("error",function(v){x(v)}).on("end",function(){h.streamInfo.crc32!==m.decompressed.crc32?x(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}s.exports=function(m,f){var x=this;return f=i.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(m)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",m,!0,f.optimizedBinaryString,f.base64).then(function(h){var v=new l(f);return v.load(h),v}).then(function(h){var v=[a.Promise.resolve(h)],g=h.files;if(f.checkCRC32)for(var b=0;b<g.length;b++)v.push(p(g[b]));return a.Promise.all(v)}).then(function(h){for(var v=h.shift(),g=v.files,b=0;b<g.length;b++){var k=g[b],P=k.fileNameStr,T=i.resolve(k.fileNameStr);x.file(T,k.decompressed,{binary:!0,optimizedBinaryString:!0,date:k.date,dir:k.dir,comment:k.fileCommentStr.length?k.fileCommentStr:null,unixPermissions:k.unixPermissions,dosPermissions:k.dosPermissions,createFolders:f.createFolders}),k.dir||(x.file(T).unsafeOriginalName=P)}return v.zipComment.length&&(x.comment=v.zipComment),x})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,s,r){var i=n("../utils"),a=n("../stream/GenericWorker");function o(l,u){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}i.inherits(o,a),o.prototype._bindStream=function(l){var u=this;(this._stream=l).pause(),l.on("data",function(c){u.push({data:c,meta:{percent:0}})}).on("error",function(c){u.isPaused?this.generatedError=c:u.error(c)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,s,r){var i=n("readable-stream").Readable;function a(o,l,u){i.call(this,l),this._helper=o;var c=this;o.on("data",function(p,m){c.push(p)||c._helper.pause(),u&&u(m)}).on("error",function(p){c.emit("error",p)}).on("end",function(){c.push(null)})}n("../utils").inherits(a,i),a.prototype._read=function(){this._helper.resume()},s.exports=a},{"../utils":32,"readable-stream":16}],14:[function(n,s,r){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,a);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,a)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var a=new Buffer(i);return a.fill(0),a},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(n,s,r){function i(T,M,A){var D,F=o.getTypeOf(M),W=o.extend(A||{},c);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(T=g(T)),W.createFolders&&(D=v(T))&&b.call(this,D,!0);var Z=F==="string"&&W.binary===!1&&W.base64===!1;A&&A.binary!==void 0||(W.binary=!Z),(M instanceof p&&M.uncompressedSize===0||W.dir||!M||M.length===0)&&(W.base64=!1,W.binary=!0,M="",W.compression="STORE",F="string");var E=null;E=M instanceof p||M instanceof l?M:x.isNode&&x.isStream(M)?new h(T,M):o.prepareContent(T,M,W.binary,W.optimizedBinaryString,W.base64);var z=new m(T,E,W);this.files[T]=z}var a=n("./utf8"),o=n("./utils"),l=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),c=n("./defaults"),p=n("./compressedObject"),m=n("./zipObject"),f=n("./generate"),x=n("./nodejsUtils"),h=n("./nodejs/NodejsStreamInputAdapter"),v=function(T){T.slice(-1)==="/"&&(T=T.substring(0,T.length-1));var M=T.lastIndexOf("/");return 0<M?T.substring(0,M):""},g=function(T){return T.slice(-1)!=="/"&&(T+="/"),T},b=function(T,M){return M=M!==void 0?M:c.createFolders,T=g(T),this.files[T]||i.call(this,T,null,{dir:!0,createFolders:M}),this.files[T]};function k(T){return Object.prototype.toString.call(T)==="[object RegExp]"}var P={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(T){var M,A,D;for(M in this.files)D=this.files[M],(A=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&T(A,D)},filter:function(T){var M=[];return this.forEach(function(A,D){T(A,D)&&M.push(D)}),M},file:function(T,M,A){if(arguments.length!==1)return T=this.root+T,i.call(this,T,M,A),this;if(k(T)){var D=T;return this.filter(function(W,Z){return!Z.dir&&D.test(W)})}var F=this.files[this.root+T];return F&&!F.dir?F:null},folder:function(T){if(!T)return this;if(k(T))return this.filter(function(F,W){return W.dir&&T.test(F)});var M=this.root+T,A=b.call(this,M),D=this.clone();return D.root=A.name,D},remove:function(T){T=this.root+T;var M=this.files[T];if(M||(T.slice(-1)!=="/"&&(T+="/"),M=this.files[T]),M&&!M.dir)delete this.files[T];else for(var A=this.filter(function(F,W){return W.name.slice(0,T.length)===T}),D=0;D<A.length;D++)delete this.files[A[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(T){var M,A={};try{if((A=o.extend(T||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");o.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var D=A.comment||this.comment||"";M=f.generateWorker(this,A,D)}catch(F){(M=new l("error")).error(F)}return new u(M,A.type||"string",A.mimeType)},generateAsync:function(T,M){return this.generateInternalStream(T).accumulate(M)},generateNodeStream:function(T,M){return(T=T||{}).type||(T.type="nodebuffer"),this.generateInternalStream(T).toNodejsStream(M)}};s.exports=P},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,s,r){s.exports=n("stream")},{stream:void 0}],17:[function(n,s,r){var i=n("./DataReader");function a(o){i.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}n("../utils").inherits(a,i),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),u=o.charCodeAt(1),c=o.charCodeAt(2),p=o.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===l&&this.data[m+1]===u&&this.data[m+2]===c&&this.data[m+3]===p)return m-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),u=o.charCodeAt(1),c=o.charCodeAt(2),p=o.charCodeAt(3),m=this.readData(4);return l===m[0]&&u===m[1]&&c===m[2]&&p===m[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./DataReader":18}],18:[function(n,s,r){var i=n("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,u=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)u=(u<<8)+this.byteAt(l);return this.index+=o,u},readString:function(o){return i.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=a},{"../utils":32}],19:[function(n,s,r){var i=n("./Uint8ArrayReader");function a(o){i.call(this,o)}n("../utils").inherits(a,i),a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,s,r){var i=n("./DataReader");function a(o){i.call(this,o)}n("../utils").inherits(a,i),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./DataReader":18}],21:[function(n,s,r){var i=n("./ArrayReader");function a(o){i.call(this,o)}n("../utils").inherits(a,i),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(n,s,r){var i=n("../utils"),a=n("../support"),o=n("./ArrayReader"),l=n("./StringReader"),u=n("./NodeBufferReader"),c=n("./Uint8ArrayReader");s.exports=function(p){var m=i.getTypeOf(p);return i.checkSupport(m),m!=="string"||a.uint8array?m==="nodebuffer"?new u(p):a.uint8array?new c(i.transformTo("uint8array",p)):new o(i.transformTo("array",p)):new l(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,s,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,s,r){var i=n("./GenericWorker"),a=n("../utils");function o(l){i.call(this,"ConvertWorker to "+l),this.destType=l}a.inherits(o,i),o.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(n,s,r){var i=n("./GenericWorker"),a=n("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(o,i),o.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,s,r){var i=n("../utils"),a=n("./GenericWorker");function o(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(o,a),o.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}a.prototype.processChunk.call(this,l)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(n,s,r){var i=n("../utils"),a=n("./GenericWorker");function o(l){a.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){u.dataIsReady=!0,u.data=c,u.max=c&&c.length||0,u.type=i.getTypeOf(c),u.isPaused||u._tickAndRepeat()},function(c){u.error(c)})}i.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,u);break;case"uint8array":l=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":l=this.data.slice(this.index,u)}return this.index=u,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(n,s,r){function i(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(l){o.processChunk(l)}),a.on("end",function(){o.end()}),a.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},s.exports=i},{}],29:[function(n,s,r){var i=n("../utils"),a=n("./ConvertWorker"),o=n("./GenericWorker"),l=n("../base64"),u=n("../support"),c=n("../external"),p=null;if(u.nodestream)try{p=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(x,h){return new c.Promise(function(v,g){var b=[],k=x._internalType,P=x._outputType,T=x._mimeType;x.on("data",function(M,A){b.push(M),h&&h(A)}).on("error",function(M){b=[],g(M)}).on("end",function(){try{var M=(function(A,D,F){switch(A){case"blob":return i.newBlob(i.transformTo("arraybuffer",D),F);case"base64":return l.encode(D);default:return i.transformTo(A,D)}})(P,(function(A,D){var F,W=0,Z=null,E=0;for(F=0;F<D.length;F++)E+=D[F].length;switch(A){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(Z=new Uint8Array(E),F=0;F<D.length;F++)Z.set(D[F],W),W+=D[F].length;return Z;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+A+"'")}})(k,b),T);v(M)}catch(A){g(A)}b=[]}).resume()})}function f(x,h,v){var g=h;switch(h){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=h,this._mimeType=v,i.checkSupport(g),this._worker=x.pipe(new a(g)),x.lock()}catch(b){this._worker=new o("error"),this._worker.error(b)}}f.prototype={accumulate:function(x){return m(this,x)},on:function(x,h){var v=this;return x==="data"?this._worker.on(x,function(g){h.call(v,g.data,g.meta)}):this._worker.on(x,function(){i.delay(h,arguments,v)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(x){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},x)}},s.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,s,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(i),r.blob=a.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!n("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(n,s,r){for(var i=n("./utils"),a=n("./support"),o=n("./nodejsUtils"),l=n("./stream/GenericWorker"),u=new Array(256),c=0;c<256;c++)u[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;u[254]=u[254]=1;function p(){l.call(this,"utf-8 decode"),this.leftOver=null}function m(){l.call(this,"utf-8 encode")}r.utf8encode=function(f){return a.nodebuffer?o.newBufferFrom(f,"utf-8"):(function(x){var h,v,g,b,k,P=x.length,T=0;for(b=0;b<P;b++)(64512&(v=x.charCodeAt(b)))==55296&&b+1<P&&(64512&(g=x.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),b++),T+=v<128?1:v<2048?2:v<65536?3:4;for(h=a.uint8array?new Uint8Array(T):new Array(T),b=k=0;k<T;b++)(64512&(v=x.charCodeAt(b)))==55296&&b+1<P&&(64512&(g=x.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),b++),v<128?h[k++]=v:(v<2048?h[k++]=192|v>>>6:(v<65536?h[k++]=224|v>>>12:(h[k++]=240|v>>>18,h[k++]=128|v>>>12&63),h[k++]=128|v>>>6&63),h[k++]=128|63&v);return h})(f)},r.utf8decode=function(f){return a.nodebuffer?i.transformTo("nodebuffer",f).toString("utf-8"):(function(x){var h,v,g,b,k=x.length,P=new Array(2*k);for(h=v=0;h<k;)if((g=x[h++])<128)P[v++]=g;else if(4<(b=u[g]))P[v++]=65533,h+=b-1;else{for(g&=b===2?31:b===3?15:7;1<b&&h<k;)g=g<<6|63&x[h++],b--;1<b?P[v++]=65533:g<65536?P[v++]=g:(g-=65536,P[v++]=55296|g>>10&1023,P[v++]=56320|1023&g)}return P.length!==v&&(P.subarray?P=P.subarray(0,v):P.length=v),i.applyFromCharCode(P)})(f=i.transformTo(a.uint8array?"uint8array":"array",f))},i.inherits(p,l),p.prototype.processChunk=function(f){var x=i.transformTo(a.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var h=x;(x=new Uint8Array(h.length+this.leftOver.length)).set(this.leftOver,0),x.set(h,this.leftOver.length)}else x=this.leftOver.concat(x);this.leftOver=null}var v=(function(b,k){var P;for((k=k||b.length)>b.length&&(k=b.length),P=k-1;0<=P&&(192&b[P])==128;)P--;return P<0||P===0?k:P+u[b[P]]>k?P:k})(x),g=x;v!==x.length&&(a.uint8array?(g=x.subarray(0,v),this.leftOver=x.subarray(v,x.length)):(g=x.slice(0,v),this.leftOver=x.slice(v,x.length))),this.push({data:r.utf8decode(g),meta:f.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=p,i.inherits(m,l),m.prototype.processChunk=function(f){this.push({data:r.utf8encode(f.data),meta:f.meta})},r.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,s,r){var i=n("./support"),a=n("./base64"),o=n("./nodejsUtils"),l=n("./external");function u(h){return h}function c(h,v){for(var g=0;g<h.length;++g)v[g]=255&h.charCodeAt(g);return v}n("setimmediate"),r.newBlob=function(h,v){r.checkSupport("blob");try{return new Blob([h],{type:v})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(h),g.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(h,v,g){var b=[],k=0,P=h.length;if(P<=g)return String.fromCharCode.apply(null,h);for(;k<P;)v==="array"||v==="nodebuffer"?b.push(String.fromCharCode.apply(null,h.slice(k,Math.min(k+g,P)))):b.push(String.fromCharCode.apply(null,h.subarray(k,Math.min(k+g,P)))),k+=g;return b.join("")},stringifyByChar:function(h){for(var v="",g=0;g<h.length;g++)v+=String.fromCharCode(h[g]);return v},applyCanBeUsed:{uint8array:(function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function m(h){var v=65536,g=r.getTypeOf(h),b=!0;if(g==="uint8array"?b=p.applyCanBeUsed.uint8array:g==="nodebuffer"&&(b=p.applyCanBeUsed.nodebuffer),b)for(;1<v;)try{return p.stringifyByChunk(h,g,v)}catch{v=Math.floor(v/2)}return p.stringifyByChar(h)}function f(h,v){for(var g=0;g<h.length;g++)v[g]=h[g];return v}r.applyFromCharCode=m;var x={};x.string={string:u,array:function(h){return c(h,new Array(h.length))},arraybuffer:function(h){return x.string.uint8array(h).buffer},uint8array:function(h){return c(h,new Uint8Array(h.length))},nodebuffer:function(h){return c(h,o.allocBuffer(h.length))}},x.array={string:m,array:u,arraybuffer:function(h){return new Uint8Array(h).buffer},uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return o.newBufferFrom(h)}},x.arraybuffer={string:function(h){return m(new Uint8Array(h))},array:function(h){return f(new Uint8Array(h),new Array(h.byteLength))},arraybuffer:u,uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return o.newBufferFrom(new Uint8Array(h))}},x.uint8array={string:m,array:function(h){return f(h,new Array(h.length))},arraybuffer:function(h){return h.buffer},uint8array:u,nodebuffer:function(h){return o.newBufferFrom(h)}},x.nodebuffer={string:m,array:function(h){return f(h,new Array(h.length))},arraybuffer:function(h){return x.nodebuffer.uint8array(h).buffer},uint8array:function(h){return f(h,new Uint8Array(h.length))},nodebuffer:u},r.transformTo=function(h,v){if(v=v||"",!h)return v;r.checkSupport(h);var g=r.getTypeOf(v);return x[g][h](v)},r.resolve=function(h){for(var v=h.split("/"),g=[],b=0;b<v.length;b++){var k=v[b];k==="."||k===""&&b!==0&&b!==v.length-1||(k===".."?g.pop():g.push(k))}return g.join("/")},r.getTypeOf=function(h){return typeof h=="string"?"string":Object.prototype.toString.call(h)==="[object Array]"?"array":i.nodebuffer&&o.isBuffer(h)?"nodebuffer":i.uint8array&&h instanceof Uint8Array?"uint8array":i.arraybuffer&&h instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(h){if(!i[h.toLowerCase()])throw new Error(h+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(h){var v,g,b="";for(g=0;g<(h||"").length;g++)b+="\\x"+((v=h.charCodeAt(g))<16?"0":"")+v.toString(16).toUpperCase();return b},r.delay=function(h,v,g){setImmediate(function(){h.apply(g||null,v||[])})},r.inherits=function(h,v){function g(){}g.prototype=v.prototype,h.prototype=new g},r.extend=function(){var h,v,g={};for(h=0;h<arguments.length;h++)for(v in arguments[h])Object.prototype.hasOwnProperty.call(arguments[h],v)&&g[v]===void 0&&(g[v]=arguments[h][v]);return g},r.prepareContent=function(h,v,g,b,k){return l.Promise.resolve(v).then(function(P){return i.blob&&(P instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(P))!==-1)&&typeof FileReader<"u"?new l.Promise(function(T,M){var A=new FileReader;A.onload=function(D){T(D.target.result)},A.onerror=function(D){M(D.target.error)},A.readAsArrayBuffer(P)}):P}).then(function(P){var T=r.getTypeOf(P);return T?(T==="arraybuffer"?P=r.transformTo("uint8array",P):T==="string"&&(k?P=a.decode(P):g&&b!==!0&&(P=(function(M){return c(M,i.uint8array?new Uint8Array(M.length):new Array(M.length))})(P))),P):l.Promise.reject(new Error("Can't read the data of '"+h+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,s,r){var i=n("./reader/readerFor"),a=n("./utils"),o=n("./signature"),l=n("./zipEntry"),u=n("./support");function c(p){this.files=[],this.loadOptions=p}c.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(m)+", expected "+a.pretty(p)+")")}},isSignature:function(p,m){var f=this.reader.index;this.reader.setIndex(p);var x=this.reader.readString(4)===m;return this.reader.setIndex(f),x},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),m=u.uint8array?"uint8array":"array",f=a.transformTo(m,p);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,m,f,x=this.zip64EndOfCentralSize-44;0<x;)p=this.reader.readInt(2),m=this.reader.readInt(4),f=this.reader.readData(m),this.zip64ExtensibleData[p]={id:p,length:m,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,m;for(p=0;p<this.files.length;p++)m=this.files[p],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(p=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var m=p;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var x=m-f;if(0<x)this.isSignature(m,o.CENTRAL_FILE_HEADER)||(this.reader.zero=x);else if(x<0)throw new Error("Corrupted zip: missing "+Math.abs(x)+" bytes.")},prepareReader:function(p){this.reader=i(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,s,r){var i=n("./reader/readerFor"),a=n("./utils"),o=n("./compressedObject"),l=n("./crc32"),u=n("./utf8"),c=n("./compressions"),p=n("./support");function m(f,x){this.options=f,this.loadOptions=x}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var x,h;if(f.skip(22),this.fileNameLength=f.readInt(2),h=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(h),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((x=(function(v){for(var g in c)if(Object.prototype.hasOwnProperty.call(c,g)&&c[g].magic===v)return c[g];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,x,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var x=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(x),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var x,h,v,g=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<g;)x=f.readInt(2),h=f.readInt(2),v=f.readData(h),this.extraFields[x]={id:x,length:h,value:v};f.setIndex(g)},handleUTF8:function(){var f=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var x=this.findExtraFieldUnicodePath();if(x!==null)this.fileNameStr=x;else{var h=a.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(h)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var g=a.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var x=i(f.value);return x.readInt(1)!==1||l(this.fileName)!==x.readInt(4)?null:u.utf8decode(x.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var x=i(f.value);return x.readInt(1)!==1||l(this.fileComment)!==x.readInt(4)?null:u.utf8decode(x.readData(f.length-5))}return null}},s.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,s,r){function i(x,h,v){this.name=x,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=h,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var a=n("./stream/StreamHelper"),o=n("./stream/DataWorker"),l=n("./utf8"),u=n("./compressedObject"),c=n("./stream/GenericWorker");i.prototype={internalStream:function(x){var h=null,v="string";try{if(!x)throw new Error("No output type specified.");var g=(v=x.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),h=this._decompressWorker();var b=!this._dataBinary;b&&!g&&(h=h.pipe(new l.Utf8EncodeWorker)),!b&&g&&(h=h.pipe(new l.Utf8DecodeWorker))}catch(k){(h=new c("error")).error(k)}return new a(h,v,"")},async:function(x,h){return this.internalStream(x).accumulate(h)},nodeStream:function(x,h){return this.internalStream(x||"nodebuffer").toNodejsStream(h)},_compressWorker:function(x,h){if(this._data instanceof u&&this._data.compression.magic===x.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),u.createWorkerFrom(v,x,h)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<p.length;f++)i.prototype[p[f]]=m;s.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,s,r){(function(i){var a,o,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var u=0,c=new l(x),p=i.document.createTextNode("");c.observe(p,{characterData:!0}),a=function(){p.data=u=++u%2}}else if(i.setImmediate||i.MessageChannel===void 0)a="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var h=i.document.createElement("script");h.onreadystatechange=function(){x(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},i.document.documentElement.appendChild(h)}:function(){setTimeout(x,0)};else{var m=new i.MessageChannel;m.port1.onmessage=x,a=function(){m.port2.postMessage(0)}}var f=[];function x(){var h,v;o=!0;for(var g=f.length;g;){for(v=f,f=[],h=-1;++h<g;)v[h]();g=f.length}o=!1}s.exports=function(h){f.push(h)!==1||o||a()}}).call(this,typeof Ue<"u"?Ue:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,s,r){var i=n("immediate");function a(){}var o={},l=["REJECTED"],u=["FULFILLED"],c=["PENDING"];function p(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,g!==a&&h(this,g)}function m(g,b,k){this.promise=g,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}function f(g,b,k){i(function(){var P;try{P=b(k)}catch(T){return o.reject(g,T)}P===g?o.reject(g,new TypeError("Cannot resolve promise with itself")):o.resolve(g,P)})}function x(g){var b=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof b=="function")return function(){b.apply(g,arguments)}}function h(g,b){var k=!1;function P(A){k||(k=!0,o.reject(g,A))}function T(A){k||(k=!0,o.resolve(g,A))}var M=v(function(){b(T,P)});M.status==="error"&&P(M.value)}function v(g,b){var k={};try{k.value=g(b),k.status="success"}catch(P){k.status="error",k.value=P}return k}(s.exports=p).prototype.finally=function(g){if(typeof g!="function")return this;var b=this.constructor;return this.then(function(k){return b.resolve(g()).then(function(){return k})},function(k){return b.resolve(g()).then(function(){throw k})})},p.prototype.catch=function(g){return this.then(null,g)},p.prototype.then=function(g,b){if(typeof g!="function"&&this.state===u||typeof b!="function"&&this.state===l)return this;var k=new this.constructor(a);return this.state!==c?f(k,this.state===u?g:b,this.outcome):this.queue.push(new m(k,g,b)),k},m.prototype.callFulfilled=function(g){o.resolve(this.promise,g)},m.prototype.otherCallFulfilled=function(g){f(this.promise,this.onFulfilled,g)},m.prototype.callRejected=function(g){o.reject(this.promise,g)},m.prototype.otherCallRejected=function(g){f(this.promise,this.onRejected,g)},o.resolve=function(g,b){var k=v(x,b);if(k.status==="error")return o.reject(g,k.value);var P=k.value;if(P)h(g,P);else{g.state=u,g.outcome=b;for(var T=-1,M=g.queue.length;++T<M;)g.queue[T].callFulfilled(b)}return g},o.reject=function(g,b){g.state=l,g.outcome=b;for(var k=-1,P=g.queue.length;++k<P;)g.queue[k].callRejected(b);return g},p.resolve=function(g){return g instanceof this?g:o.resolve(new this(a),g)},p.reject=function(g){var b=new this(a);return o.reject(b,g)},p.all=function(g){var b=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=g.length,P=!1;if(!k)return this.resolve([]);for(var T=new Array(k),M=0,A=-1,D=new this(a);++A<k;)F(g[A],A);return D;function F(W,Z){b.resolve(W).then(function(E){T[Z]=E,++M!==k||P||(P=!0,o.resolve(D,T))},function(E){P||(P=!0,o.reject(D,E))})}},p.race=function(g){var b=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=g.length,P=!1;if(!k)return this.resolve([]);for(var T=-1,M=new this(a);++T<k;)A=g[T],b.resolve(A).then(function(D){P||(P=!0,o.resolve(M,D))},function(D){P||(P=!0,o.reject(M,D))});var A;return M}},{immediate:36}],38:[function(n,s,r){var i={};(0,n("./lib/utils/common").assign)(i,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),s.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,s,r){var i=n("./zlib/deflate"),a=n("./utils/common"),o=n("./utils/strings"),l=n("./zlib/messages"),u=n("./zlib/zstream"),c=Object.prototype.toString,p=0,m=-1,f=0,x=8;function h(g){if(!(this instanceof h))return new h(g);this.options=a.assign({level:m,method:x,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},g||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var k=i.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(k!==p)throw new Error(l[k]);if(b.header&&i.deflateSetHeader(this.strm,b.header),b.dictionary){var P;if(P=typeof b.dictionary=="string"?o.string2buf(b.dictionary):c.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(k=i.deflateSetDictionary(this.strm,P))!==p)throw new Error(l[k]);this._dict_set=!0}}function v(g,b){var k=new h(b);if(k.push(g,!0),k.err)throw k.msg||l[k.err];return k.result}h.prototype.push=function(g,b){var k,P,T=this.strm,M=this.options.chunkSize;if(this.ended)return!1;P=b===~~b?b:b===!0?4:0,typeof g=="string"?T.input=o.string2buf(g):c.call(g)==="[object ArrayBuffer]"?T.input=new Uint8Array(g):T.input=g,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new a.Buf8(M),T.next_out=0,T.avail_out=M),(k=i.deflate(T,P))!==1&&k!==p)return this.onEnd(k),!(this.ended=!0);T.avail_out!==0&&(T.avail_in!==0||P!==4&&P!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(T.output,T.next_out))):this.onData(a.shrinkBuf(T.output,T.next_out)))}while((0<T.avail_in||T.avail_out===0)&&k!==1);return P===4?(k=i.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===p):P!==2||(this.onEnd(p),!(T.avail_out=0))},h.prototype.onData=function(g){this.chunks.push(g)},h.prototype.onEnd=function(g){g===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},r.Deflate=h,r.deflate=v,r.deflateRaw=function(g,b){return(b=b||{}).raw=!0,v(g,b)},r.gzip=function(g,b){return(b=b||{}).gzip=!0,v(g,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,s,r){var i=n("./zlib/inflate"),a=n("./utils/common"),o=n("./utils/strings"),l=n("./zlib/constants"),u=n("./zlib/messages"),c=n("./zlib/zstream"),p=n("./zlib/gzheader"),m=Object.prototype.toString;function f(h){if(!(this instanceof f))return new f(h);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},h||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||h&&h.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&(15&v.windowBits)==0&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var g=i.inflateInit2(this.strm,v.windowBits);if(g!==l.Z_OK)throw new Error(u[g]);this.header=new p,i.inflateGetHeader(this.strm,this.header)}function x(h,v){var g=new f(v);if(g.push(h,!0),g.err)throw g.msg||u[g.err];return g.result}f.prototype.push=function(h,v){var g,b,k,P,T,M,A=this.strm,D=this.options.chunkSize,F=this.options.dictionary,W=!1;if(this.ended)return!1;b=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof h=="string"?A.input=o.binstring2buf(h):m.call(h)==="[object ArrayBuffer]"?A.input=new Uint8Array(h):A.input=h,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new a.Buf8(D),A.next_out=0,A.avail_out=D),(g=i.inflate(A,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&F&&(M=typeof F=="string"?o.string2buf(F):m.call(F)==="[object ArrayBuffer]"?new Uint8Array(F):F,g=i.inflateSetDictionary(this.strm,M)),g===l.Z_BUF_ERROR&&W===!0&&(g=l.Z_OK,W=!1),g!==l.Z_STREAM_END&&g!==l.Z_OK)return this.onEnd(g),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&g!==l.Z_STREAM_END&&(A.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(k=o.utf8border(A.output,A.next_out),P=A.next_out-k,T=o.buf2string(A.output,k),A.next_out=P,A.avail_out=D-P,P&&a.arraySet(A.output,A.output,k,P,0),this.onData(T)):this.onData(a.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(W=!0)}while((0<A.avail_in||A.avail_out===0)&&g!==l.Z_STREAM_END);return g===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(g=i.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(A.avail_out=0))},f.prototype.onData=function(h){this.chunks.push(h)},f.prototype.onEnd=function(h){h===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},r.Inflate=f,r.inflate=x,r.inflateRaw=function(h,v){return(v=v||{}).raw=!0,x(h,v)},r.ungzip=x},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,s,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var c=u.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var p in c)c.hasOwnProperty(p)&&(l[p]=c[p])}}return l},r.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var a={arraySet:function(l,u,c,p,m){if(u.subarray&&l.subarray)l.set(u.subarray(c,c+p),m);else for(var f=0;f<p;f++)l[m+f]=u[c+f]},flattenChunks:function(l){var u,c,p,m,f,x;for(u=p=0,c=l.length;u<c;u++)p+=l[u].length;for(x=new Uint8Array(p),u=m=0,c=l.length;u<c;u++)f=l[u],x.set(f,m),m+=f.length;return x}},o={arraySet:function(l,u,c,p,m){for(var f=0;f<p;f++)l[m+f]=u[c+f]},flattenChunks:function(l){return[].concat.apply([],l)}};r.setTyped=function(l){l?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,a)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(i)},{}],42:[function(n,s,r){var i=n("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new i.Buf8(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function c(p,m){if(m<65537&&(p.subarray&&o||!p.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(p,m));for(var f="",x=0;x<m;x++)f+=String.fromCharCode(p[x]);return f}l[254]=l[254]=1,r.string2buf=function(p){var m,f,x,h,v,g=p.length,b=0;for(h=0;h<g;h++)(64512&(f=p.charCodeAt(h)))==55296&&h+1<g&&(64512&(x=p.charCodeAt(h+1)))==56320&&(f=65536+(f-55296<<10)+(x-56320),h++),b+=f<128?1:f<2048?2:f<65536?3:4;for(m=new i.Buf8(b),h=v=0;v<b;h++)(64512&(f=p.charCodeAt(h)))==55296&&h+1<g&&(64512&(x=p.charCodeAt(h+1)))==56320&&(f=65536+(f-55296<<10)+(x-56320),h++),f<128?m[v++]=f:(f<2048?m[v++]=192|f>>>6:(f<65536?m[v++]=224|f>>>12:(m[v++]=240|f>>>18,m[v++]=128|f>>>12&63),m[v++]=128|f>>>6&63),m[v++]=128|63&f);return m},r.buf2binstring=function(p){return c(p,p.length)},r.binstring2buf=function(p){for(var m=new i.Buf8(p.length),f=0,x=m.length;f<x;f++)m[f]=p.charCodeAt(f);return m},r.buf2string=function(p,m){var f,x,h,v,g=m||p.length,b=new Array(2*g);for(f=x=0;f<g;)if((h=p[f++])<128)b[x++]=h;else if(4<(v=l[h]))b[x++]=65533,f+=v-1;else{for(h&=v===2?31:v===3?15:7;1<v&&f<g;)h=h<<6|63&p[f++],v--;1<v?b[x++]=65533:h<65536?b[x++]=h:(h-=65536,b[x++]=55296|h>>10&1023,b[x++]=56320|1023&h)}return c(b,x)},r.utf8border=function(p,m){var f;for((m=m||p.length)>p.length&&(m=p.length),f=m-1;0<=f&&(192&p[f])==128;)f--;return f<0||f===0?m:f+l[p[f]]>m?f:m}},{"./common":41}],43:[function(n,s,r){s.exports=function(i,a,o,l){for(var u=65535&i|0,c=i>>>16&65535|0,p=0;o!==0;){for(o-=p=2e3<o?2e3:o;c=c+(u=u+a[l++]|0)|0,--p;);u%=65521,c%=65521}return u|c<<16|0}},{}],44:[function(n,s,r){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,s,r){var i=(function(){for(var a,o=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;o[l]=a}return o})();s.exports=function(a,o,l,u){var c=i,p=u+l;a^=-1;for(var m=u;m<p;m++)a=a>>>8^c[255&(a^o[m])];return-1^a}},{}],46:[function(n,s,r){var i,a=n("../utils/common"),o=n("./trees"),l=n("./adler32"),u=n("./crc32"),c=n("./messages"),p=0,m=4,f=0,x=-2,h=-1,v=4,g=2,b=8,k=9,P=286,T=30,M=19,A=2*P+1,D=15,F=3,W=258,Z=W+F+1,E=42,z=113,y=1,B=2,tt=3,U=4;function ot(d,O){return d.msg=c[O],O}function G(d){return(d<<1)-(4<d?9:0)}function at(d){for(var O=d.length;0<=--O;)d[O]=0}function w(d){var O=d.state,N=O.pending;N>d.avail_out&&(N=d.avail_out),N!==0&&(a.arraySet(d.output,O.pending_buf,O.pending_out,N,d.next_out),d.next_out+=N,O.pending_out+=N,d.total_out+=N,d.avail_out-=N,O.pending-=N,O.pending===0&&(O.pending_out=0))}function C(d,O){o._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,O),d.block_start=d.strstart,w(d.strm)}function K(d,O){d.pending_buf[d.pending++]=O}function V(d,O){d.pending_buf[d.pending++]=O>>>8&255,d.pending_buf[d.pending++]=255&O}function $(d,O){var N,S,_=d.max_chain_length,R=d.strstart,H=d.prev_length,q=d.nice_match,L=d.strstart>d.w_size-Z?d.strstart-(d.w_size-Z):0,X=d.window,rt=d.w_mask,J=d.prev,ct=d.strstart+W,mt=X[R+H-1],pt=X[R+H];d.prev_length>=d.good_match&&(_>>=2),q>d.lookahead&&(q=d.lookahead);do if(X[(N=O)+H]===pt&&X[N+H-1]===mt&&X[N]===X[R]&&X[++N]===X[R+1]){R+=2,N++;do;while(X[++R]===X[++N]&&X[++R]===X[++N]&&X[++R]===X[++N]&&X[++R]===X[++N]&&X[++R]===X[++N]&&X[++R]===X[++N]&&X[++R]===X[++N]&&X[++R]===X[++N]&&R<ct);if(S=W-(ct-R),R=ct-W,H<S){if(d.match_start=O,q<=(H=S))break;mt=X[R+H-1],pt=X[R+H]}}while((O=J[O&rt])>L&&--_!=0);return H<=d.lookahead?H:d.lookahead}function lt(d){var O,N,S,_,R,H,q,L,X,rt,J=d.w_size;do{if(_=d.window_size-d.lookahead-d.strstart,d.strstart>=J+(J-Z)){for(a.arraySet(d.window,d.window,J,J,0),d.match_start-=J,d.strstart-=J,d.block_start-=J,O=N=d.hash_size;S=d.head[--O],d.head[O]=J<=S?S-J:0,--N;);for(O=N=J;S=d.prev[--O],d.prev[O]=J<=S?S-J:0,--N;);_+=J}if(d.strm.avail_in===0)break;if(H=d.strm,q=d.window,L=d.strstart+d.lookahead,X=_,rt=void 0,rt=H.avail_in,X<rt&&(rt=X),N=rt===0?0:(H.avail_in-=rt,a.arraySet(q,H.input,H.next_in,rt,L),H.state.wrap===1?H.adler=l(H.adler,q,rt,L):H.state.wrap===2&&(H.adler=u(H.adler,q,rt,L)),H.next_in+=rt,H.total_in+=rt,rt),d.lookahead+=N,d.lookahead+d.insert>=F)for(R=d.strstart-d.insert,d.ins_h=d.window[R],d.ins_h=(d.ins_h<<d.hash_shift^d.window[R+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[R+F-1])&d.hash_mask,d.prev[R&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=R,R++,d.insert--,!(d.lookahead+d.insert<F)););}while(d.lookahead<Z&&d.strm.avail_in!==0)}function ut(d,O){for(var N,S;;){if(d.lookahead<Z){if(lt(d),d.lookahead<Z&&O===p)return y;if(d.lookahead===0)break}if(N=0,d.lookahead>=F&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+F-1])&d.hash_mask,N=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),N!==0&&d.strstart-N<=d.w_size-Z&&(d.match_length=$(d,N)),d.match_length>=F)if(S=o._tr_tally(d,d.strstart-d.match_start,d.match_length-F),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=F){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+F-1])&d.hash_mask,N=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else S=o._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(S&&(C(d,!1),d.strm.avail_out===0))return y}return d.insert=d.strstart<F-1?d.strstart:F-1,O===m?(C(d,!0),d.strm.avail_out===0?tt:U):d.last_lit&&(C(d,!1),d.strm.avail_out===0)?y:B}function Q(d,O){for(var N,S,_;;){if(d.lookahead<Z){if(lt(d),d.lookahead<Z&&O===p)return y;if(d.lookahead===0)break}if(N=0,d.lookahead>=F&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+F-1])&d.hash_mask,N=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=F-1,N!==0&&d.prev_length<d.max_lazy_match&&d.strstart-N<=d.w_size-Z&&(d.match_length=$(d,N),d.match_length<=5&&(d.strategy===1||d.match_length===F&&4096<d.strstart-d.match_start)&&(d.match_length=F-1)),d.prev_length>=F&&d.match_length<=d.prev_length){for(_=d.strstart+d.lookahead-F,S=o._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-F),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=_&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+F-1])&d.hash_mask,N=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=F-1,d.strstart++,S&&(C(d,!1),d.strm.avail_out===0))return y}else if(d.match_available){if((S=o._tr_tally(d,0,d.window[d.strstart-1]))&&C(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return y}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(S=o._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<F-1?d.strstart:F-1,O===m?(C(d,!0),d.strm.avail_out===0?tt:U):d.last_lit&&(C(d,!1),d.strm.avail_out===0)?y:B}function nt(d,O,N,S,_){this.good_length=d,this.max_lazy=O,this.nice_length=N,this.max_chain=S,this.func=_}function Y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*A),this.dyn_dtree=new a.Buf16(2*(2*T+1)),this.bl_tree=new a.Buf16(2*(2*M+1)),at(this.dyn_ltree),at(this.dyn_dtree),at(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(D+1),this.heap=new a.Buf16(2*P+1),at(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*P+1),at(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function st(d){var O;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=g,(O=d.state).pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?E:z,d.adler=O.wrap===2?0:1,O.last_flush=p,o._tr_init(O),f):ot(d,x)}function et(d){var O=st(d);return O===f&&(function(N){N.window_size=2*N.w_size,at(N.head),N.max_lazy_match=i[N.level].max_lazy,N.good_match=i[N.level].good_length,N.nice_match=i[N.level].nice_length,N.max_chain_length=i[N.level].max_chain,N.strstart=0,N.block_start=0,N.lookahead=0,N.insert=0,N.match_length=N.prev_length=F-1,N.match_available=0,N.ins_h=0})(d.state),O}function it(d,O,N,S,_,R){if(!d)return x;var H=1;if(O===h&&(O=6),S<0?(H=0,S=-S):15<S&&(H=2,S-=16),_<1||k<_||N!==b||S<8||15<S||O<0||9<O||R<0||v<R)return ot(d,x);S===8&&(S=9);var q=new Y;return(d.state=q).strm=d,q.wrap=H,q.gzhead=null,q.w_bits=S,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=_+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+F-1)/F),q.window=new a.Buf8(2*q.w_size),q.head=new a.Buf16(q.hash_size),q.prev=new a.Buf16(q.w_size),q.lit_bufsize=1<<_+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new a.Buf8(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=O,q.strategy=R,q.method=N,et(d)}i=[new nt(0,0,0,0,function(d,O){var N=65535;for(N>d.pending_buf_size-5&&(N=d.pending_buf_size-5);;){if(d.lookahead<=1){if(lt(d),d.lookahead===0&&O===p)return y;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var S=d.block_start+N;if((d.strstart===0||d.strstart>=S)&&(d.lookahead=d.strstart-S,d.strstart=S,C(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-Z&&(C(d,!1),d.strm.avail_out===0))return y}return d.insert=0,O===m?(C(d,!0),d.strm.avail_out===0?tt:U):(d.strstart>d.block_start&&(C(d,!1),d.strm.avail_out),y)}),new nt(4,4,8,4,ut),new nt(4,5,16,8,ut),new nt(4,6,32,32,ut),new nt(4,4,16,16,Q),new nt(8,16,32,32,Q),new nt(8,16,128,128,Q),new nt(8,32,128,256,Q),new nt(32,128,258,1024,Q),new nt(32,258,258,4096,Q)],r.deflateInit=function(d,O){return it(d,O,b,15,8,0)},r.deflateInit2=it,r.deflateReset=et,r.deflateResetKeep=st,r.deflateSetHeader=function(d,O){return d&&d.state?d.state.wrap!==2?x:(d.state.gzhead=O,f):x},r.deflate=function(d,O){var N,S,_,R;if(!d||!d.state||5<O||O<0)return d?ot(d,x):x;if(S=d.state,!d.output||!d.input&&d.avail_in!==0||S.status===666&&O!==m)return ot(d,d.avail_out===0?-5:x);if(S.strm=d,N=S.last_flush,S.last_flush=O,S.status===E)if(S.wrap===2)d.adler=0,K(S,31),K(S,139),K(S,8),S.gzhead?(K(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),K(S,255&S.gzhead.time),K(S,S.gzhead.time>>8&255),K(S,S.gzhead.time>>16&255),K(S,S.gzhead.time>>24&255),K(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),K(S,255&S.gzhead.os),S.gzhead.extra&&S.gzhead.extra.length&&(K(S,255&S.gzhead.extra.length),K(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(d.adler=u(d.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=69):(K(S,0),K(S,0),K(S,0),K(S,0),K(S,0),K(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),K(S,3),S.status=z);else{var H=b+(S.w_bits-8<<4)<<8;H|=(2<=S.strategy||S.level<2?0:S.level<6?1:S.level===6?2:3)<<6,S.strstart!==0&&(H|=32),H+=31-H%31,S.status=z,V(S,H),S.strstart!==0&&(V(S,d.adler>>>16),V(S,65535&d.adler)),d.adler=1}if(S.status===69)if(S.gzhead.extra){for(_=S.pending;S.gzindex<(65535&S.gzhead.extra.length)&&(S.pending!==S.pending_buf_size||(S.gzhead.hcrc&&S.pending>_&&(d.adler=u(d.adler,S.pending_buf,S.pending-_,_)),w(d),_=S.pending,S.pending!==S.pending_buf_size));)K(S,255&S.gzhead.extra[S.gzindex]),S.gzindex++;S.gzhead.hcrc&&S.pending>_&&(d.adler=u(d.adler,S.pending_buf,S.pending-_,_)),S.gzindex===S.gzhead.extra.length&&(S.gzindex=0,S.status=73)}else S.status=73;if(S.status===73)if(S.gzhead.name){_=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>_&&(d.adler=u(d.adler,S.pending_buf,S.pending-_,_)),w(d),_=S.pending,S.pending===S.pending_buf_size)){R=1;break}R=S.gzindex<S.gzhead.name.length?255&S.gzhead.name.charCodeAt(S.gzindex++):0,K(S,R)}while(R!==0);S.gzhead.hcrc&&S.pending>_&&(d.adler=u(d.adler,S.pending_buf,S.pending-_,_)),R===0&&(S.gzindex=0,S.status=91)}else S.status=91;if(S.status===91)if(S.gzhead.comment){_=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>_&&(d.adler=u(d.adler,S.pending_buf,S.pending-_,_)),w(d),_=S.pending,S.pending===S.pending_buf_size)){R=1;break}R=S.gzindex<S.gzhead.comment.length?255&S.gzhead.comment.charCodeAt(S.gzindex++):0,K(S,R)}while(R!==0);S.gzhead.hcrc&&S.pending>_&&(d.adler=u(d.adler,S.pending_buf,S.pending-_,_)),R===0&&(S.status=103)}else S.status=103;if(S.status===103&&(S.gzhead.hcrc?(S.pending+2>S.pending_buf_size&&w(d),S.pending+2<=S.pending_buf_size&&(K(S,255&d.adler),K(S,d.adler>>8&255),d.adler=0,S.status=z)):S.status=z),S.pending!==0){if(w(d),d.avail_out===0)return S.last_flush=-1,f}else if(d.avail_in===0&&G(O)<=G(N)&&O!==m)return ot(d,-5);if(S.status===666&&d.avail_in!==0)return ot(d,-5);if(d.avail_in!==0||S.lookahead!==0||O!==p&&S.status!==666){var q=S.strategy===2?(function(L,X){for(var rt;;){if(L.lookahead===0&&(lt(L),L.lookahead===0)){if(X===p)return y;break}if(L.match_length=0,rt=o._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++,rt&&(C(L,!1),L.strm.avail_out===0))return y}return L.insert=0,X===m?(C(L,!0),L.strm.avail_out===0?tt:U):L.last_lit&&(C(L,!1),L.strm.avail_out===0)?y:B})(S,O):S.strategy===3?(function(L,X){for(var rt,J,ct,mt,pt=L.window;;){if(L.lookahead<=W){if(lt(L),L.lookahead<=W&&X===p)return y;if(L.lookahead===0)break}if(L.match_length=0,L.lookahead>=F&&0<L.strstart&&(J=pt[ct=L.strstart-1])===pt[++ct]&&J===pt[++ct]&&J===pt[++ct]){mt=L.strstart+W;do;while(J===pt[++ct]&&J===pt[++ct]&&J===pt[++ct]&&J===pt[++ct]&&J===pt[++ct]&&J===pt[++ct]&&J===pt[++ct]&&J===pt[++ct]&&ct<mt);L.match_length=W-(mt-ct),L.match_length>L.lookahead&&(L.match_length=L.lookahead)}if(L.match_length>=F?(rt=o._tr_tally(L,1,L.match_length-F),L.lookahead-=L.match_length,L.strstart+=L.match_length,L.match_length=0):(rt=o._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++),rt&&(C(L,!1),L.strm.avail_out===0))return y}return L.insert=0,X===m?(C(L,!0),L.strm.avail_out===0?tt:U):L.last_lit&&(C(L,!1),L.strm.avail_out===0)?y:B})(S,O):i[S.level].func(S,O);if(q!==tt&&q!==U||(S.status=666),q===y||q===tt)return d.avail_out===0&&(S.last_flush=-1),f;if(q===B&&(O===1?o._tr_align(S):O!==5&&(o._tr_stored_block(S,0,0,!1),O===3&&(at(S.head),S.lookahead===0&&(S.strstart=0,S.block_start=0,S.insert=0))),w(d),d.avail_out===0))return S.last_flush=-1,f}return O!==m?f:S.wrap<=0?1:(S.wrap===2?(K(S,255&d.adler),K(S,d.adler>>8&255),K(S,d.adler>>16&255),K(S,d.adler>>24&255),K(S,255&d.total_in),K(S,d.total_in>>8&255),K(S,d.total_in>>16&255),K(S,d.total_in>>24&255)):(V(S,d.adler>>>16),V(S,65535&d.adler)),w(d),0<S.wrap&&(S.wrap=-S.wrap),S.pending!==0?f:1)},r.deflateEnd=function(d){var O;return d&&d.state?(O=d.state.status)!==E&&O!==69&&O!==73&&O!==91&&O!==103&&O!==z&&O!==666?ot(d,x):(d.state=null,O===z?ot(d,-3):f):x},r.deflateSetDictionary=function(d,O){var N,S,_,R,H,q,L,X,rt=O.length;if(!d||!d.state||(R=(N=d.state).wrap)===2||R===1&&N.status!==E||N.lookahead)return x;for(R===1&&(d.adler=l(d.adler,O,rt,0)),N.wrap=0,rt>=N.w_size&&(R===0&&(at(N.head),N.strstart=0,N.block_start=0,N.insert=0),X=new a.Buf8(N.w_size),a.arraySet(X,O,rt-N.w_size,N.w_size,0),O=X,rt=N.w_size),H=d.avail_in,q=d.next_in,L=d.input,d.avail_in=rt,d.next_in=0,d.input=O,lt(N);N.lookahead>=F;){for(S=N.strstart,_=N.lookahead-(F-1);N.ins_h=(N.ins_h<<N.hash_shift^N.window[S+F-1])&N.hash_mask,N.prev[S&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=S,S++,--_;);N.strstart=S,N.lookahead=F-1,lt(N)}return N.strstart+=N.lookahead,N.block_start=N.strstart,N.insert=N.lookahead,N.lookahead=0,N.match_length=N.prev_length=F-1,N.match_available=0,d.next_in=q,d.input=L,d.avail_in=H,N.wrap=R,f},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,s,r){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,s,r){s.exports=function(i,a){var o,l,u,c,p,m,f,x,h,v,g,b,k,P,T,M,A,D,F,W,Z,E,z,y,B;o=i.state,l=i.next_in,y=i.input,u=l+(i.avail_in-5),c=i.next_out,B=i.output,p=c-(a-i.avail_out),m=c+(i.avail_out-257),f=o.dmax,x=o.wsize,h=o.whave,v=o.wnext,g=o.window,b=o.hold,k=o.bits,P=o.lencode,T=o.distcode,M=(1<<o.lenbits)-1,A=(1<<o.distbits)-1;t:do{k<15&&(b+=y[l++]<<k,k+=8,b+=y[l++]<<k,k+=8),D=P[b&M];e:for(;;){if(b>>>=F=D>>>24,k-=F,(F=D>>>16&255)===0)B[c++]=65535&D;else{if(!(16&F)){if((64&F)==0){D=P[(65535&D)+(b&(1<<F)-1)];continue e}if(32&F){o.mode=12;break t}i.msg="invalid literal/length code",o.mode=30;break t}W=65535&D,(F&=15)&&(k<F&&(b+=y[l++]<<k,k+=8),W+=b&(1<<F)-1,b>>>=F,k-=F),k<15&&(b+=y[l++]<<k,k+=8,b+=y[l++]<<k,k+=8),D=T[b&A];n:for(;;){if(b>>>=F=D>>>24,k-=F,!(16&(F=D>>>16&255))){if((64&F)==0){D=T[(65535&D)+(b&(1<<F)-1)];continue n}i.msg="invalid distance code",o.mode=30;break t}if(Z=65535&D,k<(F&=15)&&(b+=y[l++]<<k,(k+=8)<F&&(b+=y[l++]<<k,k+=8)),f<(Z+=b&(1<<F)-1)){i.msg="invalid distance too far back",o.mode=30;break t}if(b>>>=F,k-=F,(F=c-p)<Z){if(h<(F=Z-F)&&o.sane){i.msg="invalid distance too far back",o.mode=30;break t}if(z=g,(E=0)===v){if(E+=x-F,F<W){for(W-=F;B[c++]=g[E++],--F;);E=c-Z,z=B}}else if(v<F){if(E+=x+v-F,(F-=v)<W){for(W-=F;B[c++]=g[E++],--F;);if(E=0,v<W){for(W-=F=v;B[c++]=g[E++],--F;);E=c-Z,z=B}}}else if(E+=v-F,F<W){for(W-=F;B[c++]=g[E++],--F;);E=c-Z,z=B}for(;2<W;)B[c++]=z[E++],B[c++]=z[E++],B[c++]=z[E++],W-=3;W&&(B[c++]=z[E++],1<W&&(B[c++]=z[E++]))}else{for(E=c-Z;B[c++]=B[E++],B[c++]=B[E++],B[c++]=B[E++],2<(W-=3););W&&(B[c++]=B[E++],1<W&&(B[c++]=B[E++]))}break}}break}}while(l<u&&c<m);l-=W=k>>3,b&=(1<<(k-=W<<3))-1,i.next_in=l,i.next_out=c,i.avail_in=l<u?u-l+5:5-(l-u),i.avail_out=c<m?m-c+257:257-(c-m),o.hold=b,o.bits=k}},{}],49:[function(n,s,r){var i=n("../utils/common"),a=n("./adler32"),o=n("./crc32"),l=n("./inffast"),u=n("./inftrees"),c=1,p=2,m=0,f=-2,x=1,h=852,v=592;function g(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function k(E){var z;return E&&E.state?(z=E.state,E.total_in=E.total_out=z.total=0,E.msg="",z.wrap&&(E.adler=1&z.wrap),z.mode=x,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new i.Buf32(h),z.distcode=z.distdyn=new i.Buf32(v),z.sane=1,z.back=-1,m):f}function P(E){var z;return E&&E.state?((z=E.state).wsize=0,z.whave=0,z.wnext=0,k(E)):f}function T(E,z){var y,B;return E&&E.state?(B=E.state,z<0?(y=0,z=-z):(y=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?f:(B.window!==null&&B.wbits!==z&&(B.window=null),B.wrap=y,B.wbits=z,P(E))):f}function M(E,z){var y,B;return E?(B=new b,(E.state=B).window=null,(y=T(E,z))!==m&&(E.state=null),y):f}var A,D,F=!0;function W(E){if(F){var z;for(A=new i.Buf32(512),D=new i.Buf32(32),z=0;z<144;)E.lens[z++]=8;for(;z<256;)E.lens[z++]=9;for(;z<280;)E.lens[z++]=7;for(;z<288;)E.lens[z++]=8;for(u(c,E.lens,0,288,A,0,E.work,{bits:9}),z=0;z<32;)E.lens[z++]=5;u(p,E.lens,0,32,D,0,E.work,{bits:5}),F=!1}E.lencode=A,E.lenbits=9,E.distcode=D,E.distbits=5}function Z(E,z,y,B){var tt,U=E.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new i.Buf8(U.wsize)),B>=U.wsize?(i.arraySet(U.window,z,y-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(B<(tt=U.wsize-U.wnext)&&(tt=B),i.arraySet(U.window,z,y-B,tt,U.wnext),(B-=tt)?(i.arraySet(U.window,z,y-B,B,0),U.wnext=B,U.whave=U.wsize):(U.wnext+=tt,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=tt))),0}r.inflateReset=P,r.inflateReset2=T,r.inflateResetKeep=k,r.inflateInit=function(E){return M(E,15)},r.inflateInit2=M,r.inflate=function(E,z){var y,B,tt,U,ot,G,at,w,C,K,V,$,lt,ut,Q,nt,Y,st,et,it,d,O,N,S,_=0,R=new i.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return f;(y=E.state).mode===12&&(y.mode=13),ot=E.next_out,tt=E.output,at=E.avail_out,U=E.next_in,B=E.input,G=E.avail_in,w=y.hold,C=y.bits,K=G,V=at,O=m;t:for(;;)switch(y.mode){case x:if(y.wrap===0){y.mode=13;break}for(;C<16;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if(2&y.wrap&&w===35615){R[y.check=0]=255&w,R[1]=w>>>8&255,y.check=o(y.check,R,2,0),C=w=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&w)<<8)+(w>>8))%31){E.msg="incorrect header check",y.mode=30;break}if((15&w)!=8){E.msg="unknown compression method",y.mode=30;break}if(C-=4,d=8+(15&(w>>>=4)),y.wbits===0)y.wbits=d;else if(d>y.wbits){E.msg="invalid window size",y.mode=30;break}y.dmax=1<<d,E.adler=y.check=1,y.mode=512&w?10:12,C=w=0;break;case 2:for(;C<16;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if(y.flags=w,(255&y.flags)!=8){E.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){E.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=w>>8&1),512&y.flags&&(R[0]=255&w,R[1]=w>>>8&255,y.check=o(y.check,R,2,0)),C=w=0,y.mode=3;case 3:for(;C<32;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}y.head&&(y.head.time=w),512&y.flags&&(R[0]=255&w,R[1]=w>>>8&255,R[2]=w>>>16&255,R[3]=w>>>24&255,y.check=o(y.check,R,4,0)),C=w=0,y.mode=4;case 4:for(;C<16;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}y.head&&(y.head.xflags=255&w,y.head.os=w>>8),512&y.flags&&(R[0]=255&w,R[1]=w>>>8&255,y.check=o(y.check,R,2,0)),C=w=0,y.mode=5;case 5:if(1024&y.flags){for(;C<16;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}y.length=w,y.head&&(y.head.extra_len=w),512&y.flags&&(R[0]=255&w,R[1]=w>>>8&255,y.check=o(y.check,R,2,0)),C=w=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(G<($=y.length)&&($=G),$&&(y.head&&(d=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),i.arraySet(y.head.extra,B,U,$,d)),512&y.flags&&(y.check=o(y.check,B,$,U)),G-=$,U+=$,y.length-=$),y.length))break t;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(G===0)break t;for($=0;d=B[U+$++],y.head&&d&&y.length<65536&&(y.head.name+=String.fromCharCode(d)),d&&$<G;);if(512&y.flags&&(y.check=o(y.check,B,$,U)),G-=$,U+=$,d)break t}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(G===0)break t;for($=0;d=B[U+$++],y.head&&d&&y.length<65536&&(y.head.comment+=String.fromCharCode(d)),d&&$<G;);if(512&y.flags&&(y.check=o(y.check,B,$,U)),G-=$,U+=$,d)break t}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;C<16;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if(w!==(65535&y.check)){E.msg="header crc mismatch",y.mode=30;break}C=w=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),E.adler=y.check=0,y.mode=12;break;case 10:for(;C<32;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}E.adler=y.check=g(w),C=w=0,y.mode=11;case 11:if(y.havedict===0)return E.next_out=ot,E.avail_out=at,E.next_in=U,E.avail_in=G,y.hold=w,y.bits=C,2;E.adler=y.check=1,y.mode=12;case 12:if(z===5||z===6)break t;case 13:if(y.last){w>>>=7&C,C-=7&C,y.mode=27;break}for(;C<3;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}switch(y.last=1&w,C-=1,3&(w>>>=1)){case 0:y.mode=14;break;case 1:if(W(y),y.mode=20,z!==6)break;w>>>=2,C-=2;break t;case 2:y.mode=17;break;case 3:E.msg="invalid block type",y.mode=30}w>>>=2,C-=2;break;case 14:for(w>>>=7&C,C-=7&C;C<32;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if((65535&w)!=(w>>>16^65535)){E.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&w,C=w=0,y.mode=15,z===6)break t;case 15:y.mode=16;case 16:if($=y.length){if(G<$&&($=G),at<$&&($=at),$===0)break t;i.arraySet(tt,B,U,$,ot),G-=$,U+=$,at-=$,ot+=$,y.length-=$;break}y.mode=12;break;case 17:for(;C<14;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if(y.nlen=257+(31&w),w>>>=5,C-=5,y.ndist=1+(31&w),w>>>=5,C-=5,y.ncode=4+(15&w),w>>>=4,C-=4,286<y.nlen||30<y.ndist){E.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;C<3;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}y.lens[H[y.have++]]=7&w,w>>>=3,C-=3}for(;y.have<19;)y.lens[H[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,N={bits:y.lenbits},O=u(0,y.lens,0,19,y.lencode,0,y.work,N),y.lenbits=N.bits,O){E.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;nt=(_=y.lencode[w&(1<<y.lenbits)-1])>>>16&255,Y=65535&_,!((Q=_>>>24)<=C);){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if(Y<16)w>>>=Q,C-=Q,y.lens[y.have++]=Y;else{if(Y===16){for(S=Q+2;C<S;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if(w>>>=Q,C-=Q,y.have===0){E.msg="invalid bit length repeat",y.mode=30;break}d=y.lens[y.have-1],$=3+(3&w),w>>>=2,C-=2}else if(Y===17){for(S=Q+3;C<S;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}C-=Q,d=0,$=3+(7&(w>>>=Q)),w>>>=3,C-=3}else{for(S=Q+7;C<S;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}C-=Q,d=0,$=11+(127&(w>>>=Q)),w>>>=7,C-=7}if(y.have+$>y.nlen+y.ndist){E.msg="invalid bit length repeat",y.mode=30;break}for(;$--;)y.lens[y.have++]=d}}if(y.mode===30)break;if(y.lens[256]===0){E.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,N={bits:y.lenbits},O=u(c,y.lens,0,y.nlen,y.lencode,0,y.work,N),y.lenbits=N.bits,O){E.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,N={bits:y.distbits},O=u(p,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,N),y.distbits=N.bits,O){E.msg="invalid distances set",y.mode=30;break}if(y.mode=20,z===6)break t;case 20:y.mode=21;case 21:if(6<=G&&258<=at){E.next_out=ot,E.avail_out=at,E.next_in=U,E.avail_in=G,y.hold=w,y.bits=C,l(E,V),ot=E.next_out,tt=E.output,at=E.avail_out,U=E.next_in,B=E.input,G=E.avail_in,w=y.hold,C=y.bits,y.mode===12&&(y.back=-1);break}for(y.back=0;nt=(_=y.lencode[w&(1<<y.lenbits)-1])>>>16&255,Y=65535&_,!((Q=_>>>24)<=C);){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if(nt&&(240&nt)==0){for(st=Q,et=nt,it=Y;nt=(_=y.lencode[it+((w&(1<<st+et)-1)>>st)])>>>16&255,Y=65535&_,!(st+(Q=_>>>24)<=C);){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}w>>>=st,C-=st,y.back+=st}if(w>>>=Q,C-=Q,y.back+=Q,y.length=Y,nt===0){y.mode=26;break}if(32&nt){y.back=-1,y.mode=12;break}if(64&nt){E.msg="invalid literal/length code",y.mode=30;break}y.extra=15&nt,y.mode=22;case 22:if(y.extra){for(S=y.extra;C<S;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}y.length+=w&(1<<y.extra)-1,w>>>=y.extra,C-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;nt=(_=y.distcode[w&(1<<y.distbits)-1])>>>16&255,Y=65535&_,!((Q=_>>>24)<=C);){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if((240&nt)==0){for(st=Q,et=nt,it=Y;nt=(_=y.distcode[it+((w&(1<<st+et)-1)>>st)])>>>16&255,Y=65535&_,!(st+(Q=_>>>24)<=C);){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}w>>>=st,C-=st,y.back+=st}if(w>>>=Q,C-=Q,y.back+=Q,64&nt){E.msg="invalid distance code",y.mode=30;break}y.offset=Y,y.extra=15&nt,y.mode=24;case 24:if(y.extra){for(S=y.extra;C<S;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}y.offset+=w&(1<<y.extra)-1,w>>>=y.extra,C-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){E.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(at===0)break t;if($=V-at,y.offset>$){if(($=y.offset-$)>y.whave&&y.sane){E.msg="invalid distance too far back",y.mode=30;break}lt=$>y.wnext?($-=y.wnext,y.wsize-$):y.wnext-$,$>y.length&&($=y.length),ut=y.window}else ut=tt,lt=ot-y.offset,$=y.length;for(at<$&&($=at),at-=$,y.length-=$;tt[ot++]=ut[lt++],--$;);y.length===0&&(y.mode=21);break;case 26:if(at===0)break t;tt[ot++]=y.length,at--,y.mode=21;break;case 27:if(y.wrap){for(;C<32;){if(G===0)break t;G--,w|=B[U++]<<C,C+=8}if(V-=at,E.total_out+=V,y.total+=V,V&&(E.adler=y.check=y.flags?o(y.check,tt,V,ot-V):a(y.check,tt,V,ot-V)),V=at,(y.flags?w:g(w))!==y.check){E.msg="incorrect data check",y.mode=30;break}C=w=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;C<32;){if(G===0)break t;G--,w+=B[U++]<<C,C+=8}if(w!==(4294967295&y.total)){E.msg="incorrect length check",y.mode=30;break}C=w=0}y.mode=29;case 29:O=1;break t;case 30:O=-3;break t;case 31:return-4;case 32:default:return f}return E.next_out=ot,E.avail_out=at,E.next_in=U,E.avail_in=G,y.hold=w,y.bits=C,(y.wsize||V!==E.avail_out&&y.mode<30&&(y.mode<27||z!==4))&&Z(E,E.output,E.next_out,V-E.avail_out)?(y.mode=31,-4):(K-=E.avail_in,V-=E.avail_out,E.total_in+=K,E.total_out+=V,y.total+=V,y.wrap&&V&&(E.adler=y.check=y.flags?o(y.check,tt,V,E.next_out-V):a(y.check,tt,V,E.next_out-V)),E.data_type=y.bits+(y.last?64:0)+(y.mode===12?128:0)+(y.mode===20||y.mode===15?256:0),(K==0&&V===0||z===4)&&O===m&&(O=-5),O)},r.inflateEnd=function(E){if(!E||!E.state)return f;var z=E.state;return z.window&&(z.window=null),E.state=null,m},r.inflateGetHeader=function(E,z){var y;return E&&E.state?(2&(y=E.state).wrap)==0?f:((y.head=z).done=!1,m):f},r.inflateSetDictionary=function(E,z){var y,B=z.length;return E&&E.state?(y=E.state).wrap!==0&&y.mode!==11?f:y.mode===11&&a(1,z,B,0)!==y.check?-3:Z(E,z,B,B)?(y.mode=31,-4):(y.havedict=1,m):f},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,s,r){var i=n("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(c,p,m,f,x,h,v,g){var b,k,P,T,M,A,D,F,W,Z=g.bits,E=0,z=0,y=0,B=0,tt=0,U=0,ot=0,G=0,at=0,w=0,C=null,K=0,V=new i.Buf16(16),$=new i.Buf16(16),lt=null,ut=0;for(E=0;E<=15;E++)V[E]=0;for(z=0;z<f;z++)V[p[m+z]]++;for(tt=Z,B=15;1<=B&&V[B]===0;B--);if(B<tt&&(tt=B),B===0)return x[h++]=20971520,x[h++]=20971520,g.bits=1,0;for(y=1;y<B&&V[y]===0;y++);for(tt<y&&(tt=y),E=G=1;E<=15;E++)if(G<<=1,(G-=V[E])<0)return-1;if(0<G&&(c===0||B!==1))return-1;for($[1]=0,E=1;E<15;E++)$[E+1]=$[E]+V[E];for(z=0;z<f;z++)p[m+z]!==0&&(v[$[p[m+z]]++]=z);if(A=c===0?(C=lt=v,19):c===1?(C=a,K-=257,lt=o,ut-=257,256):(C=l,lt=u,-1),E=y,M=h,ot=z=w=0,P=-1,T=(at=1<<(U=tt))-1,c===1&&852<at||c===2&&592<at)return 1;for(;;){for(D=E-ot,W=v[z]<A?(F=0,v[z]):v[z]>A?(F=lt[ut+v[z]],C[K+v[z]]):(F=96,0),b=1<<E-ot,y=k=1<<U;x[M+(w>>ot)+(k-=b)]=D<<24|F<<16|W|0,k!==0;);for(b=1<<E-1;w&b;)b>>=1;if(b!==0?(w&=b-1,w+=b):w=0,z++,--V[E]==0){if(E===B)break;E=p[m+v[z]]}if(tt<E&&(w&T)!==P){for(ot===0&&(ot=tt),M+=y,G=1<<(U=E-ot);U+ot<B&&!((G-=V[U+ot])<=0);)U++,G<<=1;if(at+=1<<U,c===1&&852<at||c===2&&592<at)return 1;x[P=w&T]=tt<<24|U<<16|M-h|0}}return w!==0&&(x[M+w]=E-ot<<24|64<<16|0),g.bits=tt,0}},{"../utils/common":41}],51:[function(n,s,r){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,s,r){var i=n("../utils/common"),a=0,o=1;function l(_){for(var R=_.length;0<=--R;)_[R]=0}var u=0,c=29,p=256,m=p+1+c,f=30,x=19,h=2*m+1,v=15,g=16,b=7,k=256,P=16,T=17,M=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=new Array(2*(m+2));l(Z);var E=new Array(2*f);l(E);var z=new Array(512);l(z);var y=new Array(256);l(y);var B=new Array(c);l(B);var tt,U,ot,G=new Array(f);function at(_,R,H,q,L){this.static_tree=_,this.extra_bits=R,this.extra_base=H,this.elems=q,this.max_length=L,this.has_stree=_&&_.length}function w(_,R){this.dyn_tree=_,this.max_code=0,this.stat_desc=R}function C(_){return _<256?z[_]:z[256+(_>>>7)]}function K(_,R){_.pending_buf[_.pending++]=255&R,_.pending_buf[_.pending++]=R>>>8&255}function V(_,R,H){_.bi_valid>g-H?(_.bi_buf|=R<<_.bi_valid&65535,K(_,_.bi_buf),_.bi_buf=R>>g-_.bi_valid,_.bi_valid+=H-g):(_.bi_buf|=R<<_.bi_valid&65535,_.bi_valid+=H)}function $(_,R,H){V(_,H[2*R],H[2*R+1])}function lt(_,R){for(var H=0;H|=1&_,_>>>=1,H<<=1,0<--R;);return H>>>1}function ut(_,R,H){var q,L,X=new Array(v+1),rt=0;for(q=1;q<=v;q++)X[q]=rt=rt+H[q-1]<<1;for(L=0;L<=R;L++){var J=_[2*L+1];J!==0&&(_[2*L]=lt(X[J]++,J))}}function Q(_){var R;for(R=0;R<m;R++)_.dyn_ltree[2*R]=0;for(R=0;R<f;R++)_.dyn_dtree[2*R]=0;for(R=0;R<x;R++)_.bl_tree[2*R]=0;_.dyn_ltree[2*k]=1,_.opt_len=_.static_len=0,_.last_lit=_.matches=0}function nt(_){8<_.bi_valid?K(_,_.bi_buf):0<_.bi_valid&&(_.pending_buf[_.pending++]=_.bi_buf),_.bi_buf=0,_.bi_valid=0}function Y(_,R,H,q){var L=2*R,X=2*H;return _[L]<_[X]||_[L]===_[X]&&q[R]<=q[H]}function st(_,R,H){for(var q=_.heap[H],L=H<<1;L<=_.heap_len&&(L<_.heap_len&&Y(R,_.heap[L+1],_.heap[L],_.depth)&&L++,!Y(R,q,_.heap[L],_.depth));)_.heap[H]=_.heap[L],H=L,L<<=1;_.heap[H]=q}function et(_,R,H){var q,L,X,rt,J=0;if(_.last_lit!==0)for(;q=_.pending_buf[_.d_buf+2*J]<<8|_.pending_buf[_.d_buf+2*J+1],L=_.pending_buf[_.l_buf+J],J++,q===0?$(_,L,R):($(_,(X=y[L])+p+1,R),(rt=A[X])!==0&&V(_,L-=B[X],rt),$(_,X=C(--q),H),(rt=D[X])!==0&&V(_,q-=G[X],rt)),J<_.last_lit;);$(_,k,R)}function it(_,R){var H,q,L,X=R.dyn_tree,rt=R.stat_desc.static_tree,J=R.stat_desc.has_stree,ct=R.stat_desc.elems,mt=-1;for(_.heap_len=0,_.heap_max=h,H=0;H<ct;H++)X[2*H]!==0?(_.heap[++_.heap_len]=mt=H,_.depth[H]=0):X[2*H+1]=0;for(;_.heap_len<2;)X[2*(L=_.heap[++_.heap_len]=mt<2?++mt:0)]=1,_.depth[L]=0,_.opt_len--,J&&(_.static_len-=rt[2*L+1]);for(R.max_code=mt,H=_.heap_len>>1;1<=H;H--)st(_,X,H);for(L=ct;H=_.heap[1],_.heap[1]=_.heap[_.heap_len--],st(_,X,1),q=_.heap[1],_.heap[--_.heap_max]=H,_.heap[--_.heap_max]=q,X[2*L]=X[2*H]+X[2*q],_.depth[L]=(_.depth[H]>=_.depth[q]?_.depth[H]:_.depth[q])+1,X[2*H+1]=X[2*q+1]=L,_.heap[1]=L++,st(_,X,1),2<=_.heap_len;);_.heap[--_.heap_max]=_.heap[1],(function(pt,Tt){var xe,Rt,be,yt,Be,fn,Dt=Tt.dyn_tree,Ps=Tt.max_code,_o=Tt.stat_desc.static_tree,So=Tt.stat_desc.has_stree,To=Tt.stat_desc.extra_bits,Is=Tt.stat_desc.extra_base,we=Tt.stat_desc.max_length,Ve=0;for(yt=0;yt<=v;yt++)pt.bl_count[yt]=0;for(Dt[2*pt.heap[pt.heap_max]+1]=0,xe=pt.heap_max+1;xe<h;xe++)we<(yt=Dt[2*Dt[2*(Rt=pt.heap[xe])+1]+1]+1)&&(yt=we,Ve++),Dt[2*Rt+1]=yt,Ps<Rt||(pt.bl_count[yt]++,Be=0,Is<=Rt&&(Be=To[Rt-Is]),fn=Dt[2*Rt],pt.opt_len+=fn*(yt+Be),So&&(pt.static_len+=fn*(_o[2*Rt+1]+Be)));if(Ve!==0){do{for(yt=we-1;pt.bl_count[yt]===0;)yt--;pt.bl_count[yt]--,pt.bl_count[yt+1]+=2,pt.bl_count[we]--,Ve-=2}while(0<Ve);for(yt=we;yt!==0;yt--)for(Rt=pt.bl_count[yt];Rt!==0;)Ps<(be=pt.heap[--xe])||(Dt[2*be+1]!==yt&&(pt.opt_len+=(yt-Dt[2*be+1])*Dt[2*be],Dt[2*be+1]=yt),Rt--)}})(_,R),ut(X,mt,_.bl_count)}function d(_,R,H){var q,L,X=-1,rt=R[1],J=0,ct=7,mt=4;for(rt===0&&(ct=138,mt=3),R[2*(H+1)+1]=65535,q=0;q<=H;q++)L=rt,rt=R[2*(q+1)+1],++J<ct&&L===rt||(J<mt?_.bl_tree[2*L]+=J:L!==0?(L!==X&&_.bl_tree[2*L]++,_.bl_tree[2*P]++):J<=10?_.bl_tree[2*T]++:_.bl_tree[2*M]++,X=L,mt=(J=0)===rt?(ct=138,3):L===rt?(ct=6,3):(ct=7,4))}function O(_,R,H){var q,L,X=-1,rt=R[1],J=0,ct=7,mt=4;for(rt===0&&(ct=138,mt=3),q=0;q<=H;q++)if(L=rt,rt=R[2*(q+1)+1],!(++J<ct&&L===rt)){if(J<mt)for(;$(_,L,_.bl_tree),--J!=0;);else L!==0?(L!==X&&($(_,L,_.bl_tree),J--),$(_,P,_.bl_tree),V(_,J-3,2)):J<=10?($(_,T,_.bl_tree),V(_,J-3,3)):($(_,M,_.bl_tree),V(_,J-11,7));X=L,mt=(J=0)===rt?(ct=138,3):L===rt?(ct=6,3):(ct=7,4)}}l(G);var N=!1;function S(_,R,H,q){V(_,(u<<1)+(q?1:0),3),(function(L,X,rt,J){nt(L),K(L,rt),K(L,~rt),i.arraySet(L.pending_buf,L.window,X,rt,L.pending),L.pending+=rt})(_,R,H)}r._tr_init=function(_){N||((function(){var R,H,q,L,X,rt=new Array(v+1);for(L=q=0;L<c-1;L++)for(B[L]=q,R=0;R<1<<A[L];R++)y[q++]=L;for(y[q-1]=L,L=X=0;L<16;L++)for(G[L]=X,R=0;R<1<<D[L];R++)z[X++]=L;for(X>>=7;L<f;L++)for(G[L]=X<<7,R=0;R<1<<D[L]-7;R++)z[256+X++]=L;for(H=0;H<=v;H++)rt[H]=0;for(R=0;R<=143;)Z[2*R+1]=8,R++,rt[8]++;for(;R<=255;)Z[2*R+1]=9,R++,rt[9]++;for(;R<=279;)Z[2*R+1]=7,R++,rt[7]++;for(;R<=287;)Z[2*R+1]=8,R++,rt[8]++;for(ut(Z,m+1,rt),R=0;R<f;R++)E[2*R+1]=5,E[2*R]=lt(R,5);tt=new at(Z,A,p+1,m,v),U=new at(E,D,0,f,v),ot=new at(new Array(0),F,0,x,b)})(),N=!0),_.l_desc=new w(_.dyn_ltree,tt),_.d_desc=new w(_.dyn_dtree,U),_.bl_desc=new w(_.bl_tree,ot),_.bi_buf=0,_.bi_valid=0,Q(_)},r._tr_stored_block=S,r._tr_flush_block=function(_,R,H,q){var L,X,rt=0;0<_.level?(_.strm.data_type===2&&(_.strm.data_type=(function(J){var ct,mt=4093624447;for(ct=0;ct<=31;ct++,mt>>>=1)if(1&mt&&J.dyn_ltree[2*ct]!==0)return a;if(J.dyn_ltree[18]!==0||J.dyn_ltree[20]!==0||J.dyn_ltree[26]!==0)return o;for(ct=32;ct<p;ct++)if(J.dyn_ltree[2*ct]!==0)return o;return a})(_)),it(_,_.l_desc),it(_,_.d_desc),rt=(function(J){var ct;for(d(J,J.dyn_ltree,J.l_desc.max_code),d(J,J.dyn_dtree,J.d_desc.max_code),it(J,J.bl_desc),ct=x-1;3<=ct&&J.bl_tree[2*W[ct]+1]===0;ct--);return J.opt_len+=3*(ct+1)+5+5+4,ct})(_),L=_.opt_len+3+7>>>3,(X=_.static_len+3+7>>>3)<=L&&(L=X)):L=X=H+5,H+4<=L&&R!==-1?S(_,R,H,q):_.strategy===4||X===L?(V(_,2+(q?1:0),3),et(_,Z,E)):(V(_,4+(q?1:0),3),(function(J,ct,mt,pt){var Tt;for(V(J,ct-257,5),V(J,mt-1,5),V(J,pt-4,4),Tt=0;Tt<pt;Tt++)V(J,J.bl_tree[2*W[Tt]+1],3);O(J,J.dyn_ltree,ct-1),O(J,J.dyn_dtree,mt-1)})(_,_.l_desc.max_code+1,_.d_desc.max_code+1,rt+1),et(_,_.dyn_ltree,_.dyn_dtree)),Q(_),q&&nt(_)},r._tr_tally=function(_,R,H){return _.pending_buf[_.d_buf+2*_.last_lit]=R>>>8&255,_.pending_buf[_.d_buf+2*_.last_lit+1]=255&R,_.pending_buf[_.l_buf+_.last_lit]=255&H,_.last_lit++,R===0?_.dyn_ltree[2*H]++:(_.matches++,R--,_.dyn_ltree[2*(y[H]+p+1)]++,_.dyn_dtree[2*C(R)]++),_.last_lit===_.lit_bufsize-1},r._tr_align=function(_){V(_,2,3),$(_,k,Z),(function(R){R.bi_valid===16?(K(R,R.bi_buf),R.bi_buf=0,R.bi_valid=0):8<=R.bi_valid&&(R.pending_buf[R.pending++]=255&R.bi_buf,R.bi_buf>>=8,R.bi_valid-=8)})(_)}},{"../utils/common":41}],53:[function(n,s,r){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,s,r){(function(i){(function(a,o){if(!a.setImmediate){var l,u,c,p,m=1,f={},x=!1,h=a.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(a);v=v&&v.setTimeout?v:a,l={}.toString.call(a.process)==="[object process]"?function(P){process.nextTick(function(){b(P)})}:(function(){if(a.postMessage&&!a.importScripts){var P=!0,T=a.onmessage;return a.onmessage=function(){P=!1},a.postMessage("","*"),a.onmessage=T,P}})()?(p="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",k,!1):a.attachEvent("onmessage",k),function(P){a.postMessage(p+P,"*")}):a.MessageChannel?((c=new MessageChannel).port1.onmessage=function(P){b(P.data)},function(P){c.port2.postMessage(P)}):h&&"onreadystatechange"in h.createElement("script")?(u=h.documentElement,function(P){var T=h.createElement("script");T.onreadystatechange=function(){b(P),T.onreadystatechange=null,u.removeChild(T),T=null},u.appendChild(T)}):function(P){setTimeout(b,0,P)},v.setImmediate=function(P){typeof P!="function"&&(P=new Function(""+P));for(var T=new Array(arguments.length-1),M=0;M<T.length;M++)T[M]=arguments[M+1];var A={callback:P,args:T};return f[m]=A,l(m),m++},v.clearImmediate=g}function g(P){delete f[P]}function b(P){if(x)setTimeout(b,0,P);else{var T=f[P];if(T){x=!0;try{(function(M){var A=M.callback,D=M.args;switch(D.length){case 0:A();break;case 1:A(D[0]);break;case 2:A(D[0],D[1]);break;case 3:A(D[0],D[1],D[2]);break;default:A.apply(o,D)}})(T)}finally{g(P),x=!1}}}}function k(P){P.source===a&&typeof P.data=="string"&&P.data.indexOf(p)===0&&b(+P.data.slice(p.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Ue<"u"?Ue:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(An)),An.exports}var Zh=Kh();const Yh=Zr(Zh);var $t=(e=>(e.INVALID_FILE="INVALID_FILE",e.MISSING_MANIFEST="MISSING_MANIFEST",e.CORRUPTION="CORRUPTION",e.DATABASE_ERROR="DATABASE_ERROR",e.UNKNOWN="UNKNOWN",e))($t||{});class Vt extends Error{constructor(t,n){super(n),this.type=t,this.name="IngestionError"}}const rn=class rn{static async findCover(t,n){var s,r;try{const i=t.replace(/\(.*\)/,"").trim(),a=n.replace(/\(.*\)/,"").trim(),o=encodeURIComponent(`${i} ${a}`),l=new AbortController,u=setTimeout(()=>l.abort(),2500),c=await fetch(`${this.SEARCH_URL}?q=${o}&limit=1&fields=cover_i`,{signal:l.signal});if(clearTimeout(u),!c.ok)return;const m=(r=(s=(await c.json()).docs)==null?void 0:s[0])==null?void 0:r.cover_i;if(m)return`${this.IMAGE_URL}/${m}-L.jpg`}catch{}}};rn.SEARCH_URL="https://openlibrary.org/search.json",rn.IMAGE_URL="https://covers.openlibrary.org/b/id";let sn=rn;class ie{constructor(){this.dbName="FlowLibraryDB",this.version=2,this.db=null}static getInstance(){return ie.instance||(ie.instance=new ie),ie.instance}async init(){if(!this.db)return new Promise((t,n)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>n(s.error),s.onupgradeneeded=r=>{const i=r.target.result;i.objectStoreNames.contains("books")||i.createObjectStore("books",{keyPath:"id"}),i.objectStoreNames.contains("metadata")||i.createObjectStore("metadata",{keyPath:"id"}),i.objectStoreNames.contains("sources")||i.createObjectStore("sources")},s.onsuccess=r=>{this.db=r.target.result,t()}})}async saveBook(t){await this.init();const{chapters:n,...s}=t;await this.put("books",t),await this.put("metadata",s)}async saveSource(t,n){await this.init(),await this.put("sources",n,t)}async getSource(t){return await this.init(),this.get("sources",t)}async deleteBook(t){await this.init(),await this.delete("books",t),await this.delete("metadata",t),await this.delete("sources",t)}async getAllMetadata(){return await this.init(),this.getAll("metadata")}async getFullBook(t){return await this.init(),this.get("books",t)}async put(t,n,s){return new Promise((r,i)=>{const o=this.db.transaction(t,"readwrite").objectStore(t),l=s?o.put(n,s):o.put(n);l.onsuccess=()=>r(),l.onerror=()=>i(l.error)})}async get(t,n){return new Promise((s,r)=>{const o=this.db.transaction(t,"readonly").objectStore(t).get(n);o.onsuccess=()=>s(o.result),o.onerror=()=>r(o.error)})}async getAll(t){return new Promise((n,s)=>{const a=this.db.transaction(t,"readonly").objectStore(t).getAll();a.onsuccess=()=>n(a.result),a.onerror=()=>s(a.error)})}async delete(t,n){return new Promise((s,r)=>{const o=this.db.transaction(t,"readwrite").objectStore(t).delete(n);o.onsuccess=()=>s(),o.onerror=()=>r(o.error)})}}class me{constructor(){}static getInstance(){return me.instance||(me.instance=new me),me.instance}async ingest(t){try{console.log(`[Ingestion] Starting import of: ${t.name} (${(t.size/1024).toFixed(1)} KB)`),this.validateFile(t);let n;try{n=await t.arrayBuffer(),console.log(`[Ingestion] File loaded into memory: ${n.byteLength} bytes`)}catch(o){throw console.error("[Ingestion] Failed to read file:",o),new Vt($t.UNKNOWN,`Failed to read file: ${o instanceof Error?o.message:"Unknown error"}`)}const s=await this.unzipFromBuffer(n);console.log("[Ingestion] ZIP extracted, files:",Object.keys(s.files).length);const r=await this.parseContainer(s);console.log(`[Ingestion] OPF path: ${r}`);const i=await this.parseOPF(s,r);console.log(`[Ingestion] OPF parsed - Title: "${i.metadata.title}", Spine items: ${i.spine.length}`);const a=await this.constructBookFromZip(s,i);return console.log(`[Ingestion] Book constructed with ${a.chapters.length} chapters`),a.coverUrl||(a.coverUrl=await sn.findCover(a.title,a.author)),a.sourceType="epub",await this.persistBook(a,n),console.log("[Ingestion] Book persisted to storage"),a}catch(n){throw console.error("[Ingestion] Import failed:",n),n instanceof Vt?n:new Vt($t.UNKNOWN,n.message||"Unknown import error")}}async ingestFromText(t,n,s,r,i){const a=crypto.randomUUID(),o=this.heuristicChaptering(s),l={id:a,title:t,author:n,coverUrl:i,tintColorHex:r,lastOpened:new Date,isFinished:!1,bookmarkProgress:0,chapters:o,sourceType:"text"};l.coverUrl||(l.coverUrl=await sn.findCover(t,n));const c=new TextEncoder().encode(s).buffer;return await this.persistBook(l,c),l}async persistBook(t,n){const s=ie.getInstance();await s.saveBook(t),await s.saveSource(t.id,n)}heuristicChaptering(t){let n=t;const s=n.indexOf("*** START OF"),r=n.indexOf("*** END OF");if(s!==-1){const p=n.substring(s),m=p.indexOf(`
`,p.indexOf(`
`)+1);n=p.substring(m)}r!==-1&&(n=n.substring(0,r));const i=n.split(/\n\s*\n/),a=[];let o=[],l="Preface",u=1;const c=400;for(let p=0;p<i.length;p++){const f=i[p].replace(/\s+/g," ").trim();if(!f)continue;const x=/^(chapter|book|part|letter|prologue|epilogue|foreword|preface|stave|volume|vol\.)\s*([ivxlcdm\d]+|the\s+\w+)?/i.test(f),h=/^[IVXLCDM]+\.?$/.test(f),v=/^\d+\.?$/.test(f);if((x||h&&f.length<10||v&&f.length<5)&&f.length<100)if(Te(o.join(" "))>50||a.length===0){this.flushChapter(a,o,l,u++),o=[],l=f;continue}else{l=f;continue}o.push(f),o.length>=c&&(this.flushChapter(a,o,l,u++),o=[],l=`Part ${u}`)}return o.length>0&&this.flushChapter(a,o,l,u++),a}flushChapter(t,n,s,r){const i=n.map(l=>`<p>${l}</p>`).join(`
`),a=Te(i);let o=s.trim();t.push({id:crypto.randomUUID(),title:o,content:i,sortOrder:t.length,wordCount:a,estimatedReadTime:Math.ceil(a/250)})}async constructBookFromZip(t,n){const s=crypto.randomUUID();let r;if(n.coverPath){const o=t.file(n.coverPath);if(o){const l=await o.async("blob");r=URL.createObjectURL(l)}}const i=[],a=20;console.log(`[Ingestion] Processing ${n.spine.length} spine items for "${n.metadata.title}"`);for(let o=0;o<n.spine.length;o+=a){const l=n.spine.slice(o,o+a);(await Promise.all(l.map((c,p)=>this.processEpubChapter(t,c,o+p)))).forEach(c=>{c&&i.push(c)}),o+a<n.spine.length&&await new Promise(c=>setTimeout(c,0))}if(console.log(`[Ingestion] Extracted ${i.length} chapters from "${n.metadata.title}"`),i.length===0&&n.spine.length>0){console.warn("[Ingestion] No chapters extracted, trying without front-matter filter...");for(let o=0;o<n.spine.length;o++){const l=await this.processEpubChapterPermissive(t,n.spine[o],o);l&&i.push(l)}console.log(`[Ingestion] Permissive mode extracted ${i.length} chapters`)}return{id:s,title:n.metadata.title,author:n.metadata.author,coverUrl:r,lastOpened:new Date,isFinished:!1,bookmarkProgress:0,chapters:i}}async processEpubChapterPermissive(t,n,s){const r=t.file(n);if(!r)return console.warn(`[Ingestion] File not found: ${n}`),null;const i=await r.async("uint8array"),a=this.cleanTextAggressive(i),o=a.replace(/<[^>]+>/g," ").trim(),l=Te(o);return l<3?null:{id:crypto.randomUUID(),title:`Section ${s+1}`,content:a,sortOrder:s,wordCount:l,estimatedReadTime:Math.ceil(l/250)}}async processEpubChapter(t,n,s){const r=t.file(n);if(!r)return null;const i=await r.async("uint8array"),a=this.cleanTextAggressive(i),o=a.replace(/<[^>]+>/g," ").trim(),l=Te(o);return l<10||s<10&&this.isLikelyFrontMatter(o,l)?null:{id:crypto.randomUUID(),title:`Chapter ${s+1}`,content:a,sortOrder:s,wordCount:l,estimatedReadTime:Math.ceil(l/250)}}cleanTextAggressive(t){let n="";try{n=new TextDecoder("utf-8",{fatal:!0}).decode(t)}catch{n=new TextDecoder("windows-1252").decode(t)}return n=n.replace(/<(script|style|head)[^>]*>[\s\S]*?<\/\1>/gi,""),n=n.replace(/<br\s*\/?>/gi,"___BR___"),n=n.replace(/<\/(p|div|h\d|li|blockquote)>/gi,"___P___"),n=n.replace(/<[^>]+>/g,""),n=this.decodeEntities(n),n=n.replace(/\s+/g," "),n=n.replace(/___BR___/g,`
`),n=n.replace(/___P___/g,`

`),n.split(`

`).map(s=>s.trim()).filter(s=>s.length>0&&!/^\d+$/.test(s)).map(s=>`<p>${s}</p>`).join(`
`)}isLikelyFrontMatter(t,n){if(n>600)return!1;const s=t.toLowerCase().slice(0,1e3);return n<200&&/copyright|rights reserved|isbn|published by|table of contents|acknowledgments/.test(s)}decodeEntities(t){const n=document.createElement("textarea");return n.innerHTML=t,n.value}validateFile(t){if(!t.name.toLowerCase().endsWith(".epub")||t.size===0)throw new Vt($t.INVALID_FILE,"Invalid EPUB file.")}async unzipFromBuffer(t){try{const n=new Yh;console.log(`[Ingestion] Loading ZIP from ArrayBuffer (${t.byteLength} bytes)...`);const s=await n.loadAsync(t);return console.log("[Ingestion] ZIP loaded successfully"),s}catch(n){throw console.error("[Ingestion] ZIP extraction failed:",n),new Vt($t.CORRUPTION,`Corrupted archive: ${n instanceof Error?n.message:"Unknown error"}`)}}async unzip(t){const n=await t.arrayBuffer();return this.unzipFromBuffer(n)}async parseContainer(t){const n=t.file("META-INF/container.xml");if(!n)throw new Vt($t.MISSING_MANIFEST,"Missing container.xml");const r=(await n.async("string")).match(/full-path=["']([^"']+)["']/i);if(!r)throw new Vt($t.MISSING_MANIFEST,"Invalid container.xml");return r[1]}async parseOPF(t,n){var h,v,g,b,k;const s=t.file(n);if(!s)throw new Vt($t.MISSING_MANIFEST,"Missing OPF");const r=await s.async("string"),i=((v=(h=r.match(/<dc:title[^>]*>(.*?)<\/dc:title>/is))==null?void 0:h[1])==null?void 0:v.trim())||"Unknown",a=((b=(g=r.match(/<dc:creator[^>]*>(.*?)<\/dc:creator>/is))==null?void 0:g[1])==null?void 0:b.trim())||"Unknown",o=new Map,l=/<item\s+([^>]+?)\s*\/?>/gi;let u;for(;(u=l.exec(r))!==null;){const P=u[1],T=P.match(/id=["']([^"']+)["']/i),M=P.match(/href=["']([^"']+)["']/i);T&&M&&o.set(T[1],M[1])}console.log(`[Ingestion] Manifest has ${o.size} items`);const c=[],p=/<itemref\s+[^>]*idref=["']([^"']+)["'][^>]*\/?>/gi;let m;for(;(m=p.exec(r))!==null;){const P=m[1],T=o.get(P);T&&c.push(this.resolvePath(n,T))}if(console.log(`[Ingestion] Spine has ${c.length} items`),c.length===0){console.warn("[Ingestion] Empty spine, falling back to manifest HTML files");for(const[P,T]of o)/\.(x?html?|htm)$/i.test(T)&&c.push(this.resolvePath(n,T));c.sort(),console.log(`[Ingestion] Fallback found ${c.length} HTML files`)}const f=(k=r.match(/<meta\s+name=["']cover["']\s+content=["']([^"']+)["']/i))==null?void 0:k[1];let x=f?o.get(f):void 0;return x&&(x=this.resolvePath(n,x)),{metadata:{title:i,author:a},spine:c,coverPath:x}}resolvePath(t,n){return(t.substring(0,t.lastIndexOf("/")+1)+n).replace(/\/+/g,"/")}}class jt{static pulse(t){if(typeof navigator>"u"||!navigator.vibrate)return;const n=t.punctuation||"";if(/[.?!]/.test(n)){navigator.vibrate(15);return}if(/[,;:]/.test(n)){navigator.vibrate(5);return}}static impactMedium(){typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(20)}static impactLight(){typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(5)}static selectionChanged(){typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(3)}}const Xh=()=>{const e=re.getInstance(),t=e.mode,n=Xt(),s=i=>{e.setMode(i)},r=["Modern","Sepia","Night","OLED"];return I.jsxs("div",{className:"flex flex-col gap-3",children:[I.jsx("h3",{className:"text-[11px] font-medium opacity-50 lowercase",style:{color:n.secondaryText},children:"appearance"}),I.jsx("div",{className:"grid grid-cols-4 gap-2",children:r.map(i=>{const a=ue[i],o=t===i;return I.jsxs("button",{onClick:()=>s(i),className:"group relative flex flex-col items-center gap-1.5 outline-none",children:[I.jsxs("div",{className:`relative w-full aspect-[4/5] rounded-xl border transition-all duration-200 ease-out overflow-hidden ${o?"ring-2 ring-offset-1 scale-[1.03]":"hover:scale-[1.02]"}`,style:{backgroundColor:a.background,borderColor:o?"transparent":"rgba(128,128,128,0.15)",ringColor:n.accent},children:[I.jsxs("div",{className:"absolute inset-3 flex flex-col items-center justify-center",children:[I.jsx("div",{className:"font-serif text-xl font-semibold",style:{color:a.primaryText},children:"Aa"}),I.jsx("div",{className:"w-full h-0.5 rounded-full mt-2 opacity-15",style:{backgroundColor:a.primaryText}}),I.jsx("div",{className:"w-2/3 h-0.5 rounded-full mt-1 opacity-15",style:{backgroundColor:a.primaryText}})]}),o&&I.jsx("div",{className:"absolute bottom-1.5 right-1.5 w-3.5 h-3.5 rounded-full flex items-center justify-center",style:{backgroundColor:n.accent},children:I.jsx("svg",{width:"8",height:"6",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:I.jsx("path",{d:"M1 4L3.5 6.5L9 1",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),I.jsx("span",{className:"text-[9px] font-medium transition-colors lowercase",style:{color:o?n.accent:n.secondaryText,opacity:o?1:.6},children:i})]},i)})}),I.jsxs("div",{className:"mt-1 flex items-center justify-between p-3 rounded-xl border",style:{backgroundColor:n.surface,borderColor:n.borderColor},children:[I.jsx("span",{className:"text-xs font-medium lowercase",style:{color:n.primaryText},children:"follow system"}),I.jsx("button",{onClick:()=>s(t==="System"?"Modern":"System"),className:"relative w-10 h-5 rounded-full transition-colors duration-200 focus:outline-none",style:{backgroundColor:t==="System"?n.accent:n.borderColor},children:I.jsx("div",{className:`absolute top-0.5 left-0.5 bg-white w-4 h-4 rounded-full shadow-sm transition-transform duration-200 ${t==="System"?"translate-x-5":"translate-x-0"}`})})]})]})},Jh=()=>{const{settings:e,updateSettings:t}=ze(),n=Xt(),[s,r]=j.useState(e.rsvpSpeed),i=j.useRef(null);j.useEffect(()=>{Math.abs(e.rsvpSpeed-s)>10&&!i.current&&r(e.rsvpSpeed)},[e.rsvpSpeed]);const a=l=>{const u=Math.max(100,Math.min(1e3,l));r(u),i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{t({rsvpSpeed:u,hasCustomSpeed:!0}),i.current=null},100)},o=[{name:"Serif",label:"fancy",val:"New York"},{name:"Sans",label:"clean",val:"SF Pro"}];return I.jsxs("div",{className:"flex flex-col gap-6 pt-2",children:[I.jsxs("div",{className:"space-y-3",children:[I.jsxs("h3",{className:"text-[11px] font-medium opacity-50 lowercase flex items-center gap-1.5",style:{color:n.secondaryText},children:[I.jsx(qh,{size:12})," pace"]}),I.jsxs("div",{className:"rounded-2xl p-4 border",style:{backgroundColor:n.surface,borderColor:n.borderColor},children:[I.jsxs("div",{className:"flex items-center justify-between mb-3",children:[I.jsx("span",{className:"text-sm font-medium lowercase",style:{color:n.primaryText},children:"speed (wpm)"}),I.jsx("span",{className:"text-xl font-semibold tracking-tight tabular-nums",style:{color:n.primaryText},children:s})]}),I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx("button",{onClick:()=>a(s-25),className:"w-10 h-10 rounded-xl flex items-center justify-center active:scale-95 transition-all",style:{backgroundColor:n.borderColor,color:n.primaryText},children:I.jsx(xo,{size:16})}),I.jsx("div",{className:"flex-1 relative h-8 flex items-center",children:I.jsx("input",{type:"range",min:100,max:1e3,step:25,value:s,onChange:l=>a(parseInt(l.target.value)),className:"w-full h-1.5 rounded-full appearance-none cursor-pointer focus:outline-none",style:{backgroundColor:n.borderColor,accentColor:n.accent}})}),I.jsx("button",{onClick:()=>a(s+25),className:"w-10 h-10 rounded-xl flex items-center justify-center active:scale-95 transition-all",style:{backgroundColor:n.borderColor,color:n.primaryText},children:I.jsx(bo,{size:16})})]})]})]}),I.jsx("div",{className:"w-full h-px",style:{backgroundColor:n.borderColor}}),I.jsxs("div",{className:"space-y-3",children:[I.jsxs("h3",{className:"text-[11px] font-medium opacity-50 lowercase flex items-center gap-1.5",style:{color:n.secondaryText},children:[I.jsx(Ae,{size:12})," typography"]}),I.jsx("div",{className:"grid grid-cols-2 gap-3",children:o.map(l=>I.jsxs("button",{onClick:()=>t({fontFamily:l.val}),className:`flex flex-col items-center justify-center gap-1.5 p-5 rounded-2xl border transition-all duration-200 ${e.fontFamily===l.val?"scale-[1.02]":"hover:scale-[1.01]"}`,style:{backgroundColor:e.fontFamily===l.val?n.primaryText:n.surface,borderColor:e.fontFamily===l.val?n.primaryText:n.borderColor,color:e.fontFamily===l.val?n.surface:n.primaryText},children:[I.jsx("span",{className:"text-2xl font-semibold",style:{fontFamily:Qh(l.val)},children:"Aa"}),I.jsxs("div",{className:"flex flex-col items-center",children:[I.jsx("span",{className:"text-sm font-medium",children:l.name}),I.jsx("span",{className:"text-[9px] font-medium opacity-50",style:{color:e.fontFamily===l.val?n.surface:n.secondaryText},children:l.label})]})]},l.val))}),I.jsxs("div",{className:"rounded-2xl p-4 border space-y-5 mt-3",style:{backgroundColor:n.surface,borderColor:n.borderColor},children:[I.jsx(Rn,{label:"size",value:e.fontSize,min:14,max:40,onChange:l=>t({fontSize:l}),theme:n}),I.jsx(Rn,{label:"room",value:e.lineHeight,min:1,max:2.2,step:.1,onChange:l=>t({lineHeight:l}),theme:n}),I.jsx(Rn,{label:"gaps",value:e.paragraphSpacing,min:0,max:40,onChange:l=>t({paragraphSpacing:l}),theme:n})]})]})]})},Rn=({label:e,value:t,min:n,max:s,step:r=1,onChange:i,theme:a})=>I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx("span",{className:"text-xs font-medium w-12 lowercase",style:{color:a.secondaryText},children:e}),I.jsx("input",{type:"range",min:n,max:s,step:r,value:t,onChange:o=>i(parseFloat(o.target.value)),className:"flex-1 h-1 rounded-full appearance-none cursor-pointer",style:{backgroundColor:a.borderColor,accentColor:a.accent}}),I.jsx("span",{className:"text-xs font-medium w-8 text-right tabular-nums",style:{color:a.primaryText},children:t.toFixed(r<1?1:0)})]});function Qh(e){return e==="New York"?"serif":e==="SF Pro"?"sans-serif":"serif"}const td="570686176836-dtbdhnverff6qo63tfbgvmrts2oadqmp.apps.googleusercontent.com",ed="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.appdata";class oe{constructor(){this.accessToken=null,this.tokenExpiry=0,this.libraryFolderId=null}static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}get isAuthenticated(){return!!this.accessToken&&Date.now()<this.tokenExpiry}async init(){window.google&&(this.tokenClient=window.google.accounts.oauth2.initTokenClient({client_id:td,scope:ed,callback:t=>{if(t.error!==void 0)throw t;this.accessToken=t.access_token,this.tokenExpiry=Date.now()+Number(t.expires_in)*1e3-6e4}}))}async signIn(){return this.tokenClient||await this.init(),new Promise(t=>{this.tokenClient.callback=n=>{n.access_token&&(this.accessToken=n.access_token,this.tokenExpiry=Date.now()+Number(n.expires_in)*1e3-6e4,t())},this.accessToken&&Date.now()<this.tokenExpiry?t():this.tokenClient.requestAccessToken({prompt:"consent"})})}async fetch(t,n={}){this.isAuthenticated||await this.signIn();const s={Authorization:`Bearer ${this.accessToken}`,...n.headers||{}};n.body instanceof FormData?delete s["Content-Type"]:s["Content-Type"]||(s["Content-Type"]="application/json");const r=async a=>fetch(t,{...n,headers:a});let i=await r(s);return i.status===401&&(await this.signIn(),s.Authorization=`Bearer ${this.accessToken}`,i=await r(s)),!i.ok&&i.status!==404&&console.warn(`[DriveService] Request failed: ${t} (${i.status})`),i}async getUserInfo(){return(await(await this.fetch("https://www.googleapis.com/oauth2/v3/userinfo")).json()).email}async ensureLibraryFolder(){if(this.libraryFolderId)return this.libraryFolderId;const s=await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("mimeType='application/vnd.google-apps.folder' and name='Flow Library' and trashed=false")}`)).json();if(s.files&&s.files.length>0)return this.libraryFolderId=s.files[0].id,this.libraryFolderId;const i=await(await this.fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",body:JSON.stringify({name:"Flow Library",mimeType:"application/vnd.google-apps.folder"})})).json();return this.libraryFolderId=i.id,this.libraryFolderId}async uploadFile(t,n){const s=await this.ensureLibraryFolder(),r={name:t,parents:[s]},i=new FormData;return i.append("metadata",new Blob([JSON.stringify(r)],{type:"application/json"})),i.append("file",n),(await(await this.fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",body:i})).json()).id}async listBooks(){const n=`'${await this.ensureLibraryFolder()}' in parents and mimeType!='application/vnd.google-apps.folder' and trashed=false`;return(await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(n)}&fields=files(id, name, modifiedTime, size, mimeType)`)).json()).files||[]}async downloadFile(t){return(await this.fetch(`https://www.googleapis.com/drive/v3/files/${t}?alt=media`)).arrayBuffer()}async getSyncState(){const s=await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name='flow_state.json' and 'appDataFolder' in parents and trashed=false")}&spaces=appDataFolder`)).json();if(!s.files||s.files.length===0)return null;const r=s.files[0].id,i=await this.fetch(`https://www.googleapis.com/drive/v3/files/${r}?alt=media`);try{return await i.json()}catch{return null}}async saveSyncState(t){const r=await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name='flow_state.json' and 'appDataFolder' in parents and trashed=false")}&spaces=appDataFolder`)).json(),i=new Blob([JSON.stringify(t)],{type:"application/json"});if(r.files&&r.files.length>0){const a=r.files[0].id;await this.fetch(`https://www.googleapis.com/upload/drive/v3/files/${a}?uploadType=media`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:i})}else{const a={name:"flow_state.json",parents:["appDataFolder"]},o=new FormData;o.append("metadata",new Blob([JSON.stringify(a)],{type:"application/json"})),o.append("file",i),await this.fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",body:o})}}}class ge{constructor(){this.status="idle",this.listeners=new Set,this.isSyncing=!1,this.pendingSync=!1,this.drive=oe.getInstance(),this.storage=ie.getInstance(),this.ingestion=me.getInstance(),this.settings=Mt.getInstance()}static getInstance(){return ge.instance||(ge.instance=new ge),ge.instance}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyStatus(t){this.status=t,this.listeners.forEach(n=>{var s;return(s=n.onStatusChange)==null?void 0:s.call(n,t)})}async connect(){try{await this.drive.signIn();const t=await this.drive.getUserInfo();return this.settings.updateSettings({isSyncEnabled:!0,googleDriveEmail:t}),this.syncNow(!0),this.syncTimer&&clearInterval(this.syncTimer),this.syncTimer=setInterval(()=>this.syncNow(!1),3e5),t}catch(t){throw console.error(t),new Error("Failed to connect Google Drive")}}requestSync(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.syncNow(!1)},2e3)}async syncNow(t=!1){if(this.settings.getSettings().isSyncEnabled&&!(!t&&!this.drive.isAuthenticated)){if(this.isSyncing){this.pendingSync=!0;return}this.isSyncing=!0,this.notifyStatus("syncing");try{await this.syncState(),await this.syncBooks(),this.notifyStatus("success"),setTimeout(()=>this.notifyStatus("idle"),3e3)}catch(n){console.error("[SyncManager] Sync failed",n),this.notifyStatus("error")}finally{this.isSyncing=!1,this.pendingSync&&(this.pendingSync=!1,this.syncNow(!1))}}}async syncState(){const t=await this.storage.getAllMetadata(),n=await this.drive.getSyncState();if(!n){const i=this.buildSyncState(t);await this.drive.saveSyncState(i);return}if(n.preferences){const i=this.settings.getSettings();JSON.stringify(i)!==JSON.stringify(n.preferences)&&this.settings.updateSettings(n.preferences)}let s=!1;const r=n.books||{};for(const i of t){this.getFingerprint(i);let a=Object.keys(r).find(o=>{const l=r[o];return!!(i.driveId&&l.driveId===i.driveId)});if(a){const o=r[a],l=new Date(i.lastOpened).getTime(),u=o.lastOpened,c=u>l+1e4,p=l>u+1e4;c?await this.applyRemoteUpdate(i,o):p?(r[a]=this.mapBookToSyncEntry(i),s=!0):(o.progress||0)>(i.bookmarkProgress||0)?await this.applyRemoteUpdate(i,o):(i.bookmarkProgress||0)>(o.progress||0)&&(r[a]=this.mapBookToSyncEntry(i),s=!0)}else r[i.id]=this.mapBookToSyncEntry(i),s=!0}s&&(n.timestamp=Date.now(),n.books=r,await this.drive.saveSyncState(n))}async syncBooks(){const t=await this.drive.listBooks(),n=await this.storage.getAllMetadata(),s=new Map,r=new Map;n.forEach(i=>{i.driveId&&s.set(i.driveId,i),r.set(this.getFingerprint(i),i)});for(const i of t){if(s.has(i.id))continue;const a=this.parseFilename(i.name),o=`${a.title}|${a.author}`,l=r.get(o);if(l){console.log(`[Sync] Linking existing book "${l.title}" to Drive ID: ${i.id}`),l.driveId=i.id,await this.storage.saveBook(l);continue}try{console.log(`[Sync] Downloading new book: ${i.name}`);const u=await this.drive.downloadFile(i.id);let c;const p=i.name.toLowerCase().endsWith(".txt")||i.mimeType==="text/plain";if(p){const f=new TextDecoder().decode(u);c=await this.ingestion.ingestFromText(a.title,a.author,f)}else{const m=new Blob([u],{type:"application/epub+zip"}),f=new File([m],i.name,{type:"application/epub+zip"});c=await this.ingestion.ingest(f)}c.driveId=i.id,c.sourceType=p?"text":"epub",await this.storage.saveBook(c),this.listeners.forEach(m=>{var f;return(f=m.onNewBook)==null?void 0:f.call(m,c)})}catch(u){console.error(`[Sync] Download failed for ${i.name}`,u)}}for(const i of n)if(!i.driveId)try{const a=await this.storage.getSource(i.id);if(a){console.log(`[Sync] Uploading: ${i.title}`);let o,l;i.sourceType==="text"?(o=new Blob([a],{type:"text/plain"}),l=`${this.sanitizeFilename(i.title)} - ${this.sanitizeFilename(i.author)}.txt`):(o=new Blob([a],{type:"application/epub+zip"}),l=`${this.sanitizeFilename(i.title)}.epub`);const u=await this.drive.uploadFile(l,o);i.driveId=u,await this.storage.saveBook(i)}}catch(a){console.error(`[Sync] Upload failed for ${i.title}`,a)}}async applyRemoteUpdate(t,n){(t.bookmarkProgress!==n.progress||t.isFinished!==n.isFinished)&&(t.bookmarkProgress=n.progress,t.lastTokenIndex=n.lastTokenIndex,t.isFinished=n.isFinished,t.lastOpened=new Date(n.lastOpened),await this.storage.saveBook(t),this.listeners.forEach(s=>{var r;return(r=s.onNewBook)==null?void 0:r.call(s,t)}))}buildSyncState(t){const n={version:1,timestamp:Date.now(),books:{},preferences:this.settings.getSettings()};return t.forEach(s=>{n.books[s.id]=this.mapBookToSyncEntry(s)}),n}mapBookToSyncEntry(t){return{progress:t.bookmarkProgress,lastTokenIndex:t.lastTokenIndex,isFinished:t.isFinished,lastOpened:new Date(t.lastOpened).getTime(),driveId:t.driveId}}getFingerprint(t){return`${t.title.trim().toLowerCase()}|${t.author.trim().toLowerCase()}`}parseFilename(t){const n=t.replace(/\.(txt|epub)$/i,""),s=n.split(" - ");return s.length>=2?{title:s[0].trim(),author:s.slice(1).join(" - ").trim()}:{title:n.trim(),author:"Unknown Author"}}sanitizeFilename(t){return t.replace(/[^a-z0-9 \-_]/gi,"").trim()}resolveConflict(t,n){t.bookmarkProgress=n,this.storage.saveBook(t),this.listeners.forEach(s=>{var r;return(r=s.onNewBook)==null?void 0:r.call(s,t)})}}const nd=({onClose:e})=>{const[t,n]=j.useState("optical"),s=Xt(),{settings:r}=ze(),[i,a]=j.useState(!1),o=async()=>{a(!0);try{await ge.getInstance().connect()}catch{alert("Could not connect to Google Drive.")}finally{a(!1)}},l=oe.getInstance().isAuthenticated;return I.jsxs("div",{className:"flex flex-col h-full transition-colors duration-300",style:{backgroundColor:s.background},children:[I.jsxs("div",{className:"flex items-center justify-between px-6 py-5 border-b",style:{borderColor:s.borderColor},children:[I.jsx("div",{children:I.jsx("h2",{className:"text-xl font-bold lowercase tracking-tight",style:{color:s.primaryText},children:"settings"})}),I.jsx("button",{onClick:e,className:"w-11 h-11 rounded-full flex items-center justify-center transition-all active:scale-95",style:{backgroundColor:`${s.primaryText}08`},children:I.jsx(Hh,{size:20,style:{color:s.primaryText}})})]}),(!r.isSyncEnabled||!l)&&I.jsx("div",{className:"px-6 pt-5",children:I.jsxs("button",{onClick:o,disabled:i,className:"w-full p-4 rounded-2xl flex items-center justify-between active:scale-[0.98] transition-all",style:{backgroundColor:s.surface,border:`1px solid ${s.borderColor}`},children:[I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx("div",{className:"p-2 rounded-xl bg-blue-500 text-white",children:I.jsx(Br,{size:16})}),I.jsxs("div",{className:"text-left",children:[I.jsx("h3",{className:"text-sm font-semibold lowercase",style:{color:s.primaryText},children:r.isSyncEnabled?"reconnect cloud":"enable cloud sync"}),I.jsx("p",{className:"text-[10px] opacity-40",style:{color:s.secondaryText},children:r.isSyncEnabled?"session expired":"sync via google drive"})]})]}),I.jsx("span",{className:"text-xs font-semibold text-blue-500",children:i?"...":"connect"})]})}),r.isSyncEnabled&&l&&I.jsx("div",{className:"px-6 pt-5",children:I.jsxs("div",{className:"w-full p-4 rounded-2xl flex items-center gap-3 border",style:{backgroundColor:s.surface,borderColor:s.borderColor},children:[I.jsx("div",{className:"p-2 rounded-xl bg-emerald-500 text-white",children:I.jsx(Br,{size:16})}),I.jsxs("div",{className:"flex-1 min-w-0",children:[I.jsx("h3",{className:"text-sm font-semibold lowercase",style:{color:s.primaryText},children:"synced"}),I.jsx("p",{className:"text-[10px] opacity-40 truncate",style:{color:s.secondaryText},children:r.googleDriveEmail||"connected"})]}),I.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"})]})}),I.jsx("div",{className:"px-6 pt-5 z-10",children:I.jsxs("div",{className:"flex p-0.5 rounded-xl border",style:{borderColor:s.borderColor},children:[I.jsxs("button",{onClick:()=>n("optical"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg text-xs font-medium transition-all lowercase",style:{backgroundColor:t==="optical"?s.surface:"transparent",color:t==="optical"?s.primaryText:s.secondaryText,opacity:t==="optical"?1:.5},children:[I.jsx(Ph,{size:14})," theme"]}),I.jsxs("button",{onClick:()=>n("typo"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg text-xs font-medium transition-all lowercase",style:{backgroundColor:t==="typo"?s.surface:"transparent",color:t==="typo"?s.primaryText:s.secondaryText,opacity:t==="typo"?1:.5},children:[I.jsx(Ae,{size:14})," typography"]})]})}),I.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar px-6 pb-10 pt-5",children:[I.jsx("div",{className:`transition-opacity duration-200 ${t==="optical"?"block":"hidden"}`,children:I.jsx(Xh,{})}),I.jsx("div",{className:`transition-opacity duration-200 ${t==="typo"?"block":"hidden"}`,children:I.jsx(Jh,{})})]})]})},sd=({book:e,onClick:t})=>{const n=j.useMemo(()=>{var u;let i=((u=e.chapters)==null?void 0:u.reduce((c,p)=>c+p.wordCount,0))||e.title.length*500;const a=36,o=64,l=Math.min(1,Math.max(0,i/1e5));return a+l*(o-a)},[e]),s=j.useMemo(()=>{const i=e.author.split(" ");return i.length>0?i[i.length-1]:e.author},[e.author]),r=e.tintColorHex||"#333";return I.jsxs(Uu.div,{layoutId:`spine-${e.id}`,onClick:t,className:"relative h-72 cursor-pointer group mx-[1px] mb-0 rounded-sm overflow-hidden transform-gpu",style:{width:`${n}px`,backgroundColor:r,boxShadow:"inset 0 0 15px rgba(0,0,0,0.3), inset 1px 0 0 rgba(255,255,255,0.1)"},whileHover:{y:-8,zIndex:10,transition:{type:"spring",stiffness:400,damping:25}},children:[I.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none mix-blend-multiply grayscale",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}}),I.jsx("div",{className:"absolute top-0 bottom-0 left-[2px] w-[1px] bg-black/20"}),I.jsx("div",{className:"absolute top-0 bottom-0 right-[2px] w-[1px] bg-black/20"}),I.jsxs("div",{className:"absolute inset-0 flex flex-col items-center py-6 px-1 z-20",children:[I.jsx("div",{className:"flex-none pt-2 pb-6",style:{writingMode:"vertical-rl",textOrientation:"mixed"},children:I.jsx("span",{className:"font-sans text-[9px] font-bold text-white/70 uppercase tracking-[0.15em]",children:s})}),I.jsx("div",{className:"flex-1 flex items-center justify-center w-full overflow-hidden",style:{writingMode:"vertical-rl",textOrientation:"mixed"},children:I.jsx("span",{className:"font-serif font-semibold text-xs md:text-sm tracking-wide text-white/95 text-center leading-relaxed line-clamp-3",style:{textShadow:"0 1px 2px rgba(0,0,0,0.5)",fontVariant:"small-caps"},children:e.title.toLowerCase()})}),I.jsx("div",{className:"flex-none mt-auto pt-4 opacity-50",children:I.jsx("div",{className:"w-4 h-4 border border-white/60 rounded-full flex items-center justify-center",children:I.jsx("div",{className:"w-1.5 h-1.5 bg-white/60 rounded-sm"})})})]}),I.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/20 via-transparent to-black/20 pointer-events-none"})]})},Zd=({books:e,onInspectBook:t})=>I.jsx("div",{className:"relative w-full pb-32",children:I.jsxs("div",{className:"flex flex-wrap items-end gap-y-16 px-6 perspective-[1000px]",children:[e.map(n=>I.jsx(sd,{book:n,onClick:()=>t(n)},n.id)),I.jsx("div",{className:"w-full h-2 rounded-full bg-current opacity-[0.03] mt-[-4px] blur-[1px]"})]})});function Kn(){return Kn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Kn.apply(null,arguments)}function Ur(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zn(e,t){return Zn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Zn(e,t)}function rd(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Zn(e,t)}var $r=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function id(e,t){return!!(e===t||$r(e)&&$r(t))}function od(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!id(e[n],t[n]))return!1;return!0}function jn(e,t){t===void 0&&(t=od);var n,s=[],r,i=!1;function a(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];return i&&n===this&&t(o,s)||(r=e.apply(this,o),i=!0,n=this,s=o),r}return a}var ad=typeof performance=="object"&&typeof performance.now=="function",Wr=ad?function(){return performance.now()}:function(){return Date.now()};function Hr(e){cancelAnimationFrame(e.id)}function ld(e,t){var n=Wr();function s(){Wr()-n>=t?e.call(null):r.id=requestAnimationFrame(s)}var r={id:requestAnimationFrame(s)};return r}var Mn=-1;function Gr(e){if(e===void 0&&(e=!1),Mn===-1||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",document.body.appendChild(t),Mn=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return Mn}var ce=null;function qr(e){if(e===void 0&&(e=!1),ce===null||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var s=document.createElement("div"),r=s.style;return r.width="100px",r.height="100px",t.appendChild(s),document.body.appendChild(t),t.scrollLeft>0?ce="positive-descending":(t.scrollLeft=1,t.scrollLeft===0?ce="negative":ce="positive-ascending"),document.body.removeChild(t),ce}return ce}var cd=150,ud=function(t,n){return t};function hd(e){var t,n=e.getItemOffset,s=e.getEstimatedTotalSize,r=e.getItemSize,i=e.getOffsetForIndexAndAlignment,a=e.getStartIndexForOffset,o=e.getStopIndexForStartIndex,l=e.initInstanceProps,u=e.shouldResetStyleCacheOnItemSizeChange,c=e.validateProps;return t=(function(p){rd(m,p);function m(x){var h;return h=p.call(this,x)||this,h._instanceProps=l(h.props,Ur(h)),h._outerRef=void 0,h._resetIsScrollingTimeoutId=null,h.state={instance:Ur(h),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof h.props.initialScrollOffset=="number"?h.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},h._callOnItemsRendered=void 0,h._callOnItemsRendered=jn(function(v,g,b,k){return h.props.onItemsRendered({overscanStartIndex:v,overscanStopIndex:g,visibleStartIndex:b,visibleStopIndex:k})}),h._callOnScroll=void 0,h._callOnScroll=jn(function(v,g,b){return h.props.onScroll({scrollDirection:v,scrollOffset:g,scrollUpdateWasRequested:b})}),h._getItemStyle=void 0,h._getItemStyle=function(v){var g=h.props,b=g.direction,k=g.itemSize,P=g.layout,T=h._getItemStyleCache(u&&k,u&&P,u&&b),M;if(T.hasOwnProperty(v))M=T[v];else{var A=n(h.props,v,h._instanceProps),D=r(h.props,v,h._instanceProps),F=b==="horizontal"||P==="horizontal",W=b==="rtl",Z=F?A:0;T[v]=M={position:"absolute",left:W?void 0:Z,right:W?Z:void 0,top:F?0:A,height:F?"100%":D,width:F?D:"100%"}}return M},h._getItemStyleCache=void 0,h._getItemStyleCache=jn(function(v,g,b){return{}}),h._onScrollHorizontal=function(v){var g=v.currentTarget,b=g.clientWidth,k=g.scrollLeft,P=g.scrollWidth;h.setState(function(T){if(T.scrollOffset===k)return null;var M=h.props.direction,A=k;if(M==="rtl")switch(qr()){case"negative":A=-k;break;case"positive-descending":A=P-b-k;break}return A=Math.max(0,Math.min(A,P-b)),{isScrolling:!0,scrollDirection:T.scrollOffset<A?"forward":"backward",scrollOffset:A,scrollUpdateWasRequested:!1}},h._resetIsScrollingDebounced)},h._onScrollVertical=function(v){var g=v.currentTarget,b=g.clientHeight,k=g.scrollHeight,P=g.scrollTop;h.setState(function(T){if(T.scrollOffset===P)return null;var M=Math.max(0,Math.min(P,k-b));return{isScrolling:!0,scrollDirection:T.scrollOffset<M?"forward":"backward",scrollOffset:M,scrollUpdateWasRequested:!1}},h._resetIsScrollingDebounced)},h._outerRefSetter=function(v){var g=h.props.outerRef;h._outerRef=v,typeof g=="function"?g(v):g!=null&&typeof g=="object"&&g.hasOwnProperty("current")&&(g.current=v)},h._resetIsScrollingDebounced=function(){h._resetIsScrollingTimeoutId!==null&&Hr(h._resetIsScrollingTimeoutId),h._resetIsScrollingTimeoutId=ld(h._resetIsScrolling,cd)},h._resetIsScrolling=function(){h._resetIsScrollingTimeoutId=null,h.setState({isScrolling:!1},function(){h._getItemStyleCache(-1,null)})},h}m.getDerivedStateFromProps=function(h,v){return dd(h,v),c(h),null};var f=m.prototype;return f.scrollTo=function(h){h=Math.max(0,h),this.setState(function(v){return v.scrollOffset===h?null:{scrollDirection:v.scrollOffset<h?"forward":"backward",scrollOffset:h,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},f.scrollToItem=function(h,v){v===void 0&&(v="auto");var g=this.props,b=g.itemCount,k=g.layout,P=this.state.scrollOffset;h=Math.max(0,Math.min(h,b-1));var T=0;if(this._outerRef){var M=this._outerRef;k==="vertical"?T=M.scrollWidth>M.clientWidth?Gr():0:T=M.scrollHeight>M.clientHeight?Gr():0}this.scrollTo(i(this.props,h,v,P,this._instanceProps,T))},f.componentDidMount=function(){var h=this.props,v=h.direction,g=h.initialScrollOffset,b=h.layout;if(typeof g=="number"&&this._outerRef!=null){var k=this._outerRef;v==="horizontal"||b==="horizontal"?k.scrollLeft=g:k.scrollTop=g}this._callPropsCallbacks()},f.componentDidUpdate=function(){var h=this.props,v=h.direction,g=h.layout,b=this.state,k=b.scrollOffset,P=b.scrollUpdateWasRequested;if(P&&this._outerRef!=null){var T=this._outerRef;if(v==="horizontal"||g==="horizontal")if(v==="rtl")switch(qr()){case"negative":T.scrollLeft=-k;break;case"positive-ascending":T.scrollLeft=k;break;default:var M=T.clientWidth,A=T.scrollWidth;T.scrollLeft=A-M-k;break}else T.scrollLeft=k;else T.scrollTop=k}this._callPropsCallbacks()},f.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&Hr(this._resetIsScrollingTimeoutId)},f.render=function(){var h=this.props,v=h.children,g=h.className,b=h.direction,k=h.height,P=h.innerRef,T=h.innerElementType,M=h.innerTagName,A=h.itemCount,D=h.itemData,F=h.itemKey,W=F===void 0?ud:F,Z=h.layout,E=h.outerElementType,z=h.outerTagName,y=h.style,B=h.useIsScrolling,tt=h.width,U=this.state.isScrolling,ot=b==="horizontal"||Z==="horizontal",G=ot?this._onScrollHorizontal:this._onScrollVertical,at=this._getRangeToRender(),w=at[0],C=at[1],K=[];if(A>0)for(var V=w;V<=C;V++)K.push(j.createElement(v,{data:D,key:W(V,D),index:V,isScrolling:B?U:void 0,style:this._getItemStyle(V)}));var $=s(this.props,this._instanceProps);return j.createElement(E||z||"div",{className:g,onScroll:G,ref:this._outerRefSetter,style:Kn({position:"relative",height:k,width:tt,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:b},y)},j.createElement(T||M||"div",{children:K,ref:P,style:{height:ot?"100%":$,pointerEvents:U?"none":void 0,width:ot?$:"100%"}}))},f._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var h=this.props.itemCount;if(h>0){var v=this._getRangeToRender(),g=v[0],b=v[1],k=v[2],P=v[3];this._callOnItemsRendered(g,b,k,P)}}if(typeof this.props.onScroll=="function"){var T=this.state,M=T.scrollDirection,A=T.scrollOffset,D=T.scrollUpdateWasRequested;this._callOnScroll(M,A,D)}},f._getRangeToRender=function(){var h=this.props,v=h.itemCount,g=h.overscanCount,b=this.state,k=b.isScrolling,P=b.scrollDirection,T=b.scrollOffset;if(v===0)return[0,0,0,0];var M=a(this.props,T,this._instanceProps),A=o(this.props,M,T,this._instanceProps),D=!k||P==="backward"?Math.max(1,g):1,F=!k||P==="forward"?Math.max(1,g):1;return[Math.max(0,M-D),Math.max(0,Math.min(v-1,A+F)),M,A]},m})(j.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var dd=function(t,n){t.children,t.direction,t.height,t.layout,t.innerTagName,t.outerTagName,t.width,n.instance},fd=hd({getItemOffset:function(t,n){var s=t.itemSize;return n*s},getItemSize:function(t,n){var s=t.itemSize;return s},getEstimatedTotalSize:function(t){var n=t.itemCount,s=t.itemSize;return s*n},getOffsetForIndexAndAlignment:function(t,n,s,r,i,a){var o=t.direction,l=t.height,u=t.itemCount,c=t.itemSize,p=t.layout,m=t.width,f=o==="horizontal"||p==="horizontal",x=f?m:l,h=Math.max(0,u*c-x),v=Math.min(h,n*c),g=Math.max(0,n*c-x+c+a);switch(s==="smart"&&(r>=g-x&&r<=v+x?s="auto":s="center"),s){case"start":return v;case"end":return g;case"center":{var b=Math.round(g+(v-g)/2);return b<Math.ceil(x/2)?0:b>h+Math.floor(x/2)?h:b}case"auto":default:return r>=g&&r<=v?r:r<g?g:v}},getStartIndexForOffset:function(t,n){var s=t.itemCount,r=t.itemSize;return Math.max(0,Math.min(s-1,Math.floor(n/r)))},getStopIndexForStartIndex:function(t,n,s){var r=t.direction,i=t.height,a=t.itemCount,o=t.itemSize,l=t.layout,u=t.width,c=r==="horizontal"||l==="horizontal",p=n*o,m=c?u:i,f=Math.ceil((m+s-p)/o);return Math.max(0,Math.min(a-1,n+f-1))},initInstanceProps:function(t){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(t){t.itemSize}});class Et{constructor(){this.tokens=[],this.currentIndex=0,this.wpm=150,this.rampStep=3,this._isPlaying=!1,this.animationFrameId=null,this.lastFrameTime=0,this.accumulatedTime=0,this.listeners=new Set,this.completionListeners=new Set,this.notifyScheduled=!1,this.loop=t=>{if(!this._isPlaying)return;if(this.lastFrameTime===0){this.lastFrameTime=t,this.animationFrameId=requestAnimationFrame(this.loop);return}const n=(t-this.lastFrameTime)/1e3;this.lastFrameTime=t;const s=Math.min(n,.1);this.accumulatedTime+=s;const r=this.currentToken;if(!r){this.finish();return}const i=60/this.wpm;let a=1;this.rampStep===0?a=2:this.rampStep===1?a=1.5:this.rampStep===2&&(a=1.2);const o=i*r.durationMultiplier*a;this.accumulatedTime>=o&&(this.advance(),this.accumulatedTime-=o),this._isPlaying&&(this.animationFrameId=requestAnimationFrame(this.loop))}}static getInstance(){return Et.instance||(Et.instance=new Et),Et.instance}get currentToken(){return this.currentIndex>=0&&this.currentIndex<this.tokens.length?this.tokens[this.currentIndex]:null}get isPlaying(){return this._isPlaying}setTokens(t){this.tokens=t,this.currentIndex>=t.length&&(this.currentIndex=0),this.notify()}clear(){this.pause(),this.tokens=[],this.currentIndex=0,this.notify()}play(){this._isPlaying||this.tokens.length!==0&&(this.currentIndex>=this.tokens.length-1&&(this.currentIndex=0),this._isPlaying=!0,this.lastFrameTime=0,this.accumulatedTime=0,this.currentIndex===0&&(this.rampStep=0),this.loop(performance.now()),this.notify())}pause(){this._isPlaying&&(this._isPlaying=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.notify())}stop(){this.pause(),this.accumulatedTime=0,this.rampStep=3,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.notify()}toggle(){this._isPlaying?this.pause():this.play()}seek(t){const n=this._isPlaying;n&&this.pause(),this.currentIndex=Math.max(0,Math.min(t,this.tokens.length-1)),this.accumulatedTime=0,this.notify(),n&&this.play()}updateWPM(t){this.wpm=Math.max(50,Math.min(2e3,t)),this.notify()}advance(){this.currentIndex<this.tokens.length-1?(this.currentIndex++,this.rampStep<3&&this.rampStep++,this.notify()):this.finish()}finish(){this.pause(),this.currentIndex=this.tokens.length-1,this.notify(),this.completionListeners.forEach(t=>t())}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}onComplete(t){return this.completionListeners.add(t),()=>this.completionListeners.delete(t)}notify(){this._isPlaying&&!this.notifyScheduled?(this.notifyScheduled=!0,queueMicrotask(()=>{this.notifyScheduled=!1,this.listeners.forEach(t=>t())})):this._isPlaying||this.listeners.forEach(t=>t())}}const pd=`
    let match;
    const regex = /([^\\s]+)(\\s*)/g;
    const punctuationRegex = /^(.+?)([.,;:!?"')\\]}\\u201C\\u201D\\u2018\\u2019\\u00BB\\u203A\\u2026\\u2014\\u2013-]+)?$/;
    const sentenceEndRegex = /[.?!\\u2026]/;
    const quoteChars = new Set(['"', '\\u201C', '\\u201D', '\\u2018', '\\u2019', "'", '\\u00AB', '\\u00BB']);
    
    function calculateORP(len) {
        if (len <= 1) return 0;
        if (len >= 2 && len <= 5) return 1;
        if (len >= 6 && len <= 10) return 2;
        return 3;
    }
    
    function processChunk() {
        let count = 0;
        
        while (count < CHUNK_SIZE) {
            match = regex.exec(text);
            if (!match) break;
            
            const fullChunk = match[1];
            const trailingSpace = match[2];
            const matchIndex = match.index;
            
            const separationMatch = fullChunk.match(punctuationRegex);
            let wordContent = fullChunk;
            let punctuationStr = "";
            
            if (separationMatch) {
                wordContent = separationMatch[1];
                punctuationStr = separationMatch[2] || "";
            }
            
            const len = wordContent.length;
            const orpIndex = (len <= 10) ? calculateORP(len) : 3;
            const leftSegment = wordContent.slice(0, orpIndex);
            const centerCharacter = wordContent[orpIndex] || "";
            const rightSegment = wordContent.slice(orpIndex + 1);
            
            // Update quote depth for dialogue tracking
            let isDialogue = quoteDepth > 0;
            for (let c of fullChunk) {
                if (c === '"' || c === '\\u201C' || c === '\\u00AB') quoteDepth++;
                else if (c === '"' || c === '\\u201D' || c === '\\u00BB') quoteDepth = Math.max(0, quoteDepth - 1);
            }
            
            // Calculate grammar-aware duration
            const duration = calcDuration(
                wordContent, 
                punctuationStr, 
                prevPunctuation,
                sentencePosition,
                isDialogue
            );
            
            // Track sentence position
            const isSentenceEnd = sentenceEndRegex.test(punctuationStr);
            if (isSentenceEnd) {
                sentencePosition = 0;
            } else {
                sentencePosition++;
            }
            prevPunctuation = punctuationStr;
            
            const isParagraphEnd = trailingSpace.indexOf('\\n') !== -1;
            
            // Add paragraph pause (scaled by WPM-aware pauseScale)
            let finalDuration = duration;
            if (isParagraphEnd) finalDuration += 2.4 * pauseScale;
            
            tokens.push({
                id: 't-' + currentTokenIndex,
                originalText: fullChunk,
                leftSegment,
                centerCharacter,
                rightSegment,
                punctuation: punctuationStr || undefined,
                durationMultiplier: finalDuration,
                isSentenceEnd,
                isParagraphEnd,
                globalIndex: currentTokenIndex,
                startOffset: matchIndex
            });

            // Insert a short explicit silent 'breath' after sentence-ending punctuation
            if (isSentenceEnd) {
                tokens.push({
                    id: 't-' + (currentTokenIndex + 1),
                    originalText: '',
                    leftSegment: '',
                    centerCharacter: '',
                    rightSegment: '',
                    punctuation: undefined,
                    durationMultiplier: 1.2 * pauseScale,
                    isSentenceEnd: false,
                    isParagraphEnd: false,
                    globalIndex: currentTokenIndex + 1,
                    startOffset: matchIndex + fullChunk.length
                });
                currentTokenIndex++;
            }
            
            currentTokenIndex++;
            count++;
        }
        
        if (!match) {
            self.postMessage(tokens);
        } else {
            setTimeout(processChunk, 0);
        }
    }
    
    processChunk();
};
`,md=pd,ne=class ne{static initWorker(){if(!this.worker)try{const t=new Blob([md],{type:"application/javascript"});this.workerUrl=URL.createObjectURL(t),this.worker=new Worker(this.workerUrl),this.worker.onmessage=n=>{const s=n.data;this.isProcessing=!1,this.pendingResolve&&(this.pendingResolve(s),this.pendingResolve=null,this.pendingReject=null)},this.worker.onerror=n=>{console.error("RSVP Worker Error",n),this.isProcessing=!1,this.pendingReject&&(this.pendingReject(n),this.pendingResolve=null,this.pendingReject=null),this.terminate()}}catch(t){console.error("Failed to initialize RSVP Worker",t)}}static async process(t,n=0,s=200){return this.isProcessing&&this.pendingReject&&(this.pendingReject(new Error("Cancelled by new process request")),this.pendingResolve=null,this.pendingReject=null,this.terminate()),this.worker||this.initWorker(),new Promise((r,i)=>{this.pendingResolve=r,this.pendingReject=i,this.isProcessing=!0,this.worker?this.worker.postMessage({text:t,startingIndex:n,wpm:s}):i(new Error("Worker failed to initialize"))})}static terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.workerUrl&&(URL.revokeObjectURL(this.workerUrl),this.workerUrl=null),this.isProcessing=!1}};ne.worker=null,ne.workerUrl=null,ne.pendingResolve=null,ne.pendingReject=null,ne.isProcessing=!1;let Yn=ne;var At=(e=>(e.IDLE="IDLE",e.PLAYING="PLAYING",e.PAUSED="PAUSED",e.FINISHED="FINISHED",e))(At||{});class It{constructor(){this.state="IDLE",this.listeners=new Set,this.lastSavedIndex=-1,this.lastContentRef=null,this.preparationPromise=null,this.wakeLock=null,this.notifyScheduled=!1,this.heartbeat=Et.getInstance(),this.core=Nt.getInstance(),this.heartbeat.subscribe(()=>this.handleHeartbeatUpdate()),this.heartbeat.onComplete(()=>{this.state="FINISHED",this.releaseWakeLock(),this.notify()});const t=Mt.getInstance(),n=t.getSettings().rsvpSpeed;this.updateWPM(n),t.subscribe(()=>{const s=t.getSettings().rsvpSpeed;this.heartbeat.wpm!==s&&this.updateWPM(s)}),document.addEventListener("visibilitychange",async()=>{this.wakeLock!==null&&document.visibilityState==="visible"&&this.state==="PLAYING"&&await this.requestWakeLock()})}static getInstance(){return It.instance||(It.instance=new It),It.instance}async prepare(t,n={}){if(this.lastContentRef===t&&this.heartbeat.tokens.length>0){this.applyConfig(n);return}if(this.preparationPromise)try{if(await this.preparationPromise,this.lastContentRef===t){this.applyConfig(n);return}}catch{}this.preparationPromise=(async()=>{try{const s=await Yn.process(t,0,this.heartbeat.wpm);this.heartbeat.setTokens(s),this.lastContentRef=t}finally{this.preparationPromise=null}})(),await this.preparationPromise,this.applyConfig(n)}applyConfig(t){const n=this.heartbeat.tokens;let s=0;if(t.index!==void 0)s=Math.max(0,Math.min(t.index,n.length-1));else if(t.offset!==void 0){const r=t.offset,i=n.findIndex(a=>a.startOffset>=r);i!==-1?s=i:s=Math.max(0,n.length-1)}else{const r=t.progress??0;s=Math.max(0,Math.min(Math.floor(n.length*r),n.length-1))}this.heartbeat.seek(s),this.state="PAUSED",this.lastSavedIndex=s,this.notify()}togglePlay(){this.state==="PLAYING"?this.pause():this.play()}play(){this.state==="FINISHED"&&(this.heartbeat.seek(0),this.state="PAUSED",jt.impactMedium()),this.heartbeat.tokens.length!==0&&(this.state="PLAYING",this.heartbeat.play(),this.requestWakeLock(),this.notify())}pause(t=!1){if(this.state="PAUSED",this.heartbeat.pause(),this.releaseWakeLock(),!t){const n=this.heartbeat.currentIndex,r=Math.max(0,n-1);r!==n&&this.heartbeat.seek(r)}this.syncProgressToCore(!0),this.notify()}seekRelative(t){const n=this.heartbeat.currentIndex,s=n+t;s!==n&&(this.state==="PLAYING"&&this.pause(!0),this.heartbeat.seek(s),this.syncProgressToCore(!0))}shutdown(t=!0){t&&this.syncProgressToCore(!0),this.heartbeat.stop(),this.state="IDLE",this.releaseWakeLock(),this.lastContentRef=null,this.heartbeat.clear(),this.notify()}updateWPM(t){this.heartbeat.updateWPM(t)}async requestWakeLock(){if("wakeLock"in navigator)try{this.wakeLock=await navigator.wakeLock.request("screen")}catch(t){console.warn("Wake Lock request failed:",t)}}releaseWakeLock(){this.wakeLock&&this.wakeLock.release().then(()=>{this.wakeLock=null}).catch(t=>console.error(t))}handleHeartbeatUpdate(){!this.heartbeat.isPlaying&&this.state==="PLAYING"&&(this.state="PAUSED",this.releaseWakeLock());const t=this.heartbeat.currentIndex;Math.abs(t-this.lastSavedIndex)>=100&&(this.syncProgressToCore(),this.lastSavedIndex=t),this.notify()}syncProgressToCore(t=!1){if(this.heartbeat.tokens.length===0)return;const s=this.heartbeat.currentToken,r=this.heartbeat.currentIndex;s?this.core.syncFromRSVP(s.startOffset,r):r>0&&this.core.saveProgress(r)}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.notifyScheduled||(this.notifyScheduled=!0,queueMicrotask(()=>{this.notifyScheduled=!1,this.listeners.forEach(t=>t())}))}}class gd{constructor(){this._content="",this.attributes={},this.layoutManagers=[]}get string(){return this._content}set string(t){this._content=t}addLayoutManager(t){this.layoutManagers.push(t)}}class yd{constructor(t){this.widthTracksTextView=!1,this.heightTracksTextView=!1,this.lineFragmentPadding=5,this.size=t}}class Kr{constructor(t){this.textContainers=[],this.id=t}addTextContainer(t){this.textContainers.push(t)}enumerateTextSegments(t,n,s){s({x:0,y:0,width:0,height:0})}}class Nt{constructor(){this.listeners=new Set,this.jumpListeners=new Set,this.offsetJumpListeners=new Set,this.progressListeners=new Set,this.isLoading=!1,this.loadingProgress=0,this.currentBook=null,this.currentProgress=0,this.isRSVPMode=!1,this.globalCharacterOffset=0,this.userSelectionOffset=null,this.totalTokens=1,this.chapterTokenOffsets=[],this._loadTimestamp=0,this._lastSavedTokenIndex=-1,this._userIntentionalRewind=!1,this.contentStorage=new gd,this.primaryLayout=new Kr("primary"),this.ghostLayout=new Kr("ghost"),this.configurePipeline(),Mt.getInstance().subscribe(()=>this.updateTypography())}static getInstance(){return Nt.instance||(Nt.instance=new Nt),Nt.instance}configurePipeline(){this.contentStorage.addLayoutManager(this.primaryLayout),this.contentStorage.addLayoutManager(this.ghostLayout)}async load(t){var s;this._loadTimestamp=Date.now(),this._lastSavedTokenIndex=-1,this._userIntentionalRewind=!1,this.isLoading=!0,this.loadingProgress=.1,this.notify();const n={...t};if(((s=this.currentBook)==null?void 0:s.id)===t.id&&this.contentStorage.string.length>0){n.lastTokenIndex!==void 0&&(this.currentBook.lastTokenIndex=n.lastTokenIndex,this.totalTokens>0&&(this.currentProgress=Math.min(1,n.lastTokenIndex/this.totalTokens))),this.currentBook.bookmarkProgress=n.bookmarkProgress||this.currentProgress,this.isLoading=!1,this.loadingProgress=1,this.notify();return}this.unload(),this.notify(),await new Promise(r=>setTimeout(r,50));try{const r=n.chapters?[...n.chapters]:[];r.sort((l,u)=>l.sortOrder-u.sortOrder),this.chapterTokenOffsets=[];let i=0;const a=[],o=r.length;for(let l=0;l<o;l++){l%3===0&&(this.loadingProgress=.1+.8*(l/o),this.notify(),await new Promise(m=>setTimeout(m,0)));const c=(r[l].content||"").replace(/<(?:.|\n)*?>/gm," ").replace(/&nbsp;/g," ").replace(/\s+/g," ").trim(),p=Te(c);this.chapterTokenOffsets.push(i),i+=p,a.push(c)}this.totalTokens=Math.max(1,i),this.contentStorage.string=a.join(`

`),this.currentBook=n,n.lastTokenIndex!==void 0?(this.currentBook.lastTokenIndex=n.lastTokenIndex,this.currentProgress=Math.min(1,n.lastTokenIndex/this.totalTokens)):(this.currentProgress=n.bookmarkProgress||0,this.currentProgress>0&&(this.currentBook.lastTokenIndex=Math.floor(this.currentProgress*this.totalTokens))),this.currentBook.bookmarkProgress=this.currentProgress,this.updateTypography(),It.getInstance().prepare(this.contentStorage.string).catch(()=>{})}catch(r){console.error("[TitanCore] Critical Error loading book:",r)}finally{this.isLoading=!1,this.loadingProgress=1,this.notify()}}unload(){this.currentBook=null,this.contentStorage.string="",this.userSelectionOffset=null,this.isRSVPMode=!1,this.totalTokens=1,this.chapterTokenOffsets=[]}updateTypography(){const t=Mt.getInstance().getSettings();let n='"New York Extra Large", "Times New Roman", serif';t.fontFamily==="SF Pro"&&(n='"SF Pro Rounded", -apple-system, sans-serif'),t.fontFamily==="OpenDyslexic"&&(n='"OpenDyslexic", "Comic Sans MS", sans-serif'),t.fontFamily==="Atkinson Hyperlegible"&&(n='"Atkinson Hyperlegible", sans-serif');const s=t.fontSize<18?"500":t.fontSize>32?"300":"400";this.contentStorage.attributes={fontFamily:n,fontSize:`${t.fontSize}px`,lineHeight:`${t.lineHeight}`,paragraphSpacing:`${t.paragraphSpacing}px`,letterSpacing:"0.2px",fontWeight:s,color:"inherit"},this.notify()}updateLayout(t){this.primaryLayout.textContainers=[];const n=new yd(t);n.widthTracksTextView=!0,this.primaryLayout.addTextContainer(n),this.notify()}saveProgress(t,n=!1){if(!this.currentBook||typeof t!="number"||t<0||t===this._lastSavedTokenIndex&&!n)return;n&&t===0&&(this._userIntentionalRewind=!0);const s=Date.now()-this._loadTimestamp,r=this.currentBook.lastTokenIndex||0;if(t===0&&r>50&&s<3e3&&!this._userIntentionalRewind)return;this._lastSavedTokenIndex=t,this.currentBook.lastTokenIndex=t;let i=0;this.totalTokens>0&&(i=t/this.totalTokens),(isNaN(i)||!isFinite(i))&&(i=0),this.currentProgress=Math.min(1,Math.max(0,i)),this.currentBook.bookmarkProgress=this.currentProgress,this.currentBook.lastOpened=new Date,this.currentProgress>=.99&&(this.currentBook.isFinished=!0),this.progressListeners.forEach(a=>a(this.currentProgress)),this.notify()}restorePosition(t,n){return 0}jump(t){if(this.currentProgress=Math.max(0,Math.min(1,t)),this.currentBook&&this.totalTokens>0){const n=Math.floor(t*this.totalTokens);this.currentBook.lastTokenIndex=n,this.currentBook.bookmarkProgress=this.currentProgress,this.jumpListeners.forEach(s=>s(t)),this.progressListeners.forEach(s=>s(t))}this.notify()}jumpToChapter(t){if(t<0||t>=this.chapterTokenOffsets.length)return;const n=this.chapterTokenOffsets[t];t===0&&(this._userIntentionalRewind=!0),this.currentBook.lastTokenIndex=n,this.totalTokens>0&&(this.currentProgress=n/this.totalTokens,this.currentBook.bookmarkProgress=this.currentProgress),this.jumpListeners.forEach(s=>s(this.currentProgress)),this.progressListeners.forEach(s=>s(this.currentProgress)),this.notify()}syncFromRSVP(t,n){this.globalCharacterOffset=t,this.saveProgress(n),this.offsetJumpListeners.forEach(s=>s(t))}selectText(t){this.userSelectionOffset=t,this.notify()}onJump(t){return this.jumpListeners.add(t),()=>this.jumpListeners.delete(t)}onOffsetJump(t){return this.offsetJumpListeners.add(t),()=>this.offsetJumpListeners.delete(t)}onProgress(t){return this.progressListeners.add(t),()=>this.progressListeners.delete(t)}rectForRange(t){return null}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t())}}const vd=j.memo(({token:e,isActive:t,theme:n})=>I.jsx("span",{id:`w-${e.globalIndex}`,"data-idx":e.globalIndex,"data-off":e.startOffset,className:`inline py-0.5 rounded-[2px] cursor-pointer select-none transition-colors duration-200 ${t?"":"hover:opacity-60"}`,style:{backgroundColor:t?n.accent:"transparent",color:t?"#FFFFFF":"inherit",boxDecorationBreak:"clone",WebkitBoxDecorationBreak:"clone"},children:e.originalText})),wo=j.memo(({text:e,settings:t,startTokenIndex:n,onParagraphClick:s})=>I.jsx("p",{id:`p-${n}`,"data-start-index":n,onClick:()=>s(n),className:"max-w-[60ch] mx-auto box-border relative cursor-pointer hover:opacity-100 transition-opacity scroll-mt-32",style:{fontSize:`${t.fontSize}px`,lineHeight:t.lineHeight,marginBottom:t.paragraphSpacing,fontFamily:t.fontFamily==="New York"?"serif":"sans-serif",color:"inherit",opacity:.9,whiteSpace:"pre-line",textAlign:"justify",hyphens:"auto",WebkitHyphens:"auto"},children:e})),ko=j.memo(({tokens:e,activeIndex:t,onWordClick:n,settings:s,theme:r,startTokenIndex:i})=>{const a=j.useCallback(o=>{const l=o.target;if(l.dataset.idx){o.stopPropagation();const u=parseInt(l.dataset.idx||"-1"),c=parseInt(l.dataset.off||"0");u>=0&&n(u,c)}},[n]);return I.jsx("p",{id:`p-${i}`,"data-start-index":i,onClick:a,className:"max-w-[60ch] mx-auto box-border relative scroll-mt-32",style:{fontSize:`${s.fontSize}px`,lineHeight:s.lineHeight,marginBottom:s.paragraphSpacing,fontFamily:s.fontFamily==="New York"?"serif":"sans-serif",opacity:.9,whiteSpace:"pre-line",textAlign:"justify",hyphens:"auto",WebkitHyphens:"auto"},children:e.map((o,l)=>I.jsxs(Ao.Fragment,{children:[I.jsx(vd,{token:o,isActive:o.globalIndex===t,theme:r})," "]},o.id))})});j.memo(({sectionIndex:e,paragraphs:t,activeParagraphIndex:n,activeIndex:s,onWordClick:r,onParagraphClick:i,settings:a,theme:o})=>I.jsx("div",{children:t.map((l,u)=>{const c=e*30+u;return Math.abs(c-n)<=1?I.jsx(ko,{startTokenIndex:l.startIndex,tokens:l.tokens,activeIndex:s,onWordClick:r,settings:a,theme:o},c):I.jsx(wo,{text:l.plainText,settings:a,startTokenIndex:l.startIndex,onParagraphClick:i},c)})}));const xd=({book:e,onToggleChrome:t,onRequestRSVP:n,isActive:s})=>{j.useEffect(()=>{console.log("[TitanReaderView] Book open effect triggered for",e.title,"at",new Date().toISOString());const et=performance.now();return()=>{const it=performance.now();console.log(`[TitanReaderView] Book open effect cleanup for ${e.title} after ${(it-et).toFixed(2)}ms`)}},[e.id]);const r=Nt.getInstance(),i=It.getInstance(),a=Et.getInstance(),o=Xt(),{settings:l}=ze(),u=j.useRef(null),[c,p]=j.useState([]),[m,f]=j.useState(-1),x=j.useRef(-1),[h,v]=j.useState(!1),[g,b]=j.useState(0),[k,P]=j.useState(!1),[T,M]=j.useState(0),[A,D]=j.useState("book"),[F,W]=j.useState(""),[Z,E]=j.useState(!1),[z,y]=j.useState(!1);j.useEffect(()=>{if(!h){const et=setInterval(()=>{W(it=>it.length<3?it+".":"")},400);return()=>clearInterval(et)}},[h]);const[B,tt]=j.useState(!1),U=j.useRef(!1),ot=j.useRef(null);j.useRef(null);const G=j.useCallback(et=>{f(et),x.current=et},[]),at=j.useRef(null),w=j.useRef(null),C=j.useRef(!1),K=j.useCallback((et,it)=>{at.current={index:et,smooth:it},w.current&&clearTimeout(w.current),w.current=window.setTimeout(()=>{C.current||(C.current=!0,requestAnimationFrame(()=>{const d=at.current;if(at.current=null,!d||!u.current){C.current=!1;return}let{index:O,smooth:N}=d,S=document.getElementById(`w-${O}`);if(!S){const X=Array.from(u.current.querySelectorAll("p[data-start-index]"));let rt=null,J=-1;for(const ct of X){const mt=parseInt(ct.dataset.startIndex||"-1");mt<=O&&mt>J&&(rt=ct,J=mt)}S=rt}if(!S){if(r.totalTokens>0){const X=O/r.totalTokens,J=u.current.scrollHeight*X;u.current.scrollTo({top:J,behavior:N?"smooth":"instant"})}C.current=!1;return}U.current=!0;const _=u.current,R=_.clientHeight*.15;let H=S.offsetTop,q=S.offsetParent;for(;q&&q!==_;)H+=q.offsetTop,q=q.offsetParent;const L=H-R;_.scrollTo({top:Math.max(0,L),behavior:N?"smooth":"instant"}),setTimeout(()=>{U.current=!1},N?600:100),C.current=!1}))},16)},[]);j.useEffect(()=>{var N;"scrollRestoration"in history&&(history.scrollRestoration="manual"),v(!1),tt(!1),U.current=!0;const it=(((N=r.currentBook)==null?void 0:N.id)===e.id?r.currentBook.lastTokenIndex:void 0)??e.lastTokenIndex;it!==void 0&&G(it);const d=r.subscribe(()=>{b(r.loadingProgress)});return(async()=>{var S;if(v(!1),tt(!1),b(0),P(!1),M(0),D("book"),p([]),!e.chapters||e.chapters.length===0){console.error("[TitanReaderView] Book has no chapters! This indicates a data loading issue.",{bookId:e.id,title:e.title,hasChapters:!!e.chapters,chaptersLength:(S=e.chapters)==null?void 0:S.length}),v(!0),tt(!0);return}try{D("book"),await r.load(e),b(1),D("tokenize"),P(!0);const _=r.contentStorage.string;_||console.warn("[TitanReaderView] Loaded book has no content string.");let R=0;M(.01);const H=setInterval(()=>{R+=.07+Math.random()*.08,M(q=>Math.min(.98,Math.max(q,R)))},120);await i.prepare(_,{progress:0}),clearInterval(H),M(1),P(!1)}catch(_){console.error("[TitanReaderView] Initialization pipeline failed:",_)}finally{const _=a.tokens;p(_),v(!0),requestAnimationFrame(()=>{tt(!0)})}})(),()=>d()},[e.id,G]),j.useEffect(()=>{const et=()=>{var _;const N=(_=r.currentBook)==null?void 0:_.lastTokenIndex;if(N===void 0)return;const S=Math.abs(N-x.current);if(S>0&&(G(N),S>10)){const R=r.isRSVPMode;K(N,R)}},it=N=>{if(r.totalTokens>0){const S=Math.floor(N*r.totalTokens);G(S),K(S,r.isRSVPMode)}},d=r.subscribe(et),O=r.onJump(it);return()=>{d(),O()}},[G,K]),j.useEffect(()=>{const et=It.getInstance(),it=Et.getInstance();let d=et.state;const O=()=>{const S=et.state;if(d==="PLAYING"&&S==="PAUSED"){const _=it.currentIndex;G(_),K(_,!0)}d=S},N=et.subscribe(O);return()=>N()},[G,K]),j.useLayoutEffect(()=>{if(!h||c.length===0)return;requestAnimationFrame(()=>{var d;const it=(((d=r.currentBook)==null?void 0:d.id)===e.id?r.currentBook.lastTokenIndex:e.lastTokenIndex)??-1;it<=10?(u.current&&(u.current.scrollTop=0),setTimeout(()=>{tt(!0),U.current=!1},100)):(K(it,!1),setTimeout(()=>tt(!0),100))})},[h,c.length,e.id,K]);const V=j.useRef(null),$=j.useRef(-1),lt=j.useCallback(et=>{$.current=et,V.current&&clearTimeout(V.current),V.current=window.setTimeout(()=>{$.current>=0&&r.saveProgress($.current),V.current=null},500)},[]);j.useEffect(()=>()=>{V.current&&($.current>=0&&r.saveProgress($.current),clearTimeout(V.current))},[]),j.useEffect(()=>{var O;if(!B||!s){ot.current&&ot.current.disconnect();return}ot.current&&ot.current.disconnect();const et=N=>{if(!U.current){for(const S of N)if(S.isIntersecting){const _=S.target,R=parseInt(_.dataset.startIndex||"-1");if(R>=0){G(R),lt(R);break}}}},it={root:u.current,rootMargin:"-10% 0px -60% 0px",threshold:0};ot.current=new IntersectionObserver(et,it);const d=(O=u.current)==null?void 0:O.querySelectorAll("p[data-start-index]");return d==null||d.forEach(N=>{var S;return(S=ot.current)==null?void 0:S.observe(N)}),()=>{var N;return(N=ot.current)==null?void 0:N.disconnect()}},[B,c.length,G]);const ut=j.useMemo(()=>{const et=performance.now(),it=[];let d=[],O=-1;for(const S of c)d.length===0&&(O=S.globalIndex),d.push(S),S.isParagraphEnd&&(it.push({tokens:d,startIndex:O,plainText:d.map(_=>_.originalText).join(" ")}),d=[]);d.length>0&&it.push({tokens:d,startIndex:O===-1?0:O,plainText:d.map(S=>S.originalText).join(" ")});const N=performance.now();return console.log(`[TitanReaderView] Token-to-paragraph mapping took ${(N-et).toFixed(2)}ms for ${c.length} tokens, ${it.length} paragraphs.`),it},[c]),Q=j.useCallback((et,it)=>{G(et),r.saveProgress(et),n&&n(it,et)},[n,G]),nt=j.useCallback(et=>{G(et),r.saveProgress(et)},[G]),Y=j.useMemo(()=>ut.findIndex(et=>m>=et.startIndex&&m<et.startIndex+et.tokens.length),[ut,m]),st=j.useCallback(({index:et,style:it})=>{const d=ut[et];if(!d)return null;const O=Math.abs(et-Y)<=1;return I.jsx("div",{style:it,children:O?I.jsx(ko,{startTokenIndex:d.startIndex,tokens:d.tokens,activeIndex:m,onWordClick:Q,settings:l,theme:o}):I.jsx(wo,{text:d.plainText,settings:l,startTokenIndex:d.startIndex,onParagraphClick:nt})},d.startIndex)},[ut,Y,m,Q,nt,l,o]);return I.jsxs("div",{ref:u,className:"absolute inset-0 z-10 w-full h-full overflow-y-auto overflow-x-hidden custom-scrollbar box-border",style:{backgroundColor:o.background,color:o.primaryText,scrollBehavior:"auto",WebkitOverflowScrolling:"touch",touchAction:"pan-y",overscrollBehaviorY:"contain",transform:"translateZ(0)"},onClick:et=>{et.target===et.currentTarget&&t()},children:[!h&&I.jsxs(I.Fragment,{children:[I.jsx("div",{style:{position:"fixed",top:0,left:0,zIndex:9999,color:"red",background:"white",fontSize:"12px",padding:"2px"},children:"[TitanReaderView] Waiting for isReady..."}),I.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100] pointer-events-auto",style:{backgroundColor:o.background},children:I.jsxs("div",{className:"w-12 h-12 relative",children:[I.jsx("div",{className:"absolute inset-0 rounded-full border-2 opacity-20",style:{borderColor:o.accent}}),I.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-t-transparent animate-spin",style:{borderColor:o.accent,borderTopColor:"transparent"}})]})})]}),h&&c.length===0&&I.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[50] pointer-events-none",style:{backgroundColor:o.background},children:I.jsxs("div",{className:"flex flex-col items-center gap-4 px-8 text-center",children:[I.jsx("div",{className:"text-4xl opacity-30",children:""}),I.jsx("span",{className:"text-lg font-medium",style:{color:o.secondaryText},children:"No content available"}),I.jsx("span",{className:"text-sm opacity-60",style:{color:o.secondaryText},children:"This book appears to be empty or failed to load."})]})}),I.jsxs("div",{className:"w-full min-h-[100dvh] px-6 md:px-0 py-24 md:py-32 box-border relative",children:[I.jsx(fd,{height:window.innerHeight*.7,itemCount:ut.length,itemSize:120,width:"100%",overscanCount:4,children:st}),I.jsx("div",{className:"h-[40vh]"})]})]})},bd=({onTap:e,onLongPressExit:t,onRewindStateChange:n})=>{const s=It.getInstance(),r=Et.getInstance(),i=Xt(),{settings:a}=ze(),o=j.useRef(null),l=j.useRef(null),[u,c]=j.useState(0),[p,m]=j.useState([]),[f,x]=j.useState(!1),[h,v]=j.useState(0),[g,b]=j.useState(!1),k=j.useRef(-1),P=j.useRef([]),T=j.useRef({x:0,y:0,time:0}),M=j.useRef(null),A=j.useRef(null),D=j.useRef(0),F=j.useRef(new Map),W=300,Z="#E25822",E=35.5,z="clamp(2.5rem, 10vw, 4rem)";j.useEffect(()=>{m(r.tokens),P.current=r.tokens,k.current=r.currentIndex,c(r.currentIndex),x(s.state===At.PLAYING);const Q=()=>{const st=r.currentIndex,et=s.state===At.PLAYING,it=r.tokens;x(et);const d=it!==P.current,O=st!==k.current;d&&(m(it),P.current=it),O&&(k.current=st,c(st))},nt=s.subscribe(Q),Y=r.subscribe(Q);return Q(),()=>{nt(),Y()}},[]);const y=j.useMemo(()=>p[u]||null,[p,u]),B=!f||a.showGhostPreview,tt=5,U=j.useMemo(()=>{if(p.length===0)return[];if(!B)return y?[{token:y,globalIdx:u}]:[];const Q=Math.max(0,u-tt),nt=Math.min(p.length-1,u+tt);return p.slice(Q,nt+1).map((Y,st)=>({token:Y,globalIdx:Q+st}))},[p,u,B,tt,y]);j.useLayoutEffect(()=>{var it;if(!l.current)return;const Q=l.current,nt=Array.from(Q.children),st=(((it=o.current)==null?void 0:it.clientWidth)||window.innerWidth)*(E/100);F.current.clear(),nt.forEach(d=>{const O=parseInt(d.dataset.idx||"0"),N=d.getBoundingClientRect(),S=Q.getBoundingClientRect(),_=N.left-S.left;let R=_+N.width/2;if(O===u&&y)try{d.removeChild(measureSpan),measureSpan.textContent=text.substring(0,focusCharIdx),d.appendChild(measureSpan);const H=measureSpan.getBoundingClientRect().width;d.removeChild(measureSpan);const q=Math.max(0,uptoInclusive-H),L=H+q/2;R=_+L}catch{R=_+N.width/2}F.current.set(O,{left:_,width:N.width,center:R})});const et=F.current.get(u);if(et){const d=st-et.center;try{document.documentElement.style.setProperty("--rsvp-center-delta",`${d.toFixed(2)}px`)}catch{}v(d)}},[U,u,y]),j.useEffect(()=>()=>{M.current&&clearTimeout(M.current),A.current&&clearInterval(A.current)},[]);const ot=Q=>{var nt,Y;if(Q.stopPropagation(),(Y=(nt=Q.target).setPointerCapture)==null||Y.call(nt,Q.pointerId),!f){t==null||t();return}T.current={x:Q.clientX,y:Q.clientY,time:Date.now()},M.current=setTimeout(()=>{b(!0),jt.impactLight(),D.current=u,s.pause(),A.current=setInterval(()=>{D.current=Math.max(0,D.current-1),c(D.current),jt.selectionChanged()},300)},W)},G=Q=>{if(g){const nt=Math.abs(Q.clientX-T.current.x),Y=Math.abs(Q.clientY-T.current.y);(nt>50||Y>50)&&C()}},at=Q=>{var nt,Y;(Y=(nt=Q.target).releasePointerCapture)==null||Y.call(nt,Q.pointerId),M.current&&(clearTimeout(M.current),M.current=null,f&&(s.state===At.PLAYING?s.pause(!0):s.play())),C()},w=Q=>{var nt,Y;(Y=(nt=Q.target).releasePointerCapture)==null||Y.call(nt,Q.pointerId),M.current&&(clearTimeout(M.current),M.current=null),C()},C=()=>{g&&(A.current&&(clearInterval(A.current),A.current=null),b(!1),r.pause(),r.currentIndex=Math.max(0,Math.min(D.current,r.tokens.length-1)),typeof r.subscribe=="function"&&r.seek(r.currentIndex),s.play(),jt.impactMedium())};if(j.useEffect(()=>{!g&&u!==r.currentIndex&&c(r.currentIndex)},[g]),j.useEffect(()=>{n==null||n(g)},[g,n]),!y)return null;const V=(Q=>Math.floor(Q.length/2))(y.originalText),$=y.originalText.slice(0,V),lt=y.originalText[V]||"",ut=y.originalText.slice(V+1);return I.jsxs("div",{ref:o,className:"absolute inset-0 select-none overflow-hidden touch-none",style:{backgroundColor:i.background},onPointerDown:ot,onPointerMove:G,onPointerUp:at,onPointerCancel:w,onPointerLeave:w,children:[!f&&I.jsx("div",{className:"absolute inset-0 z-0 flex items-center justify-center pointer-events-auto",style:{opacity:.18,fontSize:"2.5rem",color:i.primaryText,userSelect:"none"},children:I.jsx("span",{children:p.slice(Math.max(0,u-20),u+20).map(Q=>Q.originalText).join(" ")})}),I.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundColor:i.background,opacity:.95}}),I.jsx("div",{className:"absolute inset-0 z-10 pointer-events-none",style:{background:`radial-gradient(ellipse 80% 50% at ${E}% 42%, transparent 0%, ${i.background} 100%)`}}),I.jsx("div",{className:"absolute top-[20%] bottom-[20%] w-[2px] z-0 pointer-events-none transition-all duration-200",style:{left:`${E}%`,backgroundColor:Z,opacity:g?.6:.15,boxShadow:g?`0 0 30px ${Z}80`:"none"}}),I.jsxs("div",{className:"absolute inset-x-0 top-[42%] -translate-y-1/2 flex items-center justify-start overflow-visible z-20",children:[B&&I.jsxs(I.Fragment,{children:[I.jsx("div",{className:"absolute left-0 top-[-50%] bottom-[-50%] w-32 z-30 pointer-events-none",style:{background:`linear-gradient(to right, ${i.background}, transparent)`}}),I.jsx("div",{className:"absolute right-0 top-[-50%] bottom-[-50%] w-32 z-30 pointer-events-none",style:{background:`linear-gradient(to left, ${i.background}, transparent)`}})]}),I.jsx("div",{ref:l,className:"flex items-baseline gap-5 whitespace-nowrap",style:{transform:`translateX(${h}px)`,transition:g?"transform 0.05s linear":"none",opacity:g?.85:1},children:U.map(({token:Q,globalIdx:nt})=>{const Y=nt===u,st=Math.abs(nt-u),et=Math.max(.12,.55-st*.1);return Y?I.jsxs("span",{"data-idx":nt,className:"inline-flex items-baseline font-sans font-semibold cursor-pointer transition-opacity hover:opacity-100",style:{fontSize:z},children:[I.jsx("span",{style:{color:i.primaryText},children:$}),I.jsx("span",{style:{color:Z,textShadow:g?`0 0 10px ${Z}60`:`0 0 20px ${Z}40`},children:lt}),I.jsx("span",{style:{color:i.primaryText},children:ut}),Q.punctuation&&I.jsx("span",{style:{color:i.secondaryText,opacity:.5,marginLeft:"1px"},children:Q.punctuation})]},Q.id):I.jsx("span",{"data-idx":nt,className:"font-sans cursor-pointer transition-opacity hover:opacity-100",style:{fontSize:z,fontWeight:400,color:i.primaryText,opacity:et},children:Q.originalText},Q.id)})})]})]})},wd=({book:e,currentProgress:t,preciseThresholds:n,onSelectChapter:s,onSelect:r,onClose:i,readSpeed:a})=>{const o=Xt(),l=j.useRef(null),u=j.useMemo(()=>!e.chapters||e.chapters.length===0?[]:e.chapters.map((f,x)=>{const h=n[x]??0;let v=f.title.trim();const g=v.match(/^(?:chapter|part|book|letter|section)\s+(?:[\divxlcdm]+)\s*[:.-]\s+(.+)$/i),b=v.match(/^\d+\.\s+(.+)$/i);g&&g[1]?v=g[1]:b&&b[1]&&(v=b[1]);const k=Math.ceil(f.wordCount/a);return{original:f,index:x,cleanTitle:v,startProgress:h,durationLabel:k<1?"< 1m":`${k}m`}}),[e,a,n]),c=j.useMemo(()=>{let f=0;for(let x=0;x<u.length&&t>=u[x].startProgress-1e-4;x++)f=x;return f},[u,t]);j.useEffect(()=>{if(l.current){const x=Math.max(0,c*64-100);l.current.scrollTo({top:x,behavior:"smooth"})}},[]);const p=f=>{jt.impactMedium(),s?s(f):r&&r(u[f].startProgress),i()},m=j.useRef(Date.now());return I.jsxs("div",{className:"absolute bottom-full mb-4 left-2 right-2 z-50 flex flex-col max-h-[60vh] rounded-3xl overflow-hidden shadow-2xl border backdrop-blur-3xl origin-bottom animate-slideUp",style:{backgroundColor:`${o.dimmer}f5`,borderColor:o.borderColor},children:[I.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b shrink-0",style:{borderColor:o.borderColor},children:[I.jsxs("div",{children:[I.jsx("h3",{className:"text-base font-bold lowercase",style:{color:o.primaryText},children:"chapters"}),I.jsxs("span",{className:"text-[10px] opacity-40",style:{color:o.secondaryText},children:[u.length," ",u.length!==1?"sections":"section"]})]}),I.jsx("button",{onClick:i,className:"w-11 h-11 rounded-full flex items-center justify-center transition-all active:scale-95",style:{backgroundColor:`${o.primaryText}08`,color:o.primaryText},children:I.jsx(ah,{size:20})})]}),I.jsx("div",{ref:l,className:"overflow-y-auto custom-scrollbar px-2 pb-4 pt-1",children:u.map((f,x)=>{const h=x===c;return I.jsxs("button",{onClick:()=>p(f.index),className:`w-full text-left flex items-center gap-3 p-3 rounded-2xl transition-all duration-200 group ${h?"shadow-md":"hover:bg-white/5 opacity-50"}`,style:{backgroundColor:h?o.surface:"transparent"},children:[I.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 transition-all ${h?"bg-white/5":"bg-transparent"}`,style:{color:h?o.accent:o.secondaryText},children:h?I.jsxs("div",{className:"relative",children:[I.jsx("div",{className:"absolute inset-0 bg-current opacity-30 animate-ping rounded-full"}),I.jsx("div",{className:"w-2.5 h-2.5 bg-current rounded-full"})]}):I.jsx("span",{className:"text-xs font-semibold opacity-40 tabular-nums",children:x+1})}),I.jsxs("div",{className:"flex-1 min-w-0",children:[I.jsx("h4",{className:"text-sm font-semibold truncate lowercase",style:{color:o.primaryText},children:f.cleanTitle}),f.cleanTitle!==f.original.title&&I.jsx("span",{className:"text-[10px] opacity-30 truncate block",style:{color:o.primaryText},children:f.original.title})]}),I.jsx("div",{className:"flex items-center gap-1 opacity-40 shrink-0",style:{color:o.primaryText},children:I.jsx("span",{className:"text-[11px] font-medium tabular-nums",children:f.durationLabel})})]},f.original.id)})})]},m.current)},kd=({book:e,onToggleRSVP:t,isRSVPActive:n,isRewinding:s=!1,onSettingsClick:r})=>{const i=Nt.getInstance(),a=It.getInstance(),o=Et.getInstance(),{settings:l,updateSettings:u}=ze(),c=Xt(),[p,m]=j.useState(!1),[f,x]=j.useState(!1),[h,v]=j.useState(0),[g,b]=j.useState(0),[k,P]=j.useState(!1),T=j.useRef(!1),M=j.useRef(null),A=j.useRef(null),D=j.useRef(null),F=j.useRef(!1),W=j.useRef(null),Z=j.useRef(0),E=j.useRef(0),z=j.useRef(!1),y=j.useRef(0),B=j.useRef(0),tt=c.accent,U=j.useMemo(()=>{if(i.chapterTokenOffsets.length>0&&i.totalTokens>0)return i.chapterTokenOffsets.map(et=>et/i.totalTokens);if(!e.chapters||e.chapters.length===0)return[];const Y=e.chapters.reduce((et,it)=>et+it.wordCount,0);if(Y===0)return e.chapters.map((et,it)=>it/e.chapters.length);let st=0;return e.chapters.map(et=>{const it=st/Y;return st+=et.wordCount,it})},[e,i.chapterTokenOffsets,i.totalTokens]),ot=j.useCallback(Y=>{const st=Math.max(1,o.tokens.length||i.totalTokens),et=Math.floor(Y*st),it=st-et,d=l.rsvpSpeed||250,O=Math.ceil(it/d);if(O<1)return"< 1m";if(O>=60){const N=Math.floor(O/60),S=O%60;return`${N}h ${S}m`}return`${O}m`},[l.rsvpSpeed,o.tokens.length,i.totalTokens]),G=j.useCallback(Y=>{if(!e.chapters||e.chapters.length===0)return"";let st=0;for(let N=U.length-1;N>=0;N--)if(Y>=U[N]-1e-4){st=N;break}const et=e.chapters[st];if(!et)return"";const it=et.title.trim(),d=it.match(/^(?:chapter|part|book|letter|section)\s+(?:[\divxlcdm]+)\s*[:.-]\s+(.+)$/i),O=it.match(/^\d+\.\s+(.+)$/i);return d&&d[1]?d[1]:O&&O[1]?O[1]:it},[e.chapters,U]),at=j.useRef(0),w=j.useCallback(Y=>{const st=Math.max(0,Math.min(1,Y));if(M.current&&(M.current.style.width=`${st*100}%`),D.current&&(D.current.style.left=`${st*100}%`,D.current.style.transform="translateX(-50%)"),T.current)return;(Math.abs(st-at.current)>.005||st===0||st===1)&&(at.current=st,b(st))},[]);j.useEffect(()=>{const Y=()=>{m(a.state===At.PLAYING)},st=_=>{F.current||w(_)},et=()=>{if(!F.current&&i.isRSVPMode&&o.tokens.length>0){const _=o.currentIndex/o.tokens.length;w(_)}};Y();const it=i.isRSVPMode&&o.tokens.length>0?o.currentIndex/o.tokens.length:i.currentProgress;at.current=it,b(it),w(it);const d=i.subscribe(Y),O=a.subscribe(Y),N=i.onProgress(st),S=o.subscribe(et);return()=>{d(),O(),N(),S()}},[w]);const C=Y=>{if(Y.preventDefault(),Y.stopPropagation(),x(!0),F.current=!0,Z.current=Y.clientY,A.current){const st=A.current.getBoundingClientRect();E.current=Math.max(0,Math.min(1,(Y.clientX-st.left)/st.width))}z.current=a.state===At.PLAYING,z.current&&a.pause(),$(Y.clientX,Y.clientY,!1),Y.target.setPointerCapture(Y.pointerId)},K=Y=>{F.current&&(Y.preventDefault(),W.current&&cancelAnimationFrame(W.current),W.current=requestAnimationFrame(()=>{$(Y.clientX,Y.clientY,!0)}))},V=Y=>{if(F.current){if(W.current&&cancelAnimationFrame(W.current),x(!1),F.current=!1,Y.target.releasePointerCapture(Y.pointerId),A.current){const st=A.current.getBoundingClientRect(),et=Math.max(0,Math.min(1,(Y.clientX-st.left)/st.width));lt(et)}z.current&&a.play()}},$=(Y,st,et)=>{if(!A.current)return;const it=A.current.getBoundingClientRect();let d=(Y-it.left)/it.width;if(et){const N=Math.abs(st-Z.current);let S=1;N>200?S=.1:N>100?S=.3:N>50&&(S=.6),S<1&&(d=E.current+(d-E.current)*S)}const O=Math.max(0,Math.min(1,d));if(v(N=>(U.some(_=>N<_&&O>=_||N>_&&O<=_)&&jt.impactLight(),O)),w(O),i.isRSVPMode){const N=Math.max(1,o.tokens.length);o.seek(Math.floor(O*N))}else i.jump(O)},lt=Y=>{if(i.isRSVPMode){const st=Math.max(1,o.tokens.length);o.seek(Math.floor(Y*st))}else i.jump(Y)},ut=Y=>{Y.stopPropagation();const st=Date.now();st-y.current<300||(y.current=st,navigator.vibrate&&navigator.vibrate(10),t())},Q=Y=>{const st=Date.now();if(st-B.current<80)return;B.current=st,jt.impactLight();const et=l.rsvpSpeed||250,it=Math.max(50,Math.min(2e3,et+Y));u({rsvpSpeed:it,hasCustomSpeed:!0})},nt=Y=>{if(jt.impactMedium(),i.isRSVPMode){if(Y<i.chapterTokenOffsets.length){const st=i.chapterTokenOffsets[Y];o.seek(st),i.jumpToChapter(Y)}}else i.jumpToChapter(Y)};return I.jsxs("div",{className:"w-full relative pointer-events-auto",children:[k&&I.jsx(wd,{book:e,currentProgress:g,readSpeed:l.rsvpSpeed,preciseThresholds:U,onSelectChapter:Y=>nt(Y),onClose:()=>{T.current=!1,P(!1)}}),f&&!k&&I.jsx("div",{className:"absolute -top-12 left-0 right-0 flex justify-center pointer-events-none z-50",style:{animation:"fadeIn 300ms cubic-bezier(0.16, 1, 0.3, 1)"},children:I.jsxs("div",{className:"px-4 py-1.5 rounded-full shadow-xl border backdrop-blur-md text-xs font-bold font-variant-numeric tabular-nums flex items-center gap-2",style:{backgroundColor:c.surface,borderColor:c.borderColor,color:c.primaryText},children:[I.jsxs("span",{children:[(h*100).toFixed(0),"%"]}),I.jsx("span",{className:"opacity-30",children:"|"}),I.jsx("span",{className:"lowercase",children:ot(h)})]})}),I.jsxs("div",{className:"w-full backdrop-blur-2xl rounded-3xl shadow-2xl border overflow-hidden",style:{backgroundColor:`${c.surface}f5`,borderColor:c.borderColor},children:[I.jsxs("button",{onClick:()=>{jt.impactLight(),!k&&a.state===At.PLAYING&&a.pause();const Y=!k;T.current=Y,P(Y)},className:"w-full flex justify-between items-center px-5 pt-2.5 pb-0 text-[10px] font-medium select-none hover:opacity-100 transition-opacity active:scale-[0.99]",style:{color:c.primaryText,opacity:k?.8:.4},children:[I.jsxs("div",{className:"flex items-center gap-1.5 truncate max-w-[70%]",children:[I.jsx(kh,{size:10,className:"opacity-60"}),I.jsx("span",{className:"truncate lowercase",children:G(g)})]}),I.jsx("span",{className:"tabular-nums opacity-60 text-[9px]",children:ot(g)})]}),I.jsx("div",{className:"relative h-4 w-full cursor-pointer group touch-none z-20",onPointerDown:C,onPointerMove:K,onPointerUp:V,onPointerCancel:V,children:I.jsxs("div",{ref:A,className:"absolute inset-x-6 inset-y-0 flex items-center",children:[I.jsxs("div",{className:"w-full h-[1.5px] rounded-full overflow-hidden relative",style:{backgroundColor:c.primaryText+"08"},children:[I.jsx("div",{ref:M,className:"absolute top-0 left-0 bottom-0 h-full will-change-transform rounded-full",style:{width:"0%",backgroundColor:tt}}),j.useMemo(()=>U.map((Y,st)=>I.jsx("div",{className:"absolute top-0 bottom-0 w-[1px] bg-white/10",style:{left:`${Y*100}%`}},st)),[U])]}),I.jsx("div",{ref:D,className:`absolute top-1/2 w-3.5 h-3.5 -mt-[7px] rounded-full shadow-lg border-2 border-white transition-all duration-200 will-change-transform ${f?"scale-125":"scale-0 group-hover:scale-75"}`,style:{left:"0%",backgroundColor:c.accent,boxShadow:`0 0 10px ${c.accent}33`}})]})}),I.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center px-5 pb-4 pt-0.5",children:[I.jsxs("div",{className:"flex items-center h-11 rounded-xl overflow-hidden border",style:{borderColor:c.borderColor,backgroundColor:`${c.primaryText}05`},children:[I.jsx("button",{onClick:()=>Q(-25),className:"w-11 h-full flex items-center justify-center hover:bg-white/5 active:scale-90 transition-all outline-none",style:{color:c.secondaryText},children:I.jsx(xo,{size:16})}),I.jsx("div",{className:"w-px h-5",style:{backgroundColor:c.borderColor}}),I.jsx("div",{className:"px-2 text-center flex items-center justify-center min-w-[44px]",children:I.jsx("span",{className:"font-variant-numeric tabular-nums text-xs font-semibold",style:{color:c.primaryText},children:l.rsvpSpeed})}),I.jsx("div",{className:"w-px h-5",style:{backgroundColor:c.borderColor}}),I.jsx("button",{onClick:()=>Q(25),className:"w-11 h-full flex items-center justify-center hover:bg-white/5 active:scale-90 transition-all outline-none",style:{color:c.secondaryText},children:I.jsx(bo,{size:16})})]}),I.jsx("div",{className:"flex items-center justify-center px-4",children:I.jsx("button",{onClick:ut,className:"w-12 h-12 rounded-full flex items-center justify-center shadow-lg relative text-white border border-white/10 hover:scale-105 active:scale-95 transition-all outline-none",style:{backgroundColor:tt,boxShadow:`0 6px 24px -4px ${tt}66`},children:s?I.jsx(Oh,{size:20,className:"fill-white animate-pulse"}):n&&p?I.jsx(Eh,{size:20,className:"fill-white"}):I.jsx(Rh,{size:20,className:"fill-white ml-0.5"})})}),I.jsxs("div",{className:"flex items-center gap-2",children:[n&&I.jsx("button",{className:"flex items-center justify-center w-11 h-11 rounded-xl border transition-all outline-none active:scale-95",style:{borderColor:l.showGhostPreview?c.accent+"40":c.borderColor,backgroundColor:l.showGhostPreview?`${c.accent}15`:`${c.primaryText}05`,color:l.showGhostPreview?c.accent:c.secondaryText},onClick:Y=>{Y.stopPropagation(),jt.impactLight(),u({showGhostPreview:!l.showGhostPreview})},title:l.showGhostPreview?"Hide word preview":"Show word preview",children:I.jsx(zh,{size:16,className:l.showGhostPreview?"fill-current":""})}),I.jsxs("button",{className:"flex items-center justify-center h-11 gap-2 rounded-xl border hover:bg-white/5 active:scale-95 transition-all outline-none px-3",style:{borderColor:c.borderColor,backgroundColor:`${c.primaryText}05`},onClick:Y=>{Y.stopPropagation(),r()},children:[I.jsx(Ae,{size:16,style:{color:c.secondaryText}}),I.jsx("div",{className:"w-px h-4",style:{backgroundColor:c.borderColor}}),I.jsxs("div",{className:"flex items-baseline gap-0.5 opacity-60",children:[I.jsx(Ae,{size:14,style:{color:c.secondaryText}}),I.jsx(Ae,{size:10,style:{color:c.secondaryText}})]})]})]})]})]})]})},Yd=({book:e,onClose:t})=>{const n=Nt.getInstance(),s=It.getInstance(),r=Et.getInstance(),i=Xt(),[a,o]=j.useState(!0),[l,u]=j.useState(!1),[c,p]=j.useState(!1),[m,f]=j.useState(!1),[x,h]=j.useState(0),[v,g]=j.useState(!1),[b,k]=j.useState(!1),P=j.useRef(!1),T=j.useRef(!1);j.useEffect(()=>{u(n.isRSVPMode);const Z=()=>{u(n.isRSVPMode),p(s.state===At.PLAYING),h(n.currentProgress)},E=n.subscribe(Z),z=s.subscribe(Z);return Z(),()=>{E(),z()}},[]),j.useEffect(()=>()=>{s.shutdown(n.isRSVPMode),n.isRSVPMode=!1,r.clear()},[]),j.useEffect(()=>{const Z=()=>{if(!P.current){if(P.current=!0,v||b)M();else if(l){const E=Nt.getInstance(),z=It.getInstance();E.isRSVPMode&&(z.pause(),z.shutdown(!0),E.isRSVPMode=!1,E.notify(),u(!1),o(!0))}P.current=!1}};return window.addEventListener("popstate",Z),()=>window.removeEventListener("popstate",Z)},[v,b,l]),j.useEffect(()=>{let Z;return a&&l&&(Z=setTimeout(()=>o(!1),2500)),()=>clearTimeout(Z)},[a,l]),j.useEffect(()=>{v&&s.state===At.PLAYING&&s.pause()},[v]);const M=()=>{k(!0),setTimeout(()=>{g(!1),k(!1)},400)},A=()=>{var z;let Z=((z=n.currentBook)==null?void 0:z.lastTokenIndex)??(e.lastTokenIndex||0);n.isRSVPMode&&(Z=r.currentIndex,n.saveProgress(Z));const E=n.currentProgress;s.shutdown(n.isRSVPMode),n.isRSVPMode=!1,t(e.id,Z,E)},D=async(Z,E,z)=>{var B;if(T.current)return;if(l&&Z===void 0&&E===void 0&&z===void 0){s.state===At.PLAYING?s.pause(!0):s.play();return}const y=Z??!n.isRSVPMode;if(!(y===n.isRSVPMode&&E===void 0&&z===void 0)){T.current=!0;try{if(y){const tt=n.contentStorage.string,U={offset:E??n.userSelectionOffset??void 0,index:z??(E===void 0?((B=n.currentBook)==null?void 0:B.lastTokenIndex)??void 0:void 0),progress:E===void 0&&z===void 0?n.currentProgress:void 0};await s.prepare(tt,U),n.isRSVPMode=!0,n.notify(),P.current||window.history.pushState({rsvpMode:!0},"",window.location.href),s.play(),o(!1)}else{s.pause();const tt=r.currentIndex;if(n.isRSVPMode=!1,n.saveProgress(tt,!0),n.totalTokens>0){const U=tt/n.totalTokens;n.jump(U)}o(!0)}}catch(tt){console.error("Toggle failed",tt),n.isRSVPMode=!1,n.notify()}finally{T.current=!1}}},F=()=>{s.state===At.PLAYING?s.pause(!0):s.play()},W=()=>{l&&D(!1)};return I.jsxs("div",{className:"fixed inset-0 z-50 w-full h-[100dvh] overflow-hidden m-0 p-0 animate-fadeIn",style:{backgroundColor:i.background},children:[I.jsx("div",{className:"absolute inset-0 z-10 w-full h-full will-change-transform transition-opacity duration-300",style:{opacity:l?c?0:.4:1,pointerEvents:l?"none":"auto"},children:I.jsx(xd,{book:e,onToggleChrome:()=>o(Z=>!Z),onRequestRSVP:(Z,E)=>D(!0,Z,E),isActive:!l})}),I.jsxs("div",{className:`absolute inset-0 z-20 transition-all duration-300 will-change-[transform,opacity] ${l?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{pointerEvents:l?"auto":"none",transitionTimingFunction:"cubic-bezier(0.2, 0, 0, 1)"},children:[I.jsx(bd,{onTap:F,onLongPressExit:W,onRewindStateChange:f}),I.jsx("style",{children:`
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
      `})]}),I.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 w-[90%] max-w-[450px] z-50 pointer-events-auto",style:{bottom:"calc(2rem + env(safe-area-inset-bottom))"},children:I.jsx(kd,{book:e,onToggleRSVP:Z=>D(void 0,Z),isRSVPActive:l,isRewinding:m,onSettingsClick:()=>{P.current||window.history.pushState({modal:"settings"},"",window.location.href),g(!0)}})}),I.jsx("div",{className:`absolute top-0 left-0 right-0 z-[60] transition-transform duration-400 pointer-events-none ${a||l&&!c?"translate-y-0":"-translate-y-full"}`,style:{transitionTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)"},children:I.jsxs("div",{className:"backdrop-blur-2xl border-b pt-safe-top py-4 px-5 flex items-center justify-between pointer-events-auto",style:{backgroundColor:i.dimmer,borderColor:i.borderColor},children:[I.jsx("button",{onClick:l?W:A,className:"w-11 h-11 -ml-1 rounded-full flex items-center justify-center transition-all active:scale-95",style:{backgroundColor:`${i.primaryText}08`,color:i.primaryText},children:I.jsx(ch,{size:20})}),l&&I.jsx("span",{className:"text-xs font-medium",style:{color:i.secondaryText},children:"Tap to exit RSVP"})]})}),(v||b)&&I.jsxs(I.Fragment,{children:[I.jsx("div",{className:"fixed inset-0 z-[100]",style:{backgroundColor:"rgba(0,0,0,0.5)",backdropFilter:"blur(2px)",animation:b?"fadeOut 0.4s ease-out":"fadeIn 0.6s ease-out"},onClick:M}),I.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-[101] rounded-t-[32px] h-[70vh] shadow-2xl overflow-hidden",style:{backgroundColor:i.background,animation:b?"slideDown 0.5s cubic-bezier(0.7, 0, 0.84, 0)":"slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},children:I.jsx(nd,{onClose:M})})]})]})};export{Sd as A,Id as B,Md as C,Fd as D,nd as E,Dd as F,Te as G,Od as H,me as I,$d as J,Kd as K,Bd as L,Br as M,Nt as N,ge as O,Rh as P,Yd as Q,Ao as R,zh as S,qd as T,ie as U,Hh as X,Td as a,ze as b,j as c,Ad as d,Wd as e,Vd as f,Zr as g,Ud as h,jd as i,I as j,jt as k,Pd as l,Uu as m,Cd as n,Hd as o,Ld as p,zd as q,Eo as r,Zd as s,ah as t,Xt as u,Rd as v,Gd as w,Nd as x,bo as y,Ed as z};
