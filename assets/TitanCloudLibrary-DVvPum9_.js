import{r as i,j as e,A as h,m as p}from"./animations-CJNRPifJ.js";import{a as L}from"./cloud-FGMHPRwG.js";import{u as B}from"./index-BC47H-GM.js";import{r as E,X as D,s as $,t as w,u as R,n as _,D as A,v as G,a as I}from"./icons-CvM8Zi5d.js";import"./rsvp-VHkoIypx.js";import"./vendor-react-uhaD0WpH.js";const P=["philosophy","gothic","sci-fi","adventure","poetry","mystery"],K=({existingBooks:v,onClose:N,onImport:C,onOpen:k})=>{const t=B(),c=L.getInstance(),[l,y]=i.useState(""),[m,n]=i.useState([]),[d,f]=i.useState(!1),[g,x]=i.useState({});i.useEffect(()=>{const s=c.getFeaturedBooks();n(s)},[]);const j=async(s,o)=>{s?.preventDefault();const r=o!==void 0?o:l;if(!r.trim()){n(c.getFeaturedBooks());return}f(!0),n([]);try{const a=await c.searchCuratedBooks(r);n(a)}catch(a){console.error(a)}finally{f(!1)}};i.useEffect(()=>{l.trim()===""&&n(c.getFeaturedBooks())},[l]);const T=async s=>{const o=g[s.title]||"idle";if(!(o==="loading"||o==="success")){x(r=>({...r,[s.title]:"loading"}));try{const r=await c.downloadBook(s);C(r),x(a=>({...a,[s.title]:"success"}))}catch(r){console.error(`Failed to download ${s.title}`,r),x(a=>({...a,[s.title]:"error"})),setTimeout(()=>{x(a=>({...a,[s.title]:"idle"}))},3e3)}}},S=(s,o)=>{switch(s){case"loading":return e.jsxs("div",{className:"flex items-center gap-2 relative w-full justify-center h-full",children:[e.jsx("span",{className:"lowercase z-10",children:"retrieving..."}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/10 overflow-hidden",children:e.jsx("div",{className:"h-full bg-current opacity-50 w-full origin-left animate-[progress-scan_1.5s_ease-in-out_infinite]"})})]});case"success":return e.jsxs(e.Fragment,{children:[e.jsx(I,{size:16}),e.jsx("span",{className:"lowercase",children:"added to shelf"})]});case"error":return e.jsxs(e.Fragment,{children:[e.jsx(G,{size:16}),e.jsx("span",{className:"lowercase",children:"failed. retry?"})]});default:return e.jsxs(e.Fragment,{children:[e.jsx(A,{size:16}),e.jsx("span",{className:"lowercase",children:"add to shelf"})]})}},F=(s,o)=>{const r={border:"none",color:"#FFF",backgroundColor:o||t.accent};return s==="loading"?{...r,backgroundColor:t.surface,color:t.primaryText,border:`1px solid ${t.borderColor}`,cursor:"wait"}:s==="success"?{...r,backgroundColor:"#10b981"}:s==="error"?{...r,backgroundColor:"#ef4444"}:r},b=m.length>0&&m[0].isCopyrightedReplacement;return e.jsxs("div",{className:"flex flex-col h-full bg-[#F2F2F7] dark:bg-black transition-colors",style:{backgroundColor:t.background},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-6 border-b",style:{borderColor:t.borderColor},children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{size:24,style:{color:t.accent}}),e.jsx("h2",{className:"text-2xl font-serif font-black lowercase tracking-tight leading-none",style:{color:t.primaryText},children:"visit the library"})]}),e.jsx("p",{className:"text-xs font-medium opacity-60 lowercase max-w-[240px]",style:{color:t.secondaryText},children:"classics from the ether. public domain, free forever."})]}),e.jsx("button",{onClick:N,className:"p-3 -mr-3 rounded-full hover:bg-black/5 transition-colors",children:e.jsx(D,{size:24,style:{color:t.secondaryText}})})]}),e.jsxs("div",{className:"px-6 pt-6 pb-2",children:[e.jsxs("form",{onSubmit:j,className:"relative group",children:[e.jsx("input",{type:"text",placeholder:"search title, author, genre, or keyword...",value:l,onChange:s=>y(s.target.value),className:"w-full h-14 pl-12 pr-4 rounded-2xl text-lg font-medium outline-none transition-all shadow-sm focus:shadow-md",style:{backgroundColor:t.surface,color:t.primaryText,border:`1px solid ${t.borderColor}`}}),e.jsx($,{size:20,className:"absolute left-4 top-1/2 -translate-y-1/2 opacity-40 group-focus-within:opacity-100 transition-opacity",style:{color:t.primaryText}})]}),!l&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3 animate-fadeIn",children:P.map(s=>e.jsx("button",{onClick:()=>{y(s),j(void 0,s)},className:"px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest border transition-all active:scale-95 opacity-50 hover:opacity-100",style:{backgroundColor:t.surface,borderColor:t.borderColor,color:t.primaryText},children:s},s))}),e.jsx(h,{children:d&&e.jsxs(p.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-center justify-center gap-2 py-4 text-sm font-medium",style:{color:t.secondaryText},children:[e.jsx(w,{className:"animate-spin",size:16}),e.jsx("span",{children:"scanning archives..."})]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 pb-20 pt-6 custom-scrollbar",children:[e.jsx(h,{children:d&&e.jsxs(p.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-center justify-center gap-2 py-4 mb-2 text-sm font-medium",style:{color:t.secondaryText},children:[e.jsx(w,{className:"animate-spin",size:16}),e.jsx("span",{children:"scanning archives..."})]})}),e.jsx(h,{children:!d&&b&&e.jsxs(p.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6 p-4 rounded-2xl flex items-start gap-4 border",style:{backgroundColor:t.surface,borderColor:t.borderColor},children:[e.jsx("div",{className:"p-2 rounded-full bg-neutral-100 shrink-0",children:e.jsx(R,{size:16,className:"text-neutral-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm lowercase mb-1",style:{color:t.primaryText},children:"locked in the vault"}),e.jsxs("p",{className:"text-xs font-medium leading-relaxed opacity-70 lowercase",style:{color:t.secondaryText},children:["bad news: that book is still under copyright protection.",e.jsx("br",{}),"good news: we found these public domain classics that share the same soul."]})]})]})}),!d&&!b&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 opacity-50",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest",style:{color:t.secondaryText},children:l?"results":"curated selection"}),e.jsx("div",{className:"h-px flex-1 bg-current opacity-20",style:{color:t.secondaryText}})]}),!d&&m.length===0&&l&&e.jsx("div",{className:"flex flex-col items-center justify-center h-40 text-center opacity-60",children:e.jsx("p",{className:"font-serif italic text-lg lowercase",style:{color:t.secondaryText},children:'"the library is vast, but this shelf is empty."'})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(h,{mode:"popLayout",children:m.map((s,o)=>{const r=v.find(u=>u.title.trim().toLowerCase()===s.title.trim().toLowerCase()&&u.author.trim().toLowerCase()===s.author.trim().toLowerCase()),a=g[s.title]||"idle";return e.jsxs(p.div,{layout:!0,initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2,delay:o*.03},className:"relative p-5 rounded-3xl overflow-hidden shadow-sm hover:shadow-md transition-shadow group border",style:{backgroundColor:t.surface,borderColor:t.borderColor},children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 rounded-full blur-[60px] opacity-[0.15] transition-opacity group-hover:opacity-[0.25]",style:{backgroundColor:s.moodColor||t.accent}}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-serif font-bold text-xl leading-tight mb-1",style:{color:t.primaryText},children:s.title}),e.jsx("p",{className:"text-sm font-medium opacity-60 uppercase tracking-wider mb-2",style:{color:t.primaryText},children:s.author}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.genre&&e.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-tighter",style:{backgroundColor:`${t.accent}20`,color:t.accent,border:`1px solid ${t.accent}30`},children:s.genre}),s.tags?.slice(0,3).map((u,z)=>e.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] font-medium opacity-50 border border-white/10",style:{color:t.primaryText},children:u.toLowerCase()},z))]}),e.jsx("p",{className:"text-sm leading-relaxed opacity-80 line-clamp-2",style:{color:t.secondaryText},children:s.summary})]}),r?e.jsxs("button",{onClick:()=>k(r),className:"mt-5 flex items-center justify-center gap-2 w-full h-11 rounded-xl font-bold text-sm transition-all active:scale-95 shadow-sm hover:shadow-md",style:{backgroundColor:t.accent,color:"#FFF",border:"none"},children:[e.jsx(_,{size:16,fill:"currentColor"}),e.jsx("span",{className:"lowercase",children:"open book"})]}):e.jsx("button",{onClick:()=>T(s),disabled:a==="loading"||a==="success",className:"mt-5 flex items-center justify-center gap-2 w-full h-11 rounded-xl font-bold text-sm transition-all active:scale-95 disabled:opacity-90 disabled:scale-100 shadow-sm hover:shadow-md overflow-hidden relative",style:F(a,s.moodColor),children:S(a,s.moodColor)})]})]},s.title)})})})]})]})};export{K as TitanCloudLibrary};
