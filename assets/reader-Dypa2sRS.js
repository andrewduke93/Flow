var Ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var pn={exports:{}},ke={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Is;function Co(){if(Is)return ke;Is=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(s,r,i){var o=null;if(i!==void 0&&(o=""+i),r.key!==void 0&&(o=""+r.key),"key"in r){i={};for(var a in r)a!=="key"&&(i[a]=r[a])}else i=r;return r=i.ref,{$$typeof:e,type:s,key:o,ref:r!==void 0?r:null,props:i}}return ke.Fragment=t,ke.jsx=n,ke.jsxs=n,ke}var Es;function Po(){return Es||(Es=1,pn.exports=Co()),pn.exports}var I=Po(),mn={exports:{}},ut={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var As;function Io(){if(As)return ut;As=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),m=Symbol.iterator;function f(b){return b===null||typeof b!="object"?null:(b=m&&b[m]||b["@@iterator"],typeof b=="function"?b:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},d=Object.assign,v={};function g(b,C,K){this.props=b,this.context=C,this.refs=v,this.updater=K||x}g.prototype.isReactComponent={},g.prototype.setState=function(b,C){if(typeof b!="object"&&typeof b!="function"&&b!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,b,C,"setState")},g.prototype.forceUpdate=function(b){this.updater.enqueueForceUpdate(this,b,"forceUpdate")};function w(){}w.prototype=g.prototype;function k(b,C,K){this.props=b,this.context=C,this.refs=v,this.updater=K||x}var P=k.prototype=new w;P.constructor=k,d(P,g.prototype),P.isPureReactComponent=!0;var T=Array.isArray;function N(){}var M={H:null,A:null,T:null,S:null},B=Object.prototype.hasOwnProperty;function F(b,C,K){var V=K.ref;return{$$typeof:e,type:b,key:C,ref:V!==void 0?V:null,props:K}}function H(b,C){return F(b.type,C,b.props)}function et(b){return typeof b=="object"&&b!==null&&b.$$typeof===e}function E(b){var C={"=":"=0",":":"=2"};return"$"+b.replace(/[=:]/g,function(K){return C[K]})}var O=/\/+/g;function y(b,C){return typeof b=="object"&&b!==null&&b.key!=null?E(""+b.key):C.toString(36)}function L(b){switch(b.status){case"fulfilled":return b.value;case"rejected":throw b.reason;default:switch(typeof b.status=="string"?b.then(N,N):(b.status="pending",b.then(function(C){b.status==="pending"&&(b.status="fulfilled",b.value=C)},function(C){b.status==="pending"&&(b.status="rejected",b.reason=C)})),b.status){case"fulfilled":return b.value;case"rejected":throw b.reason}}throw b}function Q(b,C,K,V,G){var ot=typeof b;(ot==="undefined"||ot==="boolean")&&(b=null);var J=!1;if(b===null)J=!0;else switch(ot){case"bigint":case"string":case"number":J=!0;break;case"object":switch(b.$$typeof){case e:case t:J=!0;break;case u:return J=b._init,Q(J(b._payload),C,K,V,G)}}if(J)return G=G(b),J=V===""?"."+y(b,0):V,T(G)?(K="",J!=null&&(K=J.replace(O,"$&/")+"/"),Q(G,C,K,"",function(tt){return tt})):G!=null&&(et(G)&&(G=H(G,K+(G.key==null||b&&b.key===G.key?"":(""+G.key).replace(O,"$&/")+"/")+J)),C.push(G)),1;J=0;var st=V===""?".":V+":";if(T(b))for(var U=0;U<b.length;U++)V=b[U],ot=st+y(V,U),J+=Q(V,C,K,ot,G);else if(U=f(b),typeof U=="function")for(b=U.call(b),U=0;!(V=b.next()).done;)V=V.value,ot=st+y(V,U++),J+=Q(V,C,K,ot,G);else if(ot==="object"){if(typeof b.then=="function")return Q(L(b),C,K,V,G);throw C=String(b),Error("Objects are not valid as a React child (found: "+(C==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":C)+"). If you meant to render a collection of children, use an array instead.")}return J}function $(b,C,K){if(b==null)return b;var V=[],G=0;return Q(b,V,"","",function(ot){return C.call(K,ot,G++)}),V}function nt(b){if(b._status===-1){var C=b._result;C=C(),C.then(function(K){(b._status===0||b._status===-1)&&(b._status=1,b._result=K)},function(K){(b._status===0||b._status===-1)&&(b._status=2,b._result=K)}),b._status===-1&&(b._status=0,b._result=C)}if(b._status===1)return b._result.default;throw b._result}var q=typeof reportError=="function"?reportError:function(b){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var C=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof b=="object"&&b!==null&&typeof b.message=="string"?String(b.message):String(b),error:b});if(!window.dispatchEvent(C))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",b);return}console.error(b)},rt={map:$,forEach:function(b,C,K){$(b,function(){C.apply(this,arguments)},K)},count:function(b){var C=0;return $(b,function(){C++}),C},toArray:function(b){return $(b,function(C){return C})||[]},only:function(b){if(!et(b))throw Error("React.Children.only expected to receive a single React element child.");return b}};return ut.Activity=p,ut.Children=rt,ut.Component=g,ut.Fragment=n,ut.Profiler=r,ut.PureComponent=k,ut.StrictMode=s,ut.Suspense=l,ut.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,ut.__COMPILER_RUNTIME={__proto__:null,c:function(b){return M.H.useMemoCache(b)}},ut.cache=function(b){return function(){return b.apply(null,arguments)}},ut.cacheSignal=function(){return null},ut.cloneElement=function(b,C,K){if(b==null)throw Error("The argument must be a React element, but you passed "+b+".");var V=d({},b.props),G=b.key;if(C!=null)for(ot in C.key!==void 0&&(G=""+C.key),C)!B.call(C,ot)||ot==="key"||ot==="__self"||ot==="__source"||ot==="ref"&&C.ref===void 0||(V[ot]=C[ot]);var ot=arguments.length-2;if(ot===1)V.children=K;else if(1<ot){for(var J=Array(ot),st=0;st<ot;st++)J[st]=arguments[st+2];V.children=J}return F(b.type,G,V)},ut.createContext=function(b){return b={$$typeof:o,_currentValue:b,_currentValue2:b,_threadCount:0,Provider:null,Consumer:null},b.Provider=b,b.Consumer={$$typeof:i,_context:b},b},ut.createElement=function(b,C,K){var V,G={},ot=null;if(C!=null)for(V in C.key!==void 0&&(ot=""+C.key),C)B.call(C,V)&&V!=="key"&&V!=="__self"&&V!=="__source"&&(G[V]=C[V]);var J=arguments.length-2;if(J===1)G.children=K;else if(1<J){for(var st=Array(J),U=0;U<J;U++)st[U]=arguments[U+2];G.children=st}if(b&&b.defaultProps)for(V in J=b.defaultProps,J)G[V]===void 0&&(G[V]=J[V]);return F(b,ot,G)},ut.createRef=function(){return{current:null}},ut.forwardRef=function(b){return{$$typeof:a,render:b}},ut.isValidElement=et,ut.lazy=function(b){return{$$typeof:u,_payload:{_status:-1,_result:b},_init:nt}},ut.memo=function(b,C){return{$$typeof:c,type:b,compare:C===void 0?null:C}},ut.startTransition=function(b){var C=M.T,K={};M.T=K;try{var V=b(),G=M.S;G!==null&&G(K,V),typeof V=="object"&&V!==null&&typeof V.then=="function"&&V.then(N,q)}catch(ot){q(ot)}finally{C!==null&&K.types!==null&&(C.types=K.types),M.T=C}},ut.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},ut.use=function(b){return M.H.use(b)},ut.useActionState=function(b,C,K){return M.H.useActionState(b,C,K)},ut.useCallback=function(b,C){return M.H.useCallback(b,C)},ut.useContext=function(b){return M.H.useContext(b)},ut.useDebugValue=function(){},ut.useDeferredValue=function(b,C){return M.H.useDeferredValue(b,C)},ut.useEffect=function(b,C){return M.H.useEffect(b,C)},ut.useEffectEvent=function(b){return M.H.useEffectEvent(b)},ut.useId=function(){return M.H.useId()},ut.useImperativeHandle=function(b,C,K){return M.H.useImperativeHandle(b,C,K)},ut.useInsertionEffect=function(b,C){return M.H.useInsertionEffect(b,C)},ut.useLayoutEffect=function(b,C){return M.H.useLayoutEffect(b,C)},ut.useMemo=function(b,C){return M.H.useMemo(b,C)},ut.useOptimistic=function(b,C){return M.H.useOptimistic(b,C)},ut.useReducer=function(b,C,K){return M.H.useReducer(b,C,K)},ut.useRef=function(b){return M.H.useRef(b)},ut.useState=function(b){return M.H.useState(b)},ut.useSyncExternalStore=function(b,C,K){return M.H.useSyncExternalStore(b,C,K)},ut.useTransition=function(){return M.H.useTransition()},ut.version="19.2.3",ut}var Rs;function Eo(){return Rs||(Rs=1,mn.exports=Io()),mn.exports}var R=Eo();const Ao=Zr(R),Yn=R.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),on=R.createContext({}),an=R.createContext(null),Xn=typeof document<"u",Jn=Xn?R.useLayoutEffect:R.useEffect,Yr=R.createContext({strict:!1}),Qn=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Ro="framerAppearId",Xr="data-"+Qn(Ro),Mo={useManualTiming:!1};class Ms{constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const n=this.order.indexOf(t);n!==-1&&(this.order.splice(n,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function jo(e){let t=new Ms,n=new Ms,s=0,r=!1,i=!1;const o=new WeakSet,a={schedule:(l,c=!1,u=!1)=>{const p=u&&r,m=p?t:n;return c&&o.add(l),m.add(l)&&p&&r&&(s=t.order.length),l},cancel:l=>{n.remove(l),o.delete(l)},process:l=>{if(r){i=!0;return}if(r=!0,[t,n]=[n,t],n.clear(),s=t.order.length,s)for(let c=0;c<s;c++){const u=t.order[c];o.has(u)&&(a.schedule(u),e()),u(l)}r=!1,i&&(i=!1,a.process(l))}};return a}const $e=["read","resolveKeyframes","update","preRender","render","postRender"],No=40;function Jr(e,t){let n=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=$e.reduce((p,m)=>(p[m]=jo(()=>n=!0),p),{}),o=p=>{i[p].process(r)},a=()=>{const p=performance.now();n=!1,r.delta=s?1e3/60:Math.max(Math.min(p-r.timestamp,No),1),r.timestamp=p,r.isProcessing=!0,$e.forEach(o),r.isProcessing=!1,n&&t&&(s=!1,e(a))},l=()=>{n=!0,s=!0,r.isProcessing||e(a)};return{schedule:$e.reduce((p,m)=>{const f=i[m];return p[m]=(x,d=!1,v=!1)=>(n||l(),f.schedule(x,d,v)),p},{}),cancel:p=>$e.forEach(m=>i[m].cancel(p)),state:r,steps:i}}const{schedule:ts}=Jr(queueMicrotask,!1);function Do(e,t,n,s){const{visualElement:r}=R.useContext(on),i=R.useContext(Yr),o=R.useContext(an),a=R.useContext(Yn).reducedMotion,l=R.useRef();s=s||i.renderer,!l.current&&s&&(l.current=s(e,{visualState:t,parent:r,props:n,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:a}));const c=l.current;R.useInsertionEffect(()=>{c&&c.update(n,o)});const u=R.useRef(!!(n[Xr]&&!window.HandoffComplete));return Jn(()=>{c&&(ts.postRender(c.render),u.current&&c.animationState&&c.animationState.animateChanges())}),R.useEffect(()=>{c&&(c.updateFeatures(),!u.current&&c.animationState&&c.animationState.animateChanges(),u.current&&(u.current=!1,window.HandoffComplete=!0))}),c}function he(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Fo(e,t,n){return R.useCallback(s=>{s&&e.mount&&e.mount(s),t&&(s?t.mount(s):t.unmount()),n&&(typeof n=="function"?n(s):he(n)&&(n.current=s))},[t])}function Re(e){return typeof e=="string"||Array.isArray(e)}function ln(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const es=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ns=["initial",...es];function cn(e){return ln(e.animate)||ns.some(t=>Re(e[t]))}function Qr(e){return!!(cn(e)||e.variants)}function Oo(e,t){if(cn(e)){const{initial:n,animate:s}=e;return{initial:n===!1||Re(n)?n:void 0,animate:Re(s)?s:void 0}}return e.inherit!==!1?t:{}}function Lo(e){const{initial:t,animate:n}=Oo(e,R.useContext(on));return R.useMemo(()=>({initial:t,animate:n}),[js(t),js(n)])}function js(e){return Array.isArray(e)?e.join(" "):e}const Ns={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Me={};for(const e in Ns)Me[e]={isEnabled:t=>Ns[e].some(n=>!!t[n])};function zo(e){for(const t in e)Me[t]={...Me[t],...e[t]}}const ss=R.createContext({}),ti=R.createContext({}),Bo=Symbol.for("motionComponentSymbol");function Vo({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:s,Component:r}){e&&zo(e);function i(a,l){let c;const u={...R.useContext(Yn),...a,layoutId:Uo(a)},{isStatic:p}=u,m=Lo(a),f=s(a,p);if(!p&&Xn){m.visualElement=Do(r,f,u,t);const x=R.useContext(ti),d=R.useContext(Yr).strict;m.visualElement&&(c=m.visualElement.loadFeatures(u,d,e,x))}return I.jsxs(on.Provider,{value:m,children:[c&&m.visualElement?I.jsx(c,{visualElement:m.visualElement,...u}):null,n(r,a,Fo(f,m.visualElement,l),f,p,m.visualElement)]})}const o=R.forwardRef(i);return o[Bo]=r,o}function Uo({layoutId:e}){const t=R.useContext(ss).id;return t&&e!==void 0?t+"-"+e:e}function $o(e){function t(s,r={}){return Vo(e(s,r))}if(typeof Proxy>"u")return t;const n=new Map;return new Proxy(t,{get:(s,r)=>(n.has(r)||n.set(r,t(r)),n.get(r))})}const Wo=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function rs(e){return typeof e!="string"||e.includes("-")?!1:!!(Wo.indexOf(e)>-1||/[A-Z]/u.test(e))}const Ye={};function Ho(e){Object.assign(Ye,e)}const De=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],le=new Set(De);function ei(e,{layout:t,layoutId:n}){return le.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!Ye[e]||e==="opacity")}const St=e=>!!(e&&e.getVelocity),Go={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},qo=De.length;function Ko(e,{enableHardwareAcceleration:t=!0,allowTransformNone:n=!0},s,r){let i="";for(let o=0;o<qo;o++){const a=De[o];if(e[a]!==void 0){const l=Go[a]||a;i+=`${l}(${e[a]}) `}}return t&&!e.z&&(i+="translateZ(0)"),i=i.trim(),r?i=r(e,s?"":i):n&&s&&(i="none"),i}const ni=e=>t=>typeof t=="string"&&t.startsWith(e),si=ni("--"),Zo=ni("var(--"),is=e=>Zo(e)?Yo.test(e.split("/*")[0].trim()):!1,Yo=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Xo=(e,t)=>t&&typeof e=="number"?t.transform(e):e,Kt=(e,t,n)=>n>t?t:n<e?e:n,ve={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Ce={...ve,transform:e=>Kt(0,1,e)},We={...ve,default:1},Pe=e=>Math.round(e*1e5)/1e5,os=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,Jo=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,Qo=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function Fe(e){return typeof e=="string"}const Oe=e=>({test:t=>Fe(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Ut=Oe("deg"),Dt=Oe("%"),ct=Oe("px"),ta=Oe("vh"),ea=Oe("vw"),Ds={...Dt,parse:e=>Dt.parse(e)/100,transform:e=>Dt.transform(e*100)},Fs={...ve,transform:Math.round},ri={borderWidth:ct,borderTopWidth:ct,borderRightWidth:ct,borderBottomWidth:ct,borderLeftWidth:ct,borderRadius:ct,radius:ct,borderTopLeftRadius:ct,borderTopRightRadius:ct,borderBottomRightRadius:ct,borderBottomLeftRadius:ct,width:ct,maxWidth:ct,height:ct,maxHeight:ct,size:ct,top:ct,right:ct,bottom:ct,left:ct,padding:ct,paddingTop:ct,paddingRight:ct,paddingBottom:ct,paddingLeft:ct,margin:ct,marginTop:ct,marginRight:ct,marginBottom:ct,marginLeft:ct,rotate:Ut,rotateX:Ut,rotateY:Ut,rotateZ:Ut,scale:We,scaleX:We,scaleY:We,scaleZ:We,skew:Ut,skewX:Ut,skewY:Ut,distance:ct,translateX:ct,translateY:ct,translateZ:ct,x:ct,y:ct,z:ct,perspective:ct,transformPerspective:ct,opacity:Ce,originX:Ds,originY:Ds,originZ:ct,zIndex:Fs,backgroundPositionX:ct,backgroundPositionY:ct,fillOpacity:Ce,strokeOpacity:Ce,numOctaves:Fs};function as(e,t,n,s){const{style:r,vars:i,transform:o,transformOrigin:a}=e;let l=!1,c=!1,u=!0;for(const p in t){const m=t[p];if(si(p)){i[p]=m;continue}const f=ri[p],x=Xo(m,f);if(le.has(p)){if(l=!0,o[p]=x,!u)continue;m!==(f.default||0)&&(u=!1)}else p.startsWith("origin")?(c=!0,a[p]=x):r[p]=x}if(t.transform||(l||s?r.transform=Ko(e.transform,n,u,s):r.transform&&(r.transform="none")),c){const{originX:p="50%",originY:m="50%",originZ:f=0}=a;r.transformOrigin=`${p} ${m} ${f}`}}const ls=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ii(e,t,n){for(const s in t)!St(t[s])&&!ei(s,n)&&(e[s]=t[s])}function na({transformTemplate:e},t,n){return R.useMemo(()=>{const s=ls();return as(s,t,{enableHardwareAcceleration:!n},e),Object.assign({},s.vars,s.style)},[t])}function sa(e,t,n){const s=e.style||{},r={};return ii(r,s,e),Object.assign(r,na(e,t,n)),r}function ra(e,t,n){const s={},r=sa(e,t,n);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=r,s}const ia=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Xe(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||ia.has(e)}let oi=e=>!Xe(e);function oa(e){e&&(oi=t=>t.startsWith("on")?!Xe(t):e(t))}try{oa(require("@emotion/is-prop-valid").default)}catch{}function aa(e,t,n){const s={};for(const r in e)r==="values"&&typeof e.values=="object"||(oi(r)||n===!0&&Xe(r)||!t&&!Xe(r)||e.draggable&&r.startsWith("onDrag"))&&(s[r]=e[r]);return s}function Os(e,t,n){return typeof e=="string"?e:ct.transform(t+n*e)}function la(e,t,n){const s=Os(t,e.x,e.width),r=Os(n,e.y,e.height);return`${s} ${r}`}const ca={offset:"stroke-dashoffset",array:"stroke-dasharray"},ua={offset:"strokeDashoffset",array:"strokeDasharray"};function ha(e,t,n=1,s=0,r=!0){e.pathLength=1;const i=r?ca:ua;e[i.offset]=ct.transform(-s);const o=ct.transform(t),a=ct.transform(n);e[i.array]=`${o} ${a}`}function cs(e,{attrX:t,attrY:n,attrScale:s,originX:r,originY:i,pathLength:o,pathSpacing:a=1,pathOffset:l=0,...c},u,p,m){if(as(e,c,u,m),p){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:f,style:x,dimensions:d}=e;f.transform&&(d&&(x.transform=f.transform),delete f.transform),d&&(r!==void 0||i!==void 0||x.transform)&&(x.transformOrigin=la(d,r!==void 0?r:.5,i!==void 0?i:.5)),t!==void 0&&(f.x=t),n!==void 0&&(f.y=n),s!==void 0&&(f.scale=s),o!==void 0&&ha(f,o,a,l,!1)}const ai=()=>({...ls(),attrs:{}}),us=e=>typeof e=="string"&&e.toLowerCase()==="svg";function da(e,t,n,s){const r=R.useMemo(()=>{const i=ai();return cs(i,t,{enableHardwareAcceleration:!1},us(s),e.transformTemplate),{...i.attrs,style:{...i.style}}},[t]);if(e.style){const i={};ii(i,e.style,e),r.style={...i,...r.style}}return r}function fa(e=!1){return(n,s,r,{latestValues:i},o)=>{const l=(rs(n)?da:ra)(s,i,o,n),c=aa(s,typeof n=="string",e),u=n!==R.Fragment?{...c,...l,ref:r}:{},{children:p}=s,m=R.useMemo(()=>St(p)?p.get():p,[p]);return R.createElement(n,{...u,children:m})}}function li(e,{style:t,vars:n},s,r){Object.assign(e.style,t,r&&r.getProjectionStyles(s));for(const i in n)e.style.setProperty(i,n[i])}const ci=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function ui(e,t,n,s){li(e,t,void 0,s);for(const r in t.attrs)e.setAttribute(ci.has(r)?r:Qn(r),t.attrs[r])}function hs(e,t,n){var s;const{style:r}=e,i={};for(const o in r)(St(r[o])||t.style&&St(t.style[o])||ei(o,e)||((s=n==null?void 0:n.getValue(o))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(i[o]=r[o]);return i}function hi(e,t,n){const s=hs(e,t,n);for(const r in e)if(St(e[r])||St(t[r])){const i=De.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;s[i]=e[r]}return s}function ds(e,t,n,s={},r={}){return typeof t=="function"&&(t=t(n!==void 0?n:e.custom,s,r)),typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"&&(t=t(n!==void 0?n:e.custom,s,r)),t}function di(e){const t=R.useRef(null);return t.current===null&&(t.current=e()),t.current}const Nn=e=>Array.isArray(e),pa=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),ma=e=>Nn(e)?e[e.length-1]||0:e;function qe(e){const t=St(e)?e.get():e;return pa(t)?t.toValue():t}function ga({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:n},s,r,i){const o={latestValues:ya(s,r,i,e),renderState:t()};return n&&(o.mount=a=>n(s,a,o)),o}const fi=e=>(t,n)=>{const s=R.useContext(on),r=R.useContext(an),i=()=>ga(e,t,s,r);return n?i():di(i)};function ya(e,t,n,s){const r={},i=s(e,{});for(const m in i)r[m]=qe(i[m]);let{initial:o,animate:a}=e;const l=cn(e),c=Qr(e);t&&c&&!l&&e.inherit!==!1&&(o===void 0&&(o=t.initial),a===void 0&&(a=t.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const p=u?a:o;return p&&typeof p!="boolean"&&!ln(p)&&(Array.isArray(p)?p:[p]).forEach(f=>{const x=ds(e,f);if(!x)return;const{transitionEnd:d,transition:v,...g}=x;for(const w in g){let k=g[w];if(Array.isArray(k)){const P=u?k.length-1:0;k=k[P]}k!==null&&(r[w]=k)}for(const w in d)r[w]=d[w]}),r}const Tt=e=>e,{schedule:wt,cancel:Zt,state:bt,steps:gn}=Jr(typeof requestAnimationFrame<"u"?requestAnimationFrame:Tt,!0),va={useVisualState:fi({scrapeMotionValuesFromProps:hi,createRenderState:ai,onMount:(e,t,{renderState:n,latestValues:s})=>{wt.read(()=>{try{n.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),wt.render(()=>{cs(n,s,{enableHardwareAcceleration:!1},us(t.tagName),e.transformTemplate),ui(t,n)})}})},xa={useVisualState:fi({scrapeMotionValuesFromProps:hs,createRenderState:ls})};function wa(e,{forwardMotionProps:t=!1},n,s){return{...rs(e)?va:xa,preloadedFeatures:n,useRender:fa(t),createVisualElement:s,Component:e}}function Ot(e,t,n,s={passive:!0}){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n)}const pi=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function un(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}const ba=e=>t=>pi(t)&&e(t,un(t));function Lt(e,t,n,s){return Ot(e,t,ba(n),s)}const ka=(e,t)=>n=>t(e(n)),zt=(...e)=>e.reduce(ka);function mi(e){let t=null;return()=>{const n=()=>{t=null};return t===null?(t=e,n):!1}}const Ls=mi("dragHorizontal"),zs=mi("dragVertical");function gi(e){let t=!1;if(e==="y")t=zs();else if(e==="x")t=Ls();else{const n=Ls(),s=zs();n&&s?t=()=>{n(),s()}:(n&&n(),s&&s())}return t}function yi(){const e=gi(!0);return e?(e(),!1):!0}class Xt{constructor(t){this.isMounted=!1,this.node=t}update(){}}function Bs(e,t){const n=t?"pointerenter":"pointerleave",s=t?"onHoverStart":"onHoverEnd",r=(i,o)=>{if(i.pointerType==="touch"||yi())return;const a=e.getProps();e.animationState&&a.whileHover&&e.animationState.setActive("whileHover",t);const l=a[s];l&&l(i,o)};return Lt(e.current,n,r,{passive:!e.getProps()[s]})}class _a extends Xt{mount(){this.unmount=zt(Bs(this.node,!0),Bs(this.node,!1))}unmount(){}}class Sa extends Xt{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=zt(Ot(this.node.current,"focus",()=>this.onFocus()),Ot(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const vi=(e,t)=>t?e===t?!0:vi(e,t.parentElement):!1;function yn(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,un(n))}class Ta extends Xt{constructor(){super(...arguments),this.removeStartListeners=Tt,this.removeEndListeners=Tt,this.removeAccessibleListeners=Tt,this.startPointerPress=(t,n)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),i=Lt(window,"pointerup",(a,l)=>{if(!this.checkPressEnd())return;const{onTap:c,onTapCancel:u,globalTapTarget:p}=this.node.getProps();!p&&!vi(this.node.current,a.target)?u&&u(a,l):c&&c(a,l)},{passive:!(s.onTap||s.onPointerUp)}),o=Lt(window,"pointercancel",(a,l)=>this.cancelPress(a,l),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=zt(i,o),this.startPress(t,n)},this.startAccessiblePress=()=>{const t=i=>{if(i.key!=="Enter"||this.isPressing)return;const o=a=>{a.key!=="Enter"||!this.checkPressEnd()||yn("up",(l,c)=>{const{onTap:u}=this.node.getProps();u&&u(l,c)})};this.removeEndListeners(),this.removeEndListeners=Ot(this.node.current,"keyup",o),yn("down",(a,l)=>{this.startPress(a,l)})},n=Ot(this.node.current,"keydown",t),s=()=>{this.isPressing&&yn("cancel",(i,o)=>this.cancelPress(i,o))},r=Ot(this.node.current,"blur",s);this.removeAccessibleListeners=zt(n,r)}}startPress(t,n){this.isPressing=!0;const{onTapStart:s,whileTap:r}=this.node.getProps();r&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&s(t,n)}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!yi()}cancelPress(t,n){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&s(t,n)}mount(){const t=this.node.getProps(),n=Lt(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),s=Ot(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=zt(n,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Dn=new WeakMap,vn=new WeakMap,Ca=e=>{const t=Dn.get(e.target);t&&t(e)},Pa=e=>{e.forEach(Ca)};function Ia({root:e,...t}){const n=e||document;vn.has(n)||vn.set(n,{});const s=vn.get(n),r=JSON.stringify(t);return s[r]||(s[r]=new IntersectionObserver(Pa,{root:e,...t})),s[r]}function Ea(e,t,n){const s=Ia(t);return Dn.set(e,n),s.observe(e),()=>{Dn.delete(e),s.unobserve(e)}}const Aa={some:0,all:1};class Ra extends Xt{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:s,amount:r="some",once:i}=t,o={root:n?n.current:void 0,rootMargin:s,threshold:typeof r=="number"?r:Aa[r]},a=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,i&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:p}=this.node.getProps(),m=c?u:p;m&&m(l)};return Ea(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(Ma(t,n))&&this.startObserver()}unmount(){}}function Ma({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const ja={inView:{Feature:Ra},tap:{Feature:Ta},focus:{Feature:Sa},hover:{Feature:_a}};function xi(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}function Na(e){const t={};return e.values.forEach((n,s)=>t[s]=n.get()),t}function Da(e){const t={};return e.values.forEach((n,s)=>t[s]=n.getVelocity()),t}function hn(e,t,n){const s=e.getProps();return ds(s,t,n!==void 0?n:s.custom,Na(e),Da(e))}const Gt=e=>e*1e3,Bt=e=>e/1e3,Fa={type:"spring",stiffness:500,damping:25,restSpeed:10},Oa=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),La={type:"keyframes",duration:.8},za={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Ba=(e,{keyframes:t})=>t.length>2?La:le.has(e)?e.startsWith("scale")?Oa(t[1]):Fa:za;function Va({when:e,delay:t,delayChildren:n,staggerChildren:s,staggerDirection:r,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:c,...u}){return!!Object.keys(u).length}function fs(e,t){return e[t]||e.default||e}const Ua=e=>e!==null;function dn(e,{repeat:t,repeatType:n="loop"},s){const r=e.filter(Ua),i=t&&n!=="loop"&&t%2===1?0:r.length-1;return!i||s===void 0?r[i]:s}let Ke;function $a(){Ke=void 0}const qt={now:()=>(Ke===void 0&&qt.set(bt.isProcessing||Mo.useManualTiming?bt.timestamp:performance.now()),Ke),set:e=>{Ke=e,queueMicrotask($a)}},wi=e=>/^0[^.\s]+$/u.test(e);function Wa(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||wi(e):!0}let bi=Tt;const ki=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Ha=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Ga(e){const t=Ha.exec(e);if(!t)return[,];const[,n,s,r]=t;return[`--${n??s}`,r]}function _i(e,t,n=1){const[s,r]=Ga(e);if(!s)return;const i=window.getComputedStyle(t).getPropertyValue(s);if(i){const o=i.trim();return ki(o)?parseFloat(o):o}return is(r)?_i(r,t,n+1):r}const qa=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Vs=e=>e===ve||e===ct,Us=(e,t)=>parseFloat(e.split(", ")[t]),$s=(e,t)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const r=s.match(/^matrix3d\((.+)\)$/u);if(r)return Us(r[1],t);{const i=s.match(/^matrix\((.+)\)$/u);return i?Us(i[1],e):0}},Ka=new Set(["x","y","z"]),Za=De.filter(e=>!Ka.has(e));function Ya(e){const t=[];return Za.forEach(n=>{const s=e.getValue(n);s!==void 0&&(t.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),t}const ye={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:$s(4,13),y:$s(5,14)};ye.translateX=ye.x;ye.translateY=ye.y;const Si=e=>t=>t.test(e),Xa={test:e=>e==="auto",parse:e=>e},Ti=[ve,ct,Dt,Ut,ea,ta,Xa],Ws=e=>Ti.find(Si(e)),ae=new Set;let Fn=!1,On=!1;function Ci(){if(On){const e=Array.from(ae).filter(s=>s.needsMeasurement),t=new Set(e.map(s=>s.element)),n=new Map;t.forEach(s=>{const r=Ya(s);r.length&&(n.set(s,r),s.render())}),e.forEach(s=>s.measureInitialState()),t.forEach(s=>{s.render();const r=n.get(s);r&&r.forEach(([i,o])=>{var a;(a=s.getValue(i))===null||a===void 0||a.set(o)})}),e.forEach(s=>s.measureEndState()),e.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}On=!1,Fn=!1,ae.forEach(e=>e.complete()),ae.clear()}function Pi(){ae.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(On=!0)})}function Ja(){Pi(),Ci()}class ps{constructor(t,n,s,r,i,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=s,this.motionValue=r,this.element=i,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ae.add(this),Fn||(Fn=!0,wt.read(Pi),wt.resolveKeyframes(Ci))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:s,motionValue:r}=this;for(let i=0;i<t.length;i++)if(t[i]===null)if(i===0){const o=r==null?void 0:r.get(),a=t[t.length-1];if(o!==void 0)t[0]=o;else if(s&&n){const l=s.readValue(n,a);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=a),r&&o===void 0&&r.set(t[0])}else t[i]=t[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ae.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ae.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const ms=(e,t)=>n=>!!(Fe(n)&&Qo.test(n)&&n.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(n,t)),Ii=(e,t,n)=>s=>{if(!Fe(s))return s;const[r,i,o,a]=s.match(os);return{[e]:parseFloat(r),[t]:parseFloat(i),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},Qa=e=>Kt(0,255,e),xn={...ve,transform:e=>Math.round(Qa(e))},se={test:ms("rgb","red"),parse:Ii("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:s=1})=>"rgba("+xn.transform(e)+", "+xn.transform(t)+", "+xn.transform(n)+", "+Pe(Ce.transform(s))+")"};function tl(e){let t="",n="",s="",r="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),s=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),s=e.substring(3,4),r=e.substring(4,5),t+=t,n+=n,s+=s,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}}const Ln={test:ms("#"),parse:tl,transform:se.transform},de={test:ms("hsl","hue"),parse:Ii("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:s=1})=>"hsla("+Math.round(e)+", "+Dt.transform(Pe(t))+", "+Dt.transform(Pe(n))+", "+Pe(Ce.transform(s))+")"},_t={test:e=>se.test(e)||Ln.test(e)||de.test(e),parse:e=>se.test(e)?se.parse(e):de.test(e)?de.parse(e):Ln.parse(e),transform:e=>Fe(e)?e:e.hasOwnProperty("red")?se.transform(e):de.transform(e)};function el(e){var t,n;return isNaN(e)&&Fe(e)&&(((t=e.match(os))===null||t===void 0?void 0:t.length)||0)+(((n=e.match(Jo))===null||n===void 0?void 0:n.length)||0)>0}const Ei="number",Ai="color",nl="var",sl="var(",Hs="${}",rl=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Je(e){const t=e.toString(),n=[],s={color:[],number:[],var:[]},r=[];let i=0;const a=t.replace(rl,l=>(_t.test(l)?(s.color.push(i),r.push(Ai),n.push(_t.parse(l))):l.startsWith(sl)?(s.var.push(i),r.push(nl),n.push(l)):(s.number.push(i),r.push(Ei),n.push(parseFloat(l))),++i,Hs)).split(Hs);return{values:n,split:a,indexes:s,types:r}}function Ri(e){return Je(e).values}function Mi(e){const{split:t,types:n}=Je(e),s=t.length;return r=>{let i="";for(let o=0;o<s;o++)if(i+=t[o],r[o]!==void 0){const a=n[o];a===Ei?i+=Pe(r[o]):a===Ai?i+=_t.transform(r[o]):i+=r[o]}return i}}const il=e=>typeof e=="number"?0:e;function ol(e){const t=Ri(e);return Mi(e)(t.map(il))}const Yt={test:el,parse:Ri,createTransformer:Mi,getAnimatableNone:ol},al=new Set(["brightness","contrast","saturate","opacity"]);function ll(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[s]=n.match(os)||[];if(!s)return e;const r=n.replace(s,"");let i=al.has(t)?1:0;return s!==n&&(i*=100),t+"("+i+r+")"}const cl=/\b([a-z-]*)\(.*?\)/gu,zn={...Yt,getAnimatableNone:e=>{const t=e.match(cl);return t?t.map(ll).join(" "):e}},ul={...ri,color:_t,backgroundColor:_t,outlineColor:_t,fill:_t,stroke:_t,borderColor:_t,borderTopColor:_t,borderRightColor:_t,borderBottomColor:_t,borderLeftColor:_t,filter:zn,WebkitFilter:zn},gs=e=>ul[e];function ji(e,t){let n=gs(e);return n!==zn&&(n=Yt),n.getAnimatableNone?n.getAnimatableNone(t):void 0}function hl(e,t,n){let s=0,r;for(;s<e.length&&!r;)typeof e[s]=="string"&&e[s]!=="none"&&e[s]!=="0"&&(r=e[s]),s++;if(r&&n)for(const i of t)e[i]=ji(n,r)}class Ni extends ps{constructor(t,n,s,r){super(t,n,s,r,r==null?void 0:r.owner,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:s}=this;if(!n.current)return;super.readKeyframes();for(let l=0;l<t.length;l++){const c=t[l];if(typeof c=="string"&&is(c)){const u=_i(c,n.current);u!==void 0&&(t[l]=u),l===t.length-1&&(this.finalKeyframe=c)}}if(!qa.has(s)||t.length!==2)return this.resolveNoneKeyframes();const[r,i]=t,o=Ws(r),a=Ws(i);if(o!==a)if(Vs(o)&&Vs(a))for(let l=0;l<t.length;l++){const c=t[l];typeof c=="string"&&(t[l]=parseFloat(c))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,s=[];for(let r=0;r<t.length;r++)Wa(t[r])&&s.push(r);s.length&&hl(t,s,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:s}=this;if(!t.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ye[s](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&t.getValue(s,r).jump(r,!1)}measureEndState(){var t;const{element:n,name:s,unresolvedKeyframes:r}=this;if(!n.current)return;const i=n.getValue(s);i&&i.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=ye[s](n.measureViewportBox(),window.getComputedStyle(n.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([l,c])=>{n.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function dl(e){let t;return()=>(t===void 0&&(t=e()),t)}const Gs=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Yt.test(e)||e==="0")&&!e.startsWith("url("));function fl(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function pl(e,t,n,s){const r=e[0];if(r===null)return!1;const i=e[e.length-1],o=Gs(r,t),a=Gs(i,t);return!o||!a?!1:fl(e)||n==="spring"&&s}class Di{constructor({autoplay:t=!0,delay:n=0,type:s="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:t,delay:n,type:s,repeat:r,repeatDelay:i,repeatType:o,...a},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Ja(),this._resolved}onKeyframesResolved(t,n){this.hasAttemptedResolve=!0;const{name:s,type:r,velocity:i,delay:o,onComplete:a,onUpdate:l,isGenerator:c}=this.options;if(!c&&!pl(t,s,r,i))if(o)this.options.duration=0;else{l==null||l(dn(t,this.options,n)),a==null||a(),this.resolveFinishedPromise();return}const u=this.initPlayback(t,n);u!==!1&&(this._resolved={keyframes:t,finalKeyframe:n,...u},this.onPostResolved())}onPostResolved(){}then(t,n){return this.currentFinishedPromise.then(t,n)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function Fi(e,t){return t?e*(1e3/t):0}const ml=5;function Oi(e,t,n){const s=Math.max(t-ml,0);return Fi(n-e(s),t-s)}const wn=.001,gl=.01,yl=10,vl=.05,xl=1;function wl({duration:e=800,bounce:t=.25,velocity:n=0,mass:s=1}){let r,i,o=1-t;o=Kt(vl,xl,o),e=Kt(gl,yl,Bt(e)),o<1?(r=c=>{const u=c*o,p=u*e,m=u-n,f=Bn(c,o),x=Math.exp(-p);return wn-m/f*x},i=c=>{const p=c*o*e,m=p*n+n,f=Math.pow(o,2)*Math.pow(c,2)*e,x=Math.exp(-p),d=Bn(Math.pow(c,2),o);return(-r(c)+wn>0?-1:1)*((m-f)*x)/d}):(r=c=>{const u=Math.exp(-c*e),p=(c-n)*e+1;return-wn+u*p},i=c=>{const u=Math.exp(-c*e),p=(n-c)*(e*e);return u*p});const a=5/e,l=kl(r,i,a);if(e=Gt(e),isNaN(l))return{stiffness:100,damping:10,duration:e};{const c=Math.pow(l,2)*s;return{stiffness:c,damping:o*2*Math.sqrt(s*c),duration:e}}}const bl=12;function kl(e,t,n){let s=n;for(let r=1;r<bl;r++)s=s-e(s)/t(s);return s}function Bn(e,t){return e*Math.sqrt(1-t*t)}const _l=["duration","bounce"],Sl=["stiffness","damping","mass"];function qs(e,t){return t.some(n=>e[n]!==void 0)}function Tl(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!qs(e,Sl)&&qs(e,_l)){const n=wl(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}function Li({keyframes:e,restDelta:t,restSpeed:n,...s}){const r=e[0],i=e[e.length-1],o={done:!1,value:r},{stiffness:a,damping:l,mass:c,duration:u,velocity:p,isResolvedFromDuration:m}=Tl({...s,velocity:-Bt(s.velocity||0)}),f=p||0,x=l/(2*Math.sqrt(a*c)),d=i-r,v=Bt(Math.sqrt(a/c)),g=Math.abs(d)<5;n||(n=g?.01:2),t||(t=g?.005:.5);let w;if(x<1){const k=Bn(v,x);w=P=>{const T=Math.exp(-x*v*P);return i-T*((f+x*v*d)/k*Math.sin(k*P)+d*Math.cos(k*P))}}else if(x===1)w=k=>i-Math.exp(-v*k)*(d+(f+v*d)*k);else{const k=v*Math.sqrt(x*x-1);w=P=>{const T=Math.exp(-x*v*P),N=Math.min(k*P,300);return i-T*((f+x*v*d)*Math.sinh(N)+k*d*Math.cosh(N))/k}}return{calculatedDuration:m&&u||null,next:k=>{const P=w(k);if(m)o.done=k>=u;else{let T=f;k!==0&&(x<1?T=Oi(w,k,P):T=0);const N=Math.abs(T)<=n,M=Math.abs(i-P)<=t;o.done=N&&M}return o.value=o.done?i:P,o}}}function Ks({keyframes:e,velocity:t=0,power:n=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:u}){const p=e[0],m={done:!1,value:p},f=B=>a!==void 0&&B<a||l!==void 0&&B>l,x=B=>a===void 0?l:l===void 0||Math.abs(a-B)<Math.abs(l-B)?a:l;let d=n*t;const v=p+d,g=o===void 0?v:o(v);g!==v&&(d=g-p);const w=B=>-d*Math.exp(-B/s),k=B=>g+w(B),P=B=>{const F=w(B),H=k(B);m.done=Math.abs(F)<=c,m.value=m.done?g:H};let T,N;const M=B=>{f(m.value)&&(T=B,N=Li({keyframes:[m.value,x(m.value)],velocity:Oi(k,B,m.value),damping:r,stiffness:i,restDelta:c,restSpeed:u}))};return M(0),{calculatedDuration:null,next:B=>{let F=!1;return!N&&T===void 0&&(F=!0,P(B),M(B)),T!==void 0&&B>=T?N.next(B-T):(!F&&P(B),m)}}}const zi=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,Cl=1e-7,Pl=12;function Il(e,t,n,s,r){let i,o,a=0;do o=t+(n-t)/2,i=zi(o,s,r)-e,i>0?n=o:t=o;while(Math.abs(i)>Cl&&++a<Pl);return o}function Le(e,t,n,s){if(e===t&&n===s)return Tt;const r=i=>Il(i,0,1,e,n);return i=>i===0||i===1?i:zi(r(i),t,s)}const El=Le(.42,0,1,1),Al=Le(0,0,.58,1),Bi=Le(.42,0,.58,1),Rl=e=>Array.isArray(e)&&typeof e[0]!="number",Vi=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Ui=e=>t=>1-e(1-t),ys=e=>1-Math.sin(Math.acos(e)),$i=Ui(ys),Ml=Vi(ys),Wi=Le(.33,1.53,.69,.99),vs=Ui(Wi),jl=Vi(vs),Nl=e=>(e*=2)<1?.5*vs(e):.5*(2-Math.pow(2,-10*(e-1))),Dl={linear:Tt,easeIn:El,easeInOut:Bi,easeOut:Al,circIn:ys,circInOut:Ml,circOut:$i,backIn:vs,backInOut:jl,backOut:Wi,anticipate:Nl},Zs=e=>{if(Array.isArray(e)){bi(e.length===4);const[t,n,s,r]=e;return Le(t,n,s,r)}else if(typeof e=="string")return Dl[e];return e},je=(e,t,n)=>{const s=t-e;return s===0?1:(n-e)/s},yt=(e,t,n)=>e+(t-e)*n;function bn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Fl({hue:e,saturation:t,lightness:n,alpha:s}){e/=360,t/=100,n/=100;let r=0,i=0,o=0;if(!t)r=i=o=n;else{const a=n<.5?n*(1+t):n+t-n*t,l=2*n-a;r=bn(l,a,e+1/3),i=bn(l,a,e),o=bn(l,a,e-1/3)}return{red:Math.round(r*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:s}}const kn=(e,t,n)=>{const s=e*e,r=n*(t*t-s)+s;return r<0?0:Math.sqrt(r)},Ol=[Ln,se,de],Ll=e=>Ol.find(t=>t.test(e));function Ys(e){const t=Ll(e);let n=t.parse(e);return t===de&&(n=Fl(n)),n}const Xs=(e,t)=>{const n=Ys(e),s=Ys(t),r={...n};return i=>(r.red=kn(n.red,s.red,i),r.green=kn(n.green,s.green,i),r.blue=kn(n.blue,s.blue,i),r.alpha=yt(n.alpha,s.alpha,i),se.transform(r))};function Vn(e,t){return n=>n>0?t:e}function zl(e,t){return n=>yt(e,t,n)}function xs(e){return typeof e=="number"?zl:typeof e=="string"?is(e)?Vn:_t.test(e)?Xs:Ul:Array.isArray(e)?Hi:typeof e=="object"?_t.test(e)?Xs:Bl:Vn}function Hi(e,t){const n=[...e],s=n.length,r=e.map((i,o)=>xs(i)(i,t[o]));return i=>{for(let o=0;o<s;o++)n[o]=r[o](i);return n}}function Bl(e,t){const n={...e,...t},s={};for(const r in n)e[r]!==void 0&&t[r]!==void 0&&(s[r]=xs(e[r])(e[r],t[r]));return r=>{for(const i in s)n[i]=s[i](r);return n}}function Vl(e,t){var n;const s=[],r={color:0,var:0,number:0};for(let i=0;i<t.values.length;i++){const o=t.types[i],a=e.indexes[o][r[o]],l=(n=e.values[a])!==null&&n!==void 0?n:0;s[i]=l,r[o]++}return s}const Ul=(e,t)=>{const n=Yt.createTransformer(t),s=Je(e),r=Je(t);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?zt(Hi(Vl(s,r),r.values),n):Vn(e,t)};function Gi(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?yt(e,t,n):xs(e)(e,t)}function $l(e,t,n){const s=[],r=n||Gi,i=e.length-1;for(let o=0;o<i;o++){let a=r(e[o],e[o+1]);if(t){const l=Array.isArray(t)?t[o]||Tt:t;a=zt(l,a)}s.push(a)}return s}function Wl(e,t,{clamp:n=!0,ease:s,mixer:r}={}){const i=e.length;if(bi(i===t.length),i===1)return()=>t[0];if(i===2&&e[0]===e[1])return()=>t[1];e[0]>e[i-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=$l(t,s,r),a=o.length,l=c=>{let u=0;if(a>1)for(;u<e.length-2&&!(c<e[u+1]);u++);const p=je(e[u],e[u+1],c);return o[u](p)};return n?c=>l(Kt(e[0],e[i-1],c)):l}function Hl(e,t){const n=e[e.length-1];for(let s=1;s<=t;s++){const r=je(0,t,s);e.push(yt(n,1,r))}}function Gl(e){const t=[0];return Hl(t,e.length-1),t}function ql(e,t){return e.map(n=>n*t)}function Kl(e,t){return e.map(()=>t||Bi).splice(0,e.length-1)}function Qe({duration:e=300,keyframes:t,times:n,ease:s="easeInOut"}){const r=Rl(s)?s.map(Zs):Zs(s),i={done:!1,value:t[0]},o=ql(n&&n.length===t.length?n:Gl(t),e),a=Wl(o,t,{ease:Array.isArray(r)?r:Kl(t,r)});return{calculatedDuration:e,next:l=>(i.value=a(l),i.done=l>=e,i)}}const Js=2e4;function Zl(e){let t=0;const n=50;let s=e.next(t);for(;!s.done&&t<Js;)t+=n,s=e.next(t);return t>=Js?1/0:t}const Yl=e=>{const t=({timestamp:n})=>e(n);return{start:()=>wt.update(t,!0),stop:()=>Zt(t),now:()=>bt.isProcessing?bt.timestamp:qt.now()}},Xl={decay:Ks,inertia:Ks,tween:Qe,keyframes:Qe,spring:Li},Jl=e=>e/100;class ws extends Di{constructor({KeyframeResolver:t=ps,...n}){super(n),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:a}=this.options;a&&a()};const{name:s,motionValue:r,keyframes:i}=this.options,o=(a,l)=>this.onKeyframesResolved(a,l);s&&r&&r.owner?this.resolver=r.owner.resolveKeyframes(i,o,s,r):this.resolver=new t(i,o,s,r),this.resolver.scheduleResolve()}initPlayback(t){const{type:n="keyframes",repeat:s=0,repeatDelay:r=0,repeatType:i,velocity:o=0}=this.options,a=Xl[n]||Qe;let l,c;a!==Qe&&typeof t[0]!="number"&&(l=zt(Jl,Gi(t[0],t[1])),t=[0,100]);const u=a({...this.options,keyframes:t});i==="mirror"&&(c=a({...this.options,keyframes:[...t].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=Zl(u));const{calculatedDuration:p}=u,m=p+r,f=m*(s+1)-r;return{generator:u,mirroredGenerator:c,mapPercentToKeyframes:l,calculatedDuration:p,resolvedDuration:m,totalDuration:f}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,n=!1){const{resolved:s}=this;if(!s){const{keyframes:B}=this.options;return{done:!0,value:B[B.length-1]}}const{finalKeyframe:r,generator:i,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:l,calculatedDuration:c,totalDuration:u,resolvedDuration:p}=s;if(this.startTime===null)return i.next(0);const{delay:m,repeat:f,repeatType:x,repeatDelay:d,onUpdate:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-u/this.speed,this.startTime)),n?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const g=this.currentTime-m*(this.speed>=0?1:-1),w=this.speed>=0?g<0:g>u;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let k=this.currentTime,P=i;if(f){const B=Math.min(this.currentTime,u)/p;let F=Math.floor(B),H=B%1;!H&&B>=1&&(H=1),H===1&&F--,F=Math.min(F,f+1),!!(F%2)&&(x==="reverse"?(H=1-H,d&&(H-=d/p)):x==="mirror"&&(P=o)),k=Kt(0,1,H)*p}const T=w?{done:!1,value:l[0]}:P.next(k);a&&(T.value=a(T.value));let{done:N}=T;!w&&c!==null&&(N=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const M=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&N);return M&&r!==void 0&&(T.value=dn(l,this.options,r)),v&&v(T.value),M&&this.finish(),T}get duration(){const{resolved:t}=this;return t?Bt(t.calculatedDuration):0}get time(){return Bt(this.currentTime)}set time(t){t=Gt(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Bt(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=Yl,onPlay:n}=this.options;this.driver||(this.driver=t(r=>this.tick(r))),n&&n();const s=this.driver.now();this.holdTime!==null?this.startTime=s-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=s),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const qi=e=>Array.isArray(e)&&typeof e[0]=="number";function Ki(e){return!!(!e||typeof e=="string"&&e in bs||qi(e)||Array.isArray(e)&&e.every(Ki))}const Se=([e,t,n,s])=>`cubic-bezier(${e}, ${t}, ${n}, ${s})`,bs={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Se([0,.65,.55,1]),circOut:Se([.55,0,1,.45]),backIn:Se([.31,.01,.66,-.59]),backOut:Se([.33,1.53,.69,.99])};function Ql(e){return Zi(e)||bs.easeOut}function Zi(e){if(e)return qi(e)?Se(e):Array.isArray(e)?e.map(Ql):bs[e]}function tc(e,t,n,{delay:s=0,duration:r=300,repeat:i=0,repeatType:o="loop",ease:a,times:l}={}){const c={[t]:n};l&&(c.offset=l);const u=Zi(a);return Array.isArray(u)&&(c.easing=u),e.animate(c,{delay:s,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"})}const ec=dl(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),nc=new Set(["opacity","clipPath","filter","transform"]),tn=10,sc=2e4;function rc(e){return e.type==="spring"||e.name==="backgroundColor"||!Ki(e.ease)}function ic(e,t){const n=new ws({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:e[0]};const r=[];let i=0;for(;!s.done&&i<sc;)s=n.sample(i),r.push(s.value),i+=tn;return{times:void 0,keyframes:r,duration:i-tn,ease:"linear"}}class Qs extends Di{constructor(t){super(t);const{name:n,motionValue:s,keyframes:r}=this.options;this.resolver=new Ni(r,(i,o)=>this.onKeyframesResolved(i,o),n,s),this.resolver.scheduleResolve()}initPlayback(t,n){var s;let{duration:r=300,times:i,ease:o,type:a,motionValue:l,name:c}=this.options;if(!(!((s=l.owner)===null||s===void 0)&&s.current))return!1;if(rc(this.options)){const{onComplete:p,onUpdate:m,motionValue:f,...x}=this.options,d=ic(t,x);t=d.keyframes,t.length===1&&(t[1]=t[0]),r=d.duration,i=d.times,o=d.ease,a="keyframes"}const u=tc(l.owner.current,c,t,{...this.options,duration:r,times:i,ease:o});return u.startTime=qt.now(),this.pendingTimeline?(u.timeline=this.pendingTimeline,this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:p}=this.options;l.set(dn(t,this.options,n)),p&&p(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:r,times:i,type:a,ease:o,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:n}=t;return Bt(n)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:n}=t;return Bt(n.currentTime||0)}set time(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.currentTime=Gt(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:n}=t;return n.playbackRate}set speed(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:n}=t;return n.playState}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:n}=this;if(!n)return Tt;const{animation:s}=n;s.timeline=t,s.onfinish=null}return Tt}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:t}=this;if(!t)return;const{animation:n,keyframes:s,duration:r,type:i,ease:o,times:a}=t;if(!(n.playState==="idle"||n.playState==="finished")){if(this.time){const{motionValue:l,onUpdate:c,onComplete:u,...p}=this.options,m=new ws({...p,keyframes:s,duration:r,type:i,ease:o,times:a,isGenerator:!0}),f=Gt(this.time);l.setWithVelocity(m.sample(f-tn).value,m.sample(f).value,tn)}this.cancel()}}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:n,name:s,repeatDelay:r,repeatType:i,damping:o,type:a}=t;return ec()&&s&&nc.has(s)&&n&&n.owner&&n.owner.current instanceof HTMLElement&&!n.owner.getProps().onUpdate&&!r&&i!=="mirror"&&o!==0&&a!=="inertia"}}const ks=(e,t,n,s={},r,i)=>o=>{const a=fs(s,e)||{},l=a.delay||s.delay||0;let{elapsed:c=0}=s;c=c-Gt(l);let u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...a,delay:-c,onUpdate:m=>{t.set(m),a.onUpdate&&a.onUpdate(m)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:e,motionValue:t,element:i?void 0:r};Va(a)||(u={...u,...Ba(e,u)}),u.duration&&(u.duration=Gt(u.duration)),u.repeatDelay&&(u.repeatDelay=Gt(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let p=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(p=!0)),p&&!i&&t.get()!==void 0){const m=dn(u.keyframes,a);if(m!==void 0){wt.update(()=>{u.onUpdate(m),u.onComplete()});return}}return!i&&Qs.supports(u)?new Qs(u):new ws(u)};function en(e){return!!(St(e)&&e.add)}function _s(e,t){e.indexOf(t)===-1&&e.push(t)}function Ss(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Ts{constructor(){this.subscriptions=[]}add(t){return _s(this.subscriptions,t),()=>Ss(this.subscriptions,t)}notify(t,n,s){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](t,n,s);else for(let i=0;i<r;i++){const o=this.subscriptions[i];o&&o(t,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const tr=30,oc=e=>!isNaN(parseFloat(e));class ac{constructor(t,n={}){this.version="11.1.7",this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(s,r=!0)=>{const i=qt.now();this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.canTrackVelocity=oc(this.current),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=qt.now()}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new Ts);const s=this.events[t].add(n);return t==="change"?()=>{s(),wt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t,n=!0){!n||!this.passiveEffect?this.updateAndNotify(t,n):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=qt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>tr)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,tr);return Fi(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ne(e,t){return new ac(e,t)}function lc(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,Ne(n))}function cc(e,t){const n=hn(e,t);let{transitionEnd:s={},transition:r={},...i}=n||{};i={...i,...s};for(const o in i){const a=ma(i[o]);lc(e,o,a)}}function uc({protectedKeys:e,needsAnimating:t},n){const s=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,s}function Yi(e,t,{delay:n=0,transitionOverride:s,type:r}={}){var i;let{transition:o=e.getDefaultTransition(),transitionEnd:a,...l}=t;const c=e.getValue("willChange");s&&(o=s);const u=[],p=r&&e.animationState&&e.animationState.getState()[r];for(const m in l){const f=e.getValue(m,(i=e.latestValues[m])!==null&&i!==void 0?i:null),x=l[m];if(x===void 0||p&&uc(p,m))continue;const d={delay:n,elapsed:0,...fs(o||{},m)};let v=!1;if(window.HandoffAppearAnimations){const k=e.getProps()[Xr];if(k){const P=window.HandoffAppearAnimations(k,m);P!==null&&(d.elapsed=P,v=!0)}}f.start(ks(m,f,x,e.shouldReduceMotion&&le.has(m)?{type:!1}:d,e,v));const g=f.animation;g&&(en(c)&&(c.add(m),g.then(()=>c.remove(m))),u.push(g))}return a&&Promise.all(u).then(()=>{wt.update(()=>{a&&cc(e,a)})}),u}function Un(e,t,n={}){var s;const r=hn(e,t,n.type==="exit"?(s=e.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:i=e.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(i=n.transitionOverride);const o=r?()=>Promise.all(Yi(e,r,n)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:u=0,staggerChildren:p,staggerDirection:m}=i;return hc(e,t,u+c,p,m,n)}:()=>Promise.resolve(),{when:l}=i;if(l){const[c,u]=l==="beforeChildren"?[o,a]:[a,o];return c().then(()=>u())}else return Promise.all([o(),a(n.delay)])}function hc(e,t,n=0,s=0,r=1,i){const o=[],a=(e.variantChildren.size-1)*s,l=r===1?(c=0)=>c*s:(c=0)=>a-c*s;return Array.from(e.variantChildren).sort(dc).forEach((c,u)=>{c.notify("AnimationStart",t),o.push(Un(c,t,{...i,delay:n+l(u)}).then(()=>c.notify("AnimationComplete",t)))}),Promise.all(o)}function dc(e,t){return e.sortNodePosition(t)}function fc(e,t,n={}){e.notify("AnimationStart",t);let s;if(Array.isArray(t)){const r=t.map(i=>Un(e,i,n));s=Promise.all(r)}else if(typeof t=="string")s=Un(e,t,n);else{const r=typeof t=="function"?hn(e,t,n.custom):t;s=Promise.all(Yi(e,r,n))}return s.then(()=>{wt.postRender(()=>{e.notify("AnimationComplete",t)})})}const pc=[...es].reverse(),mc=es.length;function gc(e){return t=>Promise.all(t.map(({animation:n,options:s})=>fc(e,n,s)))}function yc(e){let t=gc(e);const n=xc();let s=!0;const r=l=>(c,u)=>{var p;const m=hn(e,u,l==="exit"?(p=e.presenceContext)===null||p===void 0?void 0:p.custom:void 0);if(m){const{transition:f,transitionEnd:x,...d}=m;c={...c,...d,...x}}return c};function i(l){t=l(e)}function o(l){const c=e.getProps(),u=e.getVariantContext(!0)||{},p=[],m=new Set;let f={},x=1/0;for(let v=0;v<mc;v++){const g=pc[v],w=n[g],k=c[g]!==void 0?c[g]:u[g],P=Re(k),T=g===l?w.isActive:null;T===!1&&(x=v);let N=k===u[g]&&k!==c[g]&&P;if(N&&s&&e.manuallyAnimateOnMount&&(N=!1),w.protectedKeys={...f},!w.isActive&&T===null||!k&&!w.prevProp||ln(k)||typeof k=="boolean")continue;let B=vc(w.prevProp,k)||g===l&&w.isActive&&!N&&P||v>x&&P,F=!1;const H=Array.isArray(k)?k:[k];let et=H.reduce(r(g),{});T===!1&&(et={});const{prevResolvedValues:E={}}=w,O={...E,...et},y=L=>{B=!0,m.has(L)&&(F=!0,m.delete(L)),w.needsAnimating[L]=!0;const Q=e.getValue(L);Q&&(Q.liveStyle=!1)};for(const L in O){const Q=et[L],$=E[L];if(f.hasOwnProperty(L))continue;let nt=!1;Nn(Q)&&Nn($)?nt=!xi(Q,$):nt=Q!==$,nt?Q!=null?y(L):m.add(L):Q!==void 0&&m.has(L)?y(L):w.protectedKeys[L]=!0}w.prevProp=k,w.prevResolvedValues=et,w.isActive&&(f={...f,...et}),s&&e.blockInitialAnimation&&(B=!1),B&&(!N||F)&&p.push(...H.map(L=>({animation:L,options:{type:g}})))}if(m.size){const v={};m.forEach(g=>{const w=e.getBaseTarget(g),k=e.getValue(g);k&&(k.liveStyle=!0),v[g]=w??null}),p.push({animation:v})}let d=!!p.length;return s&&(c.initial===!1||c.initial===c.animate)&&!e.manuallyAnimateOnMount&&(d=!1),s=!1,d?t(p):Promise.resolve()}function a(l,c){var u;if(n[l].isActive===c)return Promise.resolve();(u=e.variantChildren)===null||u===void 0||u.forEach(m=>{var f;return(f=m.animationState)===null||f===void 0?void 0:f.setActive(l,c)}),n[l].isActive=c;const p=o(l);for(const m in n)n[m].protectedKeys={};return p}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>n}}function vc(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!xi(t,e):!1}function Qt(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function xc(){return{animate:Qt(!0),whileInView:Qt(),whileHover:Qt(),whileTap:Qt(),whileDrag:Qt(),whileFocus:Qt(),exit:Qt()}}class wc extends Xt{constructor(t){super(t),t.animationState||(t.animationState=yc(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),ln(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){}}let bc=0;class kc extends Xt{constructor(){super(...arguments),this.id=bc++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const r=this.node.animationState.setActive("exit",!t);n&&!t&&r.then(()=>n(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const _c={animation:{Feature:wc},exit:{Feature:kc}},er=(e,t)=>Math.abs(e-t);function Sc(e,t){const n=er(e.x,t.x),s=er(e.y,t.y);return Math.sqrt(n**2+s**2)}class Xi{constructor(t,n,{transformPagePoint:s,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=Sn(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,f=Sc(p.offset,{x:0,y:0})>=3;if(!m&&!f)return;const{point:x}=p,{timestamp:d}=bt;this.history.push({...x,timestamp:d});const{onStart:v,onMove:g}=this.handlers;m||(v&&v(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),g&&g(this.lastMoveEvent,p)},this.handlePointerMove=(p,m)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=_n(m,this.transformPagePoint),wt.update(this.updatePoint,!0)},this.handlePointerUp=(p,m)=>{this.end();const{onEnd:f,onSessionEnd:x,resumeAnimation:d}=this.handlers;if(this.dragSnapToOrigin&&d&&d(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=Sn(p.type==="pointercancel"?this.lastMoveEventInfo:_n(m,this.transformPagePoint),this.history);this.startEvent&&f&&f(p,v),x&&x(p,v)},!pi(t))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=s,this.contextWindow=r||window;const o=un(t),a=_n(o,this.transformPagePoint),{point:l}=a,{timestamp:c}=bt;this.history=[{...l,timestamp:c}];const{onSessionStart:u}=n;u&&u(t,Sn(a,this.history)),this.removeListeners=zt(Lt(this.contextWindow,"pointermove",this.handlePointerMove),Lt(this.contextWindow,"pointerup",this.handlePointerUp),Lt(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Zt(this.updatePoint)}}function _n(e,t){return t?{point:t(e.point)}:e}function nr(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Sn({point:e},t){return{point:e,delta:nr(e,Ji(t)),offset:nr(e,Tc(t)),velocity:Cc(t,.1)}}function Tc(e){return e[0]}function Ji(e){return e[e.length-1]}function Cc(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,s=null;const r=Ji(e);for(;n>=0&&(s=e[n],!(r.timestamp-s.timestamp>Gt(t)));)n--;if(!s)return{x:0,y:0};const i=Bt(r.timestamp-s.timestamp);if(i===0)return{x:0,y:0};const o={x:(r.x-s.x)/i,y:(r.y-s.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function Pt(e){return e.max-e.min}function $n(e,t=0,n=.01){return Math.abs(e-t)<=n}function sr(e,t,n,s=.5){e.origin=s,e.originPoint=yt(t.min,t.max,e.origin),e.scale=Pt(n)/Pt(t),($n(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=yt(n.min,n.max,e.origin)-e.originPoint,($n(e.translate)||isNaN(e.translate))&&(e.translate=0)}function Ie(e,t,n,s){sr(e.x,t.x,n.x,s?s.originX:void 0),sr(e.y,t.y,n.y,s?s.originY:void 0)}function rr(e,t,n){e.min=n.min+t.min,e.max=e.min+Pt(t)}function Pc(e,t,n){rr(e.x,t.x,n.x),rr(e.y,t.y,n.y)}function ir(e,t,n){e.min=t.min-n.min,e.max=e.min+Pt(t)}function Ee(e,t,n){ir(e.x,t.x,n.x),ir(e.y,t.y,n.y)}function Ic(e,{min:t,max:n},s){return t!==void 0&&e<t?e=s?yt(t,e,s.min):Math.max(e,t):n!==void 0&&e>n&&(e=s?yt(n,e,s.max):Math.min(e,n)),e}function or(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function Ec(e,{top:t,left:n,bottom:s,right:r}){return{x:or(e.x,n,r),y:or(e.y,t,s)}}function ar(e,t){let n=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,s]=[s,n]),{min:n,max:s}}function Ac(e,t){return{x:ar(e.x,t.x),y:ar(e.y,t.y)}}function Rc(e,t){let n=.5;const s=Pt(e),r=Pt(t);return r>s?n=je(t.min,t.max-s,e.min):s>r&&(n=je(e.min,e.max-r,t.min)),Kt(0,1,n)}function Mc(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const Wn=.35;function jc(e=Wn){return e===!1?e=0:e===!0&&(e=Wn),{x:lr(e,"left","right"),y:lr(e,"top","bottom")}}function lr(e,t,n){return{min:cr(e,t),max:cr(e,n)}}function cr(e,t){return typeof e=="number"?e:e[t]||0}const ur=()=>({translate:0,scale:1,origin:0,originPoint:0}),fe=()=>({x:ur(),y:ur()}),hr=()=>({min:0,max:0}),xt=()=>({x:hr(),y:hr()});function Et(e){return[e("x"),e("y")]}function Qi({top:e,left:t,right:n,bottom:s}){return{x:{min:t,max:n},y:{min:e,max:s}}}function Nc({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Dc(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function Tn(e){return e===void 0||e===1}function Hn({scale:e,scaleX:t,scaleY:n}){return!Tn(e)||!Tn(t)||!Tn(n)}function te(e){return Hn(e)||to(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function to(e){return dr(e.x)||dr(e.y)}function dr(e){return e&&e!=="0%"}function nn(e,t,n){const s=e-n,r=t*s;return n+r}function fr(e,t,n,s,r){return r!==void 0&&(e=nn(e,r,s)),nn(e,n,s)+t}function Gn(e,t=0,n=1,s,r){e.min=fr(e.min,t,n,s,r),e.max=fr(e.max,t,n,s,r)}function eo(e,{x:t,y:n}){Gn(e.x,t.translate,t.scale,t.originPoint),Gn(e.y,n.translate,n.scale,n.originPoint)}function Fc(e,t,n,s=!1){const r=n.length;if(!r)return;t.x=t.y=1;let i,o;for(let a=0;a<r;a++){i=n[a],o=i.projectionDelta;const l=i.instance;l&&l.style&&l.style.display==="contents"||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&pe(e,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,eo(e,o)),s&&te(i.latestValues)&&pe(e,i.latestValues))}t.x=pr(t.x),t.y=pr(t.y)}function pr(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function Wt(e,t){e.min=e.min+t,e.max=e.max+t}function mr(e,t,[n,s,r]){const i=t[r]!==void 0?t[r]:.5,o=yt(e.min,e.max,i);Gn(e,t[n],t[s],o,t.scale)}const Oc=["x","scaleX","originX"],Lc=["y","scaleY","originY"];function pe(e,t){mr(e.x,t,Oc),mr(e.y,t,Lc)}function no(e,t){return Qi(Dc(e.getBoundingClientRect(),t))}function zc(e,t,n){const s=no(e,n),{scroll:r}=t;return r&&(Wt(s.x,r.offset.x),Wt(s.y,r.offset.y)),s}const so=({current:e})=>e?e.ownerDocument.defaultView:null,Bc=new WeakMap;class Vc{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=xt(),this.visualElement=t}start(t,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(un(u,"page").point)},i=(u,p)=>{const{drag:m,dragPropagation:f,onDragStart:x}=this.getProps();if(m&&!f&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=gi(m),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Et(v=>{let g=this.getAxisMotionValue(v).get()||0;if(Dt.test(g)){const{projection:w}=this.visualElement;if(w&&w.layout){const k=w.layout.layoutBox[v];k&&(g=Pt(k)*(parseFloat(g)/100))}}this.originPoint[v]=g}),x&&x(u,p);const{animationState:d}=this.visualElement;d&&d.setActive("whileDrag",!0)},o=(u,p)=>{const{dragPropagation:m,dragDirectionLock:f,onDirectionLock:x,onDrag:d}=this.getProps();if(!m&&!this.openGlobalLock)return;const{offset:v}=p;if(f&&this.currentDirection===null){this.currentDirection=Uc(v),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",p.point,v),this.updateAxis("y",p.point,v),this.visualElement.render(),d&&d(u,p)},a=(u,p)=>this.stop(u,p),l=()=>Et(u=>{var p;return this.getAnimationState(u)==="paused"&&((p=this.getAxisMotionValue(u).animation)===null||p===void 0?void 0:p.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new Xi(t,{onSessionStart:r,onStart:i,onMove:o,onSessionEnd:a,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:so(this.visualElement)})}stop(t,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&i(t,n)}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,s){const{drag:r}=this.getProps();if(!s||!He(t,r,this.currentDirection))return;const i=this.getAxisMotionValue(t);let o=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(o=Ic(o,this.constraints[t],this.elastic[t])),i.set(o)}resolveConstraints(){var t;const{dragConstraints:n,dragElastic:s}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,i=this.constraints;n&&he(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&r?this.constraints=Ec(r.layoutBox,n):this.constraints=!1,this.elastic=jc(s),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Et(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=Mc(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!he(t))return!1;const s=t.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=zc(s,r.root,this.visualElement.getTransformPagePoint());let o=Ac(r.layout.layoutBox,i);if(n){const a=n(Nc(o));this.hasMutatedConstraints=!!a,a&&(o=Qi(a))}return o}startAnimation(t){const{drag:n,dragMomentum:s,dragElastic:r,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},c=Et(u=>{if(!He(u,n,this.currentDirection))return;let p=l&&l[u]||{};o&&(p={min:0,max:0});const m=r?200:1e6,f=r?40:1e7,x={type:"inertia",velocity:s?t[u]:0,bounceStiffness:m,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...i,...p};return this.startAxisValueAnimation(u,x)});return Promise.all(c).then(a)}startAxisValueAnimation(t,n){const s=this.getAxisMotionValue(t);return s.start(ks(t,s,0,n,this.visualElement))}stopAnimation(){Et(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Et(t=>{var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,s=this.visualElement.getProps(),r=s[n];return r||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){Et(n=>{const{drag:s}=this.getProps();if(!He(n,s,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[n];i.set(t[n]-yt(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!he(n)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Et(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();r[o]=Rc({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Et(o=>{if(!He(o,t,null))return;const a=this.getAxisMotionValue(o),{min:l,max:c}=this.constraints[o];a.set(yt(l,c,r[o]))})}addListeners(){if(!this.visualElement.current)return;Bc.set(this.visualElement,this);const t=this.visualElement.current,n=Lt(t,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();he(l)&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",s);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),s();const o=Ot(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",(({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(Et(u=>{const p=this.getAxisMotionValue(u);p&&(this.originPoint[u]+=l[u].translate,p.set(p.get()+l[u].translate))}),this.visualElement.render())}));return()=>{o(),n(),i(),a&&a()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:o=Wn,dragMomentum:a=!0}=t;return{...t,drag:n,dragDirectionLock:s,dragPropagation:r,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function He(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function Uc(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class $c extends Xt{constructor(t){super(t),this.removeGroupControls=Tt,this.removeListeners=Tt,this.controls=new Vc(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Tt}unmount(){this.removeGroupControls(),this.removeListeners()}}const gr=e=>(t,n)=>{e&&e(t,n)};class Wc extends Xt{constructor(){super(...arguments),this.removePointerDownListener=Tt}onPointerDown(t){this.session=new Xi(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:so(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:gr(t),onStart:gr(n),onMove:s,onEnd:(i,o)=>{delete this.session,r&&r(i,o)}}}mount(){this.removePointerDownListener=Lt(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function Hc(){const e=R.useContext(an);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:s}=e,r=R.useId();return R.useEffect(()=>s(r),[]),!t&&n?[!1,()=>n&&n(r)]:[!0]}const Ze={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function yr(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const _e={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(ct.test(e))e=parseFloat(e);else return e;const n=yr(e,t.target.x),s=yr(e,t.target.y);return`${n}% ${s}%`}},Gc={correct:(e,{treeScale:t,projectionDelta:n})=>{const s=e,r=Yt.parse(e);if(r.length>5)return s;const i=Yt.createTransformer(e),o=typeof r[0]!="number"?1:0,a=n.x.scale*t.x,l=n.y.scale*t.y;r[0+o]/=a,r[1+o]/=l;const c=yt(a,l,.5);return typeof r[2+o]=="number"&&(r[2+o]/=c),typeof r[3+o]=="number"&&(r[3+o]/=c),i(r)}};class qc extends R.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s,layoutId:r}=this.props,{projection:i}=t;Ho(Kc),i&&(n.group&&n.group.add(i),s&&s.register&&r&&s.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Ze.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:s,drag:r,isPresent:i}=this.props,o=s.projection;return o&&(o.isPresent=i,r||t.layoutDependency!==n||n===void 0?o.willUpdate():this.safeToRemove(),t.isPresent!==i&&(i?o.promote():o.relegate()||wt.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),ts.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:r}=t;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function ro(e){const[t,n]=Hc(),s=R.useContext(ss);return I.jsx(qc,{...e,layoutGroup:s,switchLayoutGroup:R.useContext(ti),isPresent:t,safeToRemove:n})}const Kc={borderRadius:{..._e,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:_e,borderTopRightRadius:_e,borderBottomLeftRadius:_e,borderBottomRightRadius:_e,boxShadow:Gc},io=["TopLeft","TopRight","BottomLeft","BottomRight"],Zc=io.length,vr=e=>typeof e=="string"?parseFloat(e):e,xr=e=>typeof e=="number"||ct.test(e);function Yc(e,t,n,s,r,i){r?(e.opacity=yt(0,n.opacity!==void 0?n.opacity:1,Xc(s)),e.opacityExit=yt(t.opacity!==void 0?t.opacity:1,0,Jc(s))):i&&(e.opacity=yt(t.opacity!==void 0?t.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let o=0;o<Zc;o++){const a=`border${io[o]}Radius`;let l=wr(t,a),c=wr(n,a);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||xr(l)===xr(c)?(e[a]=Math.max(yt(vr(l),vr(c),s),0),(Dt.test(c)||Dt.test(l))&&(e[a]+="%")):e[a]=c}(t.rotate||n.rotate)&&(e.rotate=yt(t.rotate||0,n.rotate||0,s))}function wr(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Xc=oo(0,.5,$i),Jc=oo(.5,.95,Tt);function oo(e,t,n){return s=>s<e?0:s>t?1:n(je(e,t,s))}function br(e,t){e.min=t.min,e.max=t.max}function It(e,t){br(e.x,t.x),br(e.y,t.y)}function kr(e,t,n,s,r){return e-=t,e=nn(e,1/n,s),r!==void 0&&(e=nn(e,1/r,s)),e}function Qc(e,t=0,n=1,s=.5,r,i=e,o=e){if(Dt.test(t)&&(t=parseFloat(t),t=yt(o.min,o.max,t/100)-o.min),typeof t!="number")return;let a=yt(i.min,i.max,s);e===i&&(a-=t),e.min=kr(e.min,t,n,a,r),e.max=kr(e.max,t,n,a,r)}function _r(e,t,[n,s,r],i,o){Qc(e,t[n],t[s],t[r],t.scale,i,o)}const tu=["x","scaleX","originX"],eu=["y","scaleY","originY"];function Sr(e,t,n,s){_r(e.x,t,tu,n?n.x:void 0,s?s.x:void 0),_r(e.y,t,eu,n?n.y:void 0,s?s.y:void 0)}function Tr(e){return e.translate===0&&e.scale===1}function ao(e){return Tr(e.x)&&Tr(e.y)}function nu(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function lo(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function Cr(e){return Pt(e.x)/Pt(e.y)}class su{constructor(){this.members=[]}add(t){_s(this.members,t),t.scheduleRender()}remove(t){if(Ss(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(r=>t===r);if(n===0)return!1;let s;for(let r=n;r>=0;r--){const i=this.members[r];if(i.isPresent!==!1){s=i;break}}return s?(this.promote(s),!0):!1}promote(t,n){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,n&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:r}=t.options;r===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:s}=t;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Pr(e,t,n){let s="";const r=e.x.translate/t.x,i=e.y.translate/t.y,o=(n==null?void 0:n.z)||0;if((r||i||o)&&(s=`translate3d(${r}px, ${i}px, ${o}px) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:c,rotate:u,rotateX:p,rotateY:m,skewX:f,skewY:x}=n;c&&(s=`perspective(${c}px) ${s}`),u&&(s+=`rotate(${u}deg) `),p&&(s+=`rotateX(${p}deg) `),m&&(s+=`rotateY(${m}deg) `),f&&(s+=`skewX(${f}deg) `),x&&(s+=`skewY(${x}deg) `)}const a=e.x.scale*t.x,l=e.y.scale*t.y;return(a!==1||l!==1)&&(s+=`scale(${a}, ${l})`),s||"none"}const ru=(e,t)=>e.depth-t.depth;class iu{constructor(){this.children=[],this.isDirty=!1}add(t){_s(this.children,t),this.isDirty=!0}remove(t){Ss(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(ru),this.isDirty=!1,this.children.forEach(t)}}function ou(e,t){const n=qt.now(),s=({timestamp:r})=>{const i=r-n;i>=t&&(Zt(s),e(i-t))};return wt.read(s,!0),()=>Zt(s)}function au(e){window.MotionDebug&&window.MotionDebug.record(e)}function lu(e){return e instanceof SVGElement&&e.tagName!=="svg"}function cu(e,t,n){const s=St(e)?e:Ne(e);return s.start(ks("",s,t,n)),s.animation}const Cn=["","X","Y","Z"],uu={visibility:"hidden"},Ir=1e3;let hu=0;const ee={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function Pn(e,t,n,s){const{latestValues:r}=t;r[e]&&(n[e]=r[e],t.setStaticValue(e,0),s&&(s[e]=0))}function co({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:s,resetTransform:r}){return class{constructor(o={},a=t==null?void 0:t()){this.id=hu++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ee.totalNodes=ee.resolvedTargetDeltas=ee.recalculatedProjection=0,this.nodes.forEach(pu),this.nodes.forEach(xu),this.nodes.forEach(wu),this.nodes.forEach(mu),au(ee)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new iu)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new Ts),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=lu(o),this.instance=o;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(c||l)&&(this.isLayoutDirty=!0),e){let p;const m=()=>this.root.updateBlockedByResize=!1;e(o,()=>{this.root.updateBlockedByResize=!0,p&&p(),p=ou(m,250),Ze.hasAnimatedSinceResize&&(Ze.hasAnimatedSinceResize=!1,this.nodes.forEach(Ar))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:p,hasLayoutChanged:m,hasRelativeTargetChanged:f,layout:x})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const d=this.options.transition||u.getDefaultTransition()||Tu,{onLayoutAnimationStart:v,onLayoutAnimationComplete:g}=u.getProps(),w=!this.targetLayout||!lo(this.targetLayout,x)||f,k=!m&&f;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||k||m&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(p,k);const P={...fs(d,"layout"),onPlay:v,onComplete:g};(u.shouldReduceMotion||this.options.layoutRoot)&&(P.delay=0,P.type=!1),this.startAnimation(P)}else m||Ar(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=x})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Zt(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(bu),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const p=this.path[u];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Er);return}this.isUpdating||this.nodes.forEach(yu),this.isUpdating=!1,window.HandoffCancelAllAnimations&&window.HandoffCancelAllAnimations(),this.nodes.forEach(vu),this.nodes.forEach(du),this.nodes.forEach(fu),this.clearAllSnapshots();const a=qt.now();bt.delta=Kt(0,1e3/60,a-bt.timestamp),bt.timestamp=a,bt.isProcessing=!0,gn.update.process(bt),gn.preRender.process(bt),gn.render.process(bt),bt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,ts.read(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(gu),this.sharedNodes.forEach(ku)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,wt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){wt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=xt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&(this.scroll={animationId:this.root.animationId,phase:o,isRoot:s(this.instance),offset:n(this.instance)})}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform,a=this.projectionDelta&&!ao(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;o&&(a||te(this.latestValues)||u)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),Cu(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return xt();const a=o.measureViewportBox(),{scroll:l}=this.root;return l&&(Wt(a.x,l.offset.x),Wt(a.y,l.offset.y)),a}removeElementScroll(o){const a=xt();It(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:u,options:p}=c;if(c!==this.root&&u&&p.layoutScroll){if(u.isRoot){It(a,o);const{scroll:m}=this.root;m&&(Wt(a.x,-m.offset.x),Wt(a.y,-m.offset.y))}Wt(a.x,u.offset.x),Wt(a.y,u.offset.y)}}return a}applyTransform(o,a=!1){const l=xt();It(l,o);for(let c=0;c<this.path.length;c++){const u=this.path[c];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&pe(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),te(u.latestValues)&&pe(l,u.latestValues)}return te(this.latestValues)&&pe(l,this.latestValues),l}removeTransform(o){const a=xt();It(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!te(c.latestValues))continue;Hn(c.latestValues)&&c.updateSnapshot();const u=xt(),p=c.measurePageBox();It(u,p),Sr(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return te(this.latestValues)&&Sr(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==bt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:p,layoutId:m}=this.options;if(!(!this.layout||!(p||m))){if(this.resolvedRelativeTargetAt=bt.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=xt(),this.relativeTargetOrigin=xt(),Ee(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),It(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=xt(),this.targetWithTransforms=xt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Pc(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):It(this.target,this.layout.layoutBox),eo(this.target,this.targetDelta)):It(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=xt(),this.relativeTargetOrigin=xt(),Ee(this.relativeTargetOrigin,this.target,f.target),It(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ee.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Hn(this.parent.latestValues)||to(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===bt.timestamp&&(c=!1),c)return;const{layout:u,layoutId:p}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||p))return;It(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,f=this.treeScale.y;Fc(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=xt());const{target:x}=a;if(!x){this.projectionTransform&&(this.projectionDelta=fe(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=fe(),this.projectionDeltaWithTransform=fe());const d=this.projectionTransform;Ie(this.projectionDelta,this.layoutCorrected,x,this.latestValues),this.projectionTransform=Pr(this.projectionDelta,this.treeScale),(this.projectionTransform!==d||this.treeScale.x!==m||this.treeScale.y!==f)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",x)),ee.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),o){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(o,a=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},p=fe();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const m=xt(),f=l?l.source:void 0,x=this.layout?this.layout.source:void 0,d=f!==x,v=this.getStack(),g=!v||v.members.length<=1,w=!!(d&&!g&&this.options.crossfade===!0&&!this.path.some(Su));this.animationProgress=0;let k;this.mixTargetDelta=P=>{const T=P/1e3;Rr(p.x,o.x,T),Rr(p.y,o.y,T),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ee(m,this.layout.layoutBox,this.relativeParent.layout.layoutBox),_u(this.relativeTarget,this.relativeTargetOrigin,m,T),k&&nu(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=xt()),It(k,this.relativeTarget)),d&&(this.animationValues=u,Yc(u,c,this.latestValues,T,w,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Zt(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=wt.update(()=>{Ze.hasAnimatedSinceResize=!0,this.currentAnimation=cu(0,Ir,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Ir),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:c,latestValues:u}=o;if(!(!a||!l||!c)){if(this!==o&&this.layout&&c&&uo(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||xt();const p=Pt(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+p;const m=Pt(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+m}It(a,l),pe(a,u),Ie(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new su),this.sharedNodes.get(o).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const c={};l.z&&Pn("z",o,c,this.animationValues);for(let u=0;u<Cn.length;u++)Pn(`rotate${Cn[u]}`,o,c,this.animationValues),Pn(`skew${Cn[u]}`,o,c,this.animationValues);o.render();for(const u in c)o.setStaticValue(u,c[u]),this.animationValues&&(this.animationValues[u]=c[u]);o.scheduleRender()}getProjectionStyles(o){var a,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return uu;const c={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=qe(o==null?void 0:o.pointerEvents)||"",c.transform=u?u(this.latestValues,""):"none",c;const p=this.getLead();if(!this.projectionDelta||!this.layout||!p.target){const d={};return this.options.layoutId&&(d.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,d.pointerEvents=qe(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!te(this.latestValues)&&(d.transform=u?u({},""):"none",this.hasProjected=!1),d}const m=p.animationValues||p.latestValues;this.applyTransformsToTarget(),c.transform=Pr(this.projectionDeltaWithTransform,this.treeScale,m),u&&(c.transform=u(m,c.transform));const{x:f,y:x}=this.projectionDelta;c.transformOrigin=`${f.origin*100}% ${x.origin*100}% 0`,p.animationValues?c.opacity=p===this?(l=(a=m.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:c.opacity=p===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const d in Ye){if(m[d]===void 0)continue;const{correct:v,applyTo:g}=Ye[d],w=c.transform==="none"?m[d]:v(m[d],p);if(g){const k=g.length;for(let P=0;P<k;P++)c[g[P]]=w}else c[d]=w}return this.options.layoutId&&(c.pointerEvents=p===this?qe(o==null?void 0:o.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(Er),this.root.sharedNodes.clear()}}}function du(e){e.updateLayout()}function fu(e){var t;const n=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:r}=e.layout,{animationType:i}=e.options,o=n.source!==e.layout.source;i==="size"?Et(p=>{const m=o?n.measuredBox[p]:n.layoutBox[p],f=Pt(m);m.min=s[p].min,m.max=m.min+f}):uo(i,n.layoutBox,s)&&Et(p=>{const m=o?n.measuredBox[p]:n.layoutBox[p],f=Pt(s[p]);m.max=m.min+f,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[p].max=e.relativeTarget[p].min+f)});const a=fe();Ie(a,s,n.layoutBox);const l=fe();o?Ie(l,e.applyTransform(r,!0),n.measuredBox):Ie(l,s,n.layoutBox);const c=!ao(a);let u=!1;if(!e.resumeFrom){const p=e.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:m,layout:f}=p;if(m&&f){const x=xt();Ee(x,n.layoutBox,m.layoutBox);const d=xt();Ee(d,s,f.layoutBox),lo(x,d)||(u=!0),p.options.layoutRoot&&(e.relativeTarget=d,e.relativeTargetOrigin=x,e.relativeParent=p)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:s}=e.options;s&&s()}e.options.transition=void 0}function pu(e){ee.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function mu(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function gu(e){e.clearSnapshot()}function Er(e){e.clearMeasurements()}function yu(e){e.isLayoutDirty=!1}function vu(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Ar(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function xu(e){e.resolveTargetDelta()}function wu(e){e.calcProjection()}function bu(e){e.resetSkewAndRotation()}function ku(e){e.removeLeadSnapshot()}function Rr(e,t,n){e.translate=yt(t.translate,0,n),e.scale=yt(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function Mr(e,t,n,s){e.min=yt(t.min,n.min,s),e.max=yt(t.max,n.max,s)}function _u(e,t,n,s){Mr(e.x,t.x,n.x,s),Mr(e.y,t.y,n.y,s)}function Su(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Tu={duration:.45,ease:[.4,0,.1,1]},jr=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Nr=jr("applewebkit/")&&!jr("chrome/")?Math.round:Tt;function Dr(e){e.min=Nr(e.min),e.max=Nr(e.max)}function Cu(e){Dr(e.x),Dr(e.y)}function uo(e,t,n){return e==="position"||e==="preserve-aspect"&&!$n(Cr(t),Cr(n),.2)}const Pu=co({attachResizeListener:(e,t)=>Ot(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),In={current:void 0},ho=co({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!In.current){const e=new Pu({});e.mount(window),e.setOptions({layoutScroll:!0}),In.current=e}return In.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Iu={pan:{Feature:Wc},drag:{Feature:$c,ProjectionNode:ho,MeasureLayout:ro}},qn={current:null},fo={current:!1};function Eu(){if(fo.current=!0,!!Xn)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>qn.current=e.matches;e.addListener(t),t()}else qn.current=!1}function Au(e,t,n){const{willChange:s}=t;for(const r in t){const i=t[r],o=n[r];if(St(i))e.addValue(r,i),en(s)&&s.add(r);else if(St(o))e.addValue(r,Ne(i,{owner:e})),en(s)&&s.remove(r);else if(o!==i)if(e.hasValue(r)){const a=e.getValue(r);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=e.getStaticValue(r);e.addValue(r,Ne(a!==void 0?a:i,{owner:e}))}}for(const r in n)t[r]===void 0&&e.removeValue(r);return t}const Fr=new WeakMap,Ru=[...Ti,_t,Yt],Mu=e=>Ru.find(Si(e)),po=Object.keys(Me),ju=po.length,Or=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],Nu=ns.length;function mo(e){if(e)return e.options.allowProjection!==!1?e.projection:mo(e.parent)}class Du{scrapeMotionValuesFromProps(t,n,s){return{}}constructor({parent:t,props:n,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:i,visualState:o},a={}){this.resolveKeyframes=(m,f,x,d)=>new this.KeyframeResolver(m,f,x,d,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=ps,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>wt.render(this.render,!1,!0);const{latestValues:l,renderState:c}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=n,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=cn(n),this.isVariantNode=Qr(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:u,...p}=this.scrapeMotionValuesFromProps(n,{},this);for(const m in p){const f=p[m];l[m]!==void 0&&St(f)&&(f.set(l[m],!1),en(u)&&u.add(m))}}mount(t){this.current=t,Fr.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),fo.current||Eu(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:qn.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){var t;Fr.delete(this.current),this.projection&&this.projection.unmount(),Zt(this.notifyUpdate),Zt(this.render),this.valueSubscriptions.forEach(n=>n()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const n in this.events)this.events[n].clear();for(const n in this.features)(t=this.features[n])===null||t===void 0||t.unmount();this.current=null}bindToMotionValue(t,n){const s=le.has(t),r=n.on("change",o=>{this.latestValues[t]=o,this.props.onUpdate&&wt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),i=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{r(),i(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...n},s,r,i){let o,a;for(let l=0;l<ju;l++){const c=po[l],{isEnabled:u,Feature:p,ProjectionNode:m,MeasureLayout:f}=Me[c];m&&(o=m),u(n)&&(!this.features[c]&&p&&(this.features[c]=new p(this)),f&&(a=f))}if((this.type==="html"||this.type==="svg")&&!this.projection&&o){this.projection=new o(this.latestValues,mo(this.parent));const{layoutId:l,layout:c,drag:u,dragConstraints:p,layoutScroll:m,layoutRoot:f}=n;this.projection.setOptions({layoutId:l,layout:c,alwaysMeasureLayout:!!u||p&&he(p),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof c=="string"?c:"both",initialPromotionConfig:i,layoutScroll:m,layoutRoot:f})}return a}updateFeatures(){for(const t in this.features){const n=this.features[t];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):xt()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<Or.length;s++){const r=Or[s];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const i="on"+r,o=t[i];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=Au(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const s=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(s.initial=this.props.initial),s}const n={};for(let s=0;s<Nu;s++){const r=ns[s],i=this.props[r];(Re(i)||i===!1)&&(n[r]=i)}return n}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const s=this.values.get(t);n!==s&&(s&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&n!==void 0&&(s=Ne(n===null?void 0:n,{owner:this}),this.addValue(t,s)),s}readValue(t,n){var s;let r=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(s=this.getBaseTargetFromProps(this.props,t))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,t,this.options);return r!=null&&(typeof r=="string"&&(ki(r)||wi(r))?r=parseFloat(r):!Mu(r)&&Yt.test(n)&&(r=ji(t,n)),this.setBaseTarget(t,St(r)?r.get():r)),St(r)?r.get():r}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var n;const{initial:s}=this.props;let r;if(typeof s=="string"||typeof s=="object"){const o=ds(this.props,s,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);o&&(r=o[t])}if(s&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,t);return i!==void 0&&!St(i)?i:this.initialValues[t]!==void 0&&r===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new Ts),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}}class go extends Du{constructor(){super(...arguments),this.KeyframeResolver=Ni}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:s}){delete n[t],delete s[t]}}function Fu(e){return window.getComputedStyle(e)}class Ou extends go{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,n){if(le.has(n)){const s=gs(n);return s&&s.default||0}else{const s=Fu(t),r=(si(n)?s.getPropertyValue(n):s[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(t,{transformPagePoint:n}){return no(t,n)}build(t,n,s,r){as(t,n,s,r.transformTemplate)}scrapeMotionValuesFromProps(t,n,s){return hs(t,n,s)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;St(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(t,n,s,r){li(t,n,s,r)}}class Lu extends go{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(le.has(n)){const s=gs(n);return s&&s.default||0}return n=ci.has(n)?n:Qn(n),t.getAttribute(n)}measureInstanceViewportBox(){return xt()}scrapeMotionValuesFromProps(t,n,s){return hi(t,n,s)}build(t,n,s,r){cs(t,n,s,this.isSVGTag,r.transformTemplate)}renderInstance(t,n,s,r){ui(t,n,s,r)}mount(t){this.isSVGTag=us(t.tagName),super.mount(t)}}const zu=(e,t)=>rs(e)?new Lu(t,{enableHardwareAcceleration:!1}):new Ou(t,{allowProjection:e!==R.Fragment,enableHardwareAcceleration:!0}),Bu={layout:{ProjectionNode:ho,MeasureLayout:ro}},Vu={..._c,...ja,...Iu,...Bu},Uu=$o((e,t)=>wa(e,t,Vu,zu));function yo(){const e=R.useRef(!1);return Jn(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function $u(){const e=yo(),[t,n]=R.useState(0),s=R.useCallback(()=>{e.current&&n(t+1)},[t]);return[R.useCallback(()=>wt.postRender(s),[s]),t]}class Wu extends R.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Hu({children:e,isPresent:t}){const n=R.useId(),s=R.useRef(null),r=R.useRef({width:0,height:0,top:0,left:0}),{nonce:i}=R.useContext(Yn);return R.useInsertionEffect(()=>{const{width:o,height:a,top:l,left:c}=r.current;if(t||!s.current||!o||!a)return;s.current.dataset.motionPopId=n;const u=document.createElement("style");return i&&(u.nonce=i),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${a}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[t]),I.jsx(Wu,{isPresent:t,childRef:s,sizeRef:r,children:R.cloneElement(e,{ref:s})})}const En=({children:e,initial:t,isPresent:n,onExitComplete:s,custom:r,presenceAffectsLayout:i,mode:o})=>{const a=di(Gu),l=R.useId(),c=R.useMemo(()=>({id:l,initial:t,isPresent:n,custom:r,onExitComplete:u=>{a.set(u,!0);for(const p of a.values())if(!p)return;s&&s()},register:u=>(a.set(u,!1),()=>a.delete(u))}),i?[Math.random()]:[n]);return R.useMemo(()=>{a.forEach((u,p)=>a.set(p,!1))},[n]),R.useEffect(()=>{!n&&!a.size&&s&&s()},[n]),o==="popLayout"&&(e=I.jsx(Hu,{isPresent:n,children:e})),I.jsx(an.Provider,{value:c,children:e})};function Gu(){return new Map}function qu(e){return R.useEffect(()=>()=>e(),[])}const ne=e=>e.key||"";function Ku(e,t){e.forEach(n=>{const s=ne(n);t.set(s,n)})}function Zu(e){const t=[];return R.Children.forEach(e,n=>{R.isValidElement(n)&&t.push(n)}),t}const _d=({children:e,custom:t,initial:n=!0,onExitComplete:s,exitBeforeEnter:r,presenceAffectsLayout:i=!0,mode:o="sync"})=>{const a=R.useContext(ss).forceRender||$u()[0],l=yo(),c=Zu(e);let u=c;const p=R.useRef(new Map).current,m=R.useRef(u),f=R.useRef(new Map).current,x=R.useRef(!0);if(Jn(()=>{x.current=!1,Ku(c,f),m.current=u}),qu(()=>{x.current=!0,f.clear(),p.clear()}),x.current)return I.jsx(I.Fragment,{children:u.map(w=>I.jsx(En,{isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:i,mode:o,children:w},ne(w)))});u=[...u];const d=m.current.map(ne),v=c.map(ne),g=d.length;for(let w=0;w<g;w++){const k=d[w];v.indexOf(k)===-1&&!p.has(k)&&p.set(k,void 0)}return o==="wait"&&p.size&&(u=[]),p.forEach((w,k)=>{if(v.indexOf(k)!==-1)return;const P=f.get(k);if(!P)return;const T=d.indexOf(k);let N=w;if(!N){const M=()=>{p.delete(k);const B=Array.from(f.keys()).filter(F=>!v.includes(F));if(B.forEach(F=>f.delete(F)),m.current=c.filter(F=>{const H=ne(F);return H===k||B.includes(H)}),!p.size){if(l.current===!1)return;a(),s&&s()}};N=I.jsx(En,{isPresent:!1,onExitComplete:M,custom:t,presenceAffectsLayout:i,mode:o,children:P},ne(P)),p.set(k,N)}u.splice(T,0,N)}),u=u.map(w=>{const k=w.key;return p.has(k)?w:I.jsx(En,{isPresent:!0,presenceAffectsLayout:i,mode:o,children:w},ne(w))}),I.jsx(I.Fragment,{children:p.size?u:u.map(w=>R.cloneElement(w))})},Sd=e=>!e||!/^#[0-9A-F]{6}$/i.test(e)?"#E25822":e,Te=e=>e?(e.match(/([^\s]+)/g)||[]).length:0;/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yu=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Xu=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,s)=>s?s.toUpperCase():n.toLowerCase()),Lr=e=>{const t=Xu(e);return t.charAt(0).toUpperCase()+t.slice(1)},vo=(...e)=>e.filter((t,n,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===n).join(" ").trim(),Ju=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const th=R.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:o,...a},l)=>R.createElement("svg",{ref:l,...Qu,width:t,height:t,stroke:e,strokeWidth:s?Number(n)*24/Number(t):n,className:vo("lucide",r),...!i&&!Ju(a)&&{"aria-hidden":"true"},...a},[...o.map(([c,u])=>R.createElement(c,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=(e,t)=>{const n=R.forwardRef(({className:s,...r},i)=>R.createElement(th,{ref:i,iconNode:t,className:vo(`lucide-${Yu(Lr(e))}`,`lucide-${e}`,s),...r}));return n.displayName=Lr(e),n};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eh=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Td=pt("arrow-left",eh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nh=[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],Cd=pt("book-marked",nh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sh=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Pd=pt("book-open",sh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rh=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]],Id=pt("bookmark-check",rh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ed=pt("check",ih);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oh=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ah=pt("chevron-down",oh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ch=pt("chevron-left",lh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ad=pt("chevron-right",uh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hh=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Rd=pt("circle-alert",hh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dh=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Md=pt("circle-check-big",dh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fh=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],jd=pt("cloud-download",fh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ph=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],zr=pt("cloud",ph);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mh=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Nd=pt("download",mh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]],Dd=pt("file-plus",gh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yh=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Fd=pt("heart",yh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vh=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Od=pt("layout-grid",vh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xh=[["rect",{width:"8",height:"18",x:"3",y:"3",rx:"1",key:"oynpb5"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M20.4 18.9c.2.5-.1 1.1-.6 1.3l-1.9.7c-.5.2-1.1-.1-1.3-.6L11.1 5.1c-.2-.5.1-1.1.6-1.3l1.9-.7c.5-.2 1.1.1 1.3.6Z",key:"1qboyk"}]],Ld=pt("library-big",xh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wh=[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]],zd=pt("library",wh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bh=[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M11 19H3",key:"zflm78"}],["path",{d:"M21 16V5",key:"yxg4q8"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],kh=pt("list-music",bh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _h=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Bd=pt("loader-circle",_h);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sh=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Vd=pt("lock",Sh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Th=[["path",{d:"M5 12h14",key:"1ays0h"}]],xo=pt("minus",Th);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ch=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],Ph=pt("palette",Ch);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ih=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Eh=pt("pause",Ih);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ah=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Rh=pt("play",Ah);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mh=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],wo=pt("plus",Mh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jh=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ud=pt("refresh-cw",jh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nh=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],$d=pt("search",Nh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dh=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Wd=pt("settings",Dh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fh=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],Oh=pt("skip-back",Fh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lh=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],zh=pt("sparkles",Lh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bh=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Hd=pt("square-check-big",Bh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vh=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Gd=pt("trash-2",Vh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uh=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],qd=pt("triangle-alert",Uh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $h=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Ae=pt("type",$h);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wh=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Hh=pt("x",Wh);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gh=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],qh=pt("zap",Gh),ue={Modern:{background:"#F2F2F7",surface:"#FFFFFF",primaryText:"#000000",secondaryText:"#8A8A8E",accent:"#E25822",dimmer:"rgba(255,255,255,0.85)",borderColor:"#E5E5EA"},Sepia:{background:"#F8F1E3",surface:"#FFFDF5",primaryText:"#5C4033",secondaryText:"#8C7356",accent:"#D45D48",dimmer:"rgba(248,241,227,0.9)",borderColor:"#E6DCC8"},Night:{background:"#000000",surface:"#1C1C1E",primaryText:"#F2F2F7",secondaryText:"#8E8E93",accent:"#E25822",dimmer:"rgba(0,0,0,0.8)",borderColor:"#2C2C2E"},OLED:{background:"#000000",surface:"#121212",primaryText:"#FFFFFF",secondaryText:"#888888",accent:"#E25822",dimmer:"rgba(0,0,0,0.9)",borderColor:"#333333"},System:{background:"#F2F2F7",surface:"#FFFFFF",primaryText:"#000000",secondaryText:"#8A8A8E",accent:"#E25822",dimmer:"rgba(255,255,255,0.9)",borderColor:"#E5E5EA"}};class re{constructor(){this.listeners=new Set,this._mode="Modern";try{const t=localStorage.getItem("titan_theme_mode");t&&Object.keys(ue).concat(["System"]).includes(t)&&(this._mode=t)}catch(t){console.warn("[TitanTheme] Failed to load theme preference",t)}}static getInstance(){return re.instance||(re.instance=new re),re.instance}get mode(){return this._mode}setMode(t){this._mode=t;try{localStorage.setItem("titan_theme_mode",t)}catch(n){console.warn("[TitanTheme] Failed to save theme preference",n)}this.notify()}get currentColors(){return this._mode==="System"?typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?ue.Night:ue.Modern:ue[this._mode]||ue.Modern}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t())}}const Jt=()=>{const e=re.getInstance(),[t,n]=R.useState(e.currentColors);return R.useEffect(()=>{const s=()=>n(e.currentColors);return e.subscribe(s)},[]),t};class Ct{constructor(){this.listeners=new Set,this.STORAGE_KEY="titan_reader_prefs_v15_true_book",this.config=this.loadFromStorage()}static getInstance(){return Ct.instance||(Ct.instance=new Ct),Ct.instance}getDefaultConfig(){return{id:"user-default",themeMode:"System",fontFamily:"New York",fontSize:18,lineHeight:1.35,paragraphSpacing:10,motionBlurIntensity:.05,showReflections:!1,rsvpSpeed:200,hasCustomSpeed:!1,rsvpChunkSize:1,isRSVPContextEnabled:!0,rsvpColorHighlight:"#FF3B30"}}loadFromStorage(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(t){const n=JSON.parse(t),s={...this.getDefaultConfig(),...n};return s.hasCustomSpeed||(s.rsvpSpeed=200),s}}catch(t){console.warn("[TitanSettings] Failed to load config",t)}return this.getDefaultConfig()}saveToStorage(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.config))}catch(t){console.warn("[TitanSettings] Failed to save config",t)}}getSettings(){return{...this.config}}updateSettings(t){this.config={...this.config,...t},this.saveToStorage(),this.notify()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t())}}const ze=()=>{const e=Ct.getInstance(),[t,n]=R.useState(e.getSettings());return R.useEffect(()=>{const s=()=>n(e.getSettings());return e.subscribe(s)},[]),{settings:t,updateSettings:s=>e.updateSettings(s)}};function Ge(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var An={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Br;function Kh(){return Br||(Br=1,(function(e,t){(function(n){e.exports=n()})(function(){return(function n(s,r,i){function o(c,u){if(!r[c]){if(!s[c]){var p=typeof Ge=="function"&&Ge;if(!u&&p)return p(c,!0);if(a)return a(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var f=r[c]={exports:{}};s[c][0].call(f.exports,function(x){var d=s[c][1][x];return o(d||x)},f,f.exports,n,s,r,i)}return r[c].exports}for(var a=typeof Ge=="function"&&Ge,l=0;l<i.length;l++)o(i[l]);return o})({1:[function(n,s,r){var i=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(l){for(var c,u,p,m,f,x,d,v=[],g=0,w=l.length,k=w,P=i.getTypeOf(l)!=="string";g<l.length;)k=w-g,p=P?(c=l[g++],u=g<w?l[g++]:0,g<w?l[g++]:0):(c=l.charCodeAt(g++),u=g<w?l.charCodeAt(g++):0,g<w?l.charCodeAt(g++):0),m=c>>2,f=(3&c)<<4|u>>4,x=1<k?(15&u)<<2|p>>6:64,d=2<k?63&p:64,v.push(a.charAt(m)+a.charAt(f)+a.charAt(x)+a.charAt(d));return v.join("")},r.decode=function(l){var c,u,p,m,f,x,d=0,v=0,g="data:";if(l.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var w,k=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&k--,l.charAt(l.length-2)===a.charAt(64)&&k--,k%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=o.uint8array?new Uint8Array(0|k):new Array(0|k);d<l.length;)c=a.indexOf(l.charAt(d++))<<2|(m=a.indexOf(l.charAt(d++)))>>4,u=(15&m)<<4|(f=a.indexOf(l.charAt(d++)))>>2,p=(3&f)<<6|(x=a.indexOf(l.charAt(d++))),w[v++]=c,f!==64&&(w[v++]=u),x!==64&&(w[v++]=p);return w}},{"./support":30,"./utils":32}],2:[function(n,s,r){var i=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),l=n("./stream/DataLengthProbe");function c(u,p,m,f,x){this.compressedSize=u,this.uncompressedSize=p,this.crc32=m,this.compression=f,this.compressedContent=x}c.prototype={getContentWorker:function(){var u=new o(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),p=this;return u.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(u,p,m){return u.pipe(new a).pipe(new l("uncompressedSize")).pipe(p.compressWorker(m)).pipe(new l("compressedSize")).withStreamInfo("compression",p)},s.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,s,r){var i=n("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,s,r){var i=n("./utils"),o=(function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l})();s.exports=function(a,l){return a!==void 0&&a.length?i.getTypeOf(a)!=="string"?(function(c,u,p,m){var f=o,x=m+p;c^=-1;for(var d=m;d<x;d++)c=c>>>8^f[255&(c^u[d])];return-1^c})(0|l,a,a.length,0):(function(c,u,p,m){var f=o,x=m+p;c^=-1;for(var d=m;d<x;d++)c=c>>>8^f[255&(c^u.charCodeAt(d))];return-1^c})(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(n,s,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(n,s,r){var i=null;i=typeof Promise<"u"?Promise:n("lie"),s.exports={Promise:i}},{lie:37}],7:[function(n,s,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),l=n("./stream/GenericWorker"),c=i?"uint8array":"array";function u(p,m){l.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=m,this.meta={}}r.magic="\b\0",a.inherits(u,l),u.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,p.data),!1)},u.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(m){p.push({data:m,meta:p.meta})}},r.compressWorker=function(p){return new u("Deflate",p)},r.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,s,r){function i(f,x){var d,v="";for(d=0;d<x;d++)v+=String.fromCharCode(255&f),f>>>=8;return v}function o(f,x,d,v,g,w){var k,P,T=f.file,N=f.compression,M=w!==c.utf8encode,B=a.transformTo("string",w(T.name)),F=a.transformTo("string",c.utf8encode(T.name)),H=T.comment,et=a.transformTo("string",w(H)),E=a.transformTo("string",c.utf8encode(H)),O=F.length!==T.name.length,y=E.length!==H.length,L="",Q="",$="",nt=T.dir,q=T.date,rt={crc32:0,compressedSize:0,uncompressedSize:0};x&&!d||(rt.crc32=f.crc32,rt.compressedSize=f.compressedSize,rt.uncompressedSize=f.uncompressedSize);var b=0;x&&(b|=8),M||!O&&!y||(b|=2048);var C=0,K=0;nt&&(C|=16),g==="UNIX"?(K=798,C|=(function(G,ot){var J=G;return G||(J=ot?16893:33204),(65535&J)<<16})(T.unixPermissions,nt)):(K=20,C|=(function(G){return 63&(G||0)})(T.dosPermissions)),k=q.getUTCHours(),k<<=6,k|=q.getUTCMinutes(),k<<=5,k|=q.getUTCSeconds()/2,P=q.getUTCFullYear()-1980,P<<=4,P|=q.getUTCMonth()+1,P<<=5,P|=q.getUTCDate(),O&&(Q=i(1,1)+i(u(B),4)+F,L+="up"+i(Q.length,2)+Q),y&&($=i(1,1)+i(u(et),4)+E,L+="uc"+i($.length,2)+$);var V="";return V+=`
\0`,V+=i(b,2),V+=N.magic,V+=i(k,2),V+=i(P,2),V+=i(rt.crc32,4),V+=i(rt.compressedSize,4),V+=i(rt.uncompressedSize,4),V+=i(B.length,2),V+=i(L.length,2),{fileRecord:p.LOCAL_FILE_HEADER+V+B+L,dirRecord:p.CENTRAL_FILE_HEADER+i(K,2)+V+i(et.length,2)+"\0\0\0\0"+i(C,4)+i(v,4)+B+L+et}}var a=n("../utils"),l=n("../stream/GenericWorker"),c=n("../utf8"),u=n("../crc32"),p=n("../signature");function m(f,x,d,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=x,this.zipPlatform=d,this.encodeFileName=v,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(m,l),m.prototype.push=function(f){var x=f.meta.percent||0,d=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,l.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:d?(x+100*(d-v-1))/d:100}}))},m.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var x=this.streamFiles&&!f.file.dir;if(x){var d=o(f,x,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(f){this.accumulate=!1;var x=this.streamFiles&&!f.file.dir,d=o(f,x,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),x)this.push({data:(function(v){return p.DATA_DESCRIPTOR+i(v.crc32,4)+i(v.compressedSize,4)+i(v.uncompressedSize,4)})(f),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var f=this.bytesWritten,x=0;x<this.dirRecords.length;x++)this.push({data:this.dirRecords[x],meta:{percent:100}});var d=this.bytesWritten-f,v=(function(g,w,k,P,T){var N=a.transformTo("string",T(P));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(g,2)+i(g,2)+i(w,4)+i(k,4)+i(N.length,2)+N})(this.dirRecords.length,d,f,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(f){this._sources.push(f);var x=this;return f.on("data",function(d){x.processChunk(d)}),f.on("end",function(){x.closedSource(x.previous.streamInfo),x._sources.length?x.prepareNextSource():x.end()}),f.on("error",function(d){x.error(d)}),this},m.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(f){var x=this._sources;if(!l.prototype.error.call(this,f))return!1;for(var d=0;d<x.length;d++)try{x[d].error(f)}catch{}return!0},m.prototype.lock=function(){l.prototype.lock.call(this);for(var f=this._sources,x=0;x<f.length;x++)f[x].lock()},s.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,s,r){var i=n("../compressions"),o=n("./ZipFileWorker");r.generateWorker=function(a,l,c){var u=new o(l.streamFiles,c,l.platform,l.encodeFileName),p=0;try{a.forEach(function(m,f){p++;var x=(function(w,k){var P=w||k,T=i[P];if(!T)throw new Error(P+" is not a valid compression method !");return T})(f.options.compression,l.compression),d=f.options.compressionOptions||l.compressionOptions||{},v=f.dir,g=f.date;f._compressWorker(x,d).withStreamInfo("file",{name:m,dir:v,date:g,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=p}catch(m){u.error(m)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,s,r){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new i;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(i.prototype=n("./object")).loadAsync=n("./load"),i.support=n("./support"),i.defaults=n("./defaults"),i.version="3.10.1",i.loadAsync=function(o,a){return new i().loadAsync(o,a)},i.external=n("./external"),s.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,s,r){var i=n("./utils"),o=n("./external"),a=n("./utf8"),l=n("./zipEntries"),c=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function p(m){return new o.Promise(function(f,x){var d=m.decompressed.getContentWorker().pipe(new c);d.on("error",function(v){x(v)}).on("end",function(){d.streamInfo.crc32!==m.decompressed.crc32?x(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}s.exports=function(m,f){var x=this;return f=i.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(m)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",m,!0,f.optimizedBinaryString,f.base64).then(function(d){var v=new l(f);return v.load(d),v}).then(function(d){var v=[o.Promise.resolve(d)],g=d.files;if(f.checkCRC32)for(var w=0;w<g.length;w++)v.push(p(g[w]));return o.Promise.all(v)}).then(function(d){for(var v=d.shift(),g=v.files,w=0;w<g.length;w++){var k=g[w],P=k.fileNameStr,T=i.resolve(k.fileNameStr);x.file(T,k.decompressed,{binary:!0,optimizedBinaryString:!0,date:k.date,dir:k.dir,comment:k.fileCommentStr.length?k.fileCommentStr:null,unixPermissions:k.unixPermissions,dosPermissions:k.dosPermissions,createFolders:f.createFolders}),k.dir||(x.file(T).unsafeOriginalName=P)}return v.zipComment.length&&(x.comment=v.zipComment),x})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,s,r){var i=n("../utils"),o=n("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}i.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(u){c.push({data:u,meta:{percent:0}})}).on("error",function(u){c.isPaused?this.generatedError=u:c.error(u)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,s,r){var i=n("readable-stream").Readable;function o(a,l,c){i.call(this,l),this._helper=a;var u=this;a.on("data",function(p,m){u.push(p)||u._helper.pause(),c&&c(m)}).on("error",function(p){u.emit("error",p)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,i),o.prototype._read=function(){this._helper.resume()},s.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,s,r){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,o);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,o)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var o=new Buffer(i);return o.fill(0),o},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(n,s,r){function i(T,N,M){var B,F=a.getTypeOf(N),H=a.extend(M||{},u);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(T=g(T)),H.createFolders&&(B=v(T))&&w.call(this,B,!0);var et=F==="string"&&H.binary===!1&&H.base64===!1;M&&M.binary!==void 0||(H.binary=!et),(N instanceof p&&N.uncompressedSize===0||H.dir||!N||N.length===0)&&(H.base64=!1,H.binary=!0,N="",H.compression="STORE",F="string");var E=null;E=N instanceof p||N instanceof l?N:x.isNode&&x.isStream(N)?new d(T,N):a.prepareContent(T,N,H.binary,H.optimizedBinaryString,H.base64);var O=new m(T,E,H);this.files[T]=O}var o=n("./utf8"),a=n("./utils"),l=n("./stream/GenericWorker"),c=n("./stream/StreamHelper"),u=n("./defaults"),p=n("./compressedObject"),m=n("./zipObject"),f=n("./generate"),x=n("./nodejsUtils"),d=n("./nodejs/NodejsStreamInputAdapter"),v=function(T){T.slice(-1)==="/"&&(T=T.substring(0,T.length-1));var N=T.lastIndexOf("/");return 0<N?T.substring(0,N):""},g=function(T){return T.slice(-1)!=="/"&&(T+="/"),T},w=function(T,N){return N=N!==void 0?N:u.createFolders,T=g(T),this.files[T]||i.call(this,T,null,{dir:!0,createFolders:N}),this.files[T]};function k(T){return Object.prototype.toString.call(T)==="[object RegExp]"}var P={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(T){var N,M,B;for(N in this.files)B=this.files[N],(M=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&T(M,B)},filter:function(T){var N=[];return this.forEach(function(M,B){T(M,B)&&N.push(B)}),N},file:function(T,N,M){if(arguments.length!==1)return T=this.root+T,i.call(this,T,N,M),this;if(k(T)){var B=T;return this.filter(function(H,et){return!et.dir&&B.test(H)})}var F=this.files[this.root+T];return F&&!F.dir?F:null},folder:function(T){if(!T)return this;if(k(T))return this.filter(function(F,H){return H.dir&&T.test(F)});var N=this.root+T,M=w.call(this,N),B=this.clone();return B.root=M.name,B},remove:function(T){T=this.root+T;var N=this.files[T];if(N||(T.slice(-1)!=="/"&&(T+="/"),N=this.files[T]),N&&!N.dir)delete this.files[T];else for(var M=this.filter(function(F,H){return H.name.slice(0,T.length)===T}),B=0;B<M.length;B++)delete this.files[M[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(T){var N,M={};try{if((M=a.extend(T||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=M.type.toLowerCase(),M.compression=M.compression.toUpperCase(),M.type==="binarystring"&&(M.type="string"),!M.type)throw new Error("No output type specified.");a.checkSupport(M.type),M.platform!=="darwin"&&M.platform!=="freebsd"&&M.platform!=="linux"&&M.platform!=="sunos"||(M.platform="UNIX"),M.platform==="win32"&&(M.platform="DOS");var B=M.comment||this.comment||"";N=f.generateWorker(this,M,B)}catch(F){(N=new l("error")).error(F)}return new c(N,M.type||"string",M.mimeType)},generateAsync:function(T,N){return this.generateInternalStream(T).accumulate(N)},generateNodeStream:function(T,N){return(T=T||{}).type||(T.type="nodebuffer"),this.generateInternalStream(T).toNodejsStream(N)}};s.exports=P},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,s,r){s.exports=n("stream")},{stream:void 0}],17:[function(n,s,r){var i=n("./DataReader");function o(a){i.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}n("../utils").inherits(o,i),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),u=a.charCodeAt(2),p=a.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===l&&this.data[m+1]===c&&this.data[m+2]===u&&this.data[m+3]===p)return m-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),u=a.charCodeAt(2),p=a.charCodeAt(3),m=this.readData(4);return l===m[0]&&c===m[1]&&u===m[2]&&p===m[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,s,r){var i=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return i.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},s.exports=o},{"../utils":32}],19:[function(n,s,r){var i=n("./Uint8ArrayReader");function o(a){i.call(this,a)}n("../utils").inherits(o,i),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,s,r){var i=n("./DataReader");function o(a){i.call(this,a)}n("../utils").inherits(o,i),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,s,r){var i=n("./ArrayReader");function o(a){i.call(this,a)}n("../utils").inherits(o,i),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,s,r){var i=n("../utils"),o=n("../support"),a=n("./ArrayReader"),l=n("./StringReader"),c=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");s.exports=function(p){var m=i.getTypeOf(p);return i.checkSupport(m),m!=="string"||o.uint8array?m==="nodebuffer"?new c(p):o.uint8array?new u(i.transformTo("uint8array",p)):new a(i.transformTo("array",p)):new l(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,s,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,s,r){var i=n("./GenericWorker"),o=n("../utils");function a(l){i.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,i),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},s.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,s,r){var i=n("./GenericWorker"),o=n("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,i),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,s,r){var i=n("../utils"),o=n("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},s.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,s,r){var i=n("../utils"),o=n("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(u){c.dataIsReady=!0,c.data=u,c.max=u&&u.length||0,c.type=i.getTypeOf(u),c.isPaused||c._tickAndRepeat()},function(u){c.error(u)})}i.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,s,r){function i(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},s.exports=i},{}],29:[function(n,s,r){var i=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),l=n("../base64"),c=n("../support"),u=n("../external"),p=null;if(c.nodestream)try{p=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(x,d){return new u.Promise(function(v,g){var w=[],k=x._internalType,P=x._outputType,T=x._mimeType;x.on("data",function(N,M){w.push(N),d&&d(M)}).on("error",function(N){w=[],g(N)}).on("end",function(){try{var N=(function(M,B,F){switch(M){case"blob":return i.newBlob(i.transformTo("arraybuffer",B),F);case"base64":return l.encode(B);default:return i.transformTo(M,B)}})(P,(function(M,B){var F,H=0,et=null,E=0;for(F=0;F<B.length;F++)E+=B[F].length;switch(M){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(et=new Uint8Array(E),F=0;F<B.length;F++)et.set(B[F],H),H+=B[F].length;return et;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+M+"'")}})(k,w),T);v(N)}catch(M){g(M)}w=[]}).resume()})}function f(x,d,v){var g=d;switch(d){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=d,this._mimeType=v,i.checkSupport(g),this._worker=x.pipe(new o(g)),x.lock()}catch(w){this._worker=new a("error"),this._worker.error(w)}}f.prototype={accumulate:function(x){return m(this,x)},on:function(x,d){var v=this;return x==="data"?this._worker.on(x,function(g){d.call(v,g.data,g.meta)}):this._worker.on(x,function(){i.delay(d,arguments,v)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(x){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},x)}},s.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,s,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(i),r.blob=o.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!n("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(n,s,r){for(var i=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),l=n("./stream/GenericWorker"),c=new Array(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;c[254]=c[254]=1;function p(){l.call(this,"utf-8 decode"),this.leftOver=null}function m(){l.call(this,"utf-8 encode")}r.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):(function(x){var d,v,g,w,k,P=x.length,T=0;for(w=0;w<P;w++)(64512&(v=x.charCodeAt(w)))==55296&&w+1<P&&(64512&(g=x.charCodeAt(w+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),w++),T+=v<128?1:v<2048?2:v<65536?3:4;for(d=o.uint8array?new Uint8Array(T):new Array(T),w=k=0;k<T;w++)(64512&(v=x.charCodeAt(w)))==55296&&w+1<P&&(64512&(g=x.charCodeAt(w+1)))==56320&&(v=65536+(v-55296<<10)+(g-56320),w++),v<128?d[k++]=v:(v<2048?d[k++]=192|v>>>6:(v<65536?d[k++]=224|v>>>12:(d[k++]=240|v>>>18,d[k++]=128|v>>>12&63),d[k++]=128|v>>>6&63),d[k++]=128|63&v);return d})(f)},r.utf8decode=function(f){return o.nodebuffer?i.transformTo("nodebuffer",f).toString("utf-8"):(function(x){var d,v,g,w,k=x.length,P=new Array(2*k);for(d=v=0;d<k;)if((g=x[d++])<128)P[v++]=g;else if(4<(w=c[g]))P[v++]=65533,d+=w-1;else{for(g&=w===2?31:w===3?15:7;1<w&&d<k;)g=g<<6|63&x[d++],w--;1<w?P[v++]=65533:g<65536?P[v++]=g:(g-=65536,P[v++]=55296|g>>10&1023,P[v++]=56320|1023&g)}return P.length!==v&&(P.subarray?P=P.subarray(0,v):P.length=v),i.applyFromCharCode(P)})(f=i.transformTo(o.uint8array?"uint8array":"array",f))},i.inherits(p,l),p.prototype.processChunk=function(f){var x=i.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var d=x;(x=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),x.set(d,this.leftOver.length)}else x=this.leftOver.concat(x);this.leftOver=null}var v=(function(w,k){var P;for((k=k||w.length)>w.length&&(k=w.length),P=k-1;0<=P&&(192&w[P])==128;)P--;return P<0||P===0?k:P+c[w[P]]>k?P:k})(x),g=x;v!==x.length&&(o.uint8array?(g=x.subarray(0,v),this.leftOver=x.subarray(v,x.length)):(g=x.slice(0,v),this.leftOver=x.slice(v,x.length))),this.push({data:r.utf8decode(g),meta:f.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=p,i.inherits(m,l),m.prototype.processChunk=function(f){this.push({data:r.utf8encode(f.data),meta:f.meta})},r.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,s,r){var i=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),l=n("./external");function c(d){return d}function u(d,v){for(var g=0;g<d.length;++g)v[g]=255&d.charCodeAt(g);return v}n("setimmediate"),r.newBlob=function(d,v){r.checkSupport("blob");try{return new Blob([d],{type:v})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(d),g.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(d,v,g){var w=[],k=0,P=d.length;if(P<=g)return String.fromCharCode.apply(null,d);for(;k<P;)v==="array"||v==="nodebuffer"?w.push(String.fromCharCode.apply(null,d.slice(k,Math.min(k+g,P)))):w.push(String.fromCharCode.apply(null,d.subarray(k,Math.min(k+g,P)))),k+=g;return w.join("")},stringifyByChar:function(d){for(var v="",g=0;g<d.length;g++)v+=String.fromCharCode(d[g]);return v},applyCanBeUsed:{uint8array:(function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function m(d){var v=65536,g=r.getTypeOf(d),w=!0;if(g==="uint8array"?w=p.applyCanBeUsed.uint8array:g==="nodebuffer"&&(w=p.applyCanBeUsed.nodebuffer),w)for(;1<v;)try{return p.stringifyByChunk(d,g,v)}catch{v=Math.floor(v/2)}return p.stringifyByChar(d)}function f(d,v){for(var g=0;g<d.length;g++)v[g]=d[g];return v}r.applyFromCharCode=m;var x={};x.string={string:c,array:function(d){return u(d,new Array(d.length))},arraybuffer:function(d){return x.string.uint8array(d).buffer},uint8array:function(d){return u(d,new Uint8Array(d.length))},nodebuffer:function(d){return u(d,a.allocBuffer(d.length))}},x.array={string:m,array:c,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return a.newBufferFrom(d)}},x.arraybuffer={string:function(d){return m(new Uint8Array(d))},array:function(d){return f(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:c,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return a.newBufferFrom(new Uint8Array(d))}},x.uint8array={string:m,array:function(d){return f(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:c,nodebuffer:function(d){return a.newBufferFrom(d)}},x.nodebuffer={string:m,array:function(d){return f(d,new Array(d.length))},arraybuffer:function(d){return x.nodebuffer.uint8array(d).buffer},uint8array:function(d){return f(d,new Uint8Array(d.length))},nodebuffer:c},r.transformTo=function(d,v){if(v=v||"",!d)return v;r.checkSupport(d);var g=r.getTypeOf(v);return x[g][d](v)},r.resolve=function(d){for(var v=d.split("/"),g=[],w=0;w<v.length;w++){var k=v[w];k==="."||k===""&&w!==0&&w!==v.length-1||(k===".."?g.pop():g.push(k))}return g.join("/")},r.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":i.nodebuffer&&a.isBuffer(d)?"nodebuffer":i.uint8array&&d instanceof Uint8Array?"uint8array":i.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(d){if(!i[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(d){var v,g,w="";for(g=0;g<(d||"").length;g++)w+="\\x"+((v=d.charCodeAt(g))<16?"0":"")+v.toString(16).toUpperCase();return w},r.delay=function(d,v,g){setImmediate(function(){d.apply(g||null,v||[])})},r.inherits=function(d,v){function g(){}g.prototype=v.prototype,d.prototype=new g},r.extend=function(){var d,v,g={};for(d=0;d<arguments.length;d++)for(v in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],v)&&g[v]===void 0&&(g[v]=arguments[d][v]);return g},r.prepareContent=function(d,v,g,w,k){return l.Promise.resolve(v).then(function(P){return i.blob&&(P instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(P))!==-1)&&typeof FileReader<"u"?new l.Promise(function(T,N){var M=new FileReader;M.onload=function(B){T(B.target.result)},M.onerror=function(B){N(B.target.error)},M.readAsArrayBuffer(P)}):P}).then(function(P){var T=r.getTypeOf(P);return T?(T==="arraybuffer"?P=r.transformTo("uint8array",P):T==="string"&&(k?P=o.decode(P):g&&w!==!0&&(P=(function(N){return u(N,i.uint8array?new Uint8Array(N.length):new Array(N.length))})(P))),P):l.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,s,r){var i=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),l=n("./zipEntry"),c=n("./support");function u(p){this.files=[],this.loadOptions=p}u.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(m)+", expected "+o.pretty(p)+")")}},isSignature:function(p,m){var f=this.reader.index;this.reader.setIndex(p);var x=this.reader.readString(4)===m;return this.reader.setIndex(f),x},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),m=c.uint8array?"uint8array":"array",f=o.transformTo(m,p);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,m,f,x=this.zip64EndOfCentralSize-44;0<x;)p=this.reader.readInt(2),m=this.reader.readInt(4),f=this.reader.readData(m),this.zip64ExtensibleData[p]={id:p,length:m,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,m;for(p=0;p<this.files.length;p++)m=this.files[p],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(p=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var m=p;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var x=m-f;if(0<x)this.isSignature(m,a.CENTRAL_FILE_HEADER)||(this.reader.zero=x);else if(x<0)throw new Error("Corrupted zip: missing "+Math.abs(x)+" bytes.")},prepareReader:function(p){this.reader=i(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,s,r){var i=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),l=n("./crc32"),c=n("./utf8"),u=n("./compressions"),p=n("./support");function m(f,x){this.options=f,this.loadOptions=x}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var x,d;if(f.skip(22),this.fileNameLength=f.readInt(2),d=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((x=(function(v){for(var g in u)if(Object.prototype.hasOwnProperty.call(u,g)&&u[g].magic===v)return u[g];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,x,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var x=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(x),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=i(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var x,d,v,g=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<g;)x=f.readInt(2),d=f.readInt(2),v=f.readData(d),this.extraFields[x]={id:x,length:d,value:v};f.setIndex(g)},handleUTF8:function(){var f=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var x=this.findExtraFieldUnicodePath();if(x!==null)this.fileNameStr=x;else{var d=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var g=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var x=i(f.value);return x.readInt(1)!==1||l(this.fileName)!==x.readInt(4)?null:c.utf8decode(x.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var x=i(f.value);return x.readInt(1)!==1||l(this.fileComment)!==x.readInt(4)?null:c.utf8decode(x.readData(f.length-5))}return null}},s.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,s,r){function i(x,d,v){this.name=x,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=d,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),l=n("./utf8"),c=n("./compressedObject"),u=n("./stream/GenericWorker");i.prototype={internalStream:function(x){var d=null,v="string";try{if(!x)throw new Error("No output type specified.");var g=(v=x.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),d=this._decompressWorker();var w=!this._dataBinary;w&&!g&&(d=d.pipe(new l.Utf8EncodeWorker)),!w&&g&&(d=d.pipe(new l.Utf8DecodeWorker))}catch(k){(d=new u("error")).error(k)}return new o(d,v,"")},async:function(x,d){return this.internalStream(x).accumulate(d)},nodeStream:function(x,d){return this.internalStream(x||"nodebuffer").toNodejsStream(d)},_compressWorker:function(x,d){if(this._data instanceof c&&this._data.compression.magic===x.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(v,x,d)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<p.length;f++)i.prototype[p[f]]=m;s.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,s,r){(function(i){var o,a,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var c=0,u=new l(x),p=i.document.createTextNode("");u.observe(p,{characterData:!0}),o=function(){p.data=c=++c%2}}else if(i.setImmediate||i.MessageChannel===void 0)o="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var d=i.document.createElement("script");d.onreadystatechange=function(){x(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},i.document.documentElement.appendChild(d)}:function(){setTimeout(x,0)};else{var m=new i.MessageChannel;m.port1.onmessage=x,o=function(){m.port2.postMessage(0)}}var f=[];function x(){var d,v;a=!0;for(var g=f.length;g;){for(v=f,f=[],d=-1;++d<g;)v[d]();g=f.length}a=!1}s.exports=function(d){f.push(d)!==1||a||o()}}).call(this,typeof Ue<"u"?Ue:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,s,r){var i=n("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function p(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,g!==o&&d(this,g)}function m(g,w,k){this.promise=g,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}function f(g,w,k){i(function(){var P;try{P=w(k)}catch(T){return a.reject(g,T)}P===g?a.reject(g,new TypeError("Cannot resolve promise with itself")):a.resolve(g,P)})}function x(g){var w=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof w=="function")return function(){w.apply(g,arguments)}}function d(g,w){var k=!1;function P(M){k||(k=!0,a.reject(g,M))}function T(M){k||(k=!0,a.resolve(g,M))}var N=v(function(){w(T,P)});N.status==="error"&&P(N.value)}function v(g,w){var k={};try{k.value=g(w),k.status="success"}catch(P){k.status="error",k.value=P}return k}(s.exports=p).prototype.finally=function(g){if(typeof g!="function")return this;var w=this.constructor;return this.then(function(k){return w.resolve(g()).then(function(){return k})},function(k){return w.resolve(g()).then(function(){throw k})})},p.prototype.catch=function(g){return this.then(null,g)},p.prototype.then=function(g,w){if(typeof g!="function"&&this.state===c||typeof w!="function"&&this.state===l)return this;var k=new this.constructor(o);return this.state!==u?f(k,this.state===c?g:w,this.outcome):this.queue.push(new m(k,g,w)),k},m.prototype.callFulfilled=function(g){a.resolve(this.promise,g)},m.prototype.otherCallFulfilled=function(g){f(this.promise,this.onFulfilled,g)},m.prototype.callRejected=function(g){a.reject(this.promise,g)},m.prototype.otherCallRejected=function(g){f(this.promise,this.onRejected,g)},a.resolve=function(g,w){var k=v(x,w);if(k.status==="error")return a.reject(g,k.value);var P=k.value;if(P)d(g,P);else{g.state=c,g.outcome=w;for(var T=-1,N=g.queue.length;++T<N;)g.queue[T].callFulfilled(w)}return g},a.reject=function(g,w){g.state=l,g.outcome=w;for(var k=-1,P=g.queue.length;++k<P;)g.queue[k].callRejected(w);return g},p.resolve=function(g){return g instanceof this?g:a.resolve(new this(o),g)},p.reject=function(g){var w=new this(o);return a.reject(w,g)},p.all=function(g){var w=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=g.length,P=!1;if(!k)return this.resolve([]);for(var T=new Array(k),N=0,M=-1,B=new this(o);++M<k;)F(g[M],M);return B;function F(H,et){w.resolve(H).then(function(E){T[et]=E,++N!==k||P||(P=!0,a.resolve(B,T))},function(E){P||(P=!0,a.reject(B,E))})}},p.race=function(g){var w=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=g.length,P=!1;if(!k)return this.resolve([]);for(var T=-1,N=new this(o);++T<k;)M=g[T],w.resolve(M).then(function(B){P||(P=!0,a.resolve(N,B))},function(B){P||(P=!0,a.reject(N,B))});var M;return N}},{immediate:36}],38:[function(n,s,r){var i={};(0,n("./lib/utils/common").assign)(i,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),s.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,s,r){var i=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),l=n("./zlib/messages"),c=n("./zlib/zstream"),u=Object.prototype.toString,p=0,m=-1,f=0,x=8;function d(g){if(!(this instanceof d))return new d(g);this.options=o.assign({level:m,method:x,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},g||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var k=i.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(k!==p)throw new Error(l[k]);if(w.header&&i.deflateSetHeader(this.strm,w.header),w.dictionary){var P;if(P=typeof w.dictionary=="string"?a.string2buf(w.dictionary):u.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(k=i.deflateSetDictionary(this.strm,P))!==p)throw new Error(l[k]);this._dict_set=!0}}function v(g,w){var k=new d(w);if(k.push(g,!0),k.err)throw k.msg||l[k.err];return k.result}d.prototype.push=function(g,w){var k,P,T=this.strm,N=this.options.chunkSize;if(this.ended)return!1;P=w===~~w?w:w===!0?4:0,typeof g=="string"?T.input=a.string2buf(g):u.call(g)==="[object ArrayBuffer]"?T.input=new Uint8Array(g):T.input=g,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new o.Buf8(N),T.next_out=0,T.avail_out=N),(k=i.deflate(T,P))!==1&&k!==p)return this.onEnd(k),!(this.ended=!0);T.avail_out!==0&&(T.avail_in!==0||P!==4&&P!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(T.output,T.next_out))):this.onData(o.shrinkBuf(T.output,T.next_out)))}while((0<T.avail_in||T.avail_out===0)&&k!==1);return P===4?(k=i.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===p):P!==2||(this.onEnd(p),!(T.avail_out=0))},d.prototype.onData=function(g){this.chunks.push(g)},d.prototype.onEnd=function(g){g===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},r.Deflate=d,r.deflate=v,r.deflateRaw=function(g,w){return(w=w||{}).raw=!0,v(g,w)},r.gzip=function(g,w){return(w=w||{}).gzip=!0,v(g,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,s,r){var i=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),l=n("./zlib/constants"),c=n("./zlib/messages"),u=n("./zlib/zstream"),p=n("./zlib/gzheader"),m=Object.prototype.toString;function f(d){if(!(this instanceof f))return new f(d);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},d||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||d&&d.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&(15&v.windowBits)==0&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var g=i.inflateInit2(this.strm,v.windowBits);if(g!==l.Z_OK)throw new Error(c[g]);this.header=new p,i.inflateGetHeader(this.strm,this.header)}function x(d,v){var g=new f(v);if(g.push(d,!0),g.err)throw g.msg||c[g.err];return g.result}f.prototype.push=function(d,v){var g,w,k,P,T,N,M=this.strm,B=this.options.chunkSize,F=this.options.dictionary,H=!1;if(this.ended)return!1;w=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof d=="string"?M.input=a.binstring2buf(d):m.call(d)==="[object ArrayBuffer]"?M.input=new Uint8Array(d):M.input=d,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new o.Buf8(B),M.next_out=0,M.avail_out=B),(g=i.inflate(M,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&F&&(N=typeof F=="string"?a.string2buf(F):m.call(F)==="[object ArrayBuffer]"?new Uint8Array(F):F,g=i.inflateSetDictionary(this.strm,N)),g===l.Z_BUF_ERROR&&H===!0&&(g=l.Z_OK,H=!1),g!==l.Z_STREAM_END&&g!==l.Z_OK)return this.onEnd(g),!(this.ended=!0);M.next_out&&(M.avail_out!==0&&g!==l.Z_STREAM_END&&(M.avail_in!==0||w!==l.Z_FINISH&&w!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(k=a.utf8border(M.output,M.next_out),P=M.next_out-k,T=a.buf2string(M.output,k),M.next_out=P,M.avail_out=B-P,P&&o.arraySet(M.output,M.output,k,P,0),this.onData(T)):this.onData(o.shrinkBuf(M.output,M.next_out)))),M.avail_in===0&&M.avail_out===0&&(H=!0)}while((0<M.avail_in||M.avail_out===0)&&g!==l.Z_STREAM_END);return g===l.Z_STREAM_END&&(w=l.Z_FINISH),w===l.Z_FINISH?(g=i.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===l.Z_OK):w!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(M.avail_out=0))},f.prototype.onData=function(d){this.chunks.push(d)},f.prototype.onEnd=function(d){d===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},r.Inflate=f,r.inflate=x,r.inflateRaw=function(d,v){return(v=v||{}).raw=!0,x(d,v)},r.ungzip=x},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,s,r){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var u=c.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var p in u)u.hasOwnProperty(p)&&(l[p]=u[p])}}return l},r.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,u,p,m){if(c.subarray&&l.subarray)l.set(c.subarray(u,u+p),m);else for(var f=0;f<p;f++)l[m+f]=c[u+f]},flattenChunks:function(l){var c,u,p,m,f,x;for(c=p=0,u=l.length;c<u;c++)p+=l[c].length;for(x=new Uint8Array(p),c=m=0,u=l.length;c<u;c++)f=l[c],x.set(f,m),m+=f.length;return x}},a={arraySet:function(l,c,u,p,m){for(var f=0;f<p;f++)l[m+f]=c[u+f]},flattenChunks:function(l){return[].concat.apply([],l)}};r.setTyped=function(l){l?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,o)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(i)},{}],42:[function(n,s,r){var i=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new i.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(p,m){if(m<65537&&(p.subarray&&a||!p.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(p,m));for(var f="",x=0;x<m;x++)f+=String.fromCharCode(p[x]);return f}l[254]=l[254]=1,r.string2buf=function(p){var m,f,x,d,v,g=p.length,w=0;for(d=0;d<g;d++)(64512&(f=p.charCodeAt(d)))==55296&&d+1<g&&(64512&(x=p.charCodeAt(d+1)))==56320&&(f=65536+(f-55296<<10)+(x-56320),d++),w+=f<128?1:f<2048?2:f<65536?3:4;for(m=new i.Buf8(w),d=v=0;v<w;d++)(64512&(f=p.charCodeAt(d)))==55296&&d+1<g&&(64512&(x=p.charCodeAt(d+1)))==56320&&(f=65536+(f-55296<<10)+(x-56320),d++),f<128?m[v++]=f:(f<2048?m[v++]=192|f>>>6:(f<65536?m[v++]=224|f>>>12:(m[v++]=240|f>>>18,m[v++]=128|f>>>12&63),m[v++]=128|f>>>6&63),m[v++]=128|63&f);return m},r.buf2binstring=function(p){return u(p,p.length)},r.binstring2buf=function(p){for(var m=new i.Buf8(p.length),f=0,x=m.length;f<x;f++)m[f]=p.charCodeAt(f);return m},r.buf2string=function(p,m){var f,x,d,v,g=m||p.length,w=new Array(2*g);for(f=x=0;f<g;)if((d=p[f++])<128)w[x++]=d;else if(4<(v=l[d]))w[x++]=65533,f+=v-1;else{for(d&=v===2?31:v===3?15:7;1<v&&f<g;)d=d<<6|63&p[f++],v--;1<v?w[x++]=65533:d<65536?w[x++]=d:(d-=65536,w[x++]=55296|d>>10&1023,w[x++]=56320|1023&d)}return u(w,x)},r.utf8border=function(p,m){var f;for((m=m||p.length)>p.length&&(m=p.length),f=m-1;0<=f&&(192&p[f])==128;)f--;return f<0||f===0?m:f+l[p[f]]>m?f:m}},{"./common":41}],43:[function(n,s,r){s.exports=function(i,o,a,l){for(var c=65535&i|0,u=i>>>16&65535|0,p=0;a!==0;){for(a-=p=2e3<a?2e3:a;u=u+(c=c+o[l++]|0)|0,--p;);c%=65521,u%=65521}return c|u<<16|0}},{}],44:[function(n,s,r){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,s,r){var i=(function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a})();s.exports=function(o,a,l,c){var u=i,p=c+l;o^=-1;for(var m=c;m<p;m++)o=o>>>8^u[255&(o^a[m])];return-1^o}},{}],46:[function(n,s,r){var i,o=n("../utils/common"),a=n("./trees"),l=n("./adler32"),c=n("./crc32"),u=n("./messages"),p=0,m=4,f=0,x=-2,d=-1,v=4,g=2,w=8,k=9,P=286,T=30,N=19,M=2*P+1,B=15,F=3,H=258,et=H+F+1,E=42,O=113,y=1,L=2,Q=3,$=4;function nt(h,D){return h.msg=u[D],D}function q(h){return(h<<1)-(4<h?9:0)}function rt(h){for(var D=h.length;0<=--D;)h[D]=0}function b(h){var D=h.state,j=D.pending;j>h.avail_out&&(j=h.avail_out),j!==0&&(o.arraySet(h.output,D.pending_buf,D.pending_out,j,h.next_out),h.next_out+=j,D.pending_out+=j,h.total_out+=j,h.avail_out-=j,D.pending-=j,D.pending===0&&(D.pending_out=0))}function C(h,D){a._tr_flush_block(h,0<=h.block_start?h.block_start:-1,h.strstart-h.block_start,D),h.block_start=h.strstart,b(h.strm)}function K(h,D){h.pending_buf[h.pending++]=D}function V(h,D){h.pending_buf[h.pending++]=D>>>8&255,h.pending_buf[h.pending++]=255&D}function G(h,D){var j,S,_=h.max_chain_length,A=h.strstart,W=h.prev_length,Z=h.nice_match,z=h.strstart>h.w_size-et?h.strstart-(h.w_size-et):0,Y=h.window,it=h.w_mask,X=h.prev,lt=h.strstart+H,gt=Y[A+W-1],ft=Y[A+W];h.prev_length>=h.good_match&&(_>>=2),Z>h.lookahead&&(Z=h.lookahead);do if(Y[(j=D)+W]===ft&&Y[j+W-1]===gt&&Y[j]===Y[A]&&Y[++j]===Y[A+1]){A+=2,j++;do;while(Y[++A]===Y[++j]&&Y[++A]===Y[++j]&&Y[++A]===Y[++j]&&Y[++A]===Y[++j]&&Y[++A]===Y[++j]&&Y[++A]===Y[++j]&&Y[++A]===Y[++j]&&Y[++A]===Y[++j]&&A<lt);if(S=H-(lt-A),A=lt-H,W<S){if(h.match_start=D,Z<=(W=S))break;gt=Y[A+W-1],ft=Y[A+W]}}while((D=X[D&it])>z&&--_!=0);return W<=h.lookahead?W:h.lookahead}function ot(h){var D,j,S,_,A,W,Z,z,Y,it,X=h.w_size;do{if(_=h.window_size-h.lookahead-h.strstart,h.strstart>=X+(X-et)){for(o.arraySet(h.window,h.window,X,X,0),h.match_start-=X,h.strstart-=X,h.block_start-=X,D=j=h.hash_size;S=h.head[--D],h.head[D]=X<=S?S-X:0,--j;);for(D=j=X;S=h.prev[--D],h.prev[D]=X<=S?S-X:0,--j;);_+=X}if(h.strm.avail_in===0)break;if(W=h.strm,Z=h.window,z=h.strstart+h.lookahead,Y=_,it=void 0,it=W.avail_in,Y<it&&(it=Y),j=it===0?0:(W.avail_in-=it,o.arraySet(Z,W.input,W.next_in,it,z),W.state.wrap===1?W.adler=l(W.adler,Z,it,z):W.state.wrap===2&&(W.adler=c(W.adler,Z,it,z)),W.next_in+=it,W.total_in+=it,it),h.lookahead+=j,h.lookahead+h.insert>=F)for(A=h.strstart-h.insert,h.ins_h=h.window[A],h.ins_h=(h.ins_h<<h.hash_shift^h.window[A+1])&h.hash_mask;h.insert&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[A+F-1])&h.hash_mask,h.prev[A&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=A,A++,h.insert--,!(h.lookahead+h.insert<F)););}while(h.lookahead<et&&h.strm.avail_in!==0)}function J(h,D){for(var j,S;;){if(h.lookahead<et){if(ot(h),h.lookahead<et&&D===p)return y;if(h.lookahead===0)break}if(j=0,h.lookahead>=F&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+F-1])&h.hash_mask,j=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),j!==0&&h.strstart-j<=h.w_size-et&&(h.match_length=G(h,j)),h.match_length>=F)if(S=a._tr_tally(h,h.strstart-h.match_start,h.match_length-F),h.lookahead-=h.match_length,h.match_length<=h.max_lazy_match&&h.lookahead>=F){for(h.match_length--;h.strstart++,h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+F-1])&h.hash_mask,j=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart,--h.match_length!=0;);h.strstart++}else h.strstart+=h.match_length,h.match_length=0,h.ins_h=h.window[h.strstart],h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+1])&h.hash_mask;else S=a._tr_tally(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++;if(S&&(C(h,!1),h.strm.avail_out===0))return y}return h.insert=h.strstart<F-1?h.strstart:F-1,D===m?(C(h,!0),h.strm.avail_out===0?Q:$):h.last_lit&&(C(h,!1),h.strm.avail_out===0)?y:L}function st(h,D){for(var j,S,_;;){if(h.lookahead<et){if(ot(h),h.lookahead<et&&D===p)return y;if(h.lookahead===0)break}if(j=0,h.lookahead>=F&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+F-1])&h.hash_mask,j=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),h.prev_length=h.match_length,h.prev_match=h.match_start,h.match_length=F-1,j!==0&&h.prev_length<h.max_lazy_match&&h.strstart-j<=h.w_size-et&&(h.match_length=G(h,j),h.match_length<=5&&(h.strategy===1||h.match_length===F&&4096<h.strstart-h.match_start)&&(h.match_length=F-1)),h.prev_length>=F&&h.match_length<=h.prev_length){for(_=h.strstart+h.lookahead-F,S=a._tr_tally(h,h.strstart-1-h.prev_match,h.prev_length-F),h.lookahead-=h.prev_length-1,h.prev_length-=2;++h.strstart<=_&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+F-1])&h.hash_mask,j=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),--h.prev_length!=0;);if(h.match_available=0,h.match_length=F-1,h.strstart++,S&&(C(h,!1),h.strm.avail_out===0))return y}else if(h.match_available){if((S=a._tr_tally(h,0,h.window[h.strstart-1]))&&C(h,!1),h.strstart++,h.lookahead--,h.strm.avail_out===0)return y}else h.match_available=1,h.strstart++,h.lookahead--}return h.match_available&&(S=a._tr_tally(h,0,h.window[h.strstart-1]),h.match_available=0),h.insert=h.strstart<F-1?h.strstart:F-1,D===m?(C(h,!0),h.strm.avail_out===0?Q:$):h.last_lit&&(C(h,!1),h.strm.avail_out===0)?y:L}function U(h,D,j,S,_){this.good_length=h,this.max_lazy=D,this.nice_length=j,this.max_chain=S,this.func=_}function tt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*M),this.dyn_dtree=new o.Buf16(2*(2*T+1)),this.bl_tree=new o.Buf16(2*(2*N+1)),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(B+1),this.heap=new o.Buf16(2*P+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*P+1),rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function at(h){var D;return h&&h.state?(h.total_in=h.total_out=0,h.data_type=g,(D=h.state).pending=0,D.pending_out=0,D.wrap<0&&(D.wrap=-D.wrap),D.status=D.wrap?E:O,h.adler=D.wrap===2?0:1,D.last_flush=p,a._tr_init(D),f):nt(h,x)}function dt(h){var D=at(h);return D===f&&(function(j){j.window_size=2*j.w_size,rt(j.head),j.max_lazy_match=i[j.level].max_lazy,j.good_match=i[j.level].good_length,j.nice_match=i[j.level].nice_length,j.max_chain_length=i[j.level].max_chain,j.strstart=0,j.block_start=0,j.lookahead=0,j.insert=0,j.match_length=j.prev_length=F-1,j.match_available=0,j.ins_h=0})(h.state),D}function mt(h,D,j,S,_,A){if(!h)return x;var W=1;if(D===d&&(D=6),S<0?(W=0,S=-S):15<S&&(W=2,S-=16),_<1||k<_||j!==w||S<8||15<S||D<0||9<D||A<0||v<A)return nt(h,x);S===8&&(S=9);var Z=new tt;return(h.state=Z).strm=h,Z.wrap=W,Z.gzhead=null,Z.w_bits=S,Z.w_size=1<<Z.w_bits,Z.w_mask=Z.w_size-1,Z.hash_bits=_+7,Z.hash_size=1<<Z.hash_bits,Z.hash_mask=Z.hash_size-1,Z.hash_shift=~~((Z.hash_bits+F-1)/F),Z.window=new o.Buf8(2*Z.w_size),Z.head=new o.Buf16(Z.hash_size),Z.prev=new o.Buf16(Z.w_size),Z.lit_bufsize=1<<_+6,Z.pending_buf_size=4*Z.lit_bufsize,Z.pending_buf=new o.Buf8(Z.pending_buf_size),Z.d_buf=1*Z.lit_bufsize,Z.l_buf=3*Z.lit_bufsize,Z.level=D,Z.strategy=A,Z.method=j,dt(h)}i=[new U(0,0,0,0,function(h,D){var j=65535;for(j>h.pending_buf_size-5&&(j=h.pending_buf_size-5);;){if(h.lookahead<=1){if(ot(h),h.lookahead===0&&D===p)return y;if(h.lookahead===0)break}h.strstart+=h.lookahead,h.lookahead=0;var S=h.block_start+j;if((h.strstart===0||h.strstart>=S)&&(h.lookahead=h.strstart-S,h.strstart=S,C(h,!1),h.strm.avail_out===0)||h.strstart-h.block_start>=h.w_size-et&&(C(h,!1),h.strm.avail_out===0))return y}return h.insert=0,D===m?(C(h,!0),h.strm.avail_out===0?Q:$):(h.strstart>h.block_start&&(C(h,!1),h.strm.avail_out),y)}),new U(4,4,8,4,J),new U(4,5,16,8,J),new U(4,6,32,32,J),new U(4,4,16,16,st),new U(8,16,32,32,st),new U(8,16,128,128,st),new U(8,32,128,256,st),new U(32,128,258,1024,st),new U(32,258,258,4096,st)],r.deflateInit=function(h,D){return mt(h,D,w,15,8,0)},r.deflateInit2=mt,r.deflateReset=dt,r.deflateResetKeep=at,r.deflateSetHeader=function(h,D){return h&&h.state?h.state.wrap!==2?x:(h.state.gzhead=D,f):x},r.deflate=function(h,D){var j,S,_,A;if(!h||!h.state||5<D||D<0)return h?nt(h,x):x;if(S=h.state,!h.output||!h.input&&h.avail_in!==0||S.status===666&&D!==m)return nt(h,h.avail_out===0?-5:x);if(S.strm=h,j=S.last_flush,S.last_flush=D,S.status===E)if(S.wrap===2)h.adler=0,K(S,31),K(S,139),K(S,8),S.gzhead?(K(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),K(S,255&S.gzhead.time),K(S,S.gzhead.time>>8&255),K(S,S.gzhead.time>>16&255),K(S,S.gzhead.time>>24&255),K(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),K(S,255&S.gzhead.os),S.gzhead.extra&&S.gzhead.extra.length&&(K(S,255&S.gzhead.extra.length),K(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(h.adler=c(h.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=69):(K(S,0),K(S,0),K(S,0),K(S,0),K(S,0),K(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),K(S,3),S.status=O);else{var W=w+(S.w_bits-8<<4)<<8;W|=(2<=S.strategy||S.level<2?0:S.level<6?1:S.level===6?2:3)<<6,S.strstart!==0&&(W|=32),W+=31-W%31,S.status=O,V(S,W),S.strstart!==0&&(V(S,h.adler>>>16),V(S,65535&h.adler)),h.adler=1}if(S.status===69)if(S.gzhead.extra){for(_=S.pending;S.gzindex<(65535&S.gzhead.extra.length)&&(S.pending!==S.pending_buf_size||(S.gzhead.hcrc&&S.pending>_&&(h.adler=c(h.adler,S.pending_buf,S.pending-_,_)),b(h),_=S.pending,S.pending!==S.pending_buf_size));)K(S,255&S.gzhead.extra[S.gzindex]),S.gzindex++;S.gzhead.hcrc&&S.pending>_&&(h.adler=c(h.adler,S.pending_buf,S.pending-_,_)),S.gzindex===S.gzhead.extra.length&&(S.gzindex=0,S.status=73)}else S.status=73;if(S.status===73)if(S.gzhead.name){_=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>_&&(h.adler=c(h.adler,S.pending_buf,S.pending-_,_)),b(h),_=S.pending,S.pending===S.pending_buf_size)){A=1;break}A=S.gzindex<S.gzhead.name.length?255&S.gzhead.name.charCodeAt(S.gzindex++):0,K(S,A)}while(A!==0);S.gzhead.hcrc&&S.pending>_&&(h.adler=c(h.adler,S.pending_buf,S.pending-_,_)),A===0&&(S.gzindex=0,S.status=91)}else S.status=91;if(S.status===91)if(S.gzhead.comment){_=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>_&&(h.adler=c(h.adler,S.pending_buf,S.pending-_,_)),b(h),_=S.pending,S.pending===S.pending_buf_size)){A=1;break}A=S.gzindex<S.gzhead.comment.length?255&S.gzhead.comment.charCodeAt(S.gzindex++):0,K(S,A)}while(A!==0);S.gzhead.hcrc&&S.pending>_&&(h.adler=c(h.adler,S.pending_buf,S.pending-_,_)),A===0&&(S.status=103)}else S.status=103;if(S.status===103&&(S.gzhead.hcrc?(S.pending+2>S.pending_buf_size&&b(h),S.pending+2<=S.pending_buf_size&&(K(S,255&h.adler),K(S,h.adler>>8&255),h.adler=0,S.status=O)):S.status=O),S.pending!==0){if(b(h),h.avail_out===0)return S.last_flush=-1,f}else if(h.avail_in===0&&q(D)<=q(j)&&D!==m)return nt(h,-5);if(S.status===666&&h.avail_in!==0)return nt(h,-5);if(h.avail_in!==0||S.lookahead!==0||D!==p&&S.status!==666){var Z=S.strategy===2?(function(z,Y){for(var it;;){if(z.lookahead===0&&(ot(z),z.lookahead===0)){if(Y===p)return y;break}if(z.match_length=0,it=a._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,it&&(C(z,!1),z.strm.avail_out===0))return y}return z.insert=0,Y===m?(C(z,!0),z.strm.avail_out===0?Q:$):z.last_lit&&(C(z,!1),z.strm.avail_out===0)?y:L})(S,D):S.strategy===3?(function(z,Y){for(var it,X,lt,gt,ft=z.window;;){if(z.lookahead<=H){if(ot(z),z.lookahead<=H&&Y===p)return y;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=F&&0<z.strstart&&(X=ft[lt=z.strstart-1])===ft[++lt]&&X===ft[++lt]&&X===ft[++lt]){gt=z.strstart+H;do;while(X===ft[++lt]&&X===ft[++lt]&&X===ft[++lt]&&X===ft[++lt]&&X===ft[++lt]&&X===ft[++lt]&&X===ft[++lt]&&X===ft[++lt]&&lt<gt);z.match_length=H-(gt-lt),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=F?(it=a._tr_tally(z,1,z.match_length-F),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(it=a._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),it&&(C(z,!1),z.strm.avail_out===0))return y}return z.insert=0,Y===m?(C(z,!0),z.strm.avail_out===0?Q:$):z.last_lit&&(C(z,!1),z.strm.avail_out===0)?y:L})(S,D):i[S.level].func(S,D);if(Z!==Q&&Z!==$||(S.status=666),Z===y||Z===Q)return h.avail_out===0&&(S.last_flush=-1),f;if(Z===L&&(D===1?a._tr_align(S):D!==5&&(a._tr_stored_block(S,0,0,!1),D===3&&(rt(S.head),S.lookahead===0&&(S.strstart=0,S.block_start=0,S.insert=0))),b(h),h.avail_out===0))return S.last_flush=-1,f}return D!==m?f:S.wrap<=0?1:(S.wrap===2?(K(S,255&h.adler),K(S,h.adler>>8&255),K(S,h.adler>>16&255),K(S,h.adler>>24&255),K(S,255&h.total_in),K(S,h.total_in>>8&255),K(S,h.total_in>>16&255),K(S,h.total_in>>24&255)):(V(S,h.adler>>>16),V(S,65535&h.adler)),b(h),0<S.wrap&&(S.wrap=-S.wrap),S.pending!==0?f:1)},r.deflateEnd=function(h){var D;return h&&h.state?(D=h.state.status)!==E&&D!==69&&D!==73&&D!==91&&D!==103&&D!==O&&D!==666?nt(h,x):(h.state=null,D===O?nt(h,-3):f):x},r.deflateSetDictionary=function(h,D){var j,S,_,A,W,Z,z,Y,it=D.length;if(!h||!h.state||(A=(j=h.state).wrap)===2||A===1&&j.status!==E||j.lookahead)return x;for(A===1&&(h.adler=l(h.adler,D,it,0)),j.wrap=0,it>=j.w_size&&(A===0&&(rt(j.head),j.strstart=0,j.block_start=0,j.insert=0),Y=new o.Buf8(j.w_size),o.arraySet(Y,D,it-j.w_size,j.w_size,0),D=Y,it=j.w_size),W=h.avail_in,Z=h.next_in,z=h.input,h.avail_in=it,h.next_in=0,h.input=D,ot(j);j.lookahead>=F;){for(S=j.strstart,_=j.lookahead-(F-1);j.ins_h=(j.ins_h<<j.hash_shift^j.window[S+F-1])&j.hash_mask,j.prev[S&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=S,S++,--_;);j.strstart=S,j.lookahead=F-1,ot(j)}return j.strstart+=j.lookahead,j.block_start=j.strstart,j.insert=j.lookahead,j.lookahead=0,j.match_length=j.prev_length=F-1,j.match_available=0,h.next_in=Z,h.input=z,h.avail_in=W,j.wrap=A,f},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,s,r){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,s,r){s.exports=function(i,o){var a,l,c,u,p,m,f,x,d,v,g,w,k,P,T,N,M,B,F,H,et,E,O,y,L;a=i.state,l=i.next_in,y=i.input,c=l+(i.avail_in-5),u=i.next_out,L=i.output,p=u-(o-i.avail_out),m=u+(i.avail_out-257),f=a.dmax,x=a.wsize,d=a.whave,v=a.wnext,g=a.window,w=a.hold,k=a.bits,P=a.lencode,T=a.distcode,N=(1<<a.lenbits)-1,M=(1<<a.distbits)-1;t:do{k<15&&(w+=y[l++]<<k,k+=8,w+=y[l++]<<k,k+=8),B=P[w&N];e:for(;;){if(w>>>=F=B>>>24,k-=F,(F=B>>>16&255)===0)L[u++]=65535&B;else{if(!(16&F)){if((64&F)==0){B=P[(65535&B)+(w&(1<<F)-1)];continue e}if(32&F){a.mode=12;break t}i.msg="invalid literal/length code",a.mode=30;break t}H=65535&B,(F&=15)&&(k<F&&(w+=y[l++]<<k,k+=8),H+=w&(1<<F)-1,w>>>=F,k-=F),k<15&&(w+=y[l++]<<k,k+=8,w+=y[l++]<<k,k+=8),B=T[w&M];n:for(;;){if(w>>>=F=B>>>24,k-=F,!(16&(F=B>>>16&255))){if((64&F)==0){B=T[(65535&B)+(w&(1<<F)-1)];continue n}i.msg="invalid distance code",a.mode=30;break t}if(et=65535&B,k<(F&=15)&&(w+=y[l++]<<k,(k+=8)<F&&(w+=y[l++]<<k,k+=8)),f<(et+=w&(1<<F)-1)){i.msg="invalid distance too far back",a.mode=30;break t}if(w>>>=F,k-=F,(F=u-p)<et){if(d<(F=et-F)&&a.sane){i.msg="invalid distance too far back",a.mode=30;break t}if(O=g,(E=0)===v){if(E+=x-F,F<H){for(H-=F;L[u++]=g[E++],--F;);E=u-et,O=L}}else if(v<F){if(E+=x+v-F,(F-=v)<H){for(H-=F;L[u++]=g[E++],--F;);if(E=0,v<H){for(H-=F=v;L[u++]=g[E++],--F;);E=u-et,O=L}}}else if(E+=v-F,F<H){for(H-=F;L[u++]=g[E++],--F;);E=u-et,O=L}for(;2<H;)L[u++]=O[E++],L[u++]=O[E++],L[u++]=O[E++],H-=3;H&&(L[u++]=O[E++],1<H&&(L[u++]=O[E++]))}else{for(E=u-et;L[u++]=L[E++],L[u++]=L[E++],L[u++]=L[E++],2<(H-=3););H&&(L[u++]=L[E++],1<H&&(L[u++]=L[E++]))}break}}break}}while(l<c&&u<m);l-=H=k>>3,w&=(1<<(k-=H<<3))-1,i.next_in=l,i.next_out=u,i.avail_in=l<c?c-l+5:5-(l-c),i.avail_out=u<m?m-u+257:257-(u-m),a.hold=w,a.bits=k}},{}],49:[function(n,s,r){var i=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),l=n("./inffast"),c=n("./inftrees"),u=1,p=2,m=0,f=-2,x=1,d=852,v=592;function g(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function k(E){var O;return E&&E.state?(O=E.state,E.total_in=E.total_out=O.total=0,E.msg="",O.wrap&&(E.adler=1&O.wrap),O.mode=x,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new i.Buf32(d),O.distcode=O.distdyn=new i.Buf32(v),O.sane=1,O.back=-1,m):f}function P(E){var O;return E&&E.state?((O=E.state).wsize=0,O.whave=0,O.wnext=0,k(E)):f}function T(E,O){var y,L;return E&&E.state?(L=E.state,O<0?(y=0,O=-O):(y=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?f:(L.window!==null&&L.wbits!==O&&(L.window=null),L.wrap=y,L.wbits=O,P(E))):f}function N(E,O){var y,L;return E?(L=new w,(E.state=L).window=null,(y=T(E,O))!==m&&(E.state=null),y):f}var M,B,F=!0;function H(E){if(F){var O;for(M=new i.Buf32(512),B=new i.Buf32(32),O=0;O<144;)E.lens[O++]=8;for(;O<256;)E.lens[O++]=9;for(;O<280;)E.lens[O++]=7;for(;O<288;)E.lens[O++]=8;for(c(u,E.lens,0,288,M,0,E.work,{bits:9}),O=0;O<32;)E.lens[O++]=5;c(p,E.lens,0,32,B,0,E.work,{bits:5}),F=!1}E.lencode=M,E.lenbits=9,E.distcode=B,E.distbits=5}function et(E,O,y,L){var Q,$=E.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new i.Buf8($.wsize)),L>=$.wsize?(i.arraySet($.window,O,y-$.wsize,$.wsize,0),$.wnext=0,$.whave=$.wsize):(L<(Q=$.wsize-$.wnext)&&(Q=L),i.arraySet($.window,O,y-L,Q,$.wnext),(L-=Q)?(i.arraySet($.window,O,y-L,L,0),$.wnext=L,$.whave=$.wsize):($.wnext+=Q,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=Q))),0}r.inflateReset=P,r.inflateReset2=T,r.inflateResetKeep=k,r.inflateInit=function(E){return N(E,15)},r.inflateInit2=N,r.inflate=function(E,O){var y,L,Q,$,nt,q,rt,b,C,K,V,G,ot,J,st,U,tt,at,dt,mt,h,D,j,S,_=0,A=new i.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return f;(y=E.state).mode===12&&(y.mode=13),nt=E.next_out,Q=E.output,rt=E.avail_out,$=E.next_in,L=E.input,q=E.avail_in,b=y.hold,C=y.bits,K=q,V=rt,D=m;t:for(;;)switch(y.mode){case x:if(y.wrap===0){y.mode=13;break}for(;C<16;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if(2&y.wrap&&b===35615){A[y.check=0]=255&b,A[1]=b>>>8&255,y.check=a(y.check,A,2,0),C=b=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&b)<<8)+(b>>8))%31){E.msg="incorrect header check",y.mode=30;break}if((15&b)!=8){E.msg="unknown compression method",y.mode=30;break}if(C-=4,h=8+(15&(b>>>=4)),y.wbits===0)y.wbits=h;else if(h>y.wbits){E.msg="invalid window size",y.mode=30;break}y.dmax=1<<h,E.adler=y.check=1,y.mode=512&b?10:12,C=b=0;break;case 2:for(;C<16;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if(y.flags=b,(255&y.flags)!=8){E.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){E.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=b>>8&1),512&y.flags&&(A[0]=255&b,A[1]=b>>>8&255,y.check=a(y.check,A,2,0)),C=b=0,y.mode=3;case 3:for(;C<32;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}y.head&&(y.head.time=b),512&y.flags&&(A[0]=255&b,A[1]=b>>>8&255,A[2]=b>>>16&255,A[3]=b>>>24&255,y.check=a(y.check,A,4,0)),C=b=0,y.mode=4;case 4:for(;C<16;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}y.head&&(y.head.xflags=255&b,y.head.os=b>>8),512&y.flags&&(A[0]=255&b,A[1]=b>>>8&255,y.check=a(y.check,A,2,0)),C=b=0,y.mode=5;case 5:if(1024&y.flags){for(;C<16;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}y.length=b,y.head&&(y.head.extra_len=b),512&y.flags&&(A[0]=255&b,A[1]=b>>>8&255,y.check=a(y.check,A,2,0)),C=b=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(q<(G=y.length)&&(G=q),G&&(y.head&&(h=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),i.arraySet(y.head.extra,L,$,G,h)),512&y.flags&&(y.check=a(y.check,L,G,$)),q-=G,$+=G,y.length-=G),y.length))break t;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(q===0)break t;for(G=0;h=L[$+G++],y.head&&h&&y.length<65536&&(y.head.name+=String.fromCharCode(h)),h&&G<q;);if(512&y.flags&&(y.check=a(y.check,L,G,$)),q-=G,$+=G,h)break t}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(q===0)break t;for(G=0;h=L[$+G++],y.head&&h&&y.length<65536&&(y.head.comment+=String.fromCharCode(h)),h&&G<q;);if(512&y.flags&&(y.check=a(y.check,L,G,$)),q-=G,$+=G,h)break t}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;C<16;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if(b!==(65535&y.check)){E.msg="header crc mismatch",y.mode=30;break}C=b=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),E.adler=y.check=0,y.mode=12;break;case 10:for(;C<32;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}E.adler=y.check=g(b),C=b=0,y.mode=11;case 11:if(y.havedict===0)return E.next_out=nt,E.avail_out=rt,E.next_in=$,E.avail_in=q,y.hold=b,y.bits=C,2;E.adler=y.check=1,y.mode=12;case 12:if(O===5||O===6)break t;case 13:if(y.last){b>>>=7&C,C-=7&C,y.mode=27;break}for(;C<3;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}switch(y.last=1&b,C-=1,3&(b>>>=1)){case 0:y.mode=14;break;case 1:if(H(y),y.mode=20,O!==6)break;b>>>=2,C-=2;break t;case 2:y.mode=17;break;case 3:E.msg="invalid block type",y.mode=30}b>>>=2,C-=2;break;case 14:for(b>>>=7&C,C-=7&C;C<32;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if((65535&b)!=(b>>>16^65535)){E.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&b,C=b=0,y.mode=15,O===6)break t;case 15:y.mode=16;case 16:if(G=y.length){if(q<G&&(G=q),rt<G&&(G=rt),G===0)break t;i.arraySet(Q,L,$,G,nt),q-=G,$+=G,rt-=G,nt+=G,y.length-=G;break}y.mode=12;break;case 17:for(;C<14;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if(y.nlen=257+(31&b),b>>>=5,C-=5,y.ndist=1+(31&b),b>>>=5,C-=5,y.ncode=4+(15&b),b>>>=4,C-=4,286<y.nlen||30<y.ndist){E.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;C<3;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}y.lens[W[y.have++]]=7&b,b>>>=3,C-=3}for(;y.have<19;)y.lens[W[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,j={bits:y.lenbits},D=c(0,y.lens,0,19,y.lencode,0,y.work,j),y.lenbits=j.bits,D){E.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;U=(_=y.lencode[b&(1<<y.lenbits)-1])>>>16&255,tt=65535&_,!((st=_>>>24)<=C);){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if(tt<16)b>>>=st,C-=st,y.lens[y.have++]=tt;else{if(tt===16){for(S=st+2;C<S;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if(b>>>=st,C-=st,y.have===0){E.msg="invalid bit length repeat",y.mode=30;break}h=y.lens[y.have-1],G=3+(3&b),b>>>=2,C-=2}else if(tt===17){for(S=st+3;C<S;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}C-=st,h=0,G=3+(7&(b>>>=st)),b>>>=3,C-=3}else{for(S=st+7;C<S;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}C-=st,h=0,G=11+(127&(b>>>=st)),b>>>=7,C-=7}if(y.have+G>y.nlen+y.ndist){E.msg="invalid bit length repeat",y.mode=30;break}for(;G--;)y.lens[y.have++]=h}}if(y.mode===30)break;if(y.lens[256]===0){E.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,j={bits:y.lenbits},D=c(u,y.lens,0,y.nlen,y.lencode,0,y.work,j),y.lenbits=j.bits,D){E.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,j={bits:y.distbits},D=c(p,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,j),y.distbits=j.bits,D){E.msg="invalid distances set",y.mode=30;break}if(y.mode=20,O===6)break t;case 20:y.mode=21;case 21:if(6<=q&&258<=rt){E.next_out=nt,E.avail_out=rt,E.next_in=$,E.avail_in=q,y.hold=b,y.bits=C,l(E,V),nt=E.next_out,Q=E.output,rt=E.avail_out,$=E.next_in,L=E.input,q=E.avail_in,b=y.hold,C=y.bits,y.mode===12&&(y.back=-1);break}for(y.back=0;U=(_=y.lencode[b&(1<<y.lenbits)-1])>>>16&255,tt=65535&_,!((st=_>>>24)<=C);){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if(U&&(240&U)==0){for(at=st,dt=U,mt=tt;U=(_=y.lencode[mt+((b&(1<<at+dt)-1)>>at)])>>>16&255,tt=65535&_,!(at+(st=_>>>24)<=C);){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}b>>>=at,C-=at,y.back+=at}if(b>>>=st,C-=st,y.back+=st,y.length=tt,U===0){y.mode=26;break}if(32&U){y.back=-1,y.mode=12;break}if(64&U){E.msg="invalid literal/length code",y.mode=30;break}y.extra=15&U,y.mode=22;case 22:if(y.extra){for(S=y.extra;C<S;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}y.length+=b&(1<<y.extra)-1,b>>>=y.extra,C-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;U=(_=y.distcode[b&(1<<y.distbits)-1])>>>16&255,tt=65535&_,!((st=_>>>24)<=C);){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if((240&U)==0){for(at=st,dt=U,mt=tt;U=(_=y.distcode[mt+((b&(1<<at+dt)-1)>>at)])>>>16&255,tt=65535&_,!(at+(st=_>>>24)<=C);){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}b>>>=at,C-=at,y.back+=at}if(b>>>=st,C-=st,y.back+=st,64&U){E.msg="invalid distance code",y.mode=30;break}y.offset=tt,y.extra=15&U,y.mode=24;case 24:if(y.extra){for(S=y.extra;C<S;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}y.offset+=b&(1<<y.extra)-1,b>>>=y.extra,C-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){E.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(rt===0)break t;if(G=V-rt,y.offset>G){if((G=y.offset-G)>y.whave&&y.sane){E.msg="invalid distance too far back",y.mode=30;break}ot=G>y.wnext?(G-=y.wnext,y.wsize-G):y.wnext-G,G>y.length&&(G=y.length),J=y.window}else J=Q,ot=nt-y.offset,G=y.length;for(rt<G&&(G=rt),rt-=G,y.length-=G;Q[nt++]=J[ot++],--G;);y.length===0&&(y.mode=21);break;case 26:if(rt===0)break t;Q[nt++]=y.length,rt--,y.mode=21;break;case 27:if(y.wrap){for(;C<32;){if(q===0)break t;q--,b|=L[$++]<<C,C+=8}if(V-=rt,E.total_out+=V,y.total+=V,V&&(E.adler=y.check=y.flags?a(y.check,Q,V,nt-V):o(y.check,Q,V,nt-V)),V=rt,(y.flags?b:g(b))!==y.check){E.msg="incorrect data check",y.mode=30;break}C=b=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;C<32;){if(q===0)break t;q--,b+=L[$++]<<C,C+=8}if(b!==(4294967295&y.total)){E.msg="incorrect length check",y.mode=30;break}C=b=0}y.mode=29;case 29:D=1;break t;case 30:D=-3;break t;case 31:return-4;case 32:default:return f}return E.next_out=nt,E.avail_out=rt,E.next_in=$,E.avail_in=q,y.hold=b,y.bits=C,(y.wsize||V!==E.avail_out&&y.mode<30&&(y.mode<27||O!==4))&&et(E,E.output,E.next_out,V-E.avail_out)?(y.mode=31,-4):(K-=E.avail_in,V-=E.avail_out,E.total_in+=K,E.total_out+=V,y.total+=V,y.wrap&&V&&(E.adler=y.check=y.flags?a(y.check,Q,V,E.next_out-V):o(y.check,Q,V,E.next_out-V)),E.data_type=y.bits+(y.last?64:0)+(y.mode===12?128:0)+(y.mode===20||y.mode===15?256:0),(K==0&&V===0||O===4)&&D===m&&(D=-5),D)},r.inflateEnd=function(E){if(!E||!E.state)return f;var O=E.state;return O.window&&(O.window=null),E.state=null,m},r.inflateGetHeader=function(E,O){var y;return E&&E.state?(2&(y=E.state).wrap)==0?f:((y.head=O).done=!1,m):f},r.inflateSetDictionary=function(E,O){var y,L=O.length;return E&&E.state?(y=E.state).wrap!==0&&y.mode!==11?f:y.mode===11&&o(1,O,L,0)!==y.check?-3:et(E,O,L,L)?(y.mode=31,-4):(y.havedict=1,m):f},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,s,r){var i=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(u,p,m,f,x,d,v,g){var w,k,P,T,N,M,B,F,H,et=g.bits,E=0,O=0,y=0,L=0,Q=0,$=0,nt=0,q=0,rt=0,b=0,C=null,K=0,V=new i.Buf16(16),G=new i.Buf16(16),ot=null,J=0;for(E=0;E<=15;E++)V[E]=0;for(O=0;O<f;O++)V[p[m+O]]++;for(Q=et,L=15;1<=L&&V[L]===0;L--);if(L<Q&&(Q=L),L===0)return x[d++]=20971520,x[d++]=20971520,g.bits=1,0;for(y=1;y<L&&V[y]===0;y++);for(Q<y&&(Q=y),E=q=1;E<=15;E++)if(q<<=1,(q-=V[E])<0)return-1;if(0<q&&(u===0||L!==1))return-1;for(G[1]=0,E=1;E<15;E++)G[E+1]=G[E]+V[E];for(O=0;O<f;O++)p[m+O]!==0&&(v[G[p[m+O]]++]=O);if(M=u===0?(C=ot=v,19):u===1?(C=o,K-=257,ot=a,J-=257,256):(C=l,ot=c,-1),E=y,N=d,nt=O=b=0,P=-1,T=(rt=1<<($=Q))-1,u===1&&852<rt||u===2&&592<rt)return 1;for(;;){for(B=E-nt,H=v[O]<M?(F=0,v[O]):v[O]>M?(F=ot[J+v[O]],C[K+v[O]]):(F=96,0),w=1<<E-nt,y=k=1<<$;x[N+(b>>nt)+(k-=w)]=B<<24|F<<16|H|0,k!==0;);for(w=1<<E-1;b&w;)w>>=1;if(w!==0?(b&=w-1,b+=w):b=0,O++,--V[E]==0){if(E===L)break;E=p[m+v[O]]}if(Q<E&&(b&T)!==P){for(nt===0&&(nt=Q),N+=y,q=1<<($=E-nt);$+nt<L&&!((q-=V[$+nt])<=0);)$++,q<<=1;if(rt+=1<<$,u===1&&852<rt||u===2&&592<rt)return 1;x[P=b&T]=Q<<24|$<<16|N-d|0}}return b!==0&&(x[N+b]=E-nt<<24|64<<16|0),g.bits=Q,0}},{"../utils/common":41}],51:[function(n,s,r){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,s,r){var i=n("../utils/common"),o=0,a=1;function l(_){for(var A=_.length;0<=--A;)_[A]=0}var c=0,u=29,p=256,m=p+1+u,f=30,x=19,d=2*m+1,v=15,g=16,w=7,k=256,P=16,T=17,N=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],et=new Array(2*(m+2));l(et);var E=new Array(2*f);l(E);var O=new Array(512);l(O);var y=new Array(256);l(y);var L=new Array(u);l(L);var Q,$,nt,q=new Array(f);function rt(_,A,W,Z,z){this.static_tree=_,this.extra_bits=A,this.extra_base=W,this.elems=Z,this.max_length=z,this.has_stree=_&&_.length}function b(_,A){this.dyn_tree=_,this.max_code=0,this.stat_desc=A}function C(_){return _<256?O[_]:O[256+(_>>>7)]}function K(_,A){_.pending_buf[_.pending++]=255&A,_.pending_buf[_.pending++]=A>>>8&255}function V(_,A,W){_.bi_valid>g-W?(_.bi_buf|=A<<_.bi_valid&65535,K(_,_.bi_buf),_.bi_buf=A>>g-_.bi_valid,_.bi_valid+=W-g):(_.bi_buf|=A<<_.bi_valid&65535,_.bi_valid+=W)}function G(_,A,W){V(_,W[2*A],W[2*A+1])}function ot(_,A){for(var W=0;W|=1&_,_>>>=1,W<<=1,0<--A;);return W>>>1}function J(_,A,W){var Z,z,Y=new Array(v+1),it=0;for(Z=1;Z<=v;Z++)Y[Z]=it=it+W[Z-1]<<1;for(z=0;z<=A;z++){var X=_[2*z+1];X!==0&&(_[2*z]=ot(Y[X]++,X))}}function st(_){var A;for(A=0;A<m;A++)_.dyn_ltree[2*A]=0;for(A=0;A<f;A++)_.dyn_dtree[2*A]=0;for(A=0;A<x;A++)_.bl_tree[2*A]=0;_.dyn_ltree[2*k]=1,_.opt_len=_.static_len=0,_.last_lit=_.matches=0}function U(_){8<_.bi_valid?K(_,_.bi_buf):0<_.bi_valid&&(_.pending_buf[_.pending++]=_.bi_buf),_.bi_buf=0,_.bi_valid=0}function tt(_,A,W,Z){var z=2*A,Y=2*W;return _[z]<_[Y]||_[z]===_[Y]&&Z[A]<=Z[W]}function at(_,A,W){for(var Z=_.heap[W],z=W<<1;z<=_.heap_len&&(z<_.heap_len&&tt(A,_.heap[z+1],_.heap[z],_.depth)&&z++,!tt(A,Z,_.heap[z],_.depth));)_.heap[W]=_.heap[z],W=z,z<<=1;_.heap[W]=Z}function dt(_,A,W){var Z,z,Y,it,X=0;if(_.last_lit!==0)for(;Z=_.pending_buf[_.d_buf+2*X]<<8|_.pending_buf[_.d_buf+2*X+1],z=_.pending_buf[_.l_buf+X],X++,Z===0?G(_,z,A):(G(_,(Y=y[z])+p+1,A),(it=M[Y])!==0&&V(_,z-=L[Y],it),G(_,Y=C(--Z),W),(it=B[Y])!==0&&V(_,Z-=q[Y],it)),X<_.last_lit;);G(_,k,A)}function mt(_,A){var W,Z,z,Y=A.dyn_tree,it=A.stat_desc.static_tree,X=A.stat_desc.has_stree,lt=A.stat_desc.elems,gt=-1;for(_.heap_len=0,_.heap_max=d,W=0;W<lt;W++)Y[2*W]!==0?(_.heap[++_.heap_len]=gt=W,_.depth[W]=0):Y[2*W+1]=0;for(;_.heap_len<2;)Y[2*(z=_.heap[++_.heap_len]=gt<2?++gt:0)]=1,_.depth[z]=0,_.opt_len--,X&&(_.static_len-=it[2*z+1]);for(A.max_code=gt,W=_.heap_len>>1;1<=W;W--)at(_,Y,W);for(z=lt;W=_.heap[1],_.heap[1]=_.heap[_.heap_len--],at(_,Y,1),Z=_.heap[1],_.heap[--_.heap_max]=W,_.heap[--_.heap_max]=Z,Y[2*z]=Y[2*W]+Y[2*Z],_.depth[z]=(_.depth[W]>=_.depth[Z]?_.depth[W]:_.depth[Z])+1,Y[2*W+1]=Y[2*Z+1]=z,_.heap[1]=z++,at(_,Y,1),2<=_.heap_len;);_.heap[--_.heap_max]=_.heap[1],(function(ft,kt){var xe,Mt,we,vt,Be,fn,Ft=kt.dyn_tree,Cs=kt.max_code,_o=kt.stat_desc.static_tree,So=kt.stat_desc.has_stree,To=kt.stat_desc.extra_bits,Ps=kt.stat_desc.extra_base,be=kt.stat_desc.max_length,Ve=0;for(vt=0;vt<=v;vt++)ft.bl_count[vt]=0;for(Ft[2*ft.heap[ft.heap_max]+1]=0,xe=ft.heap_max+1;xe<d;xe++)be<(vt=Ft[2*Ft[2*(Mt=ft.heap[xe])+1]+1]+1)&&(vt=be,Ve++),Ft[2*Mt+1]=vt,Cs<Mt||(ft.bl_count[vt]++,Be=0,Ps<=Mt&&(Be=To[Mt-Ps]),fn=Ft[2*Mt],ft.opt_len+=fn*(vt+Be),So&&(ft.static_len+=fn*(_o[2*Mt+1]+Be)));if(Ve!==0){do{for(vt=be-1;ft.bl_count[vt]===0;)vt--;ft.bl_count[vt]--,ft.bl_count[vt+1]+=2,ft.bl_count[be]--,Ve-=2}while(0<Ve);for(vt=be;vt!==0;vt--)for(Mt=ft.bl_count[vt];Mt!==0;)Cs<(we=ft.heap[--xe])||(Ft[2*we+1]!==vt&&(ft.opt_len+=(vt-Ft[2*we+1])*Ft[2*we],Ft[2*we+1]=vt),Mt--)}})(_,A),J(Y,gt,_.bl_count)}function h(_,A,W){var Z,z,Y=-1,it=A[1],X=0,lt=7,gt=4;for(it===0&&(lt=138,gt=3),A[2*(W+1)+1]=65535,Z=0;Z<=W;Z++)z=it,it=A[2*(Z+1)+1],++X<lt&&z===it||(X<gt?_.bl_tree[2*z]+=X:z!==0?(z!==Y&&_.bl_tree[2*z]++,_.bl_tree[2*P]++):X<=10?_.bl_tree[2*T]++:_.bl_tree[2*N]++,Y=z,gt=(X=0)===it?(lt=138,3):z===it?(lt=6,3):(lt=7,4))}function D(_,A,W){var Z,z,Y=-1,it=A[1],X=0,lt=7,gt=4;for(it===0&&(lt=138,gt=3),Z=0;Z<=W;Z++)if(z=it,it=A[2*(Z+1)+1],!(++X<lt&&z===it)){if(X<gt)for(;G(_,z,_.bl_tree),--X!=0;);else z!==0?(z!==Y&&(G(_,z,_.bl_tree),X--),G(_,P,_.bl_tree),V(_,X-3,2)):X<=10?(G(_,T,_.bl_tree),V(_,X-3,3)):(G(_,N,_.bl_tree),V(_,X-11,7));Y=z,gt=(X=0)===it?(lt=138,3):z===it?(lt=6,3):(lt=7,4)}}l(q);var j=!1;function S(_,A,W,Z){V(_,(c<<1)+(Z?1:0),3),(function(z,Y,it,X){U(z),K(z,it),K(z,~it),i.arraySet(z.pending_buf,z.window,Y,it,z.pending),z.pending+=it})(_,A,W)}r._tr_init=function(_){j||((function(){var A,W,Z,z,Y,it=new Array(v+1);for(z=Z=0;z<u-1;z++)for(L[z]=Z,A=0;A<1<<M[z];A++)y[Z++]=z;for(y[Z-1]=z,z=Y=0;z<16;z++)for(q[z]=Y,A=0;A<1<<B[z];A++)O[Y++]=z;for(Y>>=7;z<f;z++)for(q[z]=Y<<7,A=0;A<1<<B[z]-7;A++)O[256+Y++]=z;for(W=0;W<=v;W++)it[W]=0;for(A=0;A<=143;)et[2*A+1]=8,A++,it[8]++;for(;A<=255;)et[2*A+1]=9,A++,it[9]++;for(;A<=279;)et[2*A+1]=7,A++,it[7]++;for(;A<=287;)et[2*A+1]=8,A++,it[8]++;for(J(et,m+1,it),A=0;A<f;A++)E[2*A+1]=5,E[2*A]=ot(A,5);Q=new rt(et,M,p+1,m,v),$=new rt(E,B,0,f,v),nt=new rt(new Array(0),F,0,x,w)})(),j=!0),_.l_desc=new b(_.dyn_ltree,Q),_.d_desc=new b(_.dyn_dtree,$),_.bl_desc=new b(_.bl_tree,nt),_.bi_buf=0,_.bi_valid=0,st(_)},r._tr_stored_block=S,r._tr_flush_block=function(_,A,W,Z){var z,Y,it=0;0<_.level?(_.strm.data_type===2&&(_.strm.data_type=(function(X){var lt,gt=4093624447;for(lt=0;lt<=31;lt++,gt>>>=1)if(1&gt&&X.dyn_ltree[2*lt]!==0)return o;if(X.dyn_ltree[18]!==0||X.dyn_ltree[20]!==0||X.dyn_ltree[26]!==0)return a;for(lt=32;lt<p;lt++)if(X.dyn_ltree[2*lt]!==0)return a;return o})(_)),mt(_,_.l_desc),mt(_,_.d_desc),it=(function(X){var lt;for(h(X,X.dyn_ltree,X.l_desc.max_code),h(X,X.dyn_dtree,X.d_desc.max_code),mt(X,X.bl_desc),lt=x-1;3<=lt&&X.bl_tree[2*H[lt]+1]===0;lt--);return X.opt_len+=3*(lt+1)+5+5+4,lt})(_),z=_.opt_len+3+7>>>3,(Y=_.static_len+3+7>>>3)<=z&&(z=Y)):z=Y=W+5,W+4<=z&&A!==-1?S(_,A,W,Z):_.strategy===4||Y===z?(V(_,2+(Z?1:0),3),dt(_,et,E)):(V(_,4+(Z?1:0),3),(function(X,lt,gt,ft){var kt;for(V(X,lt-257,5),V(X,gt-1,5),V(X,ft-4,4),kt=0;kt<ft;kt++)V(X,X.bl_tree[2*H[kt]+1],3);D(X,X.dyn_ltree,lt-1),D(X,X.dyn_dtree,gt-1)})(_,_.l_desc.max_code+1,_.d_desc.max_code+1,it+1),dt(_,_.dyn_ltree,_.dyn_dtree)),st(_),Z&&U(_)},r._tr_tally=function(_,A,W){return _.pending_buf[_.d_buf+2*_.last_lit]=A>>>8&255,_.pending_buf[_.d_buf+2*_.last_lit+1]=255&A,_.pending_buf[_.l_buf+_.last_lit]=255&W,_.last_lit++,A===0?_.dyn_ltree[2*W]++:(_.matches++,A--,_.dyn_ltree[2*(y[W]+p+1)]++,_.dyn_dtree[2*C(A)]++),_.last_lit===_.lit_bufsize-1},r._tr_align=function(_){V(_,2,3),G(_,k,et),(function(A){A.bi_valid===16?(K(A,A.bi_buf),A.bi_buf=0,A.bi_valid=0):8<=A.bi_valid&&(A.pending_buf[A.pending++]=255&A.bi_buf,A.bi_buf>>=8,A.bi_valid-=8)})(_)}},{"../utils/common":41}],53:[function(n,s,r){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,s,r){(function(i){(function(o,a){if(!o.setImmediate){var l,c,u,p,m=1,f={},x=!1,d=o.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(o);v=v&&v.setTimeout?v:o,l={}.toString.call(o.process)==="[object process]"?function(P){process.nextTick(function(){w(P)})}:(function(){if(o.postMessage&&!o.importScripts){var P=!0,T=o.onmessage;return o.onmessage=function(){P=!1},o.postMessage("","*"),o.onmessage=T,P}})()?(p="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",k,!1):o.attachEvent("onmessage",k),function(P){o.postMessage(p+P,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(P){w(P.data)},function(P){u.port2.postMessage(P)}):d&&"onreadystatechange"in d.createElement("script")?(c=d.documentElement,function(P){var T=d.createElement("script");T.onreadystatechange=function(){w(P),T.onreadystatechange=null,c.removeChild(T),T=null},c.appendChild(T)}):function(P){setTimeout(w,0,P)},v.setImmediate=function(P){typeof P!="function"&&(P=new Function(""+P));for(var T=new Array(arguments.length-1),N=0;N<T.length;N++)T[N]=arguments[N+1];var M={callback:P,args:T};return f[m]=M,l(m),m++},v.clearImmediate=g}function g(P){delete f[P]}function w(P){if(x)setTimeout(w,0,P);else{var T=f[P];if(T){x=!0;try{(function(N){var M=N.callback,B=N.args;switch(B.length){case 0:M();break;case 1:M(B[0]);break;case 2:M(B[0],B[1]);break;case 3:M(B[0],B[1],B[2]);break;default:M.apply(a,B)}})(T)}finally{g(P),x=!1}}}}function k(P){P.source===o&&typeof P.data=="string"&&P.data.indexOf(p)===0&&w(+P.data.slice(p.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Ue<"u"?Ue:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(An)),An.exports}var Zh=Kh();const Yh=Zr(Zh);var $t=(e=>(e.INVALID_FILE="INVALID_FILE",e.MISSING_MANIFEST="MISSING_MANIFEST",e.CORRUPTION="CORRUPTION",e.DATABASE_ERROR="DATABASE_ERROR",e.UNKNOWN="UNKNOWN",e))($t||{});class Vt extends Error{constructor(t,n){super(n),this.type=t,this.name="IngestionError"}}const rn=class rn{static async findCover(t,n){var s,r;try{const i=t.replace(/\(.*\)/,"").trim(),o=n.replace(/\(.*\)/,"").trim(),a=encodeURIComponent(`${i} ${o}`),l=new AbortController,c=setTimeout(()=>l.abort(),2500),u=await fetch(`${this.SEARCH_URL}?q=${a}&limit=1&fields=cover_i`,{signal:l.signal});if(clearTimeout(c),!u.ok)return;const m=(r=(s=(await u.json()).docs)==null?void 0:s[0])==null?void 0:r.cover_i;if(m)return`${this.IMAGE_URL}/${m}-L.jpg`}catch{}}};rn.SEARCH_URL="https://openlibrary.org/search.json",rn.IMAGE_URL="https://covers.openlibrary.org/b/id";let sn=rn;class ie{constructor(){this.dbName="FlowLibraryDB",this.version=2,this.db=null}static getInstance(){return ie.instance||(ie.instance=new ie),ie.instance}async init(){if(!this.db)return new Promise((t,n)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>n(s.error),s.onupgradeneeded=r=>{const i=r.target.result;i.objectStoreNames.contains("books")||i.createObjectStore("books",{keyPath:"id"}),i.objectStoreNames.contains("metadata")||i.createObjectStore("metadata",{keyPath:"id"}),i.objectStoreNames.contains("sources")||i.createObjectStore("sources")},s.onsuccess=r=>{this.db=r.target.result,t()}})}async saveBook(t){await this.init();const{chapters:n,...s}=t;await this.put("books",t),await this.put("metadata",s)}async saveSource(t,n){await this.init(),await this.put("sources",n,t)}async getSource(t){return await this.init(),this.get("sources",t)}async deleteBook(t){await this.init(),await this.delete("books",t),await this.delete("metadata",t),await this.delete("sources",t)}async getAllMetadata(){return await this.init(),this.getAll("metadata")}async getFullBook(t){return await this.init(),this.get("books",t)}async put(t,n,s){return new Promise((r,i)=>{const a=this.db.transaction(t,"readwrite").objectStore(t),l=s?a.put(n,s):a.put(n);l.onsuccess=()=>r(),l.onerror=()=>i(l.error)})}async get(t,n){return new Promise((s,r)=>{const a=this.db.transaction(t,"readonly").objectStore(t).get(n);a.onsuccess=()=>s(a.result),a.onerror=()=>r(a.error)})}async getAll(t){return new Promise((n,s)=>{const o=this.db.transaction(t,"readonly").objectStore(t).getAll();o.onsuccess=()=>n(o.result),o.onerror=()=>s(o.error)})}async delete(t,n){return new Promise((s,r)=>{const a=this.db.transaction(t,"readwrite").objectStore(t).delete(n);a.onsuccess=()=>s(),a.onerror=()=>r(a.error)})}}class me{constructor(){}static getInstance(){return me.instance||(me.instance=new me),me.instance}async ingest(t){try{console.log(`[Ingestion] Starting import of: ${t.name} (${(t.size/1024).toFixed(1)} KB)`),this.validateFile(t);let n;try{n=await t.arrayBuffer(),console.log(`[Ingestion] File loaded into memory: ${n.byteLength} bytes`)}catch(a){throw console.error("[Ingestion] Failed to read file:",a),new Vt($t.UNKNOWN,`Failed to read file: ${a instanceof Error?a.message:"Unknown error"}`)}const s=await this.unzipFromBuffer(n);console.log("[Ingestion] ZIP extracted, files:",Object.keys(s.files).length);const r=await this.parseContainer(s);console.log(`[Ingestion] OPF path: ${r}`);const i=await this.parseOPF(s,r);console.log(`[Ingestion] OPF parsed - Title: "${i.metadata.title}", Spine items: ${i.spine.length}`);const o=await this.constructBookFromZip(s,i);return console.log(`[Ingestion] Book constructed with ${o.chapters.length} chapters`),o.coverUrl||(o.coverUrl=await sn.findCover(o.title,o.author)),o.sourceType="epub",await this.persistBook(o,n),console.log("[Ingestion] Book persisted to storage"),o}catch(n){throw console.error("[Ingestion] Import failed:",n),n instanceof Vt?n:new Vt($t.UNKNOWN,n.message||"Unknown import error")}}async ingestFromText(t,n,s,r,i){const o=crypto.randomUUID(),a=this.heuristicChaptering(s),l={id:o,title:t,author:n,coverUrl:i,tintColorHex:r,lastOpened:new Date,isFinished:!1,bookmarkProgress:0,chapters:a,sourceType:"text"};l.coverUrl||(l.coverUrl=await sn.findCover(t,n));const u=new TextEncoder().encode(s).buffer;return await this.persistBook(l,u),l}async persistBook(t,n){const s=ie.getInstance();await s.saveBook(t),await s.saveSource(t.id,n)}heuristicChaptering(t){let n=t;const s=n.indexOf("*** START OF"),r=n.indexOf("*** END OF");if(s!==-1){const p=n.substring(s),m=p.indexOf(`
`,p.indexOf(`
`)+1);n=p.substring(m)}r!==-1&&(n=n.substring(0,r));const i=n.split(/\n\s*\n/),o=[];let a=[],l="Preface",c=1;const u=400;for(let p=0;p<i.length;p++){const f=i[p].replace(/\s+/g," ").trim();if(!f)continue;const x=/^(chapter|book|part|letter|prologue|epilogue|foreword|preface|stave|volume|vol\.)\s*([ivxlcdm\d]+|the\s+\w+)?/i.test(f),d=/^[IVXLCDM]+\.?$/.test(f),v=/^\d+\.?$/.test(f);if((x||d&&f.length<10||v&&f.length<5)&&f.length<100)if(Te(a.join(" "))>50||o.length===0){this.flushChapter(o,a,l,c++),a=[],l=f;continue}else{l=f;continue}a.push(f),a.length>=u&&(this.flushChapter(o,a,l,c++),a=[],l=`Part ${c}`)}return a.length>0&&this.flushChapter(o,a,l,c++),o}flushChapter(t,n,s,r){const i=n.map(l=>`<p>${l}</p>`).join(`
`),o=Te(i);let a=s.trim();t.push({id:crypto.randomUUID(),title:a,content:i,sortOrder:t.length,wordCount:o,estimatedReadTime:Math.ceil(o/250)})}async constructBookFromZip(t,n){const s=crypto.randomUUID();let r;if(n.coverPath){const a=t.file(n.coverPath);if(a){const l=await a.async("blob");r=URL.createObjectURL(l)}}const i=[],o=20;console.log(`[Ingestion] Processing ${n.spine.length} spine items for "${n.metadata.title}"`);for(let a=0;a<n.spine.length;a+=o){const l=n.spine.slice(a,a+o);(await Promise.all(l.map((u,p)=>this.processEpubChapter(t,u,a+p)))).forEach(u=>{u&&i.push(u)}),a+o<n.spine.length&&await new Promise(u=>setTimeout(u,0))}if(console.log(`[Ingestion] Extracted ${i.length} chapters from "${n.metadata.title}"`),i.length===0&&n.spine.length>0){console.warn("[Ingestion] No chapters extracted, trying without front-matter filter...");for(let a=0;a<n.spine.length;a++){const l=await this.processEpubChapterPermissive(t,n.spine[a],a);l&&i.push(l)}console.log(`[Ingestion] Permissive mode extracted ${i.length} chapters`)}return{id:s,title:n.metadata.title,author:n.metadata.author,coverUrl:r,lastOpened:new Date,isFinished:!1,bookmarkProgress:0,chapters:i}}async processEpubChapterPermissive(t,n,s){const r=t.file(n);if(!r)return console.warn(`[Ingestion] File not found: ${n}`),null;const i=await r.async("uint8array"),o=this.cleanTextAggressive(i),a=o.replace(/<[^>]+>/g," ").trim(),l=Te(a);return l<3?null:{id:crypto.randomUUID(),title:`Section ${s+1}`,content:o,sortOrder:s,wordCount:l,estimatedReadTime:Math.ceil(l/250)}}async processEpubChapter(t,n,s){const r=t.file(n);if(!r)return null;const i=await r.async("uint8array"),o=this.cleanTextAggressive(i),a=o.replace(/<[^>]+>/g," ").trim(),l=Te(a);return l<10||s<10&&this.isLikelyFrontMatter(a,l)?null:{id:crypto.randomUUID(),title:`Chapter ${s+1}`,content:o,sortOrder:s,wordCount:l,estimatedReadTime:Math.ceil(l/250)}}cleanTextAggressive(t){let n="";try{n=new TextDecoder("utf-8",{fatal:!0}).decode(t)}catch{n=new TextDecoder("windows-1252").decode(t)}return n=n.replace(/<(script|style|head)[^>]*>[\s\S]*?<\/\1>/gi,""),n=n.replace(/<br\s*\/?>/gi,"___BR___"),n=n.replace(/<\/(p|div|h\d|li|blockquote)>/gi,"___P___"),n=n.replace(/<[^>]+>/g,""),n=this.decodeEntities(n),n=n.replace(/\s+/g," "),n=n.replace(/___BR___/g,`
`),n=n.replace(/___P___/g,`

`),n.split(`

`).map(s=>s.trim()).filter(s=>s.length>0&&!/^\d+$/.test(s)).map(s=>`<p>${s}</p>`).join(`
`)}isLikelyFrontMatter(t,n){if(n>600)return!1;const s=t.toLowerCase().slice(0,1e3);return n<200&&/copyright|rights reserved|isbn|published by|table of contents|acknowledgments/.test(s)}decodeEntities(t){const n=document.createElement("textarea");return n.innerHTML=t,n.value}validateFile(t){if(!t.name.toLowerCase().endsWith(".epub")||t.size===0)throw new Vt($t.INVALID_FILE,"Invalid EPUB file.")}async unzipFromBuffer(t){try{const n=new Yh;console.log(`[Ingestion] Loading ZIP from ArrayBuffer (${t.byteLength} bytes)...`);const s=await n.loadAsync(t);return console.log("[Ingestion] ZIP loaded successfully"),s}catch(n){throw console.error("[Ingestion] ZIP extraction failed:",n),new Vt($t.CORRUPTION,`Corrupted archive: ${n instanceof Error?n.message:"Unknown error"}`)}}async unzip(t){const n=await t.arrayBuffer();return this.unzipFromBuffer(n)}async parseContainer(t){const n=t.file("META-INF/container.xml");if(!n)throw new Vt($t.MISSING_MANIFEST,"Missing container.xml");const r=(await n.async("string")).match(/full-path=["']([^"']+)["']/i);if(!r)throw new Vt($t.MISSING_MANIFEST,"Invalid container.xml");return r[1]}async parseOPF(t,n){var d,v,g,w,k;const s=t.file(n);if(!s)throw new Vt($t.MISSING_MANIFEST,"Missing OPF");const r=await s.async("string"),i=((v=(d=r.match(/<dc:title[^>]*>(.*?)<\/dc:title>/is))==null?void 0:d[1])==null?void 0:v.trim())||"Unknown",o=((w=(g=r.match(/<dc:creator[^>]*>(.*?)<\/dc:creator>/is))==null?void 0:g[1])==null?void 0:w.trim())||"Unknown",a=new Map,l=/<item\s+([^>]+?)\s*\/?>/gi;let c;for(;(c=l.exec(r))!==null;){const P=c[1],T=P.match(/id=["']([^"']+)["']/i),N=P.match(/href=["']([^"']+)["']/i);T&&N&&a.set(T[1],N[1])}console.log(`[Ingestion] Manifest has ${a.size} items`);const u=[],p=/<itemref\s+[^>]*idref=["']([^"']+)["'][^>]*\/?>/gi;let m;for(;(m=p.exec(r))!==null;){const P=m[1],T=a.get(P);T&&u.push(this.resolvePath(n,T))}if(console.log(`[Ingestion] Spine has ${u.length} items`),u.length===0){console.warn("[Ingestion] Empty spine, falling back to manifest HTML files");for(const[P,T]of a)/\.(x?html?|htm)$/i.test(T)&&u.push(this.resolvePath(n,T));u.sort(),console.log(`[Ingestion] Fallback found ${u.length} HTML files`)}const f=(k=r.match(/<meta\s+name=["']cover["']\s+content=["']([^"']+)["']/i))==null?void 0:k[1];let x=f?a.get(f):void 0;return x&&(x=this.resolvePath(n,x)),{metadata:{title:i,author:o},spine:u,coverPath:x}}resolvePath(t,n){return(t.substring(0,t.lastIndexOf("/")+1)+n).replace(/\/+/g,"/")}}class jt{static pulse(t){if(typeof navigator>"u"||!navigator.vibrate)return;const n=t.punctuation||"";if(/[.?!]/.test(n)){navigator.vibrate(15);return}if(/[,;:]/.test(n)){navigator.vibrate(5);return}}static impactMedium(){typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(20)}static impactLight(){typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(5)}static selectionChanged(){typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(3)}}const Xh=()=>{const e=re.getInstance(),t=e.mode,n=Jt(),s=i=>{e.setMode(i)},r=["Modern","Sepia","Night","OLED"];return I.jsxs("div",{className:"flex flex-col gap-3",children:[I.jsx("h3",{className:"text-[11px] font-medium opacity-50 lowercase",style:{color:n.secondaryText},children:"appearance"}),I.jsx("div",{className:"grid grid-cols-4 gap-2",children:r.map(i=>{const o=ue[i],a=t===i;return I.jsxs("button",{onClick:()=>s(i),className:"group relative flex flex-col items-center gap-1.5 outline-none",children:[I.jsxs("div",{className:`relative w-full aspect-[4/5] rounded-xl border transition-all duration-200 ease-out overflow-hidden ${a?"ring-2 ring-offset-1 scale-[1.03]":"hover:scale-[1.02]"}`,style:{backgroundColor:o.background,borderColor:a?"transparent":"rgba(128,128,128,0.15)",ringColor:n.accent},children:[I.jsxs("div",{className:"absolute inset-3 flex flex-col items-center justify-center",children:[I.jsx("div",{className:"font-serif text-xl font-semibold",style:{color:o.primaryText},children:"Aa"}),I.jsx("div",{className:"w-full h-0.5 rounded-full mt-2 opacity-15",style:{backgroundColor:o.primaryText}}),I.jsx("div",{className:"w-2/3 h-0.5 rounded-full mt-1 opacity-15",style:{backgroundColor:o.primaryText}})]}),a&&I.jsx("div",{className:"absolute bottom-1.5 right-1.5 w-3.5 h-3.5 rounded-full flex items-center justify-center",style:{backgroundColor:n.accent},children:I.jsx("svg",{width:"8",height:"6",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:I.jsx("path",{d:"M1 4L3.5 6.5L9 1",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),I.jsx("span",{className:"text-[9px] font-medium transition-colors lowercase",style:{color:a?n.accent:n.secondaryText,opacity:a?1:.6},children:i})]},i)})}),I.jsxs("div",{className:"mt-1 flex items-center justify-between p-3 rounded-xl border",style:{backgroundColor:n.surface,borderColor:n.borderColor},children:[I.jsx("span",{className:"text-xs font-medium lowercase",style:{color:n.primaryText},children:"follow system"}),I.jsx("button",{onClick:()=>s(t==="System"?"Modern":"System"),className:"relative w-10 h-5 rounded-full transition-colors duration-200 focus:outline-none",style:{backgroundColor:t==="System"?n.accent:n.borderColor},children:I.jsx("div",{className:`absolute top-0.5 left-0.5 bg-white w-4 h-4 rounded-full shadow-sm transition-transform duration-200 ${t==="System"?"translate-x-5":"translate-x-0"}`})})]})]})},Jh=()=>{const{settings:e,updateSettings:t}=ze(),n=Jt(),[s,r]=R.useState(e.rsvpSpeed),i=R.useRef(null);R.useEffect(()=>{Math.abs(e.rsvpSpeed-s)>10&&!i.current&&r(e.rsvpSpeed)},[e.rsvpSpeed]);const o=l=>{const c=Math.max(100,Math.min(1e3,l));r(c),i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{t({rsvpSpeed:c,hasCustomSpeed:!0}),i.current=null},100)},a=[{name:"Serif",label:"fancy",val:"New York"},{name:"Sans",label:"clean",val:"SF Pro"}];return I.jsxs("div",{className:"flex flex-col gap-6 pt-2",children:[I.jsxs("div",{className:"space-y-3",children:[I.jsxs("h3",{className:"text-[11px] font-medium opacity-50 lowercase flex items-center gap-1.5",style:{color:n.secondaryText},children:[I.jsx(qh,{size:12})," pace"]}),I.jsxs("div",{className:"rounded-2xl p-4 border",style:{backgroundColor:n.surface,borderColor:n.borderColor},children:[I.jsxs("div",{className:"flex items-center justify-between mb-3",children:[I.jsx("span",{className:"text-sm font-medium lowercase",style:{color:n.primaryText},children:"speed (wpm)"}),I.jsx("span",{className:"text-xl font-semibold tracking-tight tabular-nums",style:{color:n.primaryText},children:s})]}),I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx("button",{onClick:()=>o(s-25),className:"w-10 h-10 rounded-xl flex items-center justify-center active:scale-95 transition-all",style:{backgroundColor:n.borderColor,color:n.primaryText},children:I.jsx(xo,{size:16})}),I.jsx("div",{className:"flex-1 relative h-8 flex items-center",children:I.jsx("input",{type:"range",min:100,max:1e3,step:25,value:s,onChange:l=>o(parseInt(l.target.value)),className:"w-full h-1.5 rounded-full appearance-none cursor-pointer focus:outline-none",style:{backgroundColor:n.borderColor,accentColor:n.accent}})}),I.jsx("button",{onClick:()=>o(s+25),className:"w-10 h-10 rounded-xl flex items-center justify-center active:scale-95 transition-all",style:{backgroundColor:n.borderColor,color:n.primaryText},children:I.jsx(wo,{size:16})})]})]})]}),I.jsx("div",{className:"w-full h-px",style:{backgroundColor:n.borderColor}}),I.jsxs("div",{className:"space-y-3",children:[I.jsxs("h3",{className:"text-[11px] font-medium opacity-50 lowercase flex items-center gap-1.5",style:{color:n.secondaryText},children:[I.jsx(Ae,{size:12})," typography"]}),I.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.map(l=>I.jsxs("button",{onClick:()=>t({fontFamily:l.val}),className:`flex flex-col items-center justify-center gap-1.5 p-5 rounded-2xl border transition-all duration-200 ${e.fontFamily===l.val?"scale-[1.02]":"hover:scale-[1.01]"}`,style:{backgroundColor:e.fontFamily===l.val?n.primaryText:n.surface,borderColor:e.fontFamily===l.val?n.primaryText:n.borderColor,color:e.fontFamily===l.val?n.surface:n.primaryText},children:[I.jsx("span",{className:"text-2xl font-semibold",style:{fontFamily:Qh(l.val)},children:"Aa"}),I.jsxs("div",{className:"flex flex-col items-center",children:[I.jsx("span",{className:"text-sm font-medium",children:l.name}),I.jsx("span",{className:"text-[9px] font-medium opacity-50",style:{color:e.fontFamily===l.val?n.surface:n.secondaryText},children:l.label})]})]},l.val))}),I.jsxs("div",{className:"rounded-2xl p-4 border space-y-5 mt-3",style:{backgroundColor:n.surface,borderColor:n.borderColor},children:[I.jsx(Rn,{label:"size",value:e.fontSize,min:14,max:40,onChange:l=>t({fontSize:l}),theme:n}),I.jsx(Rn,{label:"room",value:e.lineHeight,min:1,max:2.2,step:.1,onChange:l=>t({lineHeight:l}),theme:n}),I.jsx(Rn,{label:"gaps",value:e.paragraphSpacing,min:0,max:40,onChange:l=>t({paragraphSpacing:l}),theme:n})]})]})]})},Rn=({label:e,value:t,min:n,max:s,step:r=1,onChange:i,theme:o})=>I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx("span",{className:"text-xs font-medium w-12 lowercase",style:{color:o.secondaryText},children:e}),I.jsx("input",{type:"range",min:n,max:s,step:r,value:t,onChange:a=>i(parseFloat(a.target.value)),className:"flex-1 h-1 rounded-full appearance-none cursor-pointer",style:{backgroundColor:o.borderColor,accentColor:o.accent}}),I.jsx("span",{className:"text-xs font-medium w-8 text-right tabular-nums",style:{color:o.primaryText},children:t.toFixed(r<1?1:0)})]});function Qh(e){return e==="New York"?"serif":e==="SF Pro"?"sans-serif":"serif"}const td="570686176836-dtbdhnverff6qo63tfbgvmrts2oadqmp.apps.googleusercontent.com",ed="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.appdata";class oe{constructor(){this.accessToken=null,this.tokenExpiry=0,this.libraryFolderId=null}static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}get isAuthenticated(){return!!this.accessToken&&Date.now()<this.tokenExpiry}async init(){window.google&&(this.tokenClient=window.google.accounts.oauth2.initTokenClient({client_id:td,scope:ed,callback:t=>{if(t.error!==void 0)throw t;this.accessToken=t.access_token,this.tokenExpiry=Date.now()+Number(t.expires_in)*1e3-6e4}}))}async signIn(){return this.tokenClient||await this.init(),new Promise(t=>{this.tokenClient.callback=n=>{n.access_token&&(this.accessToken=n.access_token,this.tokenExpiry=Date.now()+Number(n.expires_in)*1e3-6e4,t())},this.accessToken&&Date.now()<this.tokenExpiry?t():this.tokenClient.requestAccessToken({prompt:"consent"})})}async fetch(t,n={}){this.isAuthenticated||await this.signIn();const s={Authorization:`Bearer ${this.accessToken}`,...n.headers||{}};n.body instanceof FormData?delete s["Content-Type"]:s["Content-Type"]||(s["Content-Type"]="application/json");const r=async o=>fetch(t,{...n,headers:o});let i=await r(s);return i.status===401&&(await this.signIn(),s.Authorization=`Bearer ${this.accessToken}`,i=await r(s)),!i.ok&&i.status!==404&&console.warn(`[DriveService] Request failed: ${t} (${i.status})`),i}async getUserInfo(){return(await(await this.fetch("https://www.googleapis.com/oauth2/v3/userinfo")).json()).email}async ensureLibraryFolder(){if(this.libraryFolderId)return this.libraryFolderId;const s=await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("mimeType='application/vnd.google-apps.folder' and name='Flow Library' and trashed=false")}`)).json();if(s.files&&s.files.length>0)return this.libraryFolderId=s.files[0].id,this.libraryFolderId;const i=await(await this.fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",body:JSON.stringify({name:"Flow Library",mimeType:"application/vnd.google-apps.folder"})})).json();return this.libraryFolderId=i.id,this.libraryFolderId}async uploadFile(t,n){const s=await this.ensureLibraryFolder(),r={name:t,parents:[s]},i=new FormData;return i.append("metadata",new Blob([JSON.stringify(r)],{type:"application/json"})),i.append("file",n),(await(await this.fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",body:i})).json()).id}async listBooks(){const n=`'${await this.ensureLibraryFolder()}' in parents and mimeType!='application/vnd.google-apps.folder' and trashed=false`;return(await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(n)}&fields=files(id, name, modifiedTime, size, mimeType)`)).json()).files||[]}async downloadFile(t){return(await this.fetch(`https://www.googleapis.com/drive/v3/files/${t}?alt=media`)).arrayBuffer()}async getSyncState(){const s=await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name='flow_state.json' and 'appDataFolder' in parents and trashed=false")}&spaces=appDataFolder`)).json();if(!s.files||s.files.length===0)return null;const r=s.files[0].id,i=await this.fetch(`https://www.googleapis.com/drive/v3/files/${r}?alt=media`);try{return await i.json()}catch{return null}}async saveSyncState(t){const r=await(await this.fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name='flow_state.json' and 'appDataFolder' in parents and trashed=false")}&spaces=appDataFolder`)).json(),i=new Blob([JSON.stringify(t)],{type:"application/json"});if(r.files&&r.files.length>0){const o=r.files[0].id;await this.fetch(`https://www.googleapis.com/upload/drive/v3/files/${o}?uploadType=media`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:i})}else{const o={name:"flow_state.json",parents:["appDataFolder"]},a=new FormData;a.append("metadata",new Blob([JSON.stringify(o)],{type:"application/json"})),a.append("file",i),await this.fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",body:a})}}}class ge{constructor(){this.status="idle",this.listeners=new Set,this.isSyncing=!1,this.pendingSync=!1,this.drive=oe.getInstance(),this.storage=ie.getInstance(),this.ingestion=me.getInstance(),this.settings=Ct.getInstance()}static getInstance(){return ge.instance||(ge.instance=new ge),ge.instance}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyStatus(t){this.status=t,this.listeners.forEach(n=>{var s;return(s=n.onStatusChange)==null?void 0:s.call(n,t)})}async connect(){try{await this.drive.signIn();const t=await this.drive.getUserInfo();return this.settings.updateSettings({isSyncEnabled:!0,googleDriveEmail:t}),this.syncNow(!0),this.syncTimer&&clearInterval(this.syncTimer),this.syncTimer=setInterval(()=>this.syncNow(!1),3e5),t}catch(t){throw console.error(t),new Error("Failed to connect Google Drive")}}requestSync(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.syncNow(!1)},2e3)}async syncNow(t=!1){if(this.settings.getSettings().isSyncEnabled&&!(!t&&!this.drive.isAuthenticated)){if(this.isSyncing){this.pendingSync=!0;return}this.isSyncing=!0,this.notifyStatus("syncing");try{await this.syncState(),await this.syncBooks(),this.notifyStatus("success"),setTimeout(()=>this.notifyStatus("idle"),3e3)}catch(n){console.error("[SyncManager] Sync failed",n),this.notifyStatus("error")}finally{this.isSyncing=!1,this.pendingSync&&(this.pendingSync=!1,this.syncNow(!1))}}}async syncState(){const t=await this.storage.getAllMetadata(),n=await this.drive.getSyncState();if(!n){const i=this.buildSyncState(t);await this.drive.saveSyncState(i);return}if(n.preferences){const i=this.settings.getSettings();JSON.stringify(i)!==JSON.stringify(n.preferences)&&this.settings.updateSettings(n.preferences)}let s=!1;const r=n.books||{};for(const i of t){this.getFingerprint(i);let o=Object.keys(r).find(a=>{const l=r[a];return!!(i.driveId&&l.driveId===i.driveId)});if(o){const a=r[o],l=new Date(i.lastOpened).getTime(),c=a.lastOpened,u=c>l+1e4,p=l>c+1e4;u?await this.applyRemoteUpdate(i,a):p?(r[o]=this.mapBookToSyncEntry(i),s=!0):(a.progress||0)>(i.bookmarkProgress||0)?await this.applyRemoteUpdate(i,a):(i.bookmarkProgress||0)>(a.progress||0)&&(r[o]=this.mapBookToSyncEntry(i),s=!0)}else r[i.id]=this.mapBookToSyncEntry(i),s=!0}s&&(n.timestamp=Date.now(),n.books=r,await this.drive.saveSyncState(n))}async syncBooks(){const t=await this.drive.listBooks(),n=await this.storage.getAllMetadata(),s=new Map,r=new Map;n.forEach(i=>{i.driveId&&s.set(i.driveId,i),r.set(this.getFingerprint(i),i)});for(const i of t){if(s.has(i.id))continue;const o=this.parseFilename(i.name),a=`${o.title}|${o.author}`,l=r.get(a);if(l){console.log(`[Sync] Linking existing book "${l.title}" to Drive ID: ${i.id}`),l.driveId=i.id,await this.storage.saveBook(l);continue}try{console.log(`[Sync] Downloading new book: ${i.name}`);const c=await this.drive.downloadFile(i.id);let u;const p=i.name.toLowerCase().endsWith(".txt")||i.mimeType==="text/plain";if(p){const f=new TextDecoder().decode(c);u=await this.ingestion.ingestFromText(o.title,o.author,f)}else{const m=new Blob([c],{type:"application/epub+zip"}),f=new File([m],i.name,{type:"application/epub+zip"});u=await this.ingestion.ingest(f)}u.driveId=i.id,u.sourceType=p?"text":"epub",await this.storage.saveBook(u),this.listeners.forEach(m=>{var f;return(f=m.onNewBook)==null?void 0:f.call(m,u)})}catch(c){console.error(`[Sync] Download failed for ${i.name}`,c)}}for(const i of n)if(!i.driveId)try{const o=await this.storage.getSource(i.id);if(o){console.log(`[Sync] Uploading: ${i.title}`);let a,l;i.sourceType==="text"?(a=new Blob([o],{type:"text/plain"}),l=`${this.sanitizeFilename(i.title)} - ${this.sanitizeFilename(i.author)}.txt`):(a=new Blob([o],{type:"application/epub+zip"}),l=`${this.sanitizeFilename(i.title)}.epub`);const c=await this.drive.uploadFile(l,a);i.driveId=c,await this.storage.saveBook(i)}}catch(o){console.error(`[Sync] Upload failed for ${i.title}`,o)}}async applyRemoteUpdate(t,n){(t.bookmarkProgress!==n.progress||t.isFinished!==n.isFinished)&&(t.bookmarkProgress=n.progress,t.lastTokenIndex=n.lastTokenIndex,t.isFinished=n.isFinished,t.lastOpened=new Date(n.lastOpened),await this.storage.saveBook(t),this.listeners.forEach(s=>{var r;return(r=s.onNewBook)==null?void 0:r.call(s,t)}))}buildSyncState(t){const n={version:1,timestamp:Date.now(),books:{},preferences:this.settings.getSettings()};return t.forEach(s=>{n.books[s.id]=this.mapBookToSyncEntry(s)}),n}mapBookToSyncEntry(t){return{progress:t.bookmarkProgress,lastTokenIndex:t.lastTokenIndex,isFinished:t.isFinished,lastOpened:new Date(t.lastOpened).getTime(),driveId:t.driveId}}getFingerprint(t){return`${t.title.trim().toLowerCase()}|${t.author.trim().toLowerCase()}`}parseFilename(t){const n=t.replace(/\.(txt|epub)$/i,""),s=n.split(" - ");return s.length>=2?{title:s[0].trim(),author:s.slice(1).join(" - ").trim()}:{title:n.trim(),author:"Unknown Author"}}sanitizeFilename(t){return t.replace(/[^a-z0-9 \-_]/gi,"").trim()}resolveConflict(t,n){t.bookmarkProgress=n,this.storage.saveBook(t),this.listeners.forEach(s=>{var r;return(r=s.onNewBook)==null?void 0:r.call(s,t)})}}const nd=({onClose:e})=>{const[t,n]=R.useState("optical"),s=Jt(),{settings:r}=ze(),[i,o]=R.useState(!1),a=async()=>{o(!0);try{await ge.getInstance().connect()}catch{alert("Could not connect to Google Drive.")}finally{o(!1)}},l=oe.getInstance().isAuthenticated;return I.jsxs("div",{className:"flex flex-col h-full transition-colors duration-300",style:{backgroundColor:s.background},children:[I.jsxs("div",{className:"flex items-center justify-between px-6 py-5 border-b",style:{borderColor:s.borderColor},children:[I.jsx("div",{children:I.jsx("h2",{className:"text-xl font-bold lowercase tracking-tight",style:{color:s.primaryText},children:"settings"})}),I.jsx("button",{onClick:e,className:"w-11 h-11 rounded-full flex items-center justify-center transition-all active:scale-95",style:{backgroundColor:`${s.primaryText}08`},children:I.jsx(Hh,{size:20,style:{color:s.primaryText}})})]}),(!r.isSyncEnabled||!l)&&I.jsx("div",{className:"px-6 pt-5",children:I.jsxs("button",{onClick:a,disabled:i,className:"w-full p-4 rounded-2xl flex items-center justify-between active:scale-[0.98] transition-all",style:{backgroundColor:s.surface,border:`1px solid ${s.borderColor}`},children:[I.jsxs("div",{className:"flex items-center gap-3",children:[I.jsx("div",{className:"p-2 rounded-xl bg-blue-500 text-white",children:I.jsx(zr,{size:16})}),I.jsxs("div",{className:"text-left",children:[I.jsx("h3",{className:"text-sm font-semibold lowercase",style:{color:s.primaryText},children:r.isSyncEnabled?"reconnect cloud":"enable cloud sync"}),I.jsx("p",{className:"text-[10px] opacity-40",style:{color:s.secondaryText},children:r.isSyncEnabled?"session expired":"sync via google drive"})]})]}),I.jsx("span",{className:"text-xs font-semibold text-blue-500",children:i?"...":"connect"})]})}),r.isSyncEnabled&&l&&I.jsx("div",{className:"px-6 pt-5",children:I.jsxs("div",{className:"w-full p-4 rounded-2xl flex items-center gap-3 border",style:{backgroundColor:s.surface,borderColor:s.borderColor},children:[I.jsx("div",{className:"p-2 rounded-xl bg-emerald-500 text-white",children:I.jsx(zr,{size:16})}),I.jsxs("div",{className:"flex-1 min-w-0",children:[I.jsx("h3",{className:"text-sm font-semibold lowercase",style:{color:s.primaryText},children:"synced"}),I.jsx("p",{className:"text-[10px] opacity-40 truncate",style:{color:s.secondaryText},children:r.googleDriveEmail||"connected"})]}),I.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"})]})}),I.jsx("div",{className:"px-6 pt-5 z-10",children:I.jsxs("div",{className:"flex p-0.5 rounded-xl border",style:{borderColor:s.borderColor},children:[I.jsxs("button",{onClick:()=>n("optical"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg text-xs font-medium transition-all lowercase",style:{backgroundColor:t==="optical"?s.surface:"transparent",color:t==="optical"?s.primaryText:s.secondaryText,opacity:t==="optical"?1:.5},children:[I.jsx(Ph,{size:14})," theme"]}),I.jsxs("button",{onClick:()=>n("typo"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg text-xs font-medium transition-all lowercase",style:{backgroundColor:t==="typo"?s.surface:"transparent",color:t==="typo"?s.primaryText:s.secondaryText,opacity:t==="typo"?1:.5},children:[I.jsx(Ae,{size:14})," typography"]})]})}),I.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar px-6 pb-10 pt-5",children:[I.jsx("div",{className:`transition-opacity duration-200 ${t==="optical"?"block":"hidden"}`,children:I.jsx(Xh,{})}),I.jsx("div",{className:`transition-opacity duration-200 ${t==="typo"?"block":"hidden"}`,children:I.jsx(Jh,{})})]})]})},sd=({book:e,onClick:t})=>{const n=R.useMemo(()=>{var c;let i=((c=e.chapters)==null?void 0:c.reduce((u,p)=>u+p.wordCount,0))||e.title.length*500;const o=36,a=64,l=Math.min(1,Math.max(0,i/1e5));return o+l*(a-o)},[e]),s=R.useMemo(()=>{const i=e.author.split(" ");return i.length>0?i[i.length-1]:e.author},[e.author]),r=e.tintColorHex||"#333";return I.jsxs(Uu.div,{layoutId:`spine-${e.id}`,onClick:t,className:"relative h-72 cursor-pointer group mx-[1px] mb-0 rounded-sm overflow-hidden transform-gpu",style:{width:`${n}px`,backgroundColor:r,boxShadow:"inset 0 0 15px rgba(0,0,0,0.3), inset 1px 0 0 rgba(255,255,255,0.1)"},whileHover:{y:-8,zIndex:10,transition:{type:"spring",stiffness:400,damping:25}},children:[I.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none mix-blend-multiply grayscale",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}}),I.jsx("div",{className:"absolute top-0 bottom-0 left-[2px] w-[1px] bg-black/20"}),I.jsx("div",{className:"absolute top-0 bottom-0 right-[2px] w-[1px] bg-black/20"}),I.jsxs("div",{className:"absolute inset-0 flex flex-col items-center py-6 px-1 z-20",children:[I.jsx("div",{className:"flex-none pt-2 pb-6",style:{writingMode:"vertical-rl",textOrientation:"mixed"},children:I.jsx("span",{className:"font-sans text-[9px] font-bold text-white/70 uppercase tracking-[0.15em]",children:s})}),I.jsx("div",{className:"flex-1 flex items-center justify-center w-full overflow-hidden",style:{writingMode:"vertical-rl",textOrientation:"mixed"},children:I.jsx("span",{className:"font-serif font-semibold text-xs md:text-sm tracking-wide text-white/95 text-center leading-relaxed line-clamp-3",style:{textShadow:"0 1px 2px rgba(0,0,0,0.5)",fontVariant:"small-caps"},children:e.title.toLowerCase()})}),I.jsx("div",{className:"flex-none mt-auto pt-4 opacity-50",children:I.jsx("div",{className:"w-4 h-4 border border-white/60 rounded-full flex items-center justify-center",children:I.jsx("div",{className:"w-1.5 h-1.5 bg-white/60 rounded-sm"})})})]}),I.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/20 via-transparent to-black/20 pointer-events-none"})]})},Kd=({books:e,onInspectBook:t})=>I.jsx("div",{className:"relative w-full pb-32",children:I.jsxs("div",{className:"flex flex-wrap items-end gap-y-16 px-6 perspective-[1000px]",children:[e.map(n=>I.jsx(sd,{book:n,onClick:()=>t(n)},n.id)),I.jsx("div",{className:"w-full h-2 rounded-full bg-current opacity-[0.03] mt-[-4px] blur-[1px]"})]})});function Kn(){return Kn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Kn.apply(null,arguments)}function Vr(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zn(e,t){return Zn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Zn(e,t)}function rd(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Zn(e,t)}var Ur=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function id(e,t){return!!(e===t||Ur(e)&&Ur(t))}function od(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!id(e[n],t[n]))return!1;return!0}function Mn(e,t){t===void 0&&(t=od);var n,s=[],r,i=!1;function o(){for(var a=[],l=0;l<arguments.length;l++)a[l]=arguments[l];return i&&n===this&&t(a,s)||(r=e.apply(this,a),i=!0,n=this,s=a),r}return o}var ad=typeof performance=="object"&&typeof performance.now=="function",$r=ad?function(){return performance.now()}:function(){return Date.now()};function Wr(e){cancelAnimationFrame(e.id)}function ld(e,t){var n=$r();function s(){$r()-n>=t?e.call(null):r.id=requestAnimationFrame(s)}var r={id:requestAnimationFrame(s)};return r}var jn=-1;function Hr(e){if(e===void 0&&(e=!1),jn===-1||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",document.body.appendChild(t),jn=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return jn}var ce=null;function Gr(e){if(e===void 0&&(e=!1),ce===null||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var s=document.createElement("div"),r=s.style;return r.width="100px",r.height="100px",t.appendChild(s),document.body.appendChild(t),t.scrollLeft>0?ce="positive-descending":(t.scrollLeft=1,t.scrollLeft===0?ce="negative":ce="positive-ascending"),document.body.removeChild(t),ce}return ce}var cd=150,ud=function(t,n){return t};function hd(e){var t,n=e.getItemOffset,s=e.getEstimatedTotalSize,r=e.getItemSize,i=e.getOffsetForIndexAndAlignment,o=e.getStartIndexForOffset,a=e.getStopIndexForStartIndex,l=e.initInstanceProps,c=e.shouldResetStyleCacheOnItemSizeChange,u=e.validateProps;return t=(function(p){rd(m,p);function m(x){var d;return d=p.call(this,x)||this,d._instanceProps=l(d.props,Vr(d)),d._outerRef=void 0,d._resetIsScrollingTimeoutId=null,d.state={instance:Vr(d),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof d.props.initialScrollOffset=="number"?d.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},d._callOnItemsRendered=void 0,d._callOnItemsRendered=Mn(function(v,g,w,k){return d.props.onItemsRendered({overscanStartIndex:v,overscanStopIndex:g,visibleStartIndex:w,visibleStopIndex:k})}),d._callOnScroll=void 0,d._callOnScroll=Mn(function(v,g,w){return d.props.onScroll({scrollDirection:v,scrollOffset:g,scrollUpdateWasRequested:w})}),d._getItemStyle=void 0,d._getItemStyle=function(v){var g=d.props,w=g.direction,k=g.itemSize,P=g.layout,T=d._getItemStyleCache(c&&k,c&&P,c&&w),N;if(T.hasOwnProperty(v))N=T[v];else{var M=n(d.props,v,d._instanceProps),B=r(d.props,v,d._instanceProps),F=w==="horizontal"||P==="horizontal",H=w==="rtl",et=F?M:0;T[v]=N={position:"absolute",left:H?void 0:et,right:H?et:void 0,top:F?0:M,height:F?"100%":B,width:F?B:"100%"}}return N},d._getItemStyleCache=void 0,d._getItemStyleCache=Mn(function(v,g,w){return{}}),d._onScrollHorizontal=function(v){var g=v.currentTarget,w=g.clientWidth,k=g.scrollLeft,P=g.scrollWidth;d.setState(function(T){if(T.scrollOffset===k)return null;var N=d.props.direction,M=k;if(N==="rtl")switch(Gr()){case"negative":M=-k;break;case"positive-descending":M=P-w-k;break}return M=Math.max(0,Math.min(M,P-w)),{isScrolling:!0,scrollDirection:T.scrollOffset<M?"forward":"backward",scrollOffset:M,scrollUpdateWasRequested:!1}},d._resetIsScrollingDebounced)},d._onScrollVertical=function(v){var g=v.currentTarget,w=g.clientHeight,k=g.scrollHeight,P=g.scrollTop;d.setState(function(T){if(T.scrollOffset===P)return null;var N=Math.max(0,Math.min(P,k-w));return{isScrolling:!0,scrollDirection:T.scrollOffset<N?"forward":"backward",scrollOffset:N,scrollUpdateWasRequested:!1}},d._resetIsScrollingDebounced)},d._outerRefSetter=function(v){var g=d.props.outerRef;d._outerRef=v,typeof g=="function"?g(v):g!=null&&typeof g=="object"&&g.hasOwnProperty("current")&&(g.current=v)},d._resetIsScrollingDebounced=function(){d._resetIsScrollingTimeoutId!==null&&Wr(d._resetIsScrollingTimeoutId),d._resetIsScrollingTimeoutId=ld(d._resetIsScrolling,cd)},d._resetIsScrolling=function(){d._resetIsScrollingTimeoutId=null,d.setState({isScrolling:!1},function(){d._getItemStyleCache(-1,null)})},d}m.getDerivedStateFromProps=function(d,v){return dd(d,v),u(d),null};var f=m.prototype;return f.scrollTo=function(d){d=Math.max(0,d),this.setState(function(v){return v.scrollOffset===d?null:{scrollDirection:v.scrollOffset<d?"forward":"backward",scrollOffset:d,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},f.scrollToItem=function(d,v){v===void 0&&(v="auto");var g=this.props,w=g.itemCount,k=g.layout,P=this.state.scrollOffset;d=Math.max(0,Math.min(d,w-1));var T=0;if(this._outerRef){var N=this._outerRef;k==="vertical"?T=N.scrollWidth>N.clientWidth?Hr():0:T=N.scrollHeight>N.clientHeight?Hr():0}this.scrollTo(i(this.props,d,v,P,this._instanceProps,T))},f.componentDidMount=function(){var d=this.props,v=d.direction,g=d.initialScrollOffset,w=d.layout;if(typeof g=="number"&&this._outerRef!=null){var k=this._outerRef;v==="horizontal"||w==="horizontal"?k.scrollLeft=g:k.scrollTop=g}this._callPropsCallbacks()},f.componentDidUpdate=function(){var d=this.props,v=d.direction,g=d.layout,w=this.state,k=w.scrollOffset,P=w.scrollUpdateWasRequested;if(P&&this._outerRef!=null){var T=this._outerRef;if(v==="horizontal"||g==="horizontal")if(v==="rtl")switch(Gr()){case"negative":T.scrollLeft=-k;break;case"positive-ascending":T.scrollLeft=k;break;default:var N=T.clientWidth,M=T.scrollWidth;T.scrollLeft=M-N-k;break}else T.scrollLeft=k;else T.scrollTop=k}this._callPropsCallbacks()},f.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&Wr(this._resetIsScrollingTimeoutId)},f.render=function(){var d=this.props,v=d.children,g=d.className,w=d.direction,k=d.height,P=d.innerRef,T=d.innerElementType,N=d.innerTagName,M=d.itemCount,B=d.itemData,F=d.itemKey,H=F===void 0?ud:F,et=d.layout,E=d.outerElementType,O=d.outerTagName,y=d.style,L=d.useIsScrolling,Q=d.width,$=this.state.isScrolling,nt=w==="horizontal"||et==="horizontal",q=nt?this._onScrollHorizontal:this._onScrollVertical,rt=this._getRangeToRender(),b=rt[0],C=rt[1],K=[];if(M>0)for(var V=b;V<=C;V++)K.push(R.createElement(v,{data:B,key:H(V,B),index:V,isScrolling:L?$:void 0,style:this._getItemStyle(V)}));var G=s(this.props,this._instanceProps);return R.createElement(E||O||"div",{className:g,onScroll:q,ref:this._outerRefSetter,style:Kn({position:"relative",height:k,width:Q,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:w},y)},R.createElement(T||N||"div",{children:K,ref:P,style:{height:nt?"100%":G,pointerEvents:$?"none":void 0,width:nt?G:"100%"}}))},f._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var d=this.props.itemCount;if(d>0){var v=this._getRangeToRender(),g=v[0],w=v[1],k=v[2],P=v[3];this._callOnItemsRendered(g,w,k,P)}}if(typeof this.props.onScroll=="function"){var T=this.state,N=T.scrollDirection,M=T.scrollOffset,B=T.scrollUpdateWasRequested;this._callOnScroll(N,M,B)}},f._getRangeToRender=function(){var d=this.props,v=d.itemCount,g=d.overscanCount,w=this.state,k=w.isScrolling,P=w.scrollDirection,T=w.scrollOffset;if(v===0)return[0,0,0,0];var N=o(this.props,T,this._instanceProps),M=a(this.props,N,T,this._instanceProps),B=!k||P==="backward"?Math.max(1,g):1,F=!k||P==="forward"?Math.max(1,g):1;return[Math.max(0,N-B),Math.max(0,Math.min(v-1,M+F)),N,M]},m})(R.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var dd=function(t,n){t.children,t.direction,t.height,t.layout,t.innerTagName,t.outerTagName,t.width,n.instance},fd=hd({getItemOffset:function(t,n){var s=t.itemSize;return n*s},getItemSize:function(t,n){var s=t.itemSize;return s},getEstimatedTotalSize:function(t){var n=t.itemCount,s=t.itemSize;return s*n},getOffsetForIndexAndAlignment:function(t,n,s,r,i,o){var a=t.direction,l=t.height,c=t.itemCount,u=t.itemSize,p=t.layout,m=t.width,f=a==="horizontal"||p==="horizontal",x=f?m:l,d=Math.max(0,c*u-x),v=Math.min(d,n*u),g=Math.max(0,n*u-x+u+o);switch(s==="smart"&&(r>=g-x&&r<=v+x?s="auto":s="center"),s){case"start":return v;case"end":return g;case"center":{var w=Math.round(g+(v-g)/2);return w<Math.ceil(x/2)?0:w>d+Math.floor(x/2)?d:w}case"auto":default:return r>=g&&r<=v?r:r<g?g:v}},getStartIndexForOffset:function(t,n){var s=t.itemCount,r=t.itemSize;return Math.max(0,Math.min(s-1,Math.floor(n/r)))},getStopIndexForStartIndex:function(t,n,s){var r=t.direction,i=t.height,o=t.itemCount,a=t.itemSize,l=t.layout,c=t.width,u=r==="horizontal"||l==="horizontal",p=n*a,m=u?c:i,f=Math.ceil((m+s-p)/a);return Math.max(0,Math.min(o-1,n+f-1))},initInstanceProps:function(t){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(t){t.itemSize}}),qr={};class pd{constructor(){this.worker=null,this.tokens=[],this.rawTokens=[],this.currentIndex=0,this.timer=null,this.playing=!1,this.subscribers=new Set,this.wpm=300;const t=typeof Worker<"u"&&typeof import.meta<"u",n=(()=>{try{const s=typeof require<"u"?require("worker_threads"):null;return!!(s&&s.Worker)}catch{return!1}})();if(t||n)try{this.worker=new Worker(new URL(""+new URL("newRsvpWorker-BsNbGu9X.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=s=>{const r=s.data;if(r)if(r.type==="chunk"){const i=(r.tokens||[]).map(o=>({index:o.index,text:o.text,duration:o.duration}));this.rawTokens=this.rawTokens.concat(i),this.tokens=Ht(this.rawTokens,this.wpm),this.notify()}else r.type==="progress"||(r.type==="prepared"?(this.rawTokens=(r.tokens||[]).map(i=>({index:i.index,text:i.text,duration:i.duration})),this.tokens=Ht(this.rawTokens,this.wpm),this.currentIndex=0,this.playing=!1,this.notify()):r.type==="error"&&(typeof process<"u"&&qr&&qr.DEBUG||typeof import.meta<"u"&&!1?console.error("newRsvpWorker error:",r.message):console.debug&&console.debug("newRsvpWorker (debug):",r.message)))}}catch{console.debug&&console.debug("newRsvpEngine: worker unavailable, using main-thread fallback"),this.worker=null}else console.debug&&console.debug("newRsvpEngine: worker not available; falling back to main-thread parser"),this.worker=null}async prepare(t,n=300,s=1){return new Promise((r,i)=>{if(this.wpm=n,!this.worker){const a=t.replace(/\s+/g," ").trim().split(" ").filter(Boolean);this.rawTokens=a.map((l,c)=>({index:c,text:l,duration:Math.round(6e4/Math.max(1,n))})),this.tokens=Ht(this.rawTokens,this.wpm),this.currentIndex=0,this.notify(),r();return}const o=a=>{const l=a.data;l&&(l.type==="prepared"?(this.worker.removeEventListener("message",o),this.tokens=(l.tokens||[]).map(c=>({index:c.index,text:c.text,duration:c.duration})),this.currentIndex=0,this.notify(),r()):l.type==="error"&&(this.worker.removeEventListener("message",o),i(new Error(l.message||"Worker error"))))};this.tokens=[],this.worker.addEventListener("message",o),this.worker.postMessage({type:"prepare",content:t,wpm:n,chunkSize:s})})}play(){this.playing||this.tokens.length!==0&&(this.playing=!0,this.scheduleNext(),this.notify())}pause(){this.playing&&(this.playing=!1,this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.notify())}togglePlay(){this.playing?this.pause():this.play()}seek(t){this.currentIndex=Math.max(0,Math.min(t,this.tokens.length-1)),this.playing&&(this.timer&&window.clearTimeout(this.timer),this.scheduleNext()),this.notify()}getCurrent(){return this.tokens[this.currentIndex]||null}scheduleNext(){const t=this.tokens[this.currentIndex];if(!t){this.playing=!1,this.notify();return}this.notify();const n=Math.round(6e4/Math.max(1,this.wpm||300)),s=t.durationMultiplier?Math.round(n*t.durationMultiplier):n;this.timer=window.setTimeout(()=>{if(this.currentIndex=Math.min(this.tokens.length-1,this.currentIndex+1),this.currentIndex>=this.tokens.length-1){this.playing=!1,this.notify(),this.timer=null;return}this.scheduleNext()},s)}subscribe(t){return this.subscribers.add(t),t({index:this.currentIndex,token:this.getCurrent(),isPlaying:this.playing}),()=>this.subscribers.delete(t)}updateWPM(t){this.wpm=Math.max(1,Math.floor(t||300)),this.tokens=Ht(this.rawTokens,this.wpm),this.notify()}getIndex(){return this.currentIndex}getTokens(){return this.tokens.slice()}getTokensRaw(){return this.rawTokens.map(t=>({index:t.index??0,text:t.text??"",duration:t.duration??0}))}notify(){const t=this.getCurrent();this.subscribers.forEach(n=>n({index:this.currentIndex,token:t,isPlaying:this.playing}))}}const ht=new pd;function Ht(e,t){const n=6e4/Math.max(1,t);return(e||[]).map(s=>{const r=(s.text||"").trim(),i=r.length,o=Math.max(0,Math.floor(i/2)),a=r.slice(0,o),l=r.charAt(o)||"",c=r.slice(o+1),u=r.match(/[.!?,;:]+$/),p=s.duration?s.duration/n:1;return{id:`e-${s.index}`,originalText:r,leftSegment:a,centerCharacter:l,rightSegment:c,punctuation:u?u[0]:void 0,durationMultiplier:p,isSentenceEnd:!!u&&/[.!?]/.test(u[0]),isParagraphEnd:!1,globalIndex:s.index,startOffset:-1}})}var Rt=(e=>(e.IDLE="IDLE",e.PLAYING="PLAYING",e.PAUSED="PAUSED",e.FINISHED="FINISHED",e))(Rt||{});class At{constructor(){this.engineIndex=0,this.state="IDLE",this.listeners=new Set,this.lastSavedIndex=-1,this.lastContentRef=null,this.preparationPromise=null,this.wakeLock=null,this.notifyScheduled=!1,this.core=Nt.getInstance();try{ht.subscribe(({index:s,token:r,isPlaying:i})=>{typeof s=="number"&&(this.engineIndex=s),!i&&this.state==="PLAYING"&&(this.state="PAUSED",this.releaseWakeLock()),typeof s=="number"&&Math.abs(s-this.lastSavedIndex)>=100&&(this.syncProgressToCore(!0,s,r),this.lastSavedIndex=s);const o=ht.getTokensRaw();!i&&o&&o.length>0&&s>=o.length-1&&(this.state="FINISHED",this.releaseWakeLock()),this.notify()})}catch{}const t=Ct.getInstance(),n=t.getSettings().rsvpSpeed;this.updateWPM(n),t.subscribe(()=>{const s=t.getSettings().rsvpSpeed;this.updateWPM(s)}),document.addEventListener("visibilitychange",async()=>{this.wakeLock!==null&&document.visibilityState==="visible"&&this.state==="PLAYING"&&await this.requestWakeLock()})}static getInstance(){return At.instance||(At.instance=new At),At.instance}async prepare(t,n={}){if(this.lastContentRef===t&&ht.getTokensRaw().length>0){this.applyConfig(n);return}if(this.preparationPromise)try{if(await this.preparationPromise,this.lastContentRef===t){this.applyConfig(n);return}}catch{}this.preparationPromise=(async()=>{try{await ht.prepare(t,Ct.getInstance().getSettings().rsvpSpeed),this.lastContentRef=t}finally{this.preparationPromise=null}})(),await this.preparationPromise,this.applyConfig(n)}applyConfig(t){const n=Ct.getInstance().getSettings(),s=ht.getTokensRaw(),r=Ht(s,n.rsvpSpeed);let i=0;if(t.index!==void 0)i=Math.max(0,Math.min(t.index,r.length-1));else if(t.offset!==void 0){const o=t.offset,a=r.findIndex(l=>l.startOffset>=o);a!==-1?i=a:i=Math.max(0,r.length-1)}else{const o=t.progress??0;i=Math.max(0,Math.min(Math.floor(r.length*o),r.length-1))}try{ht.seek(i)}catch{}this.state="PAUSED",this.lastSavedIndex=i,this.notify()}togglePlay(){this.state==="PLAYING"?this.pause():this.play()}play(){if(this.state==="FINISHED"){try{ht.seek(0)}catch{}this.state="PAUSED",jt.impactMedium()}ht.getTokensRaw().length!==0&&(this.state="PLAYING",ht.play(),this.requestWakeLock(),this.notify())}pause(t=!1){if(this.state="PAUSED",ht.pause(),this.releaseWakeLock(),!t){const n=this.engineIndex,r=Math.max(0,n-1);if(r!==n)try{ht.seek(r)}catch{}}this.syncProgressToCore(!0),this.notify()}seekRelative(t){const n=this.engineIndex,s=n+t;if(s!==n){this.state==="PLAYING"&&this.pause(!0);try{ht.seek(s)}catch{}this.syncProgressToCore(!0)}}shutdown(t=!0){t&&this.syncProgressToCore(!0);try{ht.pause()}catch{}this.state="IDLE",this.releaseWakeLock(),this.lastContentRef=null,this.notify()}updateWPM(t){ht.updateWPM(t)}async requestWakeLock(){if("wakeLock"in navigator)try{this.wakeLock=await navigator.wakeLock.request("screen")}catch(t){console.warn("Wake Lock request failed:",t)}}releaseWakeLock(){this.wakeLock&&this.wakeLock.release().then(()=>{this.wakeLock=null}).catch(t=>console.error(t))}syncProgressToCore(t=!1,n,s){const r=typeof n=="number"?n:this.engineIndex,i=Ct.getInstance().getSettings(),o=ht.getTokensRaw(),a=Ht(o,i.rsvpSpeed),l=s??a[r]??null;(a&&a.length||this.core.totalTokens||0)!==0&&(l&&l.startOffset!==void 0&&l.startOffset>=0?this.core.syncFromRSVP(l.startOffset,r):r>0&&this.core.saveProgress(r))}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.notifyScheduled||(this.notifyScheduled=!0,queueMicrotask(()=>{this.notifyScheduled=!1,this.listeners.forEach(t=>t())}))}}class md{constructor(){this._content="",this.attributes={},this.layoutManagers=[]}get string(){return this._content}set string(t){this._content=t}addLayoutManager(t){this.layoutManagers.push(t)}}class gd{constructor(t){this.widthTracksTextView=!1,this.heightTracksTextView=!1,this.lineFragmentPadding=5,this.size=t}}class Kr{constructor(t){this.textContainers=[],this.id=t}addTextContainer(t){this.textContainers.push(t)}enumerateTextSegments(t,n,s){s({x:0,y:0,width:0,height:0})}}class Nt{constructor(){this.listeners=new Set,this.jumpListeners=new Set,this.offsetJumpListeners=new Set,this.progressListeners=new Set,this.isLoading=!1,this.loadingProgress=0,this.currentBook=null,this.currentProgress=0,this.isRSVPMode=!1,this.globalCharacterOffset=0,this.userSelectionOffset=null,this.totalTokens=1,this.chapterTokenOffsets=[],this._loadTimestamp=0,this._lastSavedTokenIndex=-1,this._userIntentionalRewind=!1,this.contentStorage=new md,this.primaryLayout=new Kr("primary"),this.ghostLayout=new Kr("ghost"),this.configurePipeline(),Ct.getInstance().subscribe(()=>this.updateTypography())}static getInstance(){return Nt.instance||(Nt.instance=new Nt),Nt.instance}configurePipeline(){this.contentStorage.addLayoutManager(this.primaryLayout),this.contentStorage.addLayoutManager(this.ghostLayout)}async load(t){var s;this._loadTimestamp=Date.now(),this._lastSavedTokenIndex=-1,this._userIntentionalRewind=!1,this.isLoading=!0,this.loadingProgress=.1,this.notify();const n={...t};if(((s=this.currentBook)==null?void 0:s.id)===t.id&&this.contentStorage.string.length>0){n.lastTokenIndex!==void 0&&(this.currentBook.lastTokenIndex=n.lastTokenIndex,this.totalTokens>0&&(this.currentProgress=Math.min(1,n.lastTokenIndex/this.totalTokens))),this.currentBook.bookmarkProgress=n.bookmarkProgress||this.currentProgress,this.isLoading=!1,this.loadingProgress=1,this.notify();return}this.unload(),this.notify(),await new Promise(r=>setTimeout(r,50));try{const r=n.chapters?[...n.chapters]:[];r.sort((l,c)=>l.sortOrder-c.sortOrder),this.chapterTokenOffsets=[];let i=0;const o=[],a=r.length;for(let l=0;l<a;l++){l%3===0&&(this.loadingProgress=.1+.8*(l/a),this.notify(),await new Promise(m=>setTimeout(m,0)));const u=(r[l].content||"").replace(/<(?:.|\n)*?>/gm," ").replace(/&nbsp;/g," ").replace(/\s+/g," ").trim(),p=Te(u);this.chapterTokenOffsets.push(i),i+=p,o.push(u)}this.totalTokens=Math.max(1,i),this.contentStorage.string=o.join(`

`),this.currentBook=n,n.lastTokenIndex!==void 0?(this.currentBook.lastTokenIndex=n.lastTokenIndex,this.currentProgress=Math.min(1,n.lastTokenIndex/this.totalTokens)):(this.currentProgress=n.bookmarkProgress||0,this.currentProgress>0&&(this.currentBook.lastTokenIndex=Math.floor(this.currentProgress*this.totalTokens))),this.currentBook.bookmarkProgress=this.currentProgress,this.updateTypography(),At.getInstance().prepare(this.contentStorage.string).catch(()=>{})}catch(r){console.error("[TitanCore] Critical Error loading book:",r)}finally{this.isLoading=!1,this.loadingProgress=1,this.notify()}}unload(){this.currentBook=null,this.contentStorage.string="",this.userSelectionOffset=null,this.isRSVPMode=!1,this.totalTokens=1,this.chapterTokenOffsets=[]}updateTypography(){const t=Ct.getInstance().getSettings();let n='"New York Extra Large", "Times New Roman", serif';t.fontFamily==="SF Pro"&&(n='"SF Pro Rounded", -apple-system, sans-serif'),t.fontFamily==="OpenDyslexic"&&(n='"OpenDyslexic", "Comic Sans MS", sans-serif'),t.fontFamily==="Atkinson Hyperlegible"&&(n='"Atkinson Hyperlegible", sans-serif');const s=t.fontSize<18?"500":t.fontSize>32?"300":"400";this.contentStorage.attributes={fontFamily:n,fontSize:`${t.fontSize}px`,lineHeight:`${t.lineHeight}`,paragraphSpacing:`${t.paragraphSpacing}px`,letterSpacing:"0.2px",fontWeight:s,color:"inherit"},this.notify()}updateLayout(t){this.primaryLayout.textContainers=[];const n=new gd(t);n.widthTracksTextView=!0,this.primaryLayout.addTextContainer(n),this.notify()}saveProgress(t,n=!1){if(!this.currentBook||typeof t!="number"||t<0||t===this._lastSavedTokenIndex&&!n)return;n&&t===0&&(this._userIntentionalRewind=!0);const s=Date.now()-this._loadTimestamp,r=this.currentBook.lastTokenIndex||0;if(t===0&&r>50&&s<3e3&&!this._userIntentionalRewind)return;this._lastSavedTokenIndex=t,this.currentBook.lastTokenIndex=t;let i=0;this.totalTokens>0&&(i=t/this.totalTokens),(isNaN(i)||!isFinite(i))&&(i=0),this.currentProgress=Math.min(1,Math.max(0,i)),this.currentBook.bookmarkProgress=this.currentProgress,this.currentBook.lastOpened=new Date,this.currentProgress>=.99&&(this.currentBook.isFinished=!0),this.progressListeners.forEach(o=>o(this.currentProgress)),this.notify()}restorePosition(t,n){return 0}jump(t){if(this.currentProgress=Math.max(0,Math.min(1,t)),this.currentBook&&this.totalTokens>0){const n=Math.floor(t*this.totalTokens);this.currentBook.lastTokenIndex=n,this.currentBook.bookmarkProgress=this.currentProgress,this.jumpListeners.forEach(s=>s(t)),this.progressListeners.forEach(s=>s(t))}this.notify()}jumpToChapter(t){if(t<0||t>=this.chapterTokenOffsets.length)return;const n=this.chapterTokenOffsets[t];t===0&&(this._userIntentionalRewind=!0),this.currentBook.lastTokenIndex=n,this.totalTokens>0&&(this.currentProgress=n/this.totalTokens,this.currentBook.bookmarkProgress=this.currentProgress),this.jumpListeners.forEach(s=>s(this.currentProgress)),this.progressListeners.forEach(s=>s(this.currentProgress)),this.notify()}syncFromRSVP(t,n){this.globalCharacterOffset=t,this.saveProgress(n),this.offsetJumpListeners.forEach(s=>s(t))}selectText(t){this.userSelectionOffset=t,this.notify()}onJump(t){return this.jumpListeners.add(t),()=>this.jumpListeners.delete(t)}onOffsetJump(t){return this.offsetJumpListeners.add(t),()=>this.offsetJumpListeners.delete(t)}onProgress(t){return this.progressListeners.add(t),()=>this.progressListeners.delete(t)}rectForRange(t){return null}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t())}}const yd=R.memo(({token:e,isActive:t,theme:n})=>I.jsx("span",{id:`w-${e.globalIndex}`,"data-idx":e.globalIndex,"data-off":e.startOffset,className:`inline py-0.5 rounded-[2px] cursor-pointer select-none transition-colors duration-200 ${t?"":"hover:opacity-60"}`,style:{backgroundColor:t?n.accent:"transparent",color:t?"#FFFFFF":"inherit",boxDecorationBreak:"clone",WebkitBoxDecorationBreak:"clone"},children:e.originalText})),bo=R.memo(({text:e,settings:t,startTokenIndex:n,onParagraphClick:s})=>I.jsx("p",{id:`p-${n}`,"data-start-index":n,onClick:()=>s(n),className:"max-w-[60ch] mx-auto box-border relative cursor-pointer hover:opacity-100 transition-opacity scroll-mt-32",style:{fontSize:`${t.fontSize}px`,lineHeight:t.lineHeight,marginBottom:t.paragraphSpacing,fontFamily:t.fontFamily==="New York"?"serif":"sans-serif",color:"inherit",opacity:.9,whiteSpace:"pre-line",textAlign:"justify",hyphens:"auto",WebkitHyphens:"auto"},children:e})),ko=R.memo(({tokens:e,activeIndex:t,onWordClick:n,settings:s,theme:r,startTokenIndex:i})=>{const o=R.useCallback(a=>{const l=a.target;if(l.dataset.idx){a.stopPropagation();const c=parseInt(l.dataset.idx||"-1"),u=parseInt(l.dataset.off||"0");c>=0&&n(c,u)}},[n]);return I.jsx("p",{id:`p-${i}`,"data-start-index":i,onClick:o,className:"max-w-[60ch] mx-auto box-border relative scroll-mt-32",style:{fontSize:`${s.fontSize}px`,lineHeight:s.lineHeight,marginBottom:s.paragraphSpacing,fontFamily:s.fontFamily==="New York"?"serif":"sans-serif",opacity:.9,whiteSpace:"pre-line",textAlign:"justify",hyphens:"auto",WebkitHyphens:"auto"},children:e.map((a,l)=>I.jsxs(Ao.Fragment,{children:[I.jsx(yd,{token:a,isActive:a.globalIndex===t,theme:r})," "]},a.id))})});R.memo(({sectionIndex:e,paragraphs:t,activeParagraphIndex:n,activeIndex:s,onWordClick:r,onParagraphClick:i,settings:o,theme:a})=>I.jsx("div",{children:t.map((l,c)=>{const u=e*30+c;return Math.abs(u-n)<=1?I.jsx(ko,{startTokenIndex:l.startIndex,tokens:l.tokens,activeIndex:s,onWordClick:r,settings:o,theme:a},u):I.jsx(bo,{text:l.plainText,settings:o,startTokenIndex:l.startIndex,onParagraphClick:i},u)})}));const vd=({book:e,onToggleChrome:t,onRequestRSVP:n,isActive:s})=>{R.useEffect(()=>{console.log("[TitanReaderView] Book open effect triggered for",e.title,"at",new Date().toISOString());const h=performance.now();return()=>{const D=performance.now();console.log(`[TitanReaderView] Book open effect cleanup for ${e.title} after ${(D-h).toFixed(2)}ms`)}},[e.id]);const r=Nt.getInstance(),i=At.getInstance(),o=Jt(),{settings:a}=ze(),l=R.useRef(null),[c,u]=R.useState([]),[p,m]=R.useState(-1),f=R.useRef(-1),[x,d]=R.useState(!1),[v,g]=R.useState(0),[w,k]=R.useState(!1),[P,T]=R.useState(0),[N,M]=R.useState("book"),[B,F]=R.useState(""),[H,et]=R.useState(!1),[E,O]=R.useState(!1);R.useEffect(()=>{if(!x){const h=setInterval(()=>{F(D=>D.length<3?D+".":"")},400);return()=>clearInterval(h)}},[x]);const[y,L]=R.useState(!1),Q=R.useRef(!1),$=R.useRef(null);R.useRef(null);const nt=R.useCallback(h=>{m(h),f.current=h},[]),q=R.useRef(null),rt=R.useRef(null),b=R.useRef(!1),C=R.useCallback((h,D)=>{q.current={index:h,smooth:D},rt.current&&clearTimeout(rt.current),rt.current=window.setTimeout(()=>{b.current||(b.current=!0,requestAnimationFrame(()=>{const j=q.current;if(q.current=null,!j||!l.current){b.current=!1;return}let{index:S,smooth:_}=j,A=document.getElementById(`w-${S}`);if(!A){const X=Array.from(l.current.querySelectorAll("p[data-start-index]"));let lt=null,gt=-1;for(const ft of X){const kt=parseInt(ft.dataset.startIndex||"-1");kt<=S&&kt>gt&&(lt=ft,gt=kt)}A=lt}if(!A){if(r.totalTokens>0){const X=S/r.totalTokens,gt=l.current.scrollHeight*X;l.current.scrollTo({top:gt,behavior:_?"smooth":"instant"})}b.current=!1;return}Q.current=!0;const W=l.current,Z=W.clientHeight*.15;let z=A.offsetTop,Y=A.offsetParent;for(;Y&&Y!==W;)z+=Y.offsetTop,Y=Y.offsetParent;const it=z-Z;W.scrollTo({top:Math.max(0,it),behavior:_?"smooth":"instant"}),setTimeout(()=>{Q.current=!1},_?600:100),b.current=!1}))},16)},[]);R.useEffect(()=>{var _;"scrollRestoration"in history&&(history.scrollRestoration="manual"),d(!1),L(!1),Q.current=!0;const D=(((_=r.currentBook)==null?void 0:_.id)===e.id?r.currentBook.lastTokenIndex:void 0)??e.lastTokenIndex;D!==void 0&&nt(D);const j=r.subscribe(()=>{g(r.loadingProgress)});return(async()=>{var A;if(d(!1),L(!1),g(0),k(!1),T(0),M("book"),u([]),!e.chapters||e.chapters.length===0){console.error("[TitanReaderView] Book has no chapters! This indicates a data loading issue.",{bookId:e.id,title:e.title,hasChapters:!!e.chapters,chaptersLength:(A=e.chapters)==null?void 0:A.length}),d(!0),L(!0);return}try{M("book"),await r.load(e),g(1),M("tokenize"),k(!0);const W=r.contentStorage.string;W||console.warn("[TitanReaderView] Loaded book has no content string.");let Z=0;T(.01);const z=setInterval(()=>{Z+=.07+Math.random()*.08,T(Y=>Math.min(.98,Math.max(Y,Z)))},120);await i.prepare(W,{progress:0}),clearInterval(z),T(1),k(!1)}catch(W){console.error("[TitanReaderView] Initialization pipeline failed:",W)}finally{const W=ht.getTokens();u(W),d(!0),requestAnimationFrame(()=>{L(!0)})}})(),()=>j()},[e.id,nt]),R.useEffect(()=>{const h=()=>{var W;const _=(W=r.currentBook)==null?void 0:W.lastTokenIndex;if(_===void 0)return;const A=Math.abs(_-f.current);if(A>0&&(nt(_),A>10)){const Z=r.isRSVPMode;C(_,Z)}},D=_=>{if(r.totalTokens>0){const A=Math.floor(_*r.totalTokens);nt(A),C(A,r.isRSVPMode)}},j=r.subscribe(h),S=r.onJump(D);return()=>{j(),S()}},[nt,C]),R.useEffect(()=>{const h=At.getInstance();let D=h.state;const j=()=>{const _=h.state;if(D==="PLAYING"&&_==="PAUSED"){const A=ht.getIndex();nt(A),C(A,!0)}D=_},S=h.subscribe(j);return()=>S()},[nt,C]),R.useLayoutEffect(()=>{if(!x||c.length===0)return;requestAnimationFrame(()=>{var j;const D=(((j=r.currentBook)==null?void 0:j.id)===e.id?r.currentBook.lastTokenIndex:e.lastTokenIndex)??-1;D<=10?(l.current&&(l.current.scrollTop=0),setTimeout(()=>{L(!0),Q.current=!1},100)):(C(D,!1),setTimeout(()=>L(!0),100))})},[x,c.length,e.id,C]);const K=R.useRef(null),V=R.useRef(-1),G=R.useCallback(h=>{V.current=h,K.current&&clearTimeout(K.current),K.current=window.setTimeout(()=>{V.current>=0&&r.saveProgress(V.current),K.current=null},500)},[]);R.useEffect(()=>()=>{K.current&&(V.current>=0&&r.saveProgress(V.current),clearTimeout(K.current))},[]),R.useEffect(()=>{var S;if(!y||!s){$.current&&$.current.disconnect();return}$.current&&$.current.disconnect();const h=_=>{if(!Q.current){for(const A of _)if(A.isIntersecting){const W=A.target,Z=parseInt(W.dataset.startIndex||"-1");if(Z>=0){nt(Z),G(Z);break}}}},D={root:l.current,rootMargin:"-10% 0px -60% 0px",threshold:0};$.current=new IntersectionObserver(h,D);const j=(S=l.current)==null?void 0:S.querySelectorAll("p[data-start-index]");return j==null||j.forEach(_=>{var A;return(A=$.current)==null?void 0:A.observe(_)}),()=>{var _;return(_=$.current)==null?void 0:_.disconnect()}},[y,c.length,nt]);const ot=R.useMemo(()=>{const h=performance.now(),D=[];let j=[],S=-1;for(const A of c)j.length===0&&(S=A.globalIndex),j.push(A),A.isParagraphEnd&&(D.push({tokens:j,startIndex:S,plainText:j.map(W=>W.originalText).join(" ")}),j=[]);j.length>0&&D.push({tokens:j,startIndex:S===-1?0:S,plainText:j.map(A=>A.originalText).join(" ")});const _=performance.now();return console.log(`[TitanReaderView] Token-to-paragraph mapping took ${(_-h).toFixed(2)}ms for ${c.length} tokens, ${D.length} paragraphs.`),D},[c]),J=R.useCallback((h,D)=>{nt(h),r.saveProgress(h),n&&n(D,h)},[n,nt]),st=R.useCallback(h=>{nt(h),r.saveProgress(h)},[nt]),U=R.useMemo(()=>ot.findIndex(h=>p>=h.startIndex&&p<h.startIndex+h.tokens.length),[ot,p]),tt=R.useRef(null),[at,dt]=R.useState(()=>window.innerHeight*.7);R.useEffect(()=>{const h=()=>{const j=l.current?l.current.clientHeight:window.innerHeight;dt(Math.max(200,Math.floor(j*.7)))};h();const D=new ResizeObserver(h);return l.current&&D.observe(l.current),window.addEventListener("resize",h),()=>{D.disconnect(),window.removeEventListener("resize",h)}},[]),R.useEffect(()=>{if(!(!tt.current||U<0))try{tt.current.scrollToItem(U,"center")}catch{}},[U]);const mt=R.useCallback(({index:h,style:D})=>{const j=ot[h];if(!j)return null;const S=Math.abs(h-U)<=1;return I.jsx("div",{style:D,children:S?I.jsx(ko,{startTokenIndex:j.startIndex,tokens:j.tokens,activeIndex:p,onWordClick:J,settings:a,theme:o}):I.jsx(bo,{text:j.plainText,settings:a,startTokenIndex:j.startIndex,onParagraphClick:st})},j.startIndex)},[ot,U,p,J,st,a,o]);return I.jsxs("div",{ref:l,className:"absolute inset-0 z-10 w-full h-full overflow-y-auto overflow-x-hidden custom-scrollbar box-border",style:{backgroundColor:o.background,color:o.primaryText,scrollBehavior:"auto",WebkitOverflowScrolling:"touch",touchAction:"pan-y",overscrollBehaviorY:"contain",transform:"translateZ(0)"},onClick:h=>{h.target===h.currentTarget&&t()},children:[!x&&I.jsxs(I.Fragment,{children:[I.jsx("div",{style:{position:"fixed",top:0,left:0,zIndex:9999,color:"red",background:"white",fontSize:"12px",padding:"2px"},children:"[TitanReaderView] Waiting for isReady..."}),I.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100] pointer-events-auto",style:{backgroundColor:o.background},children:I.jsxs("div",{className:"w-12 h-12 relative",children:[I.jsx("div",{className:"absolute inset-0 rounded-full border-2 opacity-20",style:{borderColor:o.accent}}),I.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-t-transparent animate-spin",style:{borderColor:o.accent,borderTopColor:"transparent"}})]})})]}),x&&c.length===0&&I.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[50] pointer-events-none",style:{backgroundColor:o.background},children:I.jsxs("div",{className:"flex flex-col items-center gap-4 px-8 text-center",children:[I.jsx("div",{className:"text-4xl opacity-30",children:""}),I.jsx("span",{className:"text-lg font-medium",style:{color:o.secondaryText},children:"No content available"}),I.jsx("span",{className:"text-sm opacity-60",style:{color:o.secondaryText},children:"This book appears to be empty or failed to load."})]})}),I.jsxs("div",{className:"w-full min-h-[100dvh] px-6 md:px-0 py-24 md:py-32 box-border relative",children:[I.jsx(fd,{ref:tt,height:at,itemCount:ot.length,itemSize:120,width:"100%",overscanCount:6,itemKey:h=>{const D=ot[h];return String(D?D.startIndex:h)},children:mt}),I.jsx("div",{className:"h-[40vh]"})]})]})},xd=({onTap:e,onLongPressExit:t,onRewindStateChange:n})=>{const s=At.getInstance(),r=Jt(),{settings:i}=ze(),o=R.useRef(null),a=R.useRef(null),[l,c]=R.useState(0),[u,p]=R.useState([]),[m,f]=R.useState(!1),[x,d]=R.useState(0),[v,g]=R.useState(!1),w=R.useRef(-1),k=R.useRef([]),P=R.useRef({x:0,y:0,time:0}),T=R.useRef(null),N=R.useRef(null),M=R.useRef(0),B=R.useRef(new Map),F=300,H="#E25822",et=35.5,E="clamp(2.5rem, 10vw, 4rem)";R.useEffect(()=>{const J=ht.getTokensRaw();if(J&&J.length>0){const tt=Ht(J,i.rsvpSpeed);p(tt),k.current=tt,w.current=0,c(0)}f(s.state===Rt.PLAYING);const st=s.subscribe(()=>f(s.state===Rt.PLAYING)),U=ht.subscribe(({index:tt,token:at,isPlaying:dt})=>{const mt=typeof tt=="number"?tt:0;f(dt);const h=ht.getTokensRaw();if(h&&h.length>0){const D=Ht(h,i.rsvpSpeed);p(D),k.current=D}else at&&(p([at]),k.current=[at]);mt!==w.current&&(w.current=mt,c(mt))});return()=>{st(),U()}},[]);const O=R.useMemo(()=>u[l]||null,[u,l]),y=!m||i.showGhostPreview,L=5,Q=R.useMemo(()=>{if(u.length===0)return[];if(!y)return O?[{token:O,globalIdx:l}]:[];const J=Math.max(0,l-L),st=Math.min(u.length-1,l+L);return u.slice(J,st+1).map((U,tt)=>({token:U,globalIdx:J+tt}))},[u,l,y,L,O]);R.useLayoutEffect(()=>{var dt;if(!a.current)return;const J=a.current,st=Array.from(J.children),tt=(((dt=o.current)==null?void 0:dt.clientWidth)||window.innerWidth)*(et/100);B.current.clear(),st.forEach(mt=>{const h=parseInt(mt.dataset.idx||"0"),D=mt.getBoundingClientRect(),j=J.getBoundingClientRect(),S=D.left-j.left;let _=S+D.width/2;h===l&&O&&(_=S+D.width/2),B.current.set(h,{left:S,width:D.width,center:_})});const at=B.current.get(l);if(at){const mt=tt-at.center;try{document.documentElement.style.setProperty("--rsvp-center-delta",`${mt.toFixed(2)}px`)}catch{}d(mt)}},[Q,l,O]),R.useEffect(()=>()=>{T.current&&clearTimeout(T.current),N.current&&clearInterval(N.current)},[]);const $=J=>{var st,U;if(J.stopPropagation(),(U=(st=J.target).setPointerCapture)==null||U.call(st,J.pointerId),!m){t==null||t();return}P.current={x:J.clientX,y:J.clientY,time:Date.now()},T.current=setTimeout(()=>{g(!0),jt.impactLight(),M.current=l;try{ht.pause()}catch{s.pause()}N.current=setInterval(()=>{M.current=Math.max(0,M.current-1),c(M.current),jt.selectionChanged()},300)},F)},nt=J=>{if(v){const st=Math.abs(J.clientX-P.current.x),U=Math.abs(J.clientY-P.current.y);(st>50||U>50)&&b()}},q=J=>{var st,U;if((U=(st=J.target).releasePointerCapture)==null||U.call(st,J.pointerId),T.current&&(clearTimeout(T.current),T.current=null,m))try{m?ht.pause():ht.play()}catch{s.state===Rt.PLAYING?s.pause(!0):s.play()}b()},rt=J=>{var st,U;(U=(st=J.target).releasePointerCapture)==null||U.call(st,J.pointerId),T.current&&(clearTimeout(T.current),T.current=null),b()},b=()=>{if(v){N.current&&(clearInterval(N.current),N.current=null),g(!1);try{ht.pause()}catch{}const J=ht.getTokensRaw(),st=Math.max(0,Math.min(M.current,J&&J.length-1||0));try{ht.seek(st)}catch{}try{ht.play()}catch{s.play()}jt.impactMedium()}};if(R.useEffect(()=>{},[v]),R.useEffect(()=>{n==null||n(v)},[v,n]),!O)return null;const K=(J=>Math.floor(J.length/2))(O.originalText),V=O.originalText.slice(0,K),G=O.originalText[K]||"",ot=O.originalText.slice(K+1);return I.jsxs("div",{ref:o,className:"absolute inset-0 select-none overflow-hidden touch-none",style:{backgroundColor:r.background},onPointerDown:$,onPointerMove:nt,onPointerUp:q,onPointerCancel:rt,onPointerLeave:rt,children:[!m&&I.jsx("div",{className:"absolute inset-0 z-0 flex items-center justify-center pointer-events-auto",style:{opacity:.18,fontSize:"2.5rem",color:r.primaryText,userSelect:"none"},children:I.jsx("span",{children:u.slice(Math.max(0,l-20),l+20).map(J=>J.originalText).join(" ")})}),I.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundColor:r.background,opacity:.95}}),I.jsx("div",{className:"absolute inset-0 z-10 pointer-events-none",style:{background:`radial-gradient(ellipse 80% 50% at ${et}% 42%, transparent 0%, ${r.background} 100%)`}}),I.jsx("div",{className:"absolute top-[20%] bottom-[20%] w-[2px] z-0 pointer-events-none transition-all duration-200",style:{left:`${et}%`,backgroundColor:H,opacity:v?.6:.15,boxShadow:v?`0 0 30px ${H}80`:"none"}}),I.jsxs("div",{className:"absolute inset-x-0 top-[42%] -translate-y-1/2 flex items-center justify-start overflow-visible z-20",children:[y&&I.jsxs(I.Fragment,{children:[I.jsx("div",{className:"absolute left-0 top-[-50%] bottom-[-50%] w-32 z-30 pointer-events-none",style:{background:`linear-gradient(to right, ${r.background}, transparent)`}}),I.jsx("div",{className:"absolute right-0 top-[-50%] bottom-[-50%] w-32 z-30 pointer-events-none",style:{background:`linear-gradient(to left, ${r.background}, transparent)`}})]}),I.jsx("div",{ref:a,className:"flex items-baseline gap-5 whitespace-nowrap",style:{transform:`translateX(${x}px)`,transition:v?"transform 0.05s linear":"none",opacity:v?.85:1},children:Q.map(({token:J,globalIdx:st})=>{const U=st===l,tt=Math.abs(st-l),at=Math.max(.12,.55-tt*.1);return U?I.jsxs("span",{"data-idx":st,className:"inline-flex items-baseline font-sans font-semibold cursor-pointer transition-opacity hover:opacity-100",style:{fontSize:E},children:[I.jsx("span",{style:{color:r.primaryText},children:V}),I.jsx("span",{style:{color:H,textShadow:v?`0 0 10px ${H}60`:`0 0 20px ${H}40`},children:G}),I.jsx("span",{style:{color:r.primaryText},children:ot}),J.punctuation&&I.jsx("span",{style:{color:r.secondaryText,opacity:.5,marginLeft:"1px"},children:J.punctuation})]},J.id):I.jsx("span",{"data-idx":st,className:"font-sans cursor-pointer transition-opacity hover:opacity-100",style:{fontSize:E,fontWeight:400,color:r.primaryText,opacity:at},children:J.originalText},J.id)})})]})]})},wd=({book:e,currentProgress:t,preciseThresholds:n,onSelectChapter:s,onSelect:r,onClose:i,readSpeed:o})=>{const a=Jt(),l=R.useRef(null),c=R.useMemo(()=>!e.chapters||e.chapters.length===0?[]:e.chapters.map((f,x)=>{const d=n[x]??0;let v=f.title.trim();const g=v.match(/^(?:chapter|part|book|letter|section)\s+(?:[\divxlcdm]+)\s*[:.-]\s+(.+)$/i),w=v.match(/^\d+\.\s+(.+)$/i);g&&g[1]?v=g[1]:w&&w[1]&&(v=w[1]);const k=Math.ceil(f.wordCount/o);return{original:f,index:x,cleanTitle:v,startProgress:d,durationLabel:k<1?"< 1m":`${k}m`}}),[e,o,n]),u=R.useMemo(()=>{let f=0;for(let x=0;x<c.length&&t>=c[x].startProgress-1e-4;x++)f=x;return f},[c,t]);R.useEffect(()=>{if(l.current){const x=Math.max(0,u*64-100);l.current.scrollTo({top:x,behavior:"smooth"})}},[]);const p=f=>{jt.impactMedium(),s?s(f):r&&r(c[f].startProgress),i()},m=R.useRef(Date.now());return I.jsxs("div",{className:"absolute bottom-full mb-4 left-2 right-2 z-50 flex flex-col max-h-[60vh] rounded-3xl overflow-hidden shadow-2xl border backdrop-blur-3xl origin-bottom animate-slideUp",style:{backgroundColor:`${a.dimmer}f5`,borderColor:a.borderColor},children:[I.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b shrink-0",style:{borderColor:a.borderColor},children:[I.jsxs("div",{children:[I.jsx("h3",{className:"text-base font-bold lowercase",style:{color:a.primaryText},children:"chapters"}),I.jsxs("span",{className:"text-[10px] opacity-40",style:{color:a.secondaryText},children:[c.length," ",c.length!==1?"sections":"section"]})]}),I.jsx("button",{onClick:i,className:"w-11 h-11 rounded-full flex items-center justify-center transition-all active:scale-95",style:{backgroundColor:`${a.primaryText}08`,color:a.primaryText},children:I.jsx(ah,{size:20})})]}),I.jsx("div",{ref:l,className:"overflow-y-auto custom-scrollbar px-2 pb-4 pt-1",children:c.map((f,x)=>{const d=x===u;return I.jsxs("button",{onClick:()=>p(f.index),className:`w-full text-left flex items-center gap-3 p-3 rounded-2xl transition-all duration-200 group ${d?"shadow-md":"hover:bg-white/5 opacity-50"}`,style:{backgroundColor:d?a.surface:"transparent"},children:[I.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 transition-all ${d?"bg-white/5":"bg-transparent"}`,style:{color:d?a.accent:a.secondaryText},children:d?I.jsxs("div",{className:"relative",children:[I.jsx("div",{className:"absolute inset-0 bg-current opacity-30 animate-ping rounded-full"}),I.jsx("div",{className:"w-2.5 h-2.5 bg-current rounded-full"})]}):I.jsx("span",{className:"text-xs font-semibold opacity-40 tabular-nums",children:x+1})}),I.jsxs("div",{className:"flex-1 min-w-0",children:[I.jsx("h4",{className:"text-sm font-semibold truncate lowercase",style:{color:a.primaryText},children:f.cleanTitle}),f.cleanTitle!==f.original.title&&I.jsx("span",{className:"text-[10px] opacity-30 truncate block",style:{color:a.primaryText},children:f.original.title})]}),I.jsx("div",{className:"flex items-center gap-1 opacity-40 shrink-0",style:{color:a.primaryText},children:I.jsx("span",{className:"text-[11px] font-medium tabular-nums",children:f.durationLabel})})]},f.original.id)})})]},m.current)},bd=({book:e,onToggleRSVP:t,isRSVPActive:n,isRewinding:s=!1,onSettingsClick:r})=>{const i=Nt.getInstance(),o=At.getInstance(),{settings:a,updateSettings:l}=ze(),c=Jt(),[u,p]=R.useState(!1),[m,f]=R.useState(!1),[x,d]=R.useState(0),[v,g]=R.useState(0),[w,k]=R.useState(!1),P=R.useRef(!1),T=R.useRef(null),N=R.useRef(null),M=R.useRef(null),B=R.useRef(!1),F=R.useRef(null),H=R.useRef(0),et=R.useRef(0),E=R.useRef(!1),O=R.useRef(0),y=R.useRef(0),L=c.accent,Q=R.useMemo(()=>{if(i.chapterTokenOffsets.length>0&&i.totalTokens>0)return i.chapterTokenOffsets.map(at=>at/i.totalTokens);if(!e.chapters||e.chapters.length===0)return[];const U=e.chapters.reduce((at,dt)=>at+dt.wordCount,0);if(U===0)return e.chapters.map((at,dt)=>dt/e.chapters.length);let tt=0;return e.chapters.map(at=>{const dt=tt/U;return tt+=at.wordCount,dt})},[e,i.chapterTokenOffsets,i.totalTokens]),$=R.useCallback(U=>{const tt=ht.getTokensRaw().length||i.totalTokens||1,at=Math.max(1,tt),dt=Math.floor(U*at),mt=at-dt,h=a.rsvpSpeed||250,D=Math.ceil(mt/h);if(D<1)return"< 1m";if(D>=60){const j=Math.floor(D/60),S=D%60;return`${j}h ${S}m`}return`${D}m`},[a.rsvpSpeed,i.totalTokens]),nt=R.useCallback(U=>{if(!e.chapters||e.chapters.length===0)return"";let tt=0;for(let D=Q.length-1;D>=0;D--)if(U>=Q[D]-1e-4){tt=D;break}const at=e.chapters[tt];if(!at)return"";const dt=at.title.trim(),mt=dt.match(/^(?:chapter|part|book|letter|section)\s+(?:[\divxlcdm]+)\s*[:.-]\s+(.+)$/i),h=dt.match(/^\d+\.\s+(.+)$/i);return mt&&mt[1]?mt[1]:h&&h[1]?h[1]:dt},[e.chapters,Q]),q=R.useRef(0),rt=R.useCallback(U=>{const tt=Math.max(0,Math.min(1,U));if(T.current&&(T.current.style.width=`${tt*100}%`),M.current&&(M.current.style.left=`${tt*100}%`,M.current.style.transform="translateX(-50%)"),P.current)return;(Math.abs(tt-q.current)>.005||tt===0||tt===1)&&(q.current=tt,g(tt))},[]);R.useEffect(()=>{const U=()=>{p(o.state===Rt.PLAYING)},tt=S=>{B.current||rt(S)};U();const at=ht.getTokensRaw(),dt=i.isRSVPMode&&at&&at.length>0?0/Math.max(1,at.length):i.currentProgress;q.current=dt,g(dt),rt(dt);const mt=i.subscribe(U),h=o.subscribe(U),D=i.onProgress(tt),j=ht.subscribe(({index:S})=>{if(!B.current&&i.isRSVPMode){const _=ht.getTokensRaw(),A=Math.max(1,_.length||i.totalTokens),W=typeof S=="number"?S/A:i.currentProgress;rt(W)}});return()=>{mt(),h(),D(),j()}},[rt]);const b=U=>{if(U.preventDefault(),U.stopPropagation(),f(!0),B.current=!0,H.current=U.clientY,N.current){const tt=N.current.getBoundingClientRect();et.current=Math.max(0,Math.min(1,(U.clientX-tt.left)/tt.width))}if(E.current=o.state===Rt.PLAYING,E.current)try{ht.pause()}catch{o.pause()}V(U.clientX,U.clientY,!1),U.target.setPointerCapture(U.pointerId)},C=U=>{B.current&&(U.preventDefault(),F.current&&cancelAnimationFrame(F.current),F.current=requestAnimationFrame(()=>{V(U.clientX,U.clientY,!0)}))},K=U=>{if(B.current){if(F.current&&cancelAnimationFrame(F.current),f(!1),B.current=!1,U.target.releasePointerCapture(U.pointerId),N.current){const tt=N.current.getBoundingClientRect(),at=Math.max(0,Math.min(1,(U.clientX-tt.left)/tt.width));G(at)}if(E.current)try{ht.play()}catch{o.play()}}},V=(U,tt,at)=>{if(!N.current)return;const dt=N.current.getBoundingClientRect();let mt=(U-dt.left)/dt.width;if(at){const D=Math.abs(tt-H.current);let j=1;D>200?j=.1:D>100?j=.3:D>50&&(j=.6),j<1&&(mt=et.current+(mt-et.current)*j)}const h=Math.max(0,Math.min(1,mt));if(d(D=>(Q.some(S=>D<S&&h>=S||D>S&&h<=S)&&jt.impactLight(),h)),rt(h),i.isRSVPMode){const D=ht.getTokensRaw().length||i.totalTokens||1,j=Math.max(1,D),S=Math.floor(h*j);try{ht.seek(S)}catch{}}else i.jump(h)},G=U=>{if(i.isRSVPMode){const tt=ht.getTokensRaw().length||i.totalTokens||1,at=Math.max(1,tt),dt=Math.floor(U*at);try{ht.seek(dt)}catch{}}else i.jump(U)},ot=U=>{U.stopPropagation();const tt=Date.now();tt-O.current<300||(O.current=tt,navigator.vibrate&&navigator.vibrate(10),t())},J=U=>{const tt=Date.now();if(tt-y.current<80)return;y.current=tt,jt.impactLight();const at=a.rsvpSpeed||250,dt=Math.max(50,Math.min(2e3,at+U));l({rsvpSpeed:dt,hasCustomSpeed:!0})},st=U=>{if(jt.impactMedium(),i.isRSVPMode){if(U<i.chapterTokenOffsets.length){const tt=i.chapterTokenOffsets[U];try{ht.seek(tt)}catch{}i.jumpToChapter(U)}}else i.jumpToChapter(U)};return I.jsxs("div",{className:"w-full relative pointer-events-auto",children:[w&&I.jsx(wd,{book:e,currentProgress:v,readSpeed:a.rsvpSpeed,preciseThresholds:Q,onSelectChapter:U=>st(U),onClose:()=>{P.current=!1,k(!1)}}),m&&!w&&I.jsx("div",{className:"absolute -top-12 left-0 right-0 flex justify-center pointer-events-none z-50",style:{animation:"fadeIn 300ms cubic-bezier(0.16, 1, 0.3, 1)"},children:I.jsxs("div",{className:"px-4 py-1.5 rounded-full shadow-xl border backdrop-blur-md text-xs font-bold font-variant-numeric tabular-nums flex items-center gap-2",style:{backgroundColor:c.surface,borderColor:c.borderColor,color:c.primaryText},children:[I.jsxs("span",{children:[(x*100).toFixed(0),"%"]}),I.jsx("span",{className:"opacity-30",children:"|"}),I.jsx("span",{className:"lowercase",children:$(x)})]})}),I.jsxs("div",{className:"w-full backdrop-blur-2xl rounded-3xl shadow-2xl border overflow-hidden",style:{backgroundColor:`${c.surface}f5`,borderColor:c.borderColor},children:[I.jsxs("button",{onClick:()=>{jt.impactLight(),!w&&o.state===Rt.PLAYING&&o.pause();const U=!w;P.current=U,k(U)},className:"w-full flex justify-between items-center px-5 pt-2.5 pb-0 text-[10px] font-medium select-none hover:opacity-100 transition-opacity active:scale-[0.99]",style:{color:c.primaryText,opacity:w?.8:.4},children:[I.jsxs("div",{className:"flex items-center gap-1.5 truncate max-w-[70%]",children:[I.jsx(kh,{size:10,className:"opacity-60"}),I.jsx("span",{className:"truncate lowercase",children:nt(v)})]}),I.jsx("span",{className:"tabular-nums opacity-60 text-[9px]",children:$(v)})]}),I.jsx("div",{className:"relative h-4 w-full cursor-pointer group touch-none z-20",onPointerDown:b,onPointerMove:C,onPointerUp:K,onPointerCancel:K,children:I.jsxs("div",{ref:N,className:"absolute inset-x-6 inset-y-0 flex items-center",children:[I.jsxs("div",{className:"w-full h-[1.5px] rounded-full overflow-hidden relative",style:{backgroundColor:c.primaryText+"08"},children:[I.jsx("div",{ref:T,className:"absolute top-0 left-0 bottom-0 h-full will-change-transform rounded-full",style:{width:"0%",backgroundColor:L}}),R.useMemo(()=>Q.map((U,tt)=>I.jsx("div",{className:"absolute top-0 bottom-0 w-[1px] bg-white/10",style:{left:`${U*100}%`}},tt)),[Q])]}),I.jsx("div",{ref:M,className:`absolute top-1/2 w-3.5 h-3.5 -mt-[7px] rounded-full shadow-lg border-2 border-white transition-all duration-200 will-change-transform ${m?"scale-125":"scale-0 group-hover:scale-75"}`,style:{left:"0%",backgroundColor:c.accent,boxShadow:`0 0 10px ${c.accent}33`}})]})}),I.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center px-5 pb-4 pt-0.5",children:[I.jsxs("div",{className:"flex items-center h-11 rounded-xl overflow-hidden border",style:{borderColor:c.borderColor,backgroundColor:`${c.primaryText}05`},children:[I.jsx("button",{onClick:()=>J(-25),className:"w-11 h-full flex items-center justify-center hover:bg-white/5 active:scale-90 transition-all outline-none",style:{color:c.secondaryText},children:I.jsx(xo,{size:16})}),I.jsx("div",{className:"w-px h-5",style:{backgroundColor:c.borderColor}}),I.jsx("div",{className:"px-2 text-center flex items-center justify-center min-w-[44px]",children:I.jsx("span",{className:"font-variant-numeric tabular-nums text-xs font-semibold",style:{color:c.primaryText},children:a.rsvpSpeed})}),I.jsx("div",{className:"w-px h-5",style:{backgroundColor:c.borderColor}}),I.jsx("button",{onClick:()=>J(25),className:"w-11 h-full flex items-center justify-center hover:bg-white/5 active:scale-90 transition-all outline-none",style:{color:c.secondaryText},children:I.jsx(wo,{size:16})})]}),I.jsx("div",{className:"flex items-center justify-center px-4",children:I.jsx("button",{onClick:ot,className:"w-12 h-12 rounded-full flex items-center justify-center shadow-lg relative text-white border border-white/10 hover:scale-105 active:scale-95 transition-all outline-none",style:{backgroundColor:L,boxShadow:`0 6px 24px -4px ${L}66`},children:s?I.jsx(Oh,{size:20,className:"fill-white animate-pulse"}):n&&u?I.jsx(Eh,{size:20,className:"fill-white"}):I.jsx(Rh,{size:20,className:"fill-white ml-0.5"})})}),I.jsxs("div",{className:"flex items-center gap-2",children:[n&&I.jsx("button",{className:"flex items-center justify-center w-11 h-11 rounded-xl border transition-all outline-none active:scale-95",style:{borderColor:a.showGhostPreview?c.accent+"40":c.borderColor,backgroundColor:a.showGhostPreview?`${c.accent}15`:`${c.primaryText}05`,color:a.showGhostPreview?c.accent:c.secondaryText},onClick:U=>{U.stopPropagation(),jt.impactLight(),l({showGhostPreview:!a.showGhostPreview})},title:a.showGhostPreview?"Hide word preview":"Show word preview",children:I.jsx(zh,{size:16,className:a.showGhostPreview?"fill-current":""})}),I.jsxs("button",{className:"flex items-center justify-center h-11 gap-2 rounded-xl border hover:bg-white/5 active:scale-95 transition-all outline-none px-3",style:{borderColor:c.borderColor,backgroundColor:`${c.primaryText}05`},onClick:U=>{U.stopPropagation(),r()},children:[I.jsx(Ae,{size:16,style:{color:c.secondaryText}}),I.jsx("div",{className:"w-px h-4",style:{backgroundColor:c.borderColor}}),I.jsxs("div",{className:"flex items-baseline gap-0.5 opacity-60",children:[I.jsx(Ae,{size:14,style:{color:c.secondaryText}}),I.jsx(Ae,{size:10,style:{color:c.secondaryText}})]})]})]})]})]})]})},Zd=({book:e,onClose:t})=>{const n=Nt.getInstance(),s=At.getInstance(),r=Ct.getInstance().getSettings(),i=Jt(),[o,a]=R.useState(!0),[l,c]=R.useState(!1),[u,p]=R.useState(!1),[m,f]=R.useState(!1),[x,d]=R.useState(0),[v,g]=R.useState(0),[w,k]=R.useState(!1),[P,T]=R.useState(!1),N=R.useRef(!1),M=R.useRef(!1);R.useEffect(()=>{c(n.isRSVPMode);const O=()=>{c(n.isRSVPMode),p(s.state===Rt.PLAYING),d(n.currentProgress)},y=n.subscribe(O),L=s.subscribe(O),Q=ht.subscribe(({index:$,token:nt,isPlaying:q})=>{p(q),typeof $=="number"&&g($);const rt=Math.max(1,n.totalTokens),b=Math.min(1,Math.max(0,$/rt));try{n.jump(b)}catch{}});return O(),()=>{y(),L(),Q()}},[]),R.useEffect(()=>()=>{s.shutdown(n.isRSVPMode),n.isRSVPMode=!1;try{ht.pause()}catch{}},[]),R.useEffect(()=>{const O=()=>{if(!N.current){if(N.current=!0,w||P)B();else if(l){const y=Nt.getInstance(),L=At.getInstance();y.isRSVPMode&&(L.pause(),L.shutdown(!0),y.isRSVPMode=!1,y.notify(),c(!1),a(!0))}N.current=!1}};return window.addEventListener("popstate",O),()=>window.removeEventListener("popstate",O)},[w,P,l]),R.useEffect(()=>{let O;return o&&l&&(O=setTimeout(()=>a(!1),2500)),()=>clearTimeout(O)},[o,l]),R.useEffect(()=>{w&&s.state===Rt.PLAYING&&(s.pause(),ht.pause())},[w]);const B=()=>{T(!0),setTimeout(()=>{k(!1),T(!1)},400)},F=()=>{var L;let O=((L=n.currentBook)==null?void 0:L.lastTokenIndex)??(e.lastTokenIndex||0);n.isRSVPMode&&(O=v,n.saveProgress(O));const y=n.currentProgress;s.shutdown(n.isRSVPMode),n.isRSVPMode=!1,t(e.id,O,y)},H=async(O,y,L)=>{var $;if(M.current)return;if(l&&O===void 0&&y===void 0&&L===void 0){s.state===Rt.PLAYING?s.pause(!0):s.play();return}const Q=O??!n.isRSVPMode;if(!(Q===n.isRSVPMode&&y===void 0&&L===void 0)){M.current=!0;try{if(Q){const nt=n.contentStorage.string,q={offset:y??n.userSelectionOffset??void 0,index:L??(y===void 0?(($=n.currentBook)==null?void 0:$.lastTokenIndex)??void 0:void 0),progress:y===void 0&&L===void 0?n.currentProgress:void 0};try{await ht.prepare(nt,r.rsvpSpeed??350,r.rsvpChunkSize??1)}catch{await s.prepare(nt,q)}n.isRSVPMode=!0,n.notify(),N.current||window.history.pushState({rsvpMode:!0},"",window.location.href);try{ht.play()}catch{s.play()}a(!1)}else{try{ht.pause()}catch{}s.pause();const nt=v;if(n.isRSVPMode=!1,n.saveProgress(nt,!0),n.totalTokens>0){const q=nt/n.totalTokens;n.jump(q)}a(!0)}}catch(nt){console.error("Toggle failed",nt),n.isRSVPMode=!1,n.notify()}finally{M.current=!1}}},et=()=>{s.state===Rt.PLAYING?s.pause(!0):s.play()},E=()=>{l&&H(!1)};return I.jsxs("div",{className:"fixed inset-0 z-50 w-full h-[100dvh] overflow-hidden m-0 p-0 animate-fadeIn",style:{backgroundColor:i.background},children:[I.jsx("div",{className:"absolute inset-0 z-10 w-full h-full will-change-transform transition-opacity duration-300",style:{opacity:l?u?0:.4:1,pointerEvents:l?"none":"auto"},children:I.jsx(vd,{book:e,onToggleChrome:()=>a(O=>!O),onRequestRSVP:(O,y)=>H(!0,O,y),isActive:!l})}),I.jsxs("div",{className:`absolute inset-0 z-20 transition-all duration-300 will-change-[transform,opacity] ${l?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{pointerEvents:l?"auto":"none",transitionTimingFunction:"cubic-bezier(0.2, 0, 0, 1)"},children:[I.jsx(xd,{onTap:et,onLongPressExit:E,onRewindStateChange:f}),I.jsx("style",{children:`
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
      `})]}),I.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 w-[90%] max-w-[450px] z-50 pointer-events-auto",style:{bottom:"calc(2rem + env(safe-area-inset-bottom))"},children:I.jsx(bd,{book:e,onToggleRSVP:O=>H(void 0,O),isRSVPActive:l,isRewinding:m,onSettingsClick:()=>{N.current||window.history.pushState({modal:"settings"},"",window.location.href),k(!0)}})}),I.jsx("div",{className:`absolute top-0 left-0 right-0 z-[60] transition-transform duration-400 pointer-events-none ${o||l&&!u?"translate-y-0":"-translate-y-full"}`,style:{transitionTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)"},children:I.jsxs("div",{className:"backdrop-blur-2xl border-b pt-safe-top py-4 px-5 flex items-center justify-between pointer-events-auto",style:{backgroundColor:i.dimmer,borderColor:i.borderColor},children:[I.jsx("button",{onClick:l?E:F,className:"w-11 h-11 -ml-1 rounded-full flex items-center justify-center transition-all active:scale-95",style:{backgroundColor:`${i.primaryText}08`,color:i.primaryText},children:I.jsx(ch,{size:20})}),l&&I.jsx("span",{className:"text-xs font-medium",style:{color:i.secondaryText},children:"Tap to exit RSVP"})]})}),(w||P)&&I.jsxs(I.Fragment,{children:[I.jsx("div",{className:"fixed inset-0 z-[100]",style:{backgroundColor:"rgba(0,0,0,0.5)",backdropFilter:"blur(2px)",animation:P?"fadeOut 0.4s ease-out":"fadeIn 0.6s ease-out"},onClick:B}),I.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-[101] rounded-t-[32px] h-[70vh] shadow-2xl overflow-hidden",style:{backgroundColor:i.background,animation:P?"slideDown 0.5s cubic-bezier(0.7, 0, 0.84, 0)":"slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1)"},children:I.jsx(nd,{onClose:B})})]})]})};export{_d as A,Pd as B,Md as C,Nd as D,nd as E,Dd as F,Te as G,Fd as H,me as I,Ud as J,qd as K,zd as L,zr as M,Nt as N,ge as O,Rh as P,Zd as Q,Ao as R,zh as S,Gd as T,ht as U,ie as V,Hh as X,Sd as a,ze as b,R as c,Ed as d,$d as e,Bd as f,Zr as g,Vd as h,Rd as i,I as j,jt as k,Cd as l,Uu as m,Td as n,Wd as o,Od as p,Ld as q,Eo as r,Kd as s,ah as t,Jt as u,Ad as v,Hd as w,jd as x,wo as y,Id as z};
