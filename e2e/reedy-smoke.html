<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reedy smoke — Flow (test)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; }
        pre { background: #f5f5f5; padding: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>Reedy smoke (vendored)</h1>
    <p id="reedy-status">initializing…</p>
    <pre id="reedy-result" style="display:none"></pre>
    <div id="reedy-ready" style="display:none">ready</div>
    <div>Tokens parsed: <span id="reedy-token-count">0</span></div>

    <textarea id="test-text">Hello world! This is a test of the Reedy parser. How does it handle punctuation, numbers like 123, and complex sentences?</textarea>
    <button onclick="parseWithReedy()">Parse with Reedy</button>

    <script src="./packages/reedy-core/js/content/reedy.js"></script>
    <script src="./packages/reedy-core/js/content/parser.js"></script>
    <script src="./packages/reedy-core/js/content/sequencer.js"></script>

    <script>
        function renderResult(obj) {
            document.getElementById('reedy-result').textContent = JSON.stringify(obj, null, 2);
            document.getElementById('reedy-result').style.display = 'block';
            document.getElementById('reedy-token-count').textContent = String((obj.tokens||[]).length);
            document.getElementById('reedy-status').textContent = 'ready';
            document.getElementById('reedy-ready').style.display = 'block';
        }

        function parseWithReedy() {
            const text = document.getElementById('test-text').value;
            if (!window.reedy || !window.reedy.simpleParser || !window.reedy.Sequencer) {
                renderResult({ error: 'reedy-not-available' });
                return;
            }

            try {
                const parser = window.reedy.simpleParser(text);
                const seq = new window.reedy.Sequencer(text, parser);
                const tokens = [];
                while (seq.toNextToken()) {
                    tokens.push(seq.getToken().toString());
                }
                renderResult({ tokens, success: true });
            } catch (e) {
                renderResult({ error: String(e) });
            }
        }

        // Auto-test on load
        window.addEventListener('load', function() {
            if (window.reedy && window.reedy.simpleParser && window.reedy.Sequencer) {
                parseWithReedy();
            } else {
                setTimeout(() => {
                    if (window.reedy && window.reedy.simpleParser && window.reedy.Sequencer) {
                        parseWithReedy();
                    } else {
                        renderResult({ error: 'reedy-load-timeout' });
                    }
                }, 1000);
            }
        });
    </script>
</body>
</html>
